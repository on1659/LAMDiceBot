# 경마 게임 개발 가이드

경마 게임의 현재 구현 상태와 개발 계획을 정리한 문서입니다.

## 현재 구현 상태

### 완료된 부분

- **클라이언트**: `horse-race-multiplayer.html` 구현 완료
  - 말 선택 UI
  - 경주 트랙 애니메이션
  - 순위 팝업
  - 채팅/주문/순위 시스템 통합

- **서버**: `server.js`에 경마 게임 핸들러 구현 완료
  - `startHorseRace`: 경마 시작
  - `selectHorse`: 말 선택 처리
  - `calculateHorseRaceResult`: 경주 결과 계산
  - `getWinnersByRule`: 룰에 따른 당첨자 결정
  - `endHorseRace`: 경마 종료

- **메인페이지**: `dice-game-multiplayer.html`에서 경마 게임 선택 가능
  - 게임 타입 선택 UI에 경마 옵션 추가
  - 경마 페이지로 이동하는 분기 구현

## 완벽하지 않은 부분 (알려진 이슈)

### 1. 게임 시작 이슈 (중요)
- **문제**: 두 번째 플레이어 입장 시 말 선택 UI가 표시되지 않음
- **증상**: 
  - 방 생성 시점(플레이어 1명)에만 `horseSelectionReady` 전송
  - 두 번째 플레이어 입장 후 재전송되지 않아 말 선택 불가
  - 결과적으로 시작 버튼이 활성화되지 않음
- **상태**: 부분 수정됨 (완전히 해결되지 않음)

### 2. 방 생성/입장 흐름
- **문제**: 메인페이지에서 방 타입 선택 후 생성 즉시 입장하는 흐름이 완전히 구현되지 않음
- **요구사항**: 룰렛 입장 흐름 참고하여 동일하게 구현 필요
- **현재**: 경마 페이지로 이동은 되지만, 흐름이 룰렛과 완전히 일치하지 않음

### 3. 루트 경로 접근
- **문제**: `localhost:3000` 루트에서 경마 게임 접근 불가
- **현재**: 직접 URL 입력 필요 (`/horse-race-multiplayer.html`)
- **향후 개선**: 루트 경로에서 게임 타입 선택 페이지 제공

### 4. 애니메이션 동기화
- **가능성**: 서버와 클라이언트 간 애니메이션 타이밍 이슈 가능성
- **상태**: 기본 구현은 완료되었으나 완전히 테스트되지 않음

### 5. 재경주 로직
- **상태**: 구현은 되어 있으나 완전히 테스트되지 않음
- **기능**: 당첨자가 2명 이상일 경우 재경주 진행

## 개발 계획 (초기 계획 요약)

### 기본 구조
- 주사위/룰렛 게임과 동일한 구조로 구현
- 준비/채팅/주문/순위 시스템 유지
- 게임 룰만 경마 방식으로 변경

### 게임 룰
- **말 수**: 4~6마리 랜덤 (서버에서 결정)
- **베팅 방식**: 1인 1말 선택 (포인트 없음)
- **경주 진행**: 자동 랜덤 (서버에서 순위 결정 후 애니메이션 재생)
- **최소 인원**: 2명 이상
- **게임 모드**: 'first' (1등 찾기) 또는 'last' (꼴등 찾기)

### 게임 플로우
1. 참가자들이 말 선택
2. 호스트가 "경마 시작" 버튼 클릭
3. 서버에서 말 수 결정 (4~6마리)
4. 각 참가자가 말 선택 (베팅)
5. 모든 참가자가 선택 완료 시 경주 시작
6. 서버에서 순위 결정 (랜덤)
7. 클라이언트에서 애니메이션 재생
8. 모든 말이 도착하면 순위 팝업 표시

## 참고 파일

- `roulette-game-multiplayer.html`: UI 구조 참고
- `dice-game-multiplayer.html`: 순위 시스템 참고
- `server.js`: 룰렛 게임 핸들러 참고

## 리소스 스펙

자세한 리소스 스펙은 `docs/RESOURCES.md` 참고:
- 말 애니메이션 스프라이트 (8프레임)
- 경기장 트랙 배경
- UI 컴포넌트

## 향후 작업

1. 게임 시작 이슈 완전 해결
2. 방 생성/입장 흐름 룰렛과 동일하게 구현
3. 루트 경로 접근 개선
4. 애니메이션 동기화 테스트 및 개선
5. 재경주 로직 완전 테스트
