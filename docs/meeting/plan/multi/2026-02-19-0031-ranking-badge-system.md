# LAMDiceBot 팀 회의록

**일시**: 2026-02-19 00:31
**주제**: 게임별 랭킹 배지 시스템 — 채팅 닉네임에 🥇🥈🥉 표시
**참석자**: 기획자(A), 개발자(B), QA/UX(C)
**회의 방식**: 3인 멀티에이전트 독립 분석 → 교차 검토 → 합의 도출

---

## 1. 현황 요약

### 사용자 요청
- 각 게임별 랭킹 1~3등에게 채팅 시 닉네임 앞에 금🥇/은🥈/동🥉 배지 표시
- 표시 순서: **(랭킹) (호스트) (플랫폼) (이름)**
- 비공개 서버에서만 지원 (자유서버 미지원)
- 해당 게임 방에서 해당 게임 랭킹 기준 (주사위 방→주사위 랭킹)

### 기존 시스템
- **랭킹 시스템**: 구현 완료 (`db/ranking.js`, `getMyRank()` 함수, DENSE_RANK 사용)
- **채팅 닉네임**: `buildUserNameText()` 함수로 표시 (👑호스트 + 💻디바이스 + 이름)
- **서버 구분**: `room.isPrivateServer` 플래그 (password_hash 유무)
- **게임 타입**: `room.gameType` ('dice', 'roulette', 'horse-race', 'crane-game')

---

## 2. 독립 분석 결과

### 2-1. 기획자 (A) — 전략 + 사용자 관점

#### 제안 1: 게임별 스페셜리스트 배지 시스템 (우선순위 **상**)
- **내용**: 게임별 1-3등 배지 (🎲🥇/🏇🥇/🎰🥇) + 종합 랭킹 배지 (💎👑)
- **전략적 의의**: 게임 다양성 증가, 커뮤니티 역할 분화, 비공개 서버 차별화
- **사용자 가치**: 한 게임 집중해도 인정, 최종 목표 제시 (전설 등급)

#### 제안 2: 동적 배지 시스템 (우선순위 **중**)
- **내용**: 게임 종료 시 배지 실시간 업데이트 + "🎉 순위 변동" 시스템 메시지
- **전략적 의의**: 실시간 경쟁 시각화, 재접속 동기 강화
- **사용자 가치**: "역전 가능" 인식 → 지속 플레이 유도

#### 제안 3: 배지 히스토리 & 갤러리 (우선순위 **하**)
- **내용**: DB에 badge_history 테이블, 최초 금메달 획득일 기록
- **전략적 의의**: 성취 아카이브, 소셜 공유 콘텐츠
- **사용자 가치**: 과거 영광 회상, 친구 자랑 콘텐츠

#### 제안 4: 배지 인센티브 시스템 (우선순위 **하**)
- **내용**: 배지 보유자 특전 (특수 이모지, 닉네임 색상)
- **전략적 의의**: 실질적 보상, 프리미엄 서버 홍보
- **리스크**: 공정성 우려, Pay-to-Win 오해

#### 제안 5: 배지 표시 옵션 & 접근성 (우선순위 **중**)
- **내용**: ON/OFF 설정, 색맹 모드
- **전략적 의의**: 포용성, 캐주얼 유저 배려
- **사용자 가치**: 설정 자유도로 만족도 향상

---

### 2-2. 개발자 (B) — 기술 + 구현 관점

#### 제안 1: Socket 이벤트 기반 전달 (난이도 **중**, **추천**)
- **구현**: 방 입장 시 `getTop3Badges(serverId)` 조회 → 소켓으로 배지 맵 전송 → 클라이언트 캐싱
- **영향 파일**: `db/ranking.js` (신규 함수), `socket/rooms.js` (joinRoom), `chat-shared.js` (배지 표시)
- **장점**: 성능/복잡도 균형 최적, 방 입장 1회만 DB 조회, 확장 가능
- **단점**: 방 인원 많으면 초기 조회 시간 증가 (배치 쿼리로 완화)

#### 제안 2: 인메모리 랭킹 캐시 (난이도 **상**)
- **구현**: 서버 메모리에 60초 주기 전체 랭킹 캐시
- **장점**: 방 입장 속도 극대화 (DB 쿼리 0회)
- **단점**: 최대 60초 지연, 캐시 무효화 복잡, 멀티서버 동기화 문제

#### 제안 3: 채팅 메시지에 랭킹 포함 (난이도 **하**)
- **구현**: 매 채팅마다 `getMyRank()` 조회 → `chatMessage.rankBadge` 추가
- **장점**: 구현 가장 간단
- **단점**: **매 채팅마다 DB 쿼리** (성능 치명적), Rate limit 필요

#### 제안 4: 클라이언트 사이드 조회 (난이도 **중**)
- **구현**: 각 클라이언트가 `/api/ranking/{serverId}` API 호출
- **장점**: 서버 로직 수정 불필요
- **단점**: 방 20명 = 20 요청 (서버 부하 20배), 캐시 불일치

#### 제안 5: 하이브리드 (난이도 **중~상**)
- **구현**: Socket 전달 + 게임 종료 시 갱신
- **장점**: 실시간 갱신, 성능 최적
- **단점**: 구현 복잡도 증가, 게임 핸들러 전부 수정 필요

**권장 아키텍처**:
```
joinRoom → getTop3Badges(serverId) → socket.emit('rankingBadges')
→ client: _rankingBadges 저장 → buildUserNameText()에서 배지 표시
```

---

### 2-3. QA/UX (C) — 품질 + UX 관점

#### 제안 1: 성능 최적화 + 캐싱 (리스크 **중**)
- **테스트**: 채팅 100건 연속 발송 시 응답 시간, Network 탭 요청 빈도
- **UX 개선**: 채팅 지연 없음, 배지 즉시 표시
- **리스크**: 캐시 동기화 이슈, 메모리 증가

#### 제안 2: 배지 미표시 시 시각적 간격 유지 (리스크 **하**)
- **테스트**: 모바일/PC에서 배지 유무에 따른 정렬
- **UX 개선**: 투명 패딩 or 플렉스 정렬로 일관된 시작점
- **리스크**: 모바일 좁은 화면에서 말줄임

#### 제안 3: 이모지 렌더링 일관성 (리스크 **상**)
- **테스트**: OS별(Windows/macOS/iOS/Android), 브라우저별(Chrome/Safari/Edge) 스크린샷 비교
- **UX 개선**: SVG 아이콘 교체 or 텍스트 배지 (`<span class="badge gold">1위</span>`)
- **리스크**: 구형 Android 🥇 깨짐 (~5% 사용자), SVG 번들 사이즈 증가

#### 제안 4: 자유서버 ↔ 비공개서버 전환 시 배지 동기화 (리스크 **중**)
- **테스트**: 서버 이동 시나리오, race condition (이동 중 채팅)
- **UX 개선**: 서버 전환 시 배지 즉시 사라지거나 나타남, 히스토리 변경 안 함
- **리스크**: 1-2초 불일치, 채팅 히스토리와 현재 배지 다름

#### 제안 5: 접근성(A11y) + 스크린 리더 (리스크 **하**)
- **테스트**: NVDA/VoiceOver/TalkBack에서 "1위, 호스트, 홍길동" 순으로 읽기
- **UX 개선**: ARIA 속성 추가 (`<span aria-label="1위" role="img">🥇</span>`)
- **리스크**: HTML 마크업 변경, 테스트 비용 증가

---

## 3. 교차 검토 결과

### 3-1. 기획자 검토 (A가 B, C 평가)

| 제안 | 평가 | 근거 |
|------|------|------|
| 개발자 #1 (Socket 전달) | ✅ 채택 | 기존 인프라 활용, 난이도 중/효과 최대, ROI 상 |
| 개발자 #2 (캐시) | ⏸️ 보류 | 60초 지연 = UX 훼손, 대규모 환경에서만 검토 |
| 개발자 #3 (채팅 포함) | ❌ 기각 | 매 채팅마다 DB 조회 = 서버 부하 급증 |
| 개발자 #4 (클라이언트) | ❌ 기각 | 중복 요청, 동기화 어려움 |
| 개발자 #5 (하이브리드) | ⏸️ 보류 | Phase 1.5에서 재검토 (실시간 갱신 추가 시) |
| QA #1 (성능) | ✅ 채택 | 개발자 #1에 포함됨 |
| QA #2 (CSS 간격) | ✅ 채택 | 난이도 최하, 효과 체감 가능 |
| QA #3 (SVG 이모지) | ⏸️ 보류 | Phase 2, 렌더링 불만 발생 시 |
| QA #4 (동기화) | ✅ 채택 | 필수 구현 (버그 예방) |
| QA #5 (A11y) | ⏸️ 보류 | Phase 3, 글로벌 확장 시 |

---

### 3-2. 개발자 검토 (B가 A, C 평가)

| 제안 | 평가 | 근거 |
|------|------|------|
| 기획자 #1 (스페셜리스트) | ✅ 채택 | 기존 `getMyRank()` 활용, 파일 3개 150줄, 리스크 낮음 |
| 기획자 #2 (동적 배지) | ⚠️ 조건부 채택 | #1 구현 후 순차 적용, 게임 핸들러 통합 어려움 |
| 기획자 #3 (히스토리) | ⏸️ 보류 | DB 마이그레이션 필요, 구현 비용 높음 |
| 기획자 #4 (인센티브) | ⏸️ 보류 | 기획 불명확, 권한 시스템 없음 |
| 기획자 #5 (옵션) | ⚠️ 부분 채택 | ON/OFF만, 색맹 모드는 SVG 필요 |
| QA #1 (캐싱) | ✅ 채택 | 필수, `gameState.userBadges` Map 추가 |
| QA #2 (CSS) | ✅ 채택 | `display: inline-flex` + 고정폭 영역 |
| QA #3 (이모지) | ⏸️ 보류 | 비용 대비 효과 낮음, 네이티브 이모지 사용 |
| QA #4 (동기화) | ✅ 채택 | 방 입장 시 `serverId` 변경 감지로 자동 해결 |
| QA #5 (A11y) | ⚠️ 부분 채택 | 여유 있으면 추가, 현재 우선순위 낮음 |

---

### 3-3. QA/UX 검토 (C가 A, B 평가)

| 제안 | 평가 | 근거 |
|------|------|------|
| 기획자 #1 (스페셜리스트) | ⚠️ 조건부 채택 | 배지 1개만 표시 (가독성), 🎲🥇🏇🥇 연속 시 모바일 판별 어려움 |
| 기획자 #2 (동적 배지) | ⏸️ 보류 | 시스템 메시지 → 조용한 업데이트로 변경 후 재검토 |
| 기획자 #3 (히스토리) | ❌ 기각 | 배지 표시도 안 된 상태에서 우선순위 낮음 |
| 기획자 #4 (인센티브) | ❌ 기각 | 공정성 최우선, 배지는 시각적 영예로만 |
| 기획자 #5 (옵션) | ⚠️ 조건부 채택 | ON/OFF 우선, 색맹 모드는 피드백 후 |
| 개발자 #1 (Socket) | ✅ 강력 추천 | 성능/단순성 균형 최우수 |
| 개발자 #2 (캐시) | ❌ 기각 | 60초 지연 = 즉각 피드백 훼손 |
| 개발자 #3 (채팅 포함) | ❌ 기각 | 채팅 지연, 불필요한 중복 조회 |
| 개발자 #4 (클라이언트) | ❌ 기각 | 초기 로딩 증가, 동기화 어려움 |
| 개발자 #5 (하이브리드) | ⚠️ 조건부 채택 | Socket으로 시작 → 성능 문제 시 전환 |

---

## 4. 합의 도출

### 채택 항목 (Phase 1 MVP)

| 우선순위 | 기능 | 판정 | 기획 | 개발 | QA/UX | 근거 |
|---------|------|------|------|------|-------|------|
| 1 | 게임별 1-3등 배지 (🥇🥈🥉) | **채택** | ✅ 상 | ✅ 추천 | ✅ 필수 | 사용자 요청 100% 일치, 커뮤니티 활성화 |
| 2 | Socket 이벤트 기반 전달 | **채택** | ✅ 지원 | ✅ 최적 | ✅ 성능 | 방 입장 1회 DB 조회, 캐싱 자동화 |
| 3 | 성능 캐싱 (`gameState.userBadges`) | **채택** | ✅ 암묵 | ✅ 필수 | ✅ 치명적 | 매 채팅마다 DB 조회 방지 |
| 4 | CSS 시각적 간격 유지 | **채택** | - | - | ✅ 쉬움 | 배지 유무에 따른 정렬 일관성 |
| 5 | 비공개서버 전용 필터링 | **채택** | ✅ 필수 | ✅ 쉬움 | ✅ 필수 | `room.isPrivateServer` 체크 |
| 6 | 배지 ON/OFF 토글 | **채택** | ✅ 중 | ✅ 간단 | ✅ 선택권 | localStorage 기반, 사용자 자유도 |

### 보류 항목 (Phase 2+)

| 기능 | 이유 | 재검토 시기 |
|------|------|------------|
| 실시간 배지 갱신 (게임 종료 시) | 구현 복잡도 중~상, 채팅창 혼잡 우려 | Phase 1.5 (사용자 반응 확인 후) |
| 배지 히스토리 DB 테이블 | MVP 범위 초과, 구현 비용 높음 | Phase 3 (장기 플레이어 증가 시) |
| SVG 배지 아이콘 | 비용 대비 효과 낮음 | Phase 2 (이모지 렌더링 불만 발생 시) |
| 색맹 모드 | 실사용자 수요 불명확 | Phase 2 (피드백 기반) |
| 인메모리 60초 캐시 | UX 지연 치명적 | Phase 3 (대규모 환경에서만) |

### 기각 항목

| 기능 | 기각 사유 |
|------|----------|
| 배지 인센티브 (특전) | 게임 공정성 우려, Pay-to-Win 오해 가능성 |
| 매 채팅마다 DB 조회 | 서버 부하 급증, 채팅 딜레이 발생 |
| 클라이언트 사이드 API 조회 | 중복 요청 (N배), 동기화 어려움 |

### 의견 충돌 사항

**없음** — 3인 전원 Socket 이벤트 방식 + MVP 범위에 합의

---

## 5. 다음 단계 (Action Items)

> 구현 상세: [`2026-02-19-0031-ranking-badge-system-impl.md`](../impl/2026-02-19-0031-ranking-badge-system-impl.md)

### Phase 1: MVP 구현 (예상 4-6시간)

- [x] **Step 1**: `db/ranking.js`에 `getTop3Badges(serverId)` 함수 추가 (배치 쿼리, DENSE_RANK, ~80줄)
- [x] **Step 2**: `socket/rooms.js` joinRoom 핸들러에서 배지 맵 소켓 전송 (~30줄)
- [x] **Step 3**: `chat-shared.js`에 배지 상태 관리 + `buildUserNameText()` 수정 (~50줄)
- [x] **Step 4**: CSS 시각적 간격 추가 (`theme.css` or inline, ~15줄)
- [x] **Step 5**: 배지 ON/OFF 토글 설정 (localStorage, ~30줄)
- [x] **Step 6**: 비공개서버 필터링 확인 (~15줄)

### Phase 1 검증 (예상 1-2시간)

- [ ] 모바일 320px 레이아웃 테스트 (badge + host + device + name)
- [ ] 배지 우선순위 테스트 (종합 vs 게임별 충돌)
- [ ] 동기화 테스트 (updateUsers 이벤트로 전체 클라이언트 일치)
- [ ] 성능 테스트 (20명 방 입장 < 500ms)

### Phase 1.5 (선택, 사용자 반응 확인 후)

- [ ] 게임 종료 시 배지 실시간 갱신 (각 게임 핸들러 수정)
- [ ] 조용한 업데이트 (시스템 메시지 없이 닉네임만 변경)

---

## 6. 핵심 파일 및 예상 작업량

| 파일 | 변경 내용 | 줄 수 | 우선순위 |
|------|----------|-------|---------|
| `db/ranking.js` | `getTop3Badges()` 신규 함수 | ~80 | P0 |
| `socket/rooms.js` | joinRoom 배지 전송 로직 | ~30 | P0 |
| `chat-shared.js` | 배지 상태 관리 + 표시 | ~50 | P0 |
| `css/theme.css` | 배지 간격 CSS | ~15 | P1 |

**총 예상 작업량**: 220줄, 4-6시간 (테스트 포함)

---

## 7. 성공 지표

- **사용자 참여도**: 게임 참여 횟수 +15% 증가 (배지 동기 효과)
- **비공개 서버 차별화**: 유료 전환율 측정 (프리미엄 경험)
- **성능**: 채팅 메시지 표시 < 200ms (체감 지연 없음)
- **만족도**: 사용자 피드백 긍정 70% 이상

---

## 8. 리스크 및 완화 방안

| 리스크 | 영향 | 완화 방안 |
|--------|------|----------|
| 배지 이모지 OS별 렌더링 차이 | 중간 | 네이티브 이모지 사용, Phase 2에서 SVG 검토 |
| DB 조회 느림 (방 입장 시) | 중간 | LIMIT 3 + wins 컬럼 인덱스 최적화 |
| 모바일 레이아웃 깨짐 | 높음 | 고정폭 배지 영역 + 말줄임표 |
| 배지 캐시 불일치 (게임 종료 후) | 낮음 | Phase 1.5에서 실시간 갱신 추가 |

---

## 9. 참고자료

- 기존 랭킹 시스템: `db/ranking.js` (2026-02-11 구현 완료)
- 채팅 모듈: `chat-shared.js` (이모지 반응, 핀 메시지, 멘션 기능)
- 서버 관리: `socket/rooms.js` (방 생명주기, 서버 타입 구분)

---

**다음 회의 주제 제안**:
- Phase 1.5: 실시간 배지 갱신 UX 개선 (게임 종료 시 조용한 업데이트)
- Phase 2: 배지 히스토리 & 성취 시스템 (장기 플레이어 유지)

**구현 추천 모델**: Sonnet 4.5 (플랜 구체적, 파일/함수/위치 명시, 코드 작성 위주)
