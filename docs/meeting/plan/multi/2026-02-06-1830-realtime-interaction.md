# LAMDiceBot 팀 회의록

**일시**: 2026-02-06
**주제**: 경마게임 실시간 인터랙션 요소 및 서버-클라이언트 시뮬레이션 동기화
**참석자**: 기획자(A), 개발자(B), QA/UX(C)
**회의 방식**: 3인 멀티에이전트 독립 분석 → 교차 검토 → 합의 도출

---

## 1. 현황 요약

### 현재 경마 게임 아키텍처
- **결정적(Deterministic) 시뮬레이션**: 서버가 경주 시작 시 모든 결과를 미리 계산
- **calculateHorseRaceResult()**: 기믹, 날씨, 슬로우모션 반영한 순위 확정
- **클라이언트**: 서버에서 받은 데이터를 기반으로 동일한 애니메이션 재생
- **기존 시스템**: 날씨 시스템, 기믹(가속/감속), 슬로우모션 구현 완료

### 핵심 질문
1. 실시간 인터랙션 종류 (방해, 응원, 아이템 등)
2. 인터랙션이 결과에 영향을 줄 수 있는 구조 (예: 70% 진행 전까지)
3. 서버-클라이언트 시뮬레이션 동기화 방법

---

## 2. 독립 분석 결과

### 2-1. 기획자 (A)

| 순위 | 기능명 | 전략적 의의 | 사용자 가치 | 우선순위 |
|------|--------|-------------|-------------|----------|
| 1 | **응원 파도 (Cheer Wave)** | 참여형 관전, 바이럴 요소 | 시각적 응원 이펙트, 결과 무영향 | 상 |
| 2 | **하늘의 심판 (Weather Vote)** | 기존 날씨 시스템 활용, 전략 깊이 | 참가자 날씨 투표, 탈것별 보정값 공개 | 상 |
| 3 | **막판 찬스 (Last Chance Bet)** | 몰입도 극대화, 심리적 긴장감 | 50% 진행 전까지 베팅 변경 가능 | 중 |
| 4 | **운명의 부스터 (Destiny Booster)** | 역전 가능성, 차별화된 게임성 | 가속/방해/행운 아이템, 70% 이전까지만 | 중 |
| 5 | **관중 예측 (Crowd Prediction)** | 비참가자 참여 유도 | 관전자 예측 투표, 결과 무영향 | 하 |

**핵심 원칙**: 공정성 유지 + 참여도 향상 균형

---

### 2-2. 개발자 (B)

| 순위 | 기능명 | 구현 방법 | 영향 파일 | 난이도 |
|------|--------|-----------|-----------|--------|
| 1 | **Progressive Determinism** | 0-70% 실시간 시뮬, 70% 이후 결정적 | socket/horse.js, js/horse-race.js | 상 |
| 2 | **Sabotage Touch** | 클릭→서버검증→브로드캐스트, 쿨다운 3초, 5회 제한 | socket/horse.js, js/horse-race.js | 중 |
| 3 | **Delta Sync** | 50ms마다 위치 업데이트, 100ms 지연 렌더링 | socket/horse.js, js/horse-race.js | 상 |
| 4 | **Fair Interaction Pool** | 동일 자원 부여 (방해 3회, 부스트 1회, 방어 1회) | socket/horse.js, config/horse/race.json | 중 |
| 5 | **Live Prediction** | 관전자 0-50% 구간 예측 베팅, 조기 예측 높은 배율 | socket/horse.js (신규 핸들러) | 하 |

**서버-클라이언트 동기화 핵심 기술**:
- 권위 서버 (서버가 모든 게임 상태의 "진실")
- 클라이언트 보간 (100ms 지연 렌더링으로 부드러운 시각화)
- 레이턴시 보상 (RTT 절반만큼 위치 예측)

---

### 2-3. QA/UX (C)

| 순위 | 기능명 | 테스트 방법 | UX 개선점 | 리스크 |
|------|--------|-------------|-----------|--------|
| 1 | **터치 피드백 강화** | FPS 모니터링, 햅틱 작동 확인 | 바운스 애니메이션, 선택 불가 상태 명확화 | 하 |
| 2 | **공정성 시드 공개** | 동일 시드 100회 재현성 테스트 | 경주 해시 공개, 검증 도구 | 중 |
| 3 | **모바일 제스처 컨트롤** | 스와이프 인식률 90%+, 44px 터치 타겟 | 스와이프 카메라, 더블탭 추적, 핀치 줌 | 중 |
| 4 | **결과 무결성 자동화 테스트** | Jest 1000회 일관성, Playwright E2E | 다중 클라이언트 동기화 검증 | 하 |
| 5 | **응원 인터랙션** | 동기화 지연 200ms 이내, 스팸 방지 | 이모지 응원, 초당 2회 제한 | 중 |

---

## 3. 교차 검토 결과

### 3-1. 기획자(A) 검토 (B, C 제안 평가)

**B 개발자 제안 평가**:
| 제안 | 비즈니스 가치 | ROI | 평가 |
|------|--------------|-----|------|
| Sabotage Touch | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | **강력 추천** - PvP 상호작용으로 engagement 극대화 |
| Live Prediction | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | **강력 추천** - 비즈니스 확장성 최고, 수익화 경로 |
| Fair Interaction Pool | ⭐⭐⭐ | ⭐⭐⭐ | 추천 - 공정성 인식 강화 |
| Delta Sync | ⭐⭐⭐ | ⭐⭐ | 보류 - 기술 난도 대비 체감 개선 미미 |
| Progressive Determinism | ⭐⭐⭐⭐ | ⭐⭐⭐ | 추천 - 핵심 가치 제공, 기술 복잡도 높음 |

**C QA/UX 제안 평가**:
| 제안 | 비즈니스 가치 | ROI | 평가 |
|------|--------------|-----|------|
| 터치 피드백 강화 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | **최우선** - 즉시 체감, 사용자 만족도 상승 |
| 결과 무결성 자동화 테스트 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | **강력 추천** - 버그=사용자이탈 방지 |
| 공정성 시드 공개 | ⭐⭐⭐ | ⭐⭐⭐ | 추천 - 중장기 신뢰도 구축 |

---

### 3-2. 개발자(B) 검토 (A, C 제안 평가)

**A 기획자 제안 평가**:
| 제안 | 구현 난이도 | 호환성 | 평가 |
|------|-------------|--------|------|
| 응원 파도 | 하 | 우수 | 긍정 - 기존 시스템 독립적 |
| 하늘의 심판 | 중 | 우수 | **강력 추천** - 기존 날씨 시스템 100% 활용 가능 |
| 막판 찬스 | **상** | 충돌 | **신중 필요** - 결정적 설계와 충돌, 50% 기준 동기화 복잡 |
| 운명의 부스터 | 중 | 부분 | 주의 - 기믹 로직 재구성 필요 |
| 관중 예측 | 하 | 우수 | 긍정 - 게임과 독립적 |

**C QA/UX 제안 평가**:
| 제안 | 구현 난이도 | 호환성 | 평가 |
|------|-------------|--------|------|
| 터치 피드백 강화 | 하 | 우수 | 긍정 - 즉시 구현 권장 |
| 공정성 시드 공개 | 중 | 변경 필요 | 주의 - 현재 Math.random() 기반, Seeding 필요 |
| 모바일 제스처 | 중 | 주의 | 점진적 도입 권장 - 기존 UI 충돌 관리 |
| 자동화 테스트 | 중 | 독립 | 긍정 - 안정성 확보 |
| 응원 인터랙션 | 중 | 중복 | A 기획의 "응원 파도"와 통합 권장 |

---

### 3-3. QA/UX(C) 검토 (A, B 제안 평가)

**A 기획자 제안 평가**:
| 제안 | 테스트 방법 | UX 영향 | 리스크 |
|------|-------------|---------|--------|
| 응원 파도 | FPS 모니터링, A/B 테스트 | ✅ 커뮤니티 강화 / ❌ 화면 복잡도 | 하 |
| 하늘의 심판 | 날씨별 승률 분석, 투표 정확성 | ✅ 전략성 추가 / ❌ 투표 시점 혼란 | 중 |
| 막판 찬스 | 50% 경계 서버 동기화 테스트 | ✅ 긴장감 / ❌ 네트워크 지연 불신 | 중 |
| 운명의 부스터 | 100회 통계 분석, 엣지 케이스 | ✅ 역전 기회 / ❌ 70% 이후 불공정감 | **중-상** |
| 관중 예측 | 비참가자 투표 검증 | ✅ 관전 참여 / ❌ 무의미한 기능 느낌 | 하 |

**B 개발자 제안 평가**:
| 제안 | 테스트 방법 | UX 영향 | 리스크 |
|------|-------------|---------|--------|
| Progressive Determinism | 재현성 테스트, 성능 모니터링 | ❌ "조작된 게임" 의혹 발생 가능 | **상** - 규제 리스크 |
| Sabotage Touch | 쿨다운/횟수 검증, 70% 경계 | ✅ 상호작용 / ❌ 오터치 문제 | 중 |
| Delta Sync | 동기화 정확도 <50ms, 네트워크 지연 | ✅ 부드러운 애니메이션 / ❌ 반응성 저하 | 상 |
| Fair Interaction Pool | 자원 분배 검증, 승률 50:50 확인 | ✅✅ **최상의 공정성** | 중 |
| Live Prediction | 배율 로직, 동시 예측 처리 | ✅ 관전 참여 유인 | 하 |

---

## 4. 합의 도출

| 우선순위 | 기능 | 판정 | 기획(A) | 개발(B) | QA(C) | 근거 |
|----------|------|------|---------|---------|-------|------|
| **1** | 터치 피드백 강화 | **채택** | ✅ ROI 최고 | ✅ 즉시 구현 | ✅ 리스크 하 | 3자 만장일치 |
| **2** | 하늘의 심판 (Weather Vote) | **채택** | ✅ 우선순위 상 | ✅ 기존 시스템 활용 | ✅ 전략성 추가 | 3자 만장일치, 구현 용이 |
| **3** | Fair Interaction Pool | **채택** | ✅ 공정성 강화 | ✅ 난이도 중 | ✅✅ 최상의 공정성 | 3자 긍정, 핵심 가치 부합 |
| **4** | 응원 파도 + 응원 인터랙션 (통합) | **채택** | ✅ 우선순위 상 | ✅ 난이도 하 | ✅ 리스크 하 | 3자 긍정, 구현 용이 |
| **5** | Sabotage Touch (방해 터치) | **채택** | ✅ 강력 추천 | ✅ 난이도 중 | ⚠️ 주의 (오터치) | 2자 긍정, UX 개선 필요 |
| **6** | Live Prediction (관전자 예측) | **채택** | ✅ 확장성 | ✅ 난이도 하 | ✅ 리스크 하 | 3자 긍정, 생태계 확장 |
| **7** | 결과 무결성 자동화 테스트 | **채택** | ✅ 신뢰도 | ✅ 독립적 | ✅ 필수 | 3자 긍정, 품질 보장 |
| **8** | 공정성 시드 공개 | **채택** | ✅ 신뢰도 | ⚠️ Seeding 필요 | ✅ 중장기 | 2자 긍정, 개발 추가 필요 |
| **9** | 막판 찬스 (Last Chance Bet) | **보류** | ✅ 긴장감 | ❌ 아키텍처 충돌 | ⚠️ 동기화 복잡 | 1자 부정, 구조 변경 필요 |
| **10** | 운명의 부스터 | **보류** | ✅ 역전 가능 | ⚠️ 기믹 재구성 | ⚠️ 70% 불공정감 | 0자 확실 긍정, 밸런스 우려 |
| **11** | Progressive Determinism (70% 분기) | **기각** | ✅ 핵심 가치 | ⚠️ 난이도 상 | ❌ 규제/공정성 리스크 | 1자 부정, 핵심 구조 변경 위험 |
| **12** | Delta Sync (50ms 동기화) | **기각** | ⚠️ ROI 낮음 | ⚠️ 난이도 상 | ❌ 반응성 저하 | 2자 부정, 비용 대비 효과 미미 |
| **13** | 모바일 제스처 컨트롤 | **보류** | ⚠️ 중순위 | ⚠️ 충돌 관리 | ✅ 모바일 UX | 1자 긍정, 점진적 도입 권장 |

---

### 의견 충돌 사항

1. **막판 찬스 (Last Chance Bet)**
   - 기획(A): 긴장감 극대화로 추천
   - 개발(B): 현재 결정적 시뮬레이션 구조와 충돌, 50% 기준 동기화 복잡
   - QA(C): 네트워크 지연 시 사용자 불신 우려
   - **결론**: 구조적 리팩토링 후 재검토

2. **운명의 부스터 (Destiny Booster)**
   - 기획(A): 역전 가능성, 차별화된 게임성
   - 개발(B): 기믹 로직 재구성 필요
   - QA(C): 70% 이후 고정 결과가 불공정감 유발
   - **결론**: 밸런스 설계 후 알파 테스트 필요

3. **Progressive Determinism (70% 분기점)**
   - 기획(A): 공정성 + 긴장감
   - 개발(B): 구현 가능하나 아키텍처 전면 변경
   - QA(C): **"조작된 게임" 의혹 및 규제 리스크** 경고
   - **결론**: 기각 - 핵심 가치(100% 공정성)와 충돌

---

## 5. 서버-클라이언트 시뮬레이션 동기화 상세

### 현재 구조 (결정적 시뮬레이션)
```
[서버] calculateHorseRaceResult()
  ↓ 결과 미리 계산 (rankings, speeds, gimmicks, weatherSchedule)
[서버] horseRaceStarted 이벤트 전송
  ↓
[클라이언트] startRaceAnimation()
  ↓ 동일한 논리적 프레임 카운터로 애니메이션 재생
```

### 제안된 인터랙션 구조 (Fair Interaction Pool 기반)
```
[경주 시작 전]
  - 서버: 모든 플레이어에게 동일 자원 부여 (방해 3회, 부스트 1회, 방어 1회)
  - 클라이언트: 자원 UI 표시

[경주 중 0-70%]
  - 클라이언트: 인터랙션 버튼 클릭 → socket.emit('useInteraction', {type, target})
  - 서버: 자원 검증, 쿨다운 체크, 효과 계산
  - 서버: io.emit('interactionTriggered', {initiator, target, type, effect})
  - 클라이언트: 이펙트 애니메이션 + 속도 조정

[70% 이후]
  - 서버: 인터랙션 거부 (raceProgress >= 0.7)
  - 클라이언트: 인터랙션 버튼 비활성화
  - 순위 확정, 슬로우모션 구간 진입
```

### 동기화 핵심 원칙
1. **권위 서버**: 모든 게임 상태는 서버가 결정
2. **클라이언트 예측**: 인터랙션 즉시 시각화 후 서버 확인으로 보정
3. **70% 분기점**: 인터랙션 마감, 이후 결정적 재생
4. **공정성 유지**: 동일 자원 부여로 모든 플레이어 균등 조건

---

## 6. 다음 단계 (Action Items)

### Phase 1: 기반 확보 (1-2주)
- [ ] 터치 피드백 강화 구현 (바운스 애니메이션, 햅틱)
- [ ] 결과 무결성 자동화 테스트 구축 (Jest + Playwright)
- [ ] 응원 파도 시스템 구현 (Socket.IO 브로드캐스트)

### Phase 2: 핵심 인터랙션 (2-4주)
- [ ] Fair Interaction Pool 설계 및 구현
- [ ] 하늘의 심판 (Weather Vote) 투표 UI + 서버 로직
- [ ] Sabotage Touch 구현 (터치 영역 명확화, 쿨다운 UI)

### Phase 3: 확장 기능 (4-6주)
- [ ] Live Prediction 관전자 예측 시스템
- [ ] 공정성 시드 공개 (Seeding 알고리즘 도입)
- [ ] 모바일 제스처 컨트롤 (점진적 도입)

### 보류 항목 (추후 재검토)
- [ ] 막판 찬스 (Last Chance Bet) - 아키텍처 리팩토링 후
- [ ] 운명의 부스터 (Destiny Booster) - 밸런스 알파 테스트 후

---

## 7. 참고: 서버-클라이언트 동기화 기술 옵션

| 방식 | 장점 | 단점 | 권장 상황 |
|------|------|------|-----------|
| **현재 (결정적)** | 100% 동일 결과, 다시보기 완벽 | 실시간 인터랙션 불가 | 공정성 최우선 |
| **하이브리드 (70% 분기)** | 인터랙션 + 공정성 균형 | 구현 복잡, 규제 우려 | 기각됨 |
| **Fair Pool 기반** | 동일 자원으로 공정성 유지, 상호작용 | 자원 밸런싱 필요 | **채택됨** |
| **델타 동기화 (50ms)** | 부드러운 실시간 | 네트워크 부하, 반응성 저하 | 기각됨 |

---

**작성자**: 3인 멀티에이전트 팀
**다음 회의**: 구현 진행 후 리뷰
