# LAMDiceBot 팀 회의록 (Single)

**일시**: 2026-02-27 15:00
**주제**: 경마 트랙 존 시스템 — 기획 확정
**참석자 (관점)**:
- 피디: PD
- 기획팀: 기획 팀장 (A1), 기획 사원 (A2)
- 개발팀: 개발 팀장 (B1), 개발 사원 (B2)
- 디자인팀: UI/UX 디자이너 (C)
- 품질팀: QA 엔지니어 (E)
**회의 방식**: 1인 순차 분석 (경량 버전)
**게임 대상**: 경마
**절대 원칙**: 동기화 (서버 사전 계산 → 클라이언트 재생) + 공정성 (모든 말 동등 조건)

---

## 1. 현황 요약

### 기존 기믹 시스템의 한계

현재 기믹 9종(stop / obstacle / item_trap / slow / wobble / sprint / item_boost / slip / reverse)은 전부 **"개별 말에 적용되는 속도 조절"** 계열이다.

비어 있는 영역:
- **트랙 기반 이벤트**: 트랙 자체가 변화하는 기믹 없음
- **전체 동시 이벤트**: 모든 말에 동시에 발생하는 기믹 없음
- **말 간 상호작용**: 말들 간 관계에 기반한 기믹 없음

### 이전 회의 문제점

2026-02-26 회의는 기존 02-03, 02-06 회의에서 채택된 아이디어(날씨 투표, Fair Interaction Pool 등)를 재탕하는 문제가 있었다. 이번 회의는 그 두 문서와 완전히 다른 새로운 콘셉트만 다룬다.

---

## 2. 관점별 분석

### PD

현재 기믹은 개별 말에 각각 작용한다. **"트랙 자체가 위험/기회 구간을 갖는" 구조**는 완전히 새롭다. 경주 전 트랙을 미리 보여주는 것만으로도 긴장감이 생긴다.

- **제안**: 트랙 특정 구간에 이벤트 존 배치 → 통과하는 모든 말에 동일 적용. 공정성 완벽(모두 동일 구간), 동기화 완벽(서버 사전 계산).

### 기획 팀장 (A1)

"맵에 장치가 있다"는 개념 자체가 기존 경마와 다른 게임 레이어다. 경주 전 트랙 구성 공개 → 플레이어가 "이번엔 진흙 구간이 있네, 내 탈것이 유리한가?" 하는 분석 재미 유발.

- **제안**: 경주당 60% 확률로 존 존재, 40%는 존 없는 깔끔한 경주. 존의 유무 자체가 변수.

### 기획 사원 (A2)

경주 시작 전 트랙을 카메라로 한 번 훑어주면 "이번 경주는 뭔가 다르다"는 기대감 형성. 카운트다운 4초가 아깝지 않아진다.

- **제안**: 존 있을 때 카운트다운 중 카메라 투어. 3-2-1 숫자는 그대로 표시.

### 개발 팀장 (B1)

기존 기믹은 `progressTrigger` 기반(특정 진행률에서 순간 발동). 트랙 존은 **구간(`startProgress ~ endProgress`) 기반**으로 구조가 다르다. 별도 데이터 구조(`trackZones` 배열) 필요하지만, `horseRaceStarted`와 동일한 전송 패턴으로 처리 가능.

- **결정**: `progressTrigger` 방식이 아닌 구간 구조 사용.

### 개발 사원 (B2)

순위 계산은 이미 speedMultiplier 누적 곱산 방식. 존 효과도 동일하게 적용하면 된다 — 말의 현재 progress가 존 구간 안에 있으면 speedMultiplier에 곱산. 별도 딜레이 계산 불필요. 기존 날씨 보정(`weatherMod *= ...`)과 완전히 같은 패턴.

- **결정**: `speedMultiplier *= zone.speedMultiplier` 방식으로 시뮬레이션 루프에 삽입.

### UI/UX 디자이너 (C)

카운트다운 카메라 투어는 4초(서버 상수) 안에서 처리해야 한다. 3-2-1과 동시 진행 방식이 적합 — 투어 ~2초, 나머지 시간에 시작점 복귀. 각 존에서 0.4초 멈추며 pulse 하이라이트.

존 시각화: 레인 위에 반투명 div. 경주 중에도 bgScrollOffset 따라 이동(결승선과 동일 방식).

### QA 엔지니어 (E)

**동기화 테스트**: 탭 3개에서 동일 방 입장 → 카운트다운 시 동일한 존 위치/타입 확인. 이게 핵심.

**공정성 테스트**: 진흙 구간 통과 시 모든 말에 동일한 speedMultiplier 로그 확인.

**기각 사유 명확화**: 텔레포트/순위 셔플은 "이미 계산된 결과 재배치"로 배팅 게임 공정성 직결 → 기각.

---

## 3. 설계 확정

### 존 생성 규칙

| 항목 | 결정 |
|------|------|
| 존 존재 확률 | 60% (40% 확률로 존 없는 경주) |
| 배치 수량 | short: 1개, medium: 1~2개, long: 1~2개 |
| 구조 | `startProgress ~ endProgress` 구간 (progressTrigger 아님) |
| 공개 시점 | `horseRaceCountdown` 이벤트에 포함 → 카운트다운 시작 시 공개 |
| 경주 중 고정 | 공개 후 변경 없음 |

### 존 타입

| 타입 | 시각 | speedMultiplier | 비고 |
|------|------|-----------------|------|
| `mud` (진흙) | 갈색 반투명 구간 | 0.55 ~ 0.65 | 강한 감속 |
| `ice` (빙판) | 하늘색 반투명 구간 | 0.80 ~ 0.90 | 약한 감속 |
| `boost_pad` (부스터 패드) | 노란 화살표 패턴 | 1.40 ~ 1.60 | 가속 |

### 순위 계산 반영

- `calculateHorseRaceResult()` 시뮬레이션 루프에서 날씨 보정 직후에 삽입
- `speedMultiplier *= zone.speedMultiplier` (존 안에 있을 때)
- 기믹 효과와 독립적으로 곱산 (기믹 + 존 동시 적용 시 둘 다 반영)

### 카운트다운 카메라 투어

- **조건**: `trackZones.length > 0` 일 때만 발동
- **시간**: 서버 카운트다운 4초 유지, 3-2-1 숫자와 동시 진행
- **동작**: 카운트다운 시작(3)과 동시에 배경 스크롤로 각 존 위치 순서대로 이동
  - 각 존에서 ~0.4초 멈추며 pulse 하이라이트
  - 전체 투어 ~1.5~2초 → 시작점 복귀
- **존 없을 때**: 기존 카운트다운 동작 그대로

---

## 4. 합의 도출

| 항목 | 판정 | 근거 |
|------|------|------|
| 트랙 존 시스템 (mud/ice/boost_pad) | ✅ 채택 | 완전 새로운 "트랙 기반" 차원, 공정성/동기화 완벽 |
| 존 없는 경주 허용 (40%) | ✅ 채택 | 존 유무 자체가 변수, 단조로움 방지 |
| 카운트다운 카메라 투어 | ✅ 채택 | 존 공개 연출, 4초 기존 유지 (서버 변경 없음) |
| 텔레포트/순위 셔플 | ❌ 기각 | 배팅 공정성 직결 |
| 말 컨디션 플레이버 | ❌ 기각 | 추가 조작 여지 생김 |
| 날씨 투표/배팅 시스템/시즌 랭킹 | ❌ 기각 | 기믹이 아님 |

---

## 5. 다음 단계 (Action Items)

> 구현 상세: [`2026-02-27-1000-horse-track-zone-impl.md`](../impl/2026-02-27-1000-horse-track-zone-impl.md)

- [ ] `config/horse/race.json` — zones 섹션 추가 (existProbability, countByTrack, types)
- [ ] `socket/horse.js` — `generateTrackZones()` 함수 추가 + raceData/raceRecord/horseRaceCountdown에 trackZones 포함
- [ ] `socket/horse.js` — `calculateHorseRaceResult()` 시뮬레이션 루프에 zone speedMultiplier 적용
- [ ] `js/horse-race.js` — `renderTrackZones()` + `updateZonePositions()` + 카메라 투어(`runTrackCameraTour()`)
- [ ] `horse-race-multiplayer.html` — 존 타입별 CSS 추가
