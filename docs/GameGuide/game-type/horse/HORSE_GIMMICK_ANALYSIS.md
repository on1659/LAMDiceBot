# 경마 오브젝트 기믹 분석

## 기믹 종류 (총 10가지)

| 기믹 | 확률 | 속도배율 | 지속시간 | 시각효과 |
|------|------|----------|----------|----------|
| **STOP (멈춤)** | 15% | 0x (완전정지) | 300-800ms | 브레이크 연기 |
| **SLOW (느림)** | 13% | 0.2-0.5x | 400-1000ms | 땀방울 |
| **SPRINT (스프린트)** | 15% | 1.4-1.7x | 400-800ms | 불꽃 이펙트 |
| **SLIP (미끄러짐)** | 10% | -0.3~-0.7x (후진) | 200-500ms | 먼지구름 |
| **WOBBLE (어지러움)** | 7% | 0.7-1.0x | 500-1000ms | 💫 회전 |
| **OBSTACLE (장애물)** | 12% | 0x (완전정지) | 500-1500ms | 🚧 |
| **ITEM_BOOST (황금당근)** | 8% | 1.2-1.4x | 800-1200ms | 🥕✨ |
| **ITEM_TRAP (바나나)** | 10% | 0.1x | 1000-2000ms | 🍌 |
| **REVERSE (역주행)** | 8% | -1.5~-2.0x | 1000-2000ms | ⚠️↩️ |
| **REVERSE_BOOST (역주행후부스트)** | 연쇄 | 1.8-2.5x | 2000-3000ms | 💨🔥 |

## 핵심 메커니즘

### 기믹 발동 조건
- 레이스 진행도 10%~85% 구간에서 랜덤 트리거

### 트랙별 기믹 수
- 짧은 트랙(300m): 3-5개
- 중간 트랙(500m): 3-5개
- 긴 트랙(700m): 5-8개

### 연쇄 기믹
- REVERSE → REVERSE_BOOST가 유일한 연쇄 쌍
- 역주행 후 자동으로 부스트 발동

### 속도 계산
- `실제속도 = 기본속도 × 기믹배율`
- 기믹 미적용 구간에서는 0.7-1.3x 자연 변동

## 기믹별 상세 설명

### STOP (멈춤)
- 말이 완전히 정지하는 기믹
- 시각적으로 회색 연기 3개가 위로 올라감
- CSS 필터: `brightness(0.7)` 적용

### SLOW (느림)
- 피로로 인해 속도가 크게 감소
- 파란 물방울이 떨어지는 이펙트
- CSS 필터: `brightness(0.9) grayscale(0.3)` 적용

### SPRINT (스프린트)
- 폭발적인 가속으로 순간 부스트
- 주황/노란 불꽃 이펙트 + 스피드 라인
- CSS 필터: `brightness(1.3) saturate(1.5)` 적용

### SLIP (미끄러짐)
- 미끄러져 뒤로 이동 (음수 속도)
- 먼지구름이 옆으로 퍼지는 이펙트
- CSS 필터: `hue-rotate(20deg)` 적용

### WOBBLE (어지러움)
- 어지러워 좌우로 흔들리며 약간 감속
- 💫 이모지가 머리 위에 회전
- 수평 지그재그 애니메이션 적용

### OBSTACLE (장애물)
- 트랙 위 장애물에 걸려 장시간 정지
- 🚧 이모지 + 애니메이션
- 가장 긴 정지시간으로 레이스에 큰 영향

### ITEM_BOOST (황금당근)
- 황금 당근을 획득하여 속도 부스트
- 🥕✨ 이모지 + 반짝임 애니메이션
- 짧은 지속시간으로 밸런스 조정됨

### ITEM_TRAP (바나나)
- 바나나 껍질을 밟아 거의 정지
- 🍌 이모지 + 회전 애니메이션
- 심각한 속도 저하

### REVERSE (역주행)
- 반대 방향으로 주행 (큰 음수 속도)
- ⚠️↩️ 이모지 + 깜빡임
- 종료 후 자동으로 REVERSE_BOOST 연쇄 발동

### REVERSE_BOOST (역주행후부스트)
- REVERSE 종료 후 자동 발동되는 보상 부스트
- 💨🔥 이모지
- 역주행 손실을 만회하고 역전 기회 제공 (1.8-2.5x 강화)

## 레이스 결과 결정 방식

1. 서버에서 전체 레이스를 기믹 포함 시뮬레이션
2. 16ms 간격 프레임 단위 계산 (최대 60초)
3. 매 프레임마다 기믹 활성 상태 체크
4. 누적 이동 거리 기반 최종 순위 결정
5. 1% 오차 이내 동시 도착 시 포토피니시 판정

## 밸런스 조정 (2026-02)

### 연속 방지 로직
- 최근 2개 카테고리 체크로 A-B-A 패턴 방지
- 기믹 간 최소 8% progress 간격 보장

### 자연 속도 변동
- 기믹 없을 때 0.7-1.3x 자연 변동 발생
- sprint는 자연 최대(1.3x)를 초과하도록 1.4-1.7x로 설정

## 관련 파일

- 서버 로직: `socket/horse.js` (기믹 생성: ~153-206줄)
- 설정: `config/horse/race.json`
- 클라이언트 애니메이션: `horse-race-multiplayer.html`
