# 프로젝트 계획서

## 프로젝트 개요
멀티플레이어 주사위 게임 서버에 GPT API 통합

## 진행 상황

### 2025-11-25
- 🧼 currentGameId 필터를 도입해 새 게임 시 이전 기록이 섞이지 않도록 클라이언트/서버 동기화
- 📣 자동 종료 플로우에서도 룰 분석 메시지가 채팅에 노출되도록 서버 로직 보강
- 🎞️ 마지막 롤 애니메이션 완료 이벤트를 받은 뒤에만 게임 종료/결과 메시지를 발행하도록 서버·클라이언트 모두 보완
- 🔢 기록 섹션의 총 카운터가 현재 표시 중인 게임만 반영하도록 UI 정정
- ♻️ `updateRoomsList()`를 전역으로 승격해 종료 헬퍼에서도 동일 로직을 재사용
- 🌸 마지막 주사위 기록은 애니메이션 종료 신호(ACK)를 받은 뒤에만 히스토리/총 카운트에 노출되도록 서버·클라이언트 동기화

### 2025-11-24
- ♻️ 게임 룰을 라디오 카드 UI로 재구성 (하이/로우/니어/기타)
- 🤖 기타 룰 작성 시 GPT 제안 버튼 및 서버 훅 추가
- 🔒 룰 편집 UI는 호스트에게만 노출, 참가자는 결과 요약만 확인
- 🧮 하이/로우/니어 룰은 서버 내장 로직으로 판정 (GPT 호출 없음)
- 🕒 분석 메시지는 게임 종료 직전에 시스템이 안내

### 2025-11-22
- ✅ OpenAI 패키지 설치 완료
- ✅ GPT API 통합 완료
  - OpenAI 클라이언트 초기화 추가
  - GPT API 호출 함수 구현
  - 채팅에서 `/gpt` 또는 `/ai` 명령어로 GPT 사용 가능

## 구현 내용

### 룰 선택 UI
- 하이/로우/니어/기타 라디오 카드로 룰 지정
- 니어는 직접 입력한 숫자에 가장 가까운 사람을 자동 계산
- 기타 옵션은 GPT 버튼으로 룰 문장을 제안받아 적용
- 호스트만 UI를 확인하고 저장할 수 있으며, 일반 유저는 최종 룰 요약만 본다
- 하이/로우/니어 룰은 서버에서 즉시 판정하여 비용 없이 결과 공유

### GPT 기능
- 채팅에서 `/gpt [질문]` 또는 `/ai [질문]` 명령어로 GPT와 대화
- 환경 변수 `OPENAI_API_KEY` 사용
- 채팅 메시지로 GPT 응답 표시
- 로딩 중 "🤔 생각 중..." 메시지 표시
- 오류 발생 시 에러 메시지 표시
- 주사위 분석 결과는 게임 종료 직전에 시스템 메시지로 노출

## 사용 방법

### 환경 변수 설정 방법

**방법 1: .env 파일 사용 (권장)**
1. 프로젝트 루트에 `.env` 파일 생성
2. `.env.example` 파일을 참고하여 다음 내용 추가:
   ```
   OPENAI_API_KEY=your-api-key-here
   ```
3. OpenAI API 키는 https://platform.openai.com/api-keys 에서 발급

**방법 2: 환경 변수로 직접 설정**
- Windows PowerShell:
  ```powershell
  $env:OPENAI_API_KEY="your-api-key-here"
  ```
- Windows CMD:
  ```cmd
  set OPENAI_API_KEY=your-api-key-here
  ```
- Linux/Mac:
  ```bash
  export OPENAI_API_KEY=your-api-key-here
  ```

### GPT 사용하기

**1. 채팅 대화형 GPT**
- 채팅에서 `/gpt 안녕하세요` 또는 `/ai 질문내용` 입력

**2. 게임 주사위 분석 GPT (자동)**
- 게임 진행 중 주사위를 굴릴 때 자동으로 GPT가 분석
- 게임 룰과 현재까지 나온 주사위 결과를 분석
- 유력한 승리 후보일 경우 특별한 연출 표시
- GPT 분석 결과는 `isGPTAnimation` 플래그와 `gptReason`으로 전달됨

**3. 룰 작성 GPT 버튼**
- 룸 호스트가 '기타' 룰을 선택하고 설명을 입력한 뒤 GPT 버튼을 누르면 간결한 룰 문장을 제안받음
- 제안된 문장을 그대로 적용하거나 편집 후 저장 가능

