# CLAUDE.md

## Project: LAMDiceBot

Express + Socket.IO 기반 멀티플레이어 주사위/경마 게임 서버.
순수 HTML (템플릿 엔진 미사용), PostgreSQL DB, 상대 경로 API (`/api/...`).

## Git Workflow

- **main = 실서버** (푸시하면 바로 배포) → 푸시 전 반드시 사용자 확인
- **feature 브랜치 = 개발용** → 자유롭게 푸시 가능

---

## Coding Guidelines

### 1. Think Before Coding

- 가정을 명시적으로 밝힌다. 불확실하면 물어본다.
- 여러 해석이 가능하면 조용히 하나를 고르지 말고 제시한다.
- 더 간단한 방법이 있으면 말한다. 필요하면 반론을 제기한다.
- 뭔가 불분명하면 멈추고, 무엇이 헷갈리는지 말하고 물어본다.

### 2. Simplicity First

- 요청된 것 이상의 기능 추가 금지.
- 한 번만 쓰이는 코드에 추상화 금지.
- 요청하지 않은 "유연성"이나 "설정 가능성" 금지.
- 불가능한 시나리오에 대한 에러 핸들링 금지.
- 200줄을 50줄로 줄일 수 있으면 줄인다.

스스로 물어보기: "시니어 엔지니어가 이걸 보고 과하다고 할까?" 그렇다면 단순화.

### 3. Surgical Changes

기존 코드 수정 시:
- 주변 코드, 주석, 포매팅 "개선" 금지.
- 망가지지 않은 것을 리팩터링 금지.
- 기존 스타일에 맞춘다 (내 취향과 달라도).
- 관련 없는 데드 코드를 발견하면 삭제하지 말고 언급만.

내 변경으로 생긴 고아 코드:
- 내 변경이 만든 미사용 import/변수/함수는 제거.
- 기존에 있던 데드 코드는 요청 없으면 건드리지 않는다.

**테스트**: 변경된 모든 줄이 사용자의 요청에 직접 연결되어야 한다.

### 4. Goal-Driven Execution

작업을 검증 가능한 목표로 변환:
- "유효성 검사 추가" → "잘못된 입력에 대한 테스트 작성, 통과시키기"
- "버그 수정" → "재현 테스트 작성, 통과시키기"
- "X 리팩터링" → "전후 테스트 통과 확인"

다단계 작업은 간략한 계획 제시:
```
1. [단계] → 검증: [확인사항]
2. [단계] → 검증: [확인사항]
3. [단계] → 검증: [확인사항]
```

### 5. Record Before Talk

"기억하겠습니다"는 이 대화창 안에서만 유효하다. 다음 세션에서도 필요한 정보는 반드시 MEMORY.md에 먼저 기록한 후 작업을 계속한다.

기록 대상:
- 새로 발견한 코드 패턴이나 관례
- 디버깅으로 알게 된 원인과 해결법
- 아키텍처 결정 (왜 A 대신 B를 선택했는지)
- 자주 실수하는 부분

기록하지 않는 것:
- 이번 세션에서만 쓰이는 임시 정보
- CLAUDE.md에 이미 있는 내용과 중복

### 6. Context-First Development

코드 작성 전 반드시 컨텍스트 수집:

1. **관련 파일 읽기** — 수정할 파일과 그 파일을 import하는 곳
2. **비슷한 기능 검색** — 기존 게임 핸들러, DB 모듈 등 동일 패턴 참조
3. **영향 범위 확인** — 이 변경이 다른 곳에 어떤 영향을 주는지

확인 안 했으면 코드 작성 금지. "X를 Y로 변경하려는데, A에도 영향이 있을 것 같습니다" 식으로 먼저 물어본다.

### 7. Project-Specific Rules

상황-행동 매칭 (이 프로젝트 전용):

| 상황 | 행동 |
|------|------|
| Socket 핸들러 수정 | `ctx.checkRateLimit()` 호출 확인, 방 상태 변경 시 `ctx.updateRoomsList()` 확인 |
| DB 모듈 수정 | `db/init.js` 스키마와 일치하는지 확인, 마이그레이션 필요 여부 확인 |
| HTML 수정 | AdSense 스니펫 포함 확인 (admin.html 제외), API는 `/api/...` 상대 경로만 |
| horse-app 소스 수정 | `cd horse-app && npm run build` 빌드 필요 |
| 새 게임 추가 | `socket/[game].js` → `socket/index.js` 등록 → `routes/api.js` 라우트 → `index.html` 링크 |
| 구현 요청 (impl 없이) | 파일 3개+ 또는 DB 변경 포함 → "impl 문서를 먼저 만들까요, 바로 구현할까요?" 확인 |
| 조정 가능한 숫자 상수 추가 | 하드코딩 금지 — `config/` 파일 또는 파일 상단 `const` 블록에 이름 있는 상수로 정의 후 참조 |

---

**이 가이드라인이 작동하는 증거:** diff에 불필요한 변경이 줄고, 과도한 복잡성으로 인한 재작성이 줄고, 실수 후가 아닌 구현 전에 질문이 나온다.
