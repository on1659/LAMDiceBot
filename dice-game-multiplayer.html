<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LAM Dice :)</title>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1608259764663412" crossorigin="anonymous"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 0;
            position: relative;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            margin: 20px auto;
        }
        
        /* ë¡œë¹„ ì„¹ì…˜ì´ í™œì„±í™”ë˜ì–´ ìˆì„ ë•ŒëŠ” ì¤‘ì•™ ì •ë ¬ */
        body.lobby-active .container {
            margin-left: auto;
            margin-right: auto;
        }
        
        /* ê²Œì„ ì„¹ì…˜ì´ í™œì„±í™”ë˜ì–´ ìˆì„ ë•Œ ì»¨í…Œì´ë„ˆë¥¼ ì¤‘ì•™ì— ë°°ì¹˜ */
        body.game-active .container {
            /* ì»¨í…Œì´ë„ˆë¥¼ í™”ë©´ ì¤‘ì•™ì— ë°°ì¹˜ (ì˜¤ë¥¸ìª½ìœ¼ë¡œ 160px ì¶”ê°€ ì´ë™)
               - ì»¨í…Œì´ë„ˆ ë„ˆë¹„: 800px
               - ê¸°ë¡ ì„¹ì…˜ ë„ˆë¹„: 320px
               - ì»¨í…Œì´ë„ˆì™€ ê¸°ë¡ ì„¹ì…˜ ì‚¬ì´ ì—¬ë°±: 20px
               ì´ ë„ˆë¹„: 800px + 20px + 320px = 1140px
               ì¤‘ì•™ ì •ë ¬: (100vw - 1140px) / 2 + 160px
            */
            margin-left: calc((100vw - 1140px) / 2 + 160px);
            margin-right: auto;
            max-width: 800px;
        }
        
        .chat-history-wrapper {
            margin-top: 20px;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .lobby-section, .game-section, .create-room-section {
            display: none;
        }

        .lobby-section.active, .game-section.active, .create-room-section.active {
            display: block;
        }
        
        .rooms-list {
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
        }
        
        .room-item {
            background: white;
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .room-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .room-item.active {
            background: #e3f2fd;
            border-color: #2196f3;
        }
        
        .room-item.my-room {
            background: #fff3cd;
            border-color: #ffc107;
            border-width: 3px;
        }
        
        .my-room-badge {
            display: inline-block;
            background: #ffc107;
            color: #333;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .room-info {
            flex: 1;
        }
        
        .room-name {
            font-size: 18px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .room-details {
            font-size: 14px;
            color: #666;
        }
        
        .room-status {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
            margin-top: 5px;
            display: inline-block;
        }
        
        .room-status.playing {
            background: #d4edda;
            color: #155724;
        }
        
        .room-status.ordering {
            background: #fff9e6;
            color: #856404;
        }
        
        .room-status.waiting {
            background: #e0e0e0;
            color: #666;
        }
        
        .room-action {
            margin-left: 15px;
        }
        
        .room-action button {
            width: auto;
            padding: 10px 20px;
        }
        
        .create-room-section, .join-room-section {
            background: #f8f9fa;
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .room-name-input-section {
            background: #f8f9fa;
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            display: none;
        }
        
        .room-name-input-section.active {
            display: block;
        }
        
        .room-name-display {
            font-size: 16px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 10px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        input[type="text"], input[type="number"], textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
        }

        input[type="text"]:focus, input[type="number"]:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .user-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-name {
            font-weight: 600;
            color: #667eea;
            font-size: 18px;
        }

        .host-badge {
            background: #ffc107;
            color: #333;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .connection-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .connection-status.connected {
            background: #28a745;
            color: white;
        }

        .connection-status.disconnected {
            background: #dc3545;
            color: white;
        }

        .game-status {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
            font-size: 18px;
        }

        .game-status.waiting {
            background: #fff3cd;
            color: #856404;
        }

        .game-status.playing {
            background: #d4edda;
            color: #155724;
        }

        .game-status.ordering {
            background: #fff9e6;
            color: #856404;
        }

        .host-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        #clearDataButton {
            grid-column: 1 / -1;
        }

        .dice-container {
            text-align: center;
            margin: 30px 0;
        }

        .dice {
            width: 150px;
            height: 150px;
            background: white;
            border: 3px solid #667eea;
            border-radius: 15px;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
            margin: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s, opacity 0.3s;
            position: relative;
        }
        
        .dice::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-radius: 15px;
            pointer-events: none;
        }

        .dice.rolling {
            animation: roll 0.3s infinite, shake 0.15s infinite, pulse 0.4s infinite;
            filter: drop-shadow(0 0 15px rgba(102, 126, 234, 0.9));
        }
        
        .dice.rolling .dice-content {
            animation: fadeInOut 0.5s infinite;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }

        @keyframes roll {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(90deg) scale(1.15); }
            50% { transform: rotate(180deg) scale(1.3); }
            75% { transform: rotate(270deg) scale(1.15); }
            100% { transform: rotate(360deg) scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0) translateY(0); }
            25% { transform: translateX(-8px) translateY(-5px); }
            50% { transform: translateX(8px) translateY(5px); }
            75% { transform: translateX(-5px) translateY(8px); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; filter: brightness(1); }
            50% { opacity: 0.8; filter: brightness(1.3); }
        }

        .roll-button {
            margin: 20px 0;
        }

        .users-section {
            margin-bottom: 20px;
        }

        .progress-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid #667eea;
        }

        .progress-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .progress-bar-container {
            background: #e0e0e0;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-bar {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .progress-text {
            text-align: center;
            font-size: 16px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 20px;
        }

        .not-rolled-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px dashed #ddd;
        }

        .not-rolled-title {
            font-size: 16px;
            font-weight: 600;
            color: #856404;
            margin-bottom: 12px;
        }

        .not-rolled-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            min-height: 40px;
        }

        .not-rolled-tag {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .empty-not-rolled {
            color: #28a745;
            text-align: center;
            padding: 10px;
            font-weight: 600;
            width: 100%;
        }

        .users-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #667eea;
        }

        .users-list {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            min-height: 50px;
        }

        .user-tag {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .user-tag.host {
            background: #667eea;
            color: white;
        }

        /* ì£¼ë¬¸ë°›ê¸° ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .orders-section {
            margin-bottom: 20px;
            display: none;
        }

        .orders-section.active {
            display: block;
        }

        .my-order-box {
            background: #fff9e6;
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .my-order-title {
            font-size: 16px;
            font-weight: 600;
            color: #856404;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .order-input-group {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            position: relative;
        }

        .order-input-wrapper {
            position: relative;
            width: 100%;
        }

        .autocomplete-suggestion {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 12px;
            color: #999;
            pointer-events: none;
            font-family: inherit;
            font-size: 16px;
            line-height: 1.5;
            border: 2px solid transparent;
            border-radius: 8px;
            z-index: 1;
        }

        #myOrderInput {
            position: relative;
            z-index: 2;
            background-color: transparent;
        }

        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #667eea;
            border-radius: 8px;
            margin-top: 4px;
            max-height: 200px;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }

        .autocomplete-item {
            padding: 10px 12px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        .autocomplete-item:hover,
        .autocomplete-item.selected {
            background-color: #e3f2fd;
        }

        .menu-manager {
            background: #f8f9fa;
            border: 2px solid #667eea;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
        }

        .menu-manager.active {
            display: block;
        }

        .menu-manager-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .menu-manager-input {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            margin-bottom: 10px;
        }

        .menu-list {
            background: white;
            border-radius: 6px;
            padding: 10px;
            max-height: 150px;
            overflow-y: auto;
        }

        .menu-tag {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 14px;
            margin: 4px;
            position: relative;
        }

        .menu-tag .delete-btn {
            margin-left: 6px;
            cursor: pointer;
            font-weight: bold;
        }

        .menu-tag .delete-btn:hover {
            opacity: 0.8;
        }

        .order-list {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        .order-item {
            background: white;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 6px;
            border-left: 3px solid #ffc107;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-item:last-child {
            margin-bottom: 0;
        }

        .order-item-left {
            flex: 1;
        }

        .order-user {
            font-weight: 600;
            color: #856404;
            margin-bottom: 4px;
        }

        .order-text {
            color: #666;
            font-size: 20px;
            font-weight: 600;
            word-break: break-word;
        }

        .order-text.empty {
            color: #999;
            font-style: italic;
        }

        .order-count {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
            margin-left: 15px;
        }

        .history-section {
            position: fixed;
            top: 20px;
            width: 320px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 20px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
            z-index: 1000;
            display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€, ë°© ì…ì¥ ì‹œì—ë§Œ í‘œì‹œ */
        }
        
        /* ê²Œì„ ì„¹ì…˜ì´ í™œì„±í™”ë˜ì–´ ìˆì„ ë•Œ ê¸°ë¡ ì„¹ì…˜ì„ ì»¨í…Œì´ë„ˆ ë°”ë¡œ ì˜†ì— ë°°ì¹˜ */
        body.game-active .history-section {
            /* ì»¨í…Œì´ë„ˆ ì˜¤ë¥¸ìª½ ë ìœ„ì¹˜: (100vw - 1140px) / 2 + 160px + 800px
               ì»¨í…Œì´ë„ˆì™€ ê¸°ë¡ ì„¹ì…˜ ì‚¬ì´ ì—¬ë°±: 20px
               ê¸°ë¡ ì„¹ì…˜ ì™¼ìª½ ìœ„ì¹˜: (100vw - 1140px) / 2 + 160px + 800px + 20px
            */
            left: calc((100vw - 1140px) / 2 + 160px + 800px + 20px);
            right: auto;
        }
        
        .history-section.visible {
            display: block;
        }
        
        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• ìŠ¤íƒ€ì¼ */
        @media (max-width: 768px) {
            /* ëª¨ë°”ì¼ì—ì„œëŠ” ì»¨í…Œì´ë„ˆë¥¼ ì „ì²´ ë„ˆë¹„ë¡œ ì‚¬ìš© */
            .container {
                max-width: 95vw;
                width: 95vw;
                margin: 20px auto;
                padding: 20px;
            }
            
            /* ëª¨ë°”ì¼ì—ì„œëŠ” ê²Œì„ ì„¹ì…˜ë„ ì¤‘ì•™ ì •ë ¬ */
            body.game-active .container {
                margin-left: auto;
                margin-right: auto;
                max-width: 95vw;
                width: 95vw;
            }
            
            /* ëª¨ë°”ì¼ì—ì„œëŠ” ê²Œì„ ê¸°ë¡ ì„¹ì…˜ì„ ìˆ¨ê¸°ê±°ë‚˜ í•˜ë‹¨ì— ë°°ì¹˜ */
            .history-section {
                position: relative;
                top: auto;
                left: auto;
                right: auto;
                width: 100%;
                max-width: 95vw;
                margin: 20px auto;
                max-height: 400px;
            }
            
            body.game-active .history-section {
                position: relative;
                left: auto;
                right: auto;
                width: 100%;
                max-width: 95vw;
                margin: 20px auto;
            }
        }
        
        .chat-section {
            margin-bottom: 0;
        }
        
        /* ì£¼ì‚¬ìœ„ ê²°ê³¼ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes diceRoll {
            0% {
                transform: scale(0.5) rotate(-180deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.2) rotate(0deg);
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }
        
        .dice-result-animated {
            display: inline-block;
            animation: diceRoll 0.5s ease-out;
        }

        .history-title-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .history-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            white-space: nowrap; /* ì¤„ë°”ê¿ˆ ë°©ì§€ */
        }

        .sort-buttons {
            display: flex;
            gap: 5px;
        }

        .sort-button {
            background: #f8f9fa;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            width: auto;
        }

        .sort-button:hover {
            background: #e3f2fd;
            transform: none;
        }

        .sort-button.active {
            background: #667eea;
            color: white;
        }

        .history-list {
            max-height: calc(100vh - 200px);
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
        }

        .history-item {
            background: white;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 6px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item:last-child {
            margin-bottom: 0;
        }

        .history-user {
            font-weight: 600;
            color: #667eea;
        }

        .history-result {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .history-time {
            font-size: 12px;
            color: #999;
        }

        .history-range {
            font-size: 12px;
            color: #667eea;
            font-weight: 600;
        }

        .empty-history {
            text-align: center;
            color: #999;
            padding: 20px;
        }

        .logout-button {
            background: #dc3545;
            margin-top: 10px;
        }

        .logout-button:hover {
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        }

        .dice-settings {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 2px solid #2196f3;
        }

        .dice-settings-title {
            font-size: 16px;
            font-weight: 600;
            color: #1976d2;
            margin-bottom: 10px;
        }

        .dice-range-inputs {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            align-items: end;
        }

        .reconnect-notice {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .reconnect-notice strong {
            color: #856404;
            font-size: 16px;
        }

        .reconnect-notice p {
            color: #856404;
            margin-top: 8px;
            font-size: 14px;
        }

        .order-button {
            background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
        }

        .order-button:hover {
            box-shadow: 0 5px 15px rgba(255, 193, 7, 0.4);
        }

        .clear-data-button {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .clear-data-button:hover {
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ² LAM Dice :)</h1>

        <!-- ëŒ€ê¸°ì‹¤ ì„¹ì…˜ -->
        <div class="lobby-section active" id="lobbySection">
            <div class="create-room-button-section" style="background: #f8f9fa; border: 2px solid #667eea; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                <h2 style="margin-bottom: 15px; color: #667eea;">ë°© ë§Œë“¤ê¸°</h2>
                <button onclick="showCreateRoomPage()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin-bottom: 15px;">ë°© ìƒì„±í•˜ê¸°</button>
                <div class="input-group" style="margin: 0;">
                    <label for="globalUserNameInput">ì´ë¦„</label>
                    <input type="text" id="globalUserNameInput" placeholder="ì´ë¦„ ì…ë ¥" maxlength="20" />
            </div>
            </div>
            
            <div class="join-room-section">
                <h2 style="margin-bottom: 15px; color: #667eea;">ë°© ëª©ë¡</h2>
                <button onclick="refreshRooms()" style="width: auto; padding: 8px 16px; margin-bottom: 15px; background: #6c757d;">ìƒˆë¡œê³ ì¹¨</button>
                <div class="rooms-list" id="roomsList">
                    <div style="color: #999; text-align: center; padding: 20px;">ë°© ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
                
                <!-- Google AdSense ê´‘ê³ : ë°˜ì‘í˜• ë°•ìŠ¤ -->
                <div style="margin: 20px 0; text-align: center;">
                    <ins class="adsbygoogle"
                         style="display:block"
                         data-ad-client="ca-pub-1608259764663412"
                         data-ad-slot="YOUR_SLOT_ID"
                         data-ad-format="auto"
                         data-full-width-responsive="true"></ins>
                    <script>
                        (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                </div>
                
            </div>
            
            <!-- ì—…ë°ì´íŠ¸ ë‚´ì—­ -->
            <div class="update-log-section" style="background: #f8f9fa; border: 2px solid #667eea; border-radius: 12px; padding: 20px; margin-top: 20px;">
                <h2 style="margin-bottom: 15px; color: #667eea;">ğŸ“ ì—…ë°ì´íŠ¸ ë‚´ì—­</h2>
                <div class="update-log-content" id="updateLogContent" style="background: white; border-radius: 8px; padding: 15px; max-height: 300px; overflow-y: auto; white-space: pre-wrap; line-height: 1.8; color: #333; font-size: 14px;">
<b style="color: #667eea;">ğŸ® ìµœì‹  ì—…ë°ì´íŠ¸</b> <span style="color: #999; font-size: 12px; font-weight: normal;">(2025-01-XX)</span>

<b>ğŸªœ ì‚¬ë‹¤ë¦¬íƒ€ê¸° ê²Œì„ ê¸°ëŠ¥ ì¶”ê°€ (ì¤€ë¹„ ì¤‘)</b>
â€¢ ì‚¬ë‹¤ë¦¬íƒ€ê¸° ê²Œì„ ì „ìš© í˜ì´ì§€ ì¶”ê°€ (ladder-game-multiplayer.html)
â€¢ ì¤€ë¹„í•œ ì°¸ê°€ì ìˆ˜ì— ë”°ë¼ ë§‰ëŒ€ê¸° ìë™ ìƒì„±
â€¢ ì°¸ê°€ì ìˆ˜ì— ë”°ë¥¸ ë™ì  í¬ê¸° ì¡°ì • (1-3ëª…: í¬ê²Œ, 4-6ëª…: ì¤‘ê°„, 7ëª… ì´ìƒ: ì‘ê²Œ)
â€¢ ë„ì°©ì§€ í…ìŠ¤íŠ¸ ì…ë ¥ ê¸°ëŠ¥ ì¶”ê°€
â€¢ ì±„íŒ… ë° ì¤€ë¹„ ìƒíƒœ UIë¥¼ ì£¼ì‚¬ìœ„ ê²Œì„ê³¼ ë™ì¼í•œ ìŠ¤íƒ€ì¼ë¡œ í†µì¼
â€¢ ì¤‘ë³µ ì´ë¦„ ì²´í¬ ë¡œì§ ê°•í™” (ì¬ì—°ê²° vs ì¤‘ë³µ êµ¬ë¶„)
â€¢ ìº”ë²„ìŠ¤ ì˜ë¦¼ ë¬¸ì œ í•´ê²° ë° ë°˜ì‘í˜• ì²˜ë¦¬
â€¢ ë¡œë¹„ì—ì„œ ì‚¬ë‹¤ë¦¬íƒ€ê¸° ê²Œì„ ìƒì„± ì˜µì…˜ ì„ì‹œ ë¹„í™œì„±í™” (ì¤€ë¹„ ì¤‘)

<b>ğŸ“Š ì‚¬ìš©ì ëª©ë¡ ì •ë ¬ ê°œì„ </b>
â€¢ ì¤€ë¹„í•œ ì‚¬ëŒ, ì£¼ì‚¬ìœ„ë¥¼ êµ´ë¦¬ì§€ ì•Šì€ ì‚¬ëŒ, ì£¼ë¬¸í•˜ì§€ ì•Šì€ ì‚¬ëŒ ëª©ë¡ì„ ê°€ë‚˜ë‹¤ìˆœìœ¼ë¡œ ì •ë ¬

<b>ğŸ’¾ ë£° ì €ì¥ ì•Œë¦¼ ì¶”ê°€</b>
â€¢ ë°©ì¥ì´ ë£°ì„ ì €ì¥í•˜ë©´ "{ë£° ë‚´ìš©} ë£°ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤." íŒì—… í‘œì‹œ

<b>ğŸ“± ë””ë°”ì´ìŠ¤ ì•„ì´ì½˜ í•­ìƒ í‘œì‹œ</b>
â€¢ ì»´í“¨í„°(ğŸ’»), ì‚¬ê³¼(ğŸ), AOS(ğŸ“±) ì•„ì´ì½˜ì´ ëª¨ë“  ì±„íŒ… ë©”ì‹œì§€ì—ì„œ í•­ìƒ í‘œì‹œ
â€¢ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë¦° í›„ì—ë„ ì•„ì´ì½˜ì´ ìœ ì§€ë¨

<b>ğŸ¬ ì£¼ì‚¬ìœ„ ì• ë‹ˆë©”ì´ì…˜ ê°œì„ </b>

<b>ğŸ’° êµ¬ê¸€ ê´‘ê³  ì¶”ê°€</b>
â€¢ Google AdSense ê´‘ê³  í†µí•©
â€¢ ë°© ëª©ë¡ ì•„ë˜ ê´‘ê³  ë°°ì¹˜

<b>ğŸ’¬ ì±„íŒ… UI ê°œì„ </b>
â€¢ ê²Œì„ ì‹œì‘ ì‹œ ì±„íŒ…ì— ê²Œì„ ë£° ìë™ í‘œì‹œ
â€¢ ê·¸ë¼ë””ì–¸íŠ¸ ë°°ê²½ê³¼ ì¹´ë“œ ìŠ¤íƒ€ì¼ë¡œ ì‹œê°ì  ê°œì„ 
â€¢ ì—¬ëŸ¬ ì¤„ ë£° ì§€ì› (ì¤‘ì•™ ì •ë ¬)

<b>ğŸ² ì£¼ì‚¬ìœ„ ê²°ê³¼ í‘œì‹œ ìµœì í™”</b>
â€¢ /ì£¼ì‚¬ìœ„ ëª…ë ¹ì–´ì™€ ê²°ê³¼ë¥¼ ê°™ì€ ì¤„ì— í‘œì‹œ
â€¢ ì£¼ì‚¬ìœ„ ê²°ê³¼ë¥¼ ì˜¤ë¥¸ìª½ ëì— ì •ë ¬
â€¢ ê¸°ë¡ ì €ì¥ ì—¬ë¶€ì— ë”°ë¥¸ ì•„ì´ì½˜ í‘œì‹œ ì°¨ë³„í™”
  - ê¸°ë¡ ì €ì¥: ğŸ² ì•„ì´ì½˜ + ìˆ«ì (ì˜ˆ: ğŸ² 8)
  - ê¸°ë¡ ë¯¸ì €ì¥: ìˆ«ìë§Œ í‘œì‹œ (ì˜ˆ: 8), ì˜¤ë¥¸ìª½ ë ì •ë ¬

<b>ğŸ“ ê²Œì„ ê¸°ë¡ ì €ì¥ ë¡œì§ ê°œì„ </b>
â€¢ ê²Œì„ ì§„í–‰ ì¤‘ ìµœì´ˆ 1íšŒë§Œ ê¸°ë¡ì— ì €ì¥
â€¢ ê¸°ë¡ì— ì €ì¥ë˜ì§€ ì•ŠëŠ” ì£¼ì‚¬ìœ„ëŠ” ì±„íŒ…ì— ì•„ì´ì½˜ ì—†ì´ ìˆ«ìë§Œ í‘œì‹œ

<b>ğŸ› ë²„ê·¸ ìˆ˜ì •</b>
â€¢ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë¦¬ì§€ ì•Šì€ ì‚¬ëŒ ì§‘ê³„ ê¸°ëŠ¥ ìˆ˜ì •
  - ê²Œì„ ì‹œì‘ í›„ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë¦¬ì§€ ì•Šì€ ì‚¬ëŒì´ ì˜¬ë°”ë¥´ê²Œ ì§‘ê³„ë˜ì§€ ì•Šë˜ ë¬¸ì œ ìˆ˜ì •
â€¢ ê²Œì„ ì¬ì‹œì‘ ì‹œ ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í”Œë˜ê·¸ ì´ˆê¸°í™”ë¡œ ë©”ì‹œì§€ íƒ€ì´ë° ë¬¸ì œ í•´ê²°
â€¢ Socket.IO ì¬ì—°ê²° ë¡œì§ ê°œì„  (disconnect íƒ€ì„ì•„ì›ƒ ì¡°ì •)
â€¢ ì¤‘ë³µ ì´ë¦„ ì²´í¬ ê°•í™” (ì‹¤ì œ ì—°ê²°ëœ socket í™•ì¸)

---

<b style="color: #667eea;">ğŸ“… ì´ì „ ì—…ë°ì´íŠ¸</b> <span style="color: #999; font-size: 12px; font-weight: normal;">(2025-11-04)</span>

<b>ğŸ¨ UI êµ¬ì„± ê°œì„ </b>
â€¢ ê²Œì„ í™”ë©´ ë ˆì´ì•„ì›ƒ ì¬êµ¬ì„± (ë°© ì œëª© â†’ ê²Œì„ ë£° â†’ ì£¼ì‚¬ìœ„ ëª…ë ¹ì–´ ì…ë ¥ â†’ ì£¼ì‚¬ìœ„ ì•„ì´ì½˜)
â€¢ ì£¼ì‚¬ìœ„ ë²”ìœ„ ì„¤ì • ì„¹ì…˜ ì œê±° (ëª…ë ¹ì–´ë¡œ ëŒ€ì²´)

<b>ğŸ² ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° ë°©ì‹ ë³€ê²½</b>
â€¢ ë²„íŠ¼ ë°©ì‹ â†’ ì±„íŒ… ëª…ë ¹ì–´ ë°©ì‹ìœ¼ë¡œ ë³€ê²½
â€¢ `/ì£¼ì‚¬ìœ„ [ìˆ«ì]` ëª…ë ¹ì–´ë¡œ ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° (ì˜ˆ: /ì£¼ì‚¬ìœ„ 100)
â€¢ ìˆ«ì ì—†ì´ `/ì£¼ì‚¬ìœ„`ë§Œ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ 100 ì‚¬ìš©
â€¢ ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° ë²„íŠ¼ ì œê±°

<b>ğŸ” ì£¼ë¬¸ë°›ê¸° ì‹œìŠ¤í…œ ê°œì„ </b>
â€¢ ì£¼ë¬¸ë°›ê¸° ì„¹ì…˜ í•­ìƒ í‘œì‹œ (ì£¼ë¬¸ë°›ê¸° ì¢…ë£Œ í›„ì—ë„ ì£¼ë¬¸ ëª©ë¡ í‘œì‹œ)
â€¢ ì£¼ë¬¸ ëª©ë¡ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
â€¢ ì£¼ë¬¸ë¦¬ìŠ¤íŠ¸ ë³´ê¸° ë²„íŠ¼ í•­ìƒ í‘œì‹œ

<b>ğŸ“Š ê²Œì„ ê¸°ë¡ í‘œì‹œ ê°œì„ </b>
â€¢ ë²”ìœ„ í‘œì‹œ ê°„ì†Œí™” ("1~100" â†’ "100"ë§Œ í‘œì‹œ)

<b>ğŸ• ì‹œê°„ ê¸°ë¡ ê°œì„ </b>
â€¢ UTC+9 (í•œêµ­ í‘œì¤€ì‹œ) ì ìš©
â€¢ ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° ê¸°ë¡ ë° ì±„íŒ… ë©”ì‹œì§€ ì‹œê°„ì„ í•œêµ­ ì‹œê°„ìœ¼ë¡œ í‘œì‹œ

---

<b style="color: #667eea;">ğŸ“… ì´ì „ ì—…ë°ì´íŠ¸</b> <span style="color: #999; font-size: 12px; font-weight: normal;">(2025-11-03)</span>

<b>ğŸ”„ ë°© ìƒì„± ë° ì…ì¥ ì‹œìŠ¤í…œ ê°œì„ </b>
â€¢ ë°© ìƒì„± ì‹œ ë°© ì œëª© ìë™ ìƒì„± ("ì´ë¦„ë‹˜ì˜ Dice" í˜•ì‹)
â€¢ í˜¸ìŠ¤íŠ¸ ì´ë¦„ ì…ë ¥ ì‹œ ë°© ì œëª© ì‹¤ì‹œê°„ ìë™ ì—…ë°ì´íŠ¸
â€¢ ë°© ìƒì„± ì „ ë°© ì œëª©ê³¼ í˜¸ìŠ¤íŠ¸ ì´ë¦„ë§Œ ì…ë ¥í•˜ë©´ ê°„í¸í•˜ê²Œ ìƒì„±
â€¢ ì£¼ì‚¬ìœ„ ë²”ìœ„ ë° ê²Œì„ ë£°ì€ ë°© ìƒì„± í›„ ë°© ë‚´ë¶€ì—ì„œ ì„¤ì • ê°€ëŠ¥

<b>ğŸ‘¤ ì „ì—­ ì´ë¦„ ì‹œìŠ¤í…œ</b>
â€¢ ëŒ€ê¸°ì‹¤ì—ì„œ í•œ ë²ˆë§Œ ì´ë¦„ ì…ë ¥í•˜ë©´ ëª¨ë“  ë°©ì— ë™ì¼ ì´ë¦„ìœ¼ë¡œ ì…ì¥
â€¢ ë§ˆì§€ë§‰ ì‚¬ìš©í•œ ì´ë¦„ localStorageì— ìë™ ì €ì¥
â€¢ í˜ì´ì§€ ì¬ì ‘ì† ì‹œ ë§ˆì§€ë§‰ ì´ë¦„ ìë™ ë¶ˆëŸ¬ì˜¤ê¸°
â€¢ ë°© ìƒì„± ì‹œ í˜¸ìŠ¤íŠ¸ ì´ë¦„ì€ ë³„ë„ë¡œ ì…ë ¥ (ì „ì—­ ì´ë¦„ê³¼ ë¶„ë¦¬)

<b>ğŸ‘‘ í˜¸ìŠ¤íŠ¸ ê¶Œí•œ ìë™ ì „ë‹¬ ì‹œìŠ¤í…œ</b>
â€¢ í˜¸ìŠ¤íŠ¸ê°€ ë‚˜ê°€ë„ ë°©ì´ ìë™ìœ¼ë¡œ ìœ ì§€ë¨
â€¢ ë‚¨ì€ ì‚¬ìš©ìê°€ ìˆìœ¼ë©´ ì²« ë²ˆì§¸ ì‚¬ìš©ìì—ê²Œ í˜¸ìŠ¤íŠ¸ ê¶Œí•œ ìë™ ì „ë‹¬
â€¢ í˜¸ìŠ¤íŠ¸ ê¶Œí•œ ì „ë‹¬ ì‹œ ìƒˆ í˜¸ìŠ¤íŠ¸ì—ê²Œ ìë™ ì•Œë¦¼
â€¢ í˜¸ìŠ¤íŠ¸ UI (ë°°ì§€, ë²„íŠ¼) ìë™ ì—…ë°ì´íŠ¸
â€¢ ëª¨ë“  ì‚¬ìš©ì ë‚˜ê°€ë©´ ë°© ìë™ ì‚­ì œ

<b>ğŸšª ë°© ì…ì¥ UX ê°œì„ </b>
â€¢ ë°© ëª©ë¡ì—ì„œ ì…ì¥í•˜ê¸° ë²„íŠ¼ í´ë¦­ë§Œìœ¼ë¡œ ì¦‰ì‹œ ì…ì¥
â€¢ ë³„ë„ ì…ì¥ í™•ì¸ ë‹¨ê³„ ì œê±°ë¡œ ë” ë¹ ë¥¸ ì…ì¥
â€¢ ì „ì—­ ì´ë¦„ìœ¼ë¡œ ìë™ ì…ì¥ (ë§¤ë²ˆ ì´ë¦„ ì…ë ¥ ë¶ˆí•„ìš”)

<b>âœ… ë°© ì‹œìŠ¤í…œ</b>
â€¢ ì—¬ëŸ¬ ë°© ìƒì„± ë° ì…ì¥ ê¸°ëŠ¥
â€¢ ë°© ëª©ë¡ì—ì„œ ì‹¤ì‹œê°„ ìƒíƒœ í™•ì¸ (ëŒ€ê¸° ì¤‘/ê²Œì„ ì§„í–‰ ì¤‘/ì£¼ë¬¸ë°›ê¸° ì¤‘)
â€¢ ë‚´ê°€ ì°¸ì—¬ ì¤‘ì¸ ë°© í‘œì‹œ
â€¢ ë°© ëª©ë¡ ì‹¤ì‹œê°„ ìƒˆë¡œê³ ì¹¨

<b>âœ… ì¤€ë¹„ ì‹œìŠ¤í…œ</b>
â€¢ ê²Œì„ ì‹œì‘ ì „ ì¤€ë¹„ ë²„íŠ¼ìœ¼ë¡œ ì°¸ì—¬ì ì„ íƒ
â€¢ ì¤€ë¹„í•œ ì‚¬ëŒë§Œ ê²Œì„ì— ì°¸ì—¬
â€¢ ì¤€ë¹„ ëª©ë¡ ì‹¤ì‹œê°„ í‘œì‹œ

<b>âœ… ì±„íŒ… ê¸°ëŠ¥</b>
â€¢ ë°© ë‚´ë¶€ì—ì„œ ì‹¤ì‹œê°„ ì±„íŒ… ê°€ëŠ¥
â€¢ í˜¸ìŠ¤íŠ¸ êµ¬ë¶„ í‘œì‹œ (ğŸ‘‘)
â€¢ Enter í‚¤ë¡œ ë¹ ë¥¸ ì „ì†¡

<b>âœ… ë°© ê´€ë¦¬ ê¸°ëŠ¥</b>
â€¢ í˜¸ìŠ¤íŠ¸ê°€ ë°© ì œëª© ë³€ê²½ ê°€ëŠ¥
â€¢ ì´ì „ ê²Œì„ ë°ì´í„° ì‚­ì œ ê¸°ëŠ¥

<b>âœ… ì£¼ë¬¸ë°›ê¸° ì‹œìŠ¤í…œ</b>
â€¢ ê²Œì„ ì¢…ë£Œ í›„ ì£¼ë¬¸ë°›ê¸° ê¸°ëŠ¥
â€¢ ìì£¼ ì“°ëŠ” ë©”ë‰´ ìë™ì™„ì„±
â€¢ ë©”ë‰´ë³„ ê·¸ë£¹í™” ë° ì •ë ¬
                </div>
            </div>
        </div>

        <!-- ë°© ìƒì„± í˜ì´ì§€ -->
        <div class="create-room-section" id="createRoomSection">
            <div style="margin-bottom: 20px;">
                <button onclick="goBackToLobby()" style="width: auto; padding: 10px 20px; margin-bottom: 15px; background: #6c757d;">â† ëŒ€ê¸°ì‹¤ë¡œ ëŒì•„ê°€ê¸°</button>
                <h2 style="margin-bottom: 20px; color: #667eea;">ë°© ë§Œë“¤ê¸°</h2>
            </div>
            
            <!-- ë¡œê³  ë° ì—°ê²° ìƒíƒœ -->
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="display: inline-flex; align-items: center; gap: 10px;">
                    <span style="font-size: 24px;">ğŸ²</span>
                    <span style="font-size: 20px; font-weight: 600; color: #667eea;">LAM Dice :)</span>
                    <span class="connection-status connected" id="createRoomConnectionStatus">â— ì—°ê²°ë¨</span>
                </div>
            </div>
            
            <!-- ë°© ì œëª© ì…ë ¥ -->
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 2px solid #667eea;">
                <div class="input-group" style="margin-bottom: 0;">
                    <label for="createRoomNameInput">ë°© ì œëª©</label>
                    <input type="text" id="createRoomNameInput" placeholder="ë°© ì œëª© ì…ë ¥" maxlength="30" />
                </div>
            </div>
            
            <!-- í˜¸ìŠ¤íŠ¸ ì´ë¦„ ì…ë ¥ (ë°© ìƒì„± ì‹œì—ë§Œ ì‚¬ìš©) -->
            <div class="input-group" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 2px solid #667eea;">
                <label for="createRoomHostNameInput">í˜¸ìŠ¤íŠ¸ ì´ë¦„</label>
                <input type="text" id="createRoomHostNameInput" placeholder="í˜¸ìŠ¤íŠ¸ ì´ë¦„ ì…ë ¥" maxlength="20" />
            </div>
            
            <!-- ê²Œì„ íƒ€ì… ì„ íƒ -->
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 2px solid #667eea;">
                        <label style="display: block; margin-bottom: 10px; font-weight: 500;">ê²Œì„ íƒ€ì…</label>
                        <div style="display: flex; gap: 15px;">
                            <label style="flex: 1; display: flex; align-items: center; padding: 12px; background: white; border: 2px solid #667eea; border-radius: 8px; cursor: pointer; transition: all 0.2s;">
                                <input type="radio" name="gameType" value="dice" id="gameTypeDice" checked style="width: 20px; height: 20px; margin-right: 10px; cursor: pointer;" />
                                <span style="font-weight: 500;">ğŸ² ì£¼ì‚¬ìœ„ ê²Œì„</span>
                            </label>
                            <label style="flex: 1; display: flex; align-items: center; padding: 12px; background: #e9ecef; border: 2px solid #ced4da; border-radius: 8px; cursor: not-allowed; opacity: 0.6;">
                                <input type="radio" name="gameType" value="ladder" id="gameTypeLadder" disabled style="width: 20px; height: 20px; margin-right: 10px; cursor: not-allowed;" />
                                <span style="font-weight: 500;">ğŸªœ ì‚¬ë‹¤ë¦¬íƒ€ê¸° (ì¤€ë¹„ ì¤‘)</span>
                            </label>
                        </div>
                    </div>
            
            <!-- ê³µê°œ/ë¹„ê³µê°œ ì„¤ì • -->
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 2px solid #667eea;">
                <div style="display: flex; align-items: center; margin-bottom: 15px;">
                    <input type="checkbox" id="createRoomPrivateCheckbox" style="width: 20px; height: 20px; margin-right: 10px; cursor: pointer;" />
                    <label for="createRoomPrivateCheckbox" style="cursor: pointer; font-weight: 500; margin: 0;">ë¹„ê³µê°œ ë°©</label>
                </div>
                <div id="createRoomPasswordContainer" style="display: none;">
                    <div class="input-group" style="margin-bottom: 0;">
                        <label for="createRoomPasswordInput">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="createRoomPasswordInput" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ (4~20ì)" maxlength="20" />
                    </div>
                </div>
            </div>
            
            <!-- ë°© ìƒì„±í•˜ê¸° ë²„íŠ¼ (ë§¨ ì•„ë˜) -->
            <button onclick="finalizeRoomCreation()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin-top: 30px; width: 100%;">ë°© ìƒì„±í•˜ê¸°</button>
        </div>

        <!-- ê²Œì„ ì„¹ì…˜ -->
        <div class="game-section" id="gameSection">
            <div class="user-info">
                <div>
                    <span class="user-name" id="currentUser"></span>
                    <span class="host-badge" id="hostBadge" style="display: none;">HOST</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span class="connection-status connected" id="connectionStatus">â— ì—°ê²°ë¨</span>
                    <span id="roomPasswordDisplay" style="font-size: 12px; color: #667eea; font-weight: 500; display: none;"></span>
                </div>
            </div>
            
            <!-- ì¬ì ‘ì† ì•Œë¦¼ -->
            <div class="reconnect-notice" id="reconnectNotice" style="display: none;">
                <strong>ğŸ”„ ì¬ì ‘ì†í•˜ì…¨ìŠµë‹ˆë‹¤!</strong>
                <p id="reconnectMessage"></p>
            </div>

            <!-- 1. ë°© ì œëª© -->
            <div class="room-info-section" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 2px solid #667eea;">
                <div id="roomNameDisplay" style="font-size: 18px; font-weight: 600; color: #667eea; margin-bottom: 10px;">
                    <span id="roomNameText">ë°© ì œëª©</span>
                </div>
                <div id="roomNameEditSection" style="display: none;">
                    <div class="input-group" style="margin-bottom: 10px;">
                        <input type="text" id="roomNameInput" placeholder="ë°© ì œëª© ì…ë ¥" maxlength="30" />
                    </div>
                    <button onclick="saveRoomName()" style="width: auto; padding: 8px 16px; margin-right: 10px;">ì €ì¥</button>
                    <button onclick="cancelRoomNameEdit()" style="width: auto; padding: 8px 16px; background: #6c757d;">ì·¨ì†Œ</button>
                </div>
                <button id="editRoomNameButton" onclick="editRoomName()" style="width: auto; padding: 8px 16px; font-size: 14px; display: none;">ë°© ì œëª© ë³€ê²½</button>
            </div>

            <!-- 2. ê²Œì„ ë£° ì„¹ì…˜ -->
            <div class="game-rules-section" id="gameRulesSection" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 2px solid #667eea;">
                <div class="dice-settings-title">ğŸ“‹ ê²Œì„ ë£°</div>
                <div class="input-group">
                    <textarea 
                        id="gameRulesInput" 
                        placeholder="ê²Œì„ ë£°ì„ ì…ë ¥í•˜ì„¸ìš” (ê²Œì„ ì‹œì‘ ì „ì—ë§Œ ìˆ˜ì • ê°€ëŠ¥)"
                        maxlength="500"
                        rows="3"
                        disabled
                    ></textarea>
                </div>
                <button onclick="updateGameRules()" id="gameRulesSaveButton" style="width: auto; padding: 12px 20px;" disabled>ì €ì¥</button>
                <div style="margin-top: 8px; font-size: 12px; color: #999;">
                    ê²Œì„ ì‹œì‘ ì „ì—ë§Œ ìˆ˜ì • ê°€ëŠ¥í•©ë‹ˆë‹¤
                </div>
            </div>


            <!-- ì ‘ì†ì ë¦¬ìŠ¤íŠ¸ -->
            <div class="users-section">
                <div class="users-title">ğŸ‘¥ ì ‘ì†ì (<span id="userCount">0</span>ëª…)</div>
                <div class="users-list" id="usersList">
                    <div style="color: #999; text-align: center; padding: 10px; width: 100%;">ì ‘ì†ìê°€ ì—†ìŠµë‹ˆë‹¤</div>
                </div>
            </div>
            
            <!-- ì¤€ë¹„ ìƒíƒœ -->
            <div class="ready-section" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 2px solid #667eea; display: none;" id="readySection">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div class="users-title" style="margin: 0;">âœ… ì¤€ë¹„í•œ ì‚¬ëŒ (<span id="readyCount">0</span>ëª…)</div>
                    <button id="readyButton" onclick="toggleReady()" style="width: auto; padding: 10px 20px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">ì¤€ë¹„</button>
                </div>
                <div class="users-list" id="readyUsersList" style="min-height: 50px;">
                    <div style="color: #999; text-align: center; padding: 10px; width: 100%;">ì•„ì§ ì¤€ë¹„í•œ ì‚¬ëŒì´ ì—†ìŠµë‹ˆë‹¤</div>
                </div>
            </div>

            <div class="game-status waiting" id="gameStatus">
                ê²Œì„ ëŒ€ê¸° ì¤‘...
            </div>

            <!-- ì§„í–‰ ìƒí™© í‘œì‹œ -->
            <div class="progress-section" id="progressSection" style="display: none;">
                <div class="progress-title">ğŸ“Š ì§„í–‰ ìƒí™©</div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                <div class="progress-text">
                    <span id="progressCount">0/0</span> ëª… ì™„ë£Œ
                </div>
                
                <div class="not-rolled-section">
                    <div class="not-rolled-title">â³ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë¦¬ì§€ ì•Šì€ ì‚¬ëŒ</div>
                    <div class="not-rolled-list" id="notRolledList">
                        <!-- ë¯¸ì™„ë£Œì ëª©ë¡ -->
                    </div>
                </div>
            </div>

            <!-- Host ì „ìš© ì»¨íŠ¸ë¡¤ -->
            <div class="host-controls" id="hostControls" style="display: none;">
                <button onclick="startGame()" id="startButton">ê²Œì„ ì‹œì‘</button>
                <button onclick="endGame()" id="endButton" style="display: none;">ê²Œì„ ì¢…ë£Œ</button>
                <button onclick="startOrder()" id="startOrderButton" class="order-button" style="display: none;">ì£¼ë¬¸ë°›ê¸° ì‹œì‘</button>
                <button onclick="endOrder()" id="endOrderButton" class="order-button" style="display: none;">ì£¼ë¬¸ë°›ê¸° ì¢…ë£Œ</button>
                <button onclick="clearGameData()" id="clearDataButton" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);">ì´ì „ ê²Œì„ ë°ì´í„° ì‚­ì œ</button>
            </div>

            <!-- ì£¼ë¬¸ë°›ê¸° ì„¹ì…˜ -->
            <div class="orders-section" id="ordersSection">
                <div class="history-title-wrapper">
                    <div class="users-title">ğŸ” ì£¼ë¬¸ë°›ê¸°</div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button onclick="showOrderList()" id="showOrderListButton" class="order-button" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 8px 16px; font-size: 14px;">ğŸ“‹ ì£¼ë¬¸ë¦¬ìŠ¤íŠ¸ ë³´ê¸°</button>
                        <div class="sort-buttons">
                            <button class="sort-button active" id="sortOrderAscBtn" onclick="sortOrders('asc')">ê°€ë‚˜ë‹¤ìˆœ</button>
                            <button class="sort-button" id="sortOrderDescBtn" onclick="sortOrders('desc')">ê°€ë‚˜ë‹¤ ì—­ìˆœ</button>
                            <button class="sort-button" id="sortOrderCountBtn" onclick="sortOrders('count')">ì£¼ë¬¸ ë§ì€ ìˆœ</button>
                        </div>
                    </div>
                </div>
                
                <!-- ë‚´ ì£¼ë¬¸ ì…ë ¥ -->
                <div class="my-order-box">
                    <div class="my-order-title">
                        <span>ğŸ“</span>
                        <span>ë‚´ ì£¼ë¬¸</span>
                        <button onclick="toggleMenuManager()" style="width: auto; padding: 6px 12px; font-size: 12px; margin-left: auto; background: #f8f9fa; color: #667eea; border: 1px solid #667eea;">ë©”ë‰´ ê´€ë¦¬</button>
                    </div>
                    
                    <!-- ìì£¼ ì“°ëŠ” ë©”ë‰´ ê´€ë¦¬ -->
                    <div class="menu-manager" id="menuManager">
                        <div class="menu-manager-title">
                            <span>ğŸ“‹ ìì£¼ ì“°ëŠ” ë©”ë‰´</span>
                            <button onclick="toggleMenuManager()" style="width: auto; padding: 4px 8px; font-size: 12px; background: #dc3545; color: white; border: none; border-radius: 4px;">ë‹«ê¸°</button>
                        </div>
                        <div class="menu-manager-input">
                            <input type="text" id="menuInput" placeholder="ë©”ë‰´ ì¶”ê°€ (ì˜ˆ: ì¹˜í‚¨)" maxlength="50" />
                            <button onclick="addMenu()" style="width: auto; padding: 12px 20px; height: fit-content;">ì¶”ê°€</button>
                        </div>
                        <div class="menu-list" id="menuList">
                            <!-- ë©”ë‰´ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                    
                    <div class="order-input-group">
                        <div class="order-input-wrapper">
                            <div class="autocomplete-suggestion" id="autocompleteSuggestion"></div>
                            <input 
                                type="text"
                                id="myOrderInput" 
                                placeholder="ì£¼ë¬¸í•  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì˜¤ì´ˆ, ì˜¤ê³ )"
                                maxlength="100"
                                disabled
                            />
                            <div class="autocomplete-dropdown" id="autocompleteDropdown" style="display: none;"></div>
                        </div>
                        <button onclick="updateMyOrder()" id="orderSaveButton" style="width: auto; padding: 12px 20px; height: fit-content;" disabled>ì €ì¥</button>
                    </div>
                </div>

                <!-- ì „ì²´ ì£¼ë¬¸ ëª©ë¡ -->
                <div class="order-list" id="orderList">
                    <div style="color: #999; text-align: center; padding: 10px;">ì•„ì§ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤</div>
                </div>

                <!-- ì£¼ë¬¸í•˜ì§€ ì•Šì€ ì‚¬ëŒ ëª©ë¡ -->
                <div class="not-ordered-section" id="notOrderedSection" style="display: none;">
                    <div class="not-rolled-title" style="margin-top: 15px;">â³ ì£¼ë¬¸í•˜ì§€ ì•Šì€ ì‚¬ëŒ</div>
                    <div class="not-rolled-list" id="notOrderedList">
                        <!-- ì£¼ë¬¸í•˜ì§€ ì•Šì€ ì‚¬ëŒ ëª©ë¡ -->
                    </div>
                </div>
            </div>

            <!-- ì±„íŒ… ì„¹ì…˜ -->
            <div class="chat-history-wrapper">
                <div class="chat-section">
                    <div class="users-title" style="margin-bottom: 10px;">ğŸ’¬ ì±„íŒ… </div>
                    <div class="chat-messages" id="chatMessages" style="background: #f8f9fa; border-radius: 8px; padding: 15px; max-height: 480px; overflow-y: auto; margin-bottom: 10px; border: 2px solid #667eea;">
                        <div style="color: #999; text-align: center; padding: 10px;">ì±„íŒ… ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤</div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 10px;">
                        <div style="position: relative;">
                            <div class="autocomplete-suggestion" id="chatAutocompleteSuggestion" style="position: absolute; top: 10px; left: 10px; pointer-events: none; z-index: 10;"></div>
                            <input type="text" id="chatInput" placeholder="/ì£¼ì‚¬ìœ„ - ì…ë ¥í•˜ì‹œë©´ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤." maxlength="200" style="padding: 10px; border: 2px solid #667eea; border-radius: 8px; font-size: 14px; position: relative; background: transparent;" />
                            <div class="autocomplete-dropdown" id="chatAutocompleteDropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; z-index: 1000;"></div>
                        </div>
                        <button onclick="sendChatMessage()" style="width: auto; padding: 10px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">ì „ì†¡</button>
                    </div>
                </div>
            </div>

            <button class="logout-button" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>

    <!-- ê¸°ë¡ ì„¹ì…˜ (ì˜¤ë¥¸ìª½ ê³ ì •) -->
    <div class="history-section">
        <div class="history-title-wrapper">
            <div class="history-title" id="historyTitle">ğŸ“‹ ê²Œì„ ê¸°ë¡ - ì—°ìŠµê²½ê¸°</div>
            <div class="sort-buttons">
                <button class="sort-button active" id="sortTimeBtn" onclick="sortHistory('time')">ì‹œê°„ìˆœ</button>
                <button class="sort-button" id="sortAscBtn" onclick="sortHistory('asc')">ì˜¤ë¦„ì°¨ìˆœ</button>
                <button class="sort-button" id="sortDescBtn" onclick="sortHistory('desc')">ë‚´ë¦¼ì°¨ìˆœ</button>
            </div>
        </div>
        <div class="history-list" id="historyList">
            <div class="empty-history">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>
        </div>
        <div class="rolled-users-info" id="rolledUsersInfo" style="text-align: right; margin-top: 10px; padding-top: 10px; border-top: 1px solid #e0e0e0; color: #666; font-size: 14px;">
            ì´ ê¸°ë¡: <span id="rolledUsersCount">0</span>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        
        // ë””ë°”ì´ìŠ¤ íƒ€ì… ê°ì§€
        function getDeviceType() {
            const userAgent = navigator.userAgent;
            if (/iPhone|iPad|iPod/i.test(userAgent)) {
                return 'ios';
            } else if (/Android/i.test(userAgent)) {
                return 'android';
            } else {
                return 'pc';
            }
        }
        
        // ë””ë°”ì´ìŠ¤ íƒ€ì…ì— ë”°ë¥¸ ì•„ì´ì½˜ ë°˜í™˜
        function getDeviceIcon(deviceType) {
            switch(deviceType) {
                case 'ios':
                    return 'ğŸ';
                case 'android':
                    return 'ğŸ“±';
                case 'pc':
                default:
                    return 'ğŸ’»';
            }
        }
        
        // ì£¼ì‚¬ìœ„ ì—°ì¶œ íš¨ê³¼ í•¨ìˆ˜ë“¤
        const diceAnimationEffects = {
            // 1. ì¹´ìš´íŠ¸ì—… ì• ë‹ˆë©”ì´ì…˜
            countUp: function(diceResultSpan, diceIcon, finalResult, onComplete) {
                let currentNum = 1;
                const maxNum = Math.min(finalResult, 100);
                const steps = 50;
                const increment = Math.max(1, Math.floor(maxNum / steps));
                const interval = setInterval(() => {
                    currentNum += increment;
                    if (currentNum >= maxNum) {
                        currentNum = finalResult;
                        clearInterval(interval);
                        onComplete();
                    }
                    diceResultSpan.textContent = diceIcon + currentNum;
                }, 60);
            },
            
            // 2. ì˜¬ë¼ê°”ë‹¤ê°€ ë‚´ë ¤ì˜¤ëŠ” ì• ë‹ˆë©”ì´ì…˜
            upAndDown: function(diceResultSpan, diceIcon, finalResult, onComplete) {
                const targetNum = Math.min(finalResult, 100);
                const maxNum = 100;
                let currentNum = 1;
                
                // 1ë‹¨ê³„: ë¹ ë¥´ê²Œ 100ê¹Œì§€ ì˜¬ë¼ê°€ê¸°
                const upSteps = 30;
                const upIncrement = Math.max(1, Math.floor(maxNum / upSteps));
                const upInterval = setInterval(() => {
                    currentNum += upIncrement;
                    if (currentNum >= maxNum) {
                        currentNum = maxNum;
                        clearInterval(upInterval);
                        diceResultSpan.textContent = diceIcon + maxNum;
                        
                        // 2ë‹¨ê³„: 0.3ì´ˆ ëŒ€ê¸°
                        setTimeout(() => {
                            // 3ë‹¨ê³„: ê²°ê³¼ ìˆ«ìê¹Œì§€ ë‚´ë ¤ì˜¤ê¸° (ë„ì°© ì§ì „ì— ì²œì²œíˆ)
                            let downNum = maxNum;
                            let downDelay = 30; // ì´ˆê¸° ë”œë ˆì´
                            const downSteps = 40; // ë‚´ë ¤ì˜¤ëŠ” ë‹¨ê³„ ìˆ˜
                            const downIncrement = Math.max(1, Math.floor((maxNum - targetNum) / downSteps));
                            
                            const countDown = () => {
                                downNum -= downIncrement;
                                
                                // ë„ì°© ì§ì „ (targetNum + 40% ë²”ìœ„)ì— ë“¤ì–´ê°€ë©´ ì²œì²œíˆ
                                const slowDownThreshold = targetNum + (maxNum - targetNum) * 0.4;
                                if (downNum <= slowDownThreshold) {
                                    // ë” ë§ì´ ëŠë ¤ì§€ê²Œ (ì¦ê°€ëŸ‰ì„ í¬ê²Œ)
                                    downDelay = Math.min(downDelay + 8, 200); // ì ì  ëŠë ¤ì§€ê²Œ (ìµœëŒ€ 200ms)
                                }
                                
                                // ë§ˆì§€ë§‰ 10% ë²”ìœ„ì—ì„œëŠ” ë”ìš± ì²œì²œíˆ
                                const verySlowThreshold = targetNum + (maxNum - targetNum) * 0.1;
                                if (downNum <= verySlowThreshold) {
                                    downDelay = Math.min(downDelay + 10, 300); // ë§¤ìš° ì²œì²œíˆ (ìµœëŒ€ 300ms)
                                }
                                
                                if (downNum <= targetNum) {
                                    downNum = targetNum;
                                    diceResultSpan.textContent = diceIcon + targetNum;
                                    setTimeout(() => {
                                        onComplete();
                                    }, 200);
                                } else {
                                    diceResultSpan.textContent = diceIcon + downNum;
                                    setTimeout(countDown, downDelay);
                                }
                            };
                            
                            countDown();
                        }, 150); // 0.15ì´ˆ ëŒ€ê¸°
                    } else {
                        diceResultSpan.textContent = diceIcon + currentNum;
                    }
                }, 30); // ë¹ ë¥´ê²Œ ì˜¬ë¼ê°€ê¸°
            },
            
            // 3. í•œ ìë¦¬ì”© ë³´ì—¬ì£¼ëŠ” ì• ë‹ˆë©”ì´ì…˜
            digitByDigit: function(diceResultSpan, diceIcon, finalResult, onComplete) {
                const targetNum = Math.min(finalResult, 99); // ìµœëŒ€ 99ê¹Œì§€
                const onesDigit = targetNum % 10; // 1ì˜ ìë¦¬
                const tensDigit = Math.floor(targetNum / 10); // 10ì˜ ìë¦¬
                
                // í•œ ìë¦¬ìˆ˜ì¸ ê²½ìš° (0~9)
                if (targetNum < 10) {
                    // ì²˜ìŒì— ? í‘œì‹œ
                    diceResultSpan.textContent = diceIcon + '?';
                    
                    // 1ì˜ ìë¦¬ë§Œ ì• ë‹ˆë©”ì´ì…˜
                    let onesCurrent = 0;
                    let onesDelay = 100; // ì´ˆê¸° ë”œë ˆì´ (ì²œì²œíˆ)
                    let passedTarget = false; // ëª©í‘œ ìˆ«ìë¥¼ ì§€ë‚˜ì³¤ëŠ”ì§€
                    let spinCount = 0; // ëª‡ ë°”í€´ ëŒì•˜ëŠ”ì§€
                    const minSpins = 2; // ìµœì†Œ ëª‡ ë°”í€´ ëŒê¸°
                    
                    const animateOnes = () => {
                        onesCurrent++;
                        if (onesCurrent > 9) {
                            onesCurrent = 0;
                            if (passedTarget) spinCount++;
                        }
                        
                        // ëª©í‘œ ìˆ«ìë¥¼ ì§€ë‚˜ì³¤ëŠ”ì§€ í™•ì¸
                        if (onesCurrent === onesDigit && !passedTarget) {
                            passedTarget = true;
                        }
                        
                        diceResultSpan.textContent = diceIcon + onesCurrent;
                        
                        // ëª©í‘œ ìˆ«ìì— ë„ë‹¬í•˜ê³  ìµœì†Œ ë°”í€´ ìˆ˜ë¥¼ ëŒì•˜ìœ¼ë©´
                        if (onesCurrent === onesDigit && passedTarget && spinCount >= minSpins) {
                            diceResultSpan.textContent = diceIcon + targetNum;
                            
                            // í™•ëŒ€/ì¶•ì†Œ ì—°ì¶œ ì¶”ê°€
                            diceResultSpan.style.transition = 'transform 0.1s ease-out';
                            diceResultSpan.style.transform = 'scale(1.3)';
                            
                            setTimeout(() => {
                                diceResultSpan.style.transform = 'scale(1)';
                                setTimeout(() => {
                                    onComplete();
                                }, 100);
                            }, 100);
                        } else {
                            // ë„ì°© ì§ì „ì— ì²œì²œíˆ (ëª©í‘œ ìˆ«ì - 3 ë²”ìœ„)
                            if (passedTarget && spinCount >= minSpins - 1) {
                                const distance = (onesDigit - onesCurrent + 10) % 10;
                                if (distance <= 3 && distance > 0) {
                                    onesDelay = Math.min(onesDelay + 30, 200); // ì ì  ëŠë ¤ì§€ê²Œ
                                }
                            }
                            setTimeout(animateOnes, onesDelay);
                        }
                    };
                    
                    setTimeout(animateOnes, onesDelay);
                } else {
                    // ë‘ ìë¦¬ìˆ˜ì¸ ê²½ìš° (10~99)
                    // ì²˜ìŒì— ?? í‘œì‹œ
                    diceResultSpan.textContent = diceIcon + '??';
                    
                    // 1ì˜ ìë¦¬ ì• ë‹ˆë©”ì´ì…˜ (ì²œì²œíˆ ë–¨ì–´ì§€ëŠ” íš¨ê³¼ ì—†ìŒ - ë¹ ë¥´ê²Œ ì§„í–‰)
                    let onesCurrent = 0;
                    let onesDelay = 60; // ë¹ ë¥¸ ë”œë ˆì´
                    let onesPassedTarget = false;
                    let onesSpinCount = 0;
                    const onesMinSpins = 2;
                    
                    const animateOnes = () => {
                        onesCurrent++;
                        if (onesCurrent > 9) {
                            onesCurrent = 0;
                            if (onesPassedTarget) onesSpinCount++;
                        }
                        
                        if (onesCurrent === onesDigit && !onesPassedTarget) {
                            onesPassedTarget = true;
                        }
                        
                        diceResultSpan.textContent = diceIcon + '?' + onesCurrent;
                        
                        // 1ì˜ ìë¦¬ê°€ ëª©í‘œ ìˆ«ìì— ë„ë‹¬í•˜ê³  ìµœì†Œ ë°”í€´ ìˆ˜ë¥¼ ëŒì•˜ìœ¼ë©´
                        if (onesCurrent === onesDigit && onesPassedTarget && onesSpinCount >= onesMinSpins) {
                            diceResultSpan.textContent = diceIcon + '?' + onesDigit;
                            
                            // ì ì‹œ ëŒ€ê¸° í›„ 10ì˜ ìë¦¬ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
                            setTimeout(() => {
                                let tensCurrent = 0;
                                let tensDelay = 100; // ì´ˆê¸° ë”œë ˆì´
                                let tensPassedTarget = false;
                                let tensSpinCount = 0;
                                const tensMinSpins = 2;
                                
                                const animateTens = () => {
                                    tensCurrent++;
                                    if (tensCurrent > 9) {
                                        tensCurrent = 0;
                                        if (tensPassedTarget) tensSpinCount++;
                                    }
                                    
                                    if (tensCurrent === tensDigit && !tensPassedTarget) {
                                        tensPassedTarget = true;
                                    }
                                    
                                    diceResultSpan.textContent = diceIcon + tensCurrent + onesDigit;
                                    
                                    // 10ì˜ ìë¦¬ê°€ ëª©í‘œ ìˆ«ìì— ë„ë‹¬í•˜ê³  ìµœì†Œ ë°”í€´ ìˆ˜ë¥¼ ëŒì•˜ìœ¼ë©´
                                    if (tensCurrent === tensDigit && tensPassedTarget && tensSpinCount >= tensMinSpins) {
                                        diceResultSpan.textContent = diceIcon + targetNum;
                                        
                                        // í™•ëŒ€/ì¶•ì†Œ ì—°ì¶œ ì¶”ê°€
                                        diceResultSpan.style.transition = 'transform 0.1s ease-out';
                                        diceResultSpan.style.transform = 'scale(1.3)';
                                        
                                        setTimeout(() => {
                                            diceResultSpan.style.transform = 'scale(1)';
                                            setTimeout(() => {
                                                onComplete();
                                            }, 100);
                                        }, 100);
                                    } else {
                                        // ë„ì°© ì§ì „ì— ì²œì²œíˆ (ëª©í‘œ ìˆ«ì - 3 ë²”ìœ„) - ê°€ì¥ í° ìë¦¬ìˆ˜ë§Œ
                                        if (tensPassedTarget && tensSpinCount >= tensMinSpins - 1) {
                                            const distance = (tensDigit - tensCurrent + 10) % 10;
                                            if (distance <= 3 && distance > 0) {
                                                tensDelay = Math.min(tensDelay + 30, 200); // ì ì  ëŠë ¤ì§€ê²Œ
                                            }
                                        }
                                        setTimeout(animateTens, tensDelay);
                                    }
                                };
                                
                                setTimeout(animateTens, tensDelay);
                            }, 200); // 1ì˜ ìë¦¬ì™€ 10ì˜ ìë¦¬ ì‚¬ì´ ëŒ€ê¸° ì‹œê°„
                        } else {
                            // 1ì˜ ìë¦¬ëŠ” ì²œì²œíˆ ë–¨ì–´ì§€ëŠ” íš¨ê³¼ ì—†ìŒ - ë¹ ë¥´ê²Œ ì§„í–‰
                            setTimeout(animateOnes, onesDelay);
                        }
                    };
                    
                    setTimeout(animateOnes, onesDelay);
                }
            }
        };
        
        // ëœë¤ìœ¼ë¡œ ì—°ì¶œ íš¨ê³¼ ì„ íƒ (ë˜ëŠ” íŠ¹ì • íš¨ê³¼ ì„ íƒ)
        function playRandomDiceAnimation(diceResultSpan, diceIcon, finalResult, onComplete, animationIndex = null) {
            const effectNames = Object.keys(diceAnimationEffects);
            let selectedEffect;
            
            // íŠ¹ì • ì• ë‹ˆë©”ì´ì…˜ ì¸ë±ìŠ¤ê°€ ì§€ì •ëœ ê²½ìš° (í…ŒìŠ¤íŠ¸ìš©: 1001~1006)
            if (animationIndex !== null && animationIndex >= 0 && animationIndex < effectNames.length) {
                selectedEffect = effectNames[animationIndex];
                console.log(`í…ŒìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜ ì„ íƒ: ì¸ë±ìŠ¤ ${animationIndex} â†’ ${selectedEffect}`);
            } else {
                // ê²°ê³¼ì— ë”°ë¼ ì• ë‹ˆë©”ì´ì…˜ ì„ íƒ
                // 80 ë¯¸ë§Œì¼ ë•Œë§Œ ë‘ ë²ˆì§¸ ì• ë‹ˆë©”ì´ì…˜(upAndDown) ì‚¬ìš© ê°€ëŠ¥
                if (finalResult < 80 && effectNames.includes('upAndDown')) {
                    // 80 ë¯¸ë§Œì´ë©´ ëœë¤ìœ¼ë¡œ ì„ íƒ (countUp ë˜ëŠ” upAndDown)
                    selectedEffect = effectNames[Math.floor(Math.random() * effectNames.length)];
                } else {
                    // 80 ì´ìƒì´ë©´ ì²« ë²ˆì§¸ ì• ë‹ˆë©”ì´ì…˜(countUp)ë§Œ ì‚¬ìš©
                    selectedEffect = 'countUp';
                }
            }
            
            diceAnimationEffects[selectedEffect](diceResultSpan, diceIcon, finalResult, onComplete);
        }
        
        // ëª¨ë°”ì¼ ì ‘ì† ê°ì§€
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                   (window.innerWidth <= 768);
        }
        
        let currentUser = '';
        let isHost = false;
        let isGameActive = false;
        let isOrderActive = false;
        let diceMax = 100;
        let myDiceSettings = { max: 100 };
        let hasRolledInCurrentGame = false;
        let rolledUsersInGame = []; // ê²Œì„ ì¤‘ êµ´ë¦° ì‚¬ìš©ì ëª©ë¡ ì¶”ì 
        let historyData = [];
        let currentSortMode = 'time'; // ê¸°ë³¸ê°’ì„ ì‹œê°„ìˆœìœ¼ë¡œ ë³€ê²½
        let ordersData = {};
        let currentOrderSortMode = 'asc'; // ì£¼ë¬¸ ì •ë ¬ ëª¨ë“œ: 'asc' (ê°€ë‚˜ë‹¤ìˆœ), 'desc' (ê°€ë‚˜ë‹¤ ì—­ìˆœ), 'count' (ì£¼ë¬¸ ë§ì€ ìˆœ)
        let usersList = []; // ì ‘ì†ì ëª©ë¡
        let frequentMenus = []; // ìì£¼ ì“°ëŠ” ë©”ë‰´ ëª©ë¡
        let readyUsers = []; // ì¤€ë¹„í•œ ì‚¬ìš©ì ëª©ë¡
        let isReady = false; // ë‚´ ì¤€ë¹„ ìƒíƒœ
        let currentSuggestions = []; // í˜„ì¬ ìë™ì™„ì„± ì œì•ˆ ëª©ë¡
        let selectedSuggestionIndex = -1; // ì„ íƒëœ ì œì•ˆ ì¸ë±ìŠ¤
        
        // ì„œë²„ì—ì„œ ìì£¼ ì“°ëŠ” ë©”ë‰´ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadFrequentMenus() {
            socket.emit('getFrequentMenus');
        }
        
        // ì„œë²„ì—ì„œ ë©”ë‰´ ëª©ë¡ ì—…ë°ì´íŠ¸ ìˆ˜ì‹ 
        socket.on('frequentMenusUpdated', (menus) => {
            frequentMenus = menus;
            renderMenuList();
        });
        
        // ë©”ë‰´ ê´€ë¦¬ UI í† ê¸€
        function toggleMenuManager() {
            const menuManager = document.getElementById('menuManager');
            menuManager.classList.toggle('active');
        }
        
        // ë©”ë‰´ ì¶”ê°€
        function addMenu() {
            const menuInput = document.getElementById('menuInput');
            const menu = menuInput.value.trim();
            
            if (menu === '') {
                alert('ë©”ë‰´ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            // ì„œë²„ì— ë©”ë‰´ ì¶”ê°€ ìš”ì²­
            socket.emit('addFrequentMenu', { menu: menu });
            menuInput.value = '';
        }
        
        // ë©”ë‰´ ì…ë ¥ í•„ë“œì—ì„œ Enter í‚¤ë¡œ ì¶”ê°€
        document.addEventListener('DOMContentLoaded', () => {
            const menuInput = document.getElementById('menuInput');
            if (menuInput) {
                menuInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        addMenu();
                    }
                });
            }
        });
        
        // ë©”ë‰´ ì‚­ì œ
        function deleteMenu(menu) {
            // ì„œë²„ì— ë©”ë‰´ ì‚­ì œ ìš”ì²­
            socket.emit('deleteFrequentMenu', { menu: menu });
        }
        
        // ë©”ë‰´ ì—ëŸ¬ ì²˜ë¦¬
        socket.on('menuError', (message) => {
            alert(message);
        });
        
        // ë©”ë‰´ ëª©ë¡ ë Œë”ë§
        function renderMenuList() {
            const menuList = document.getElementById('menuList');
            
            if (frequentMenus.length === 0) {
                menuList.innerHTML = '<div style="color: #999; text-align: center; padding: 10px;">ë“±ë¡ëœ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }
            
            menuList.innerHTML = '';
            frequentMenus.forEach(menu => {
                const tag = document.createElement('span');
                tag.className = 'menu-tag';
                tag.innerHTML = `${menu}<span class="delete-btn" onclick="deleteMenu('${menu}')">Ã—</span>`;
                menuList.appendChild(tag);
            });
        }
        
        // ì±„íŒ… ì…ë ¥ì°½ìš© ìë™ì™„ì„± ì œì•ˆ ì°¾ê¸°
        function findChatAutocompleteSuggestions(text) {
            if (!text || text.trim() === '') {
                return [];
            }
            
            const trimmedText = text.trim();
            
            // /, /ã…ˆ, /ì£¼, /ì£¼ã……, /ì£¼ì‚¬, /ì£¼ì‚¬ã…‡, /ì£¼ì‚¬ìš° ë“±ìœ¼ë¡œ ì‹œì‘í•˜ë©´ /ì£¼ì‚¬ìœ„ ì œì•ˆ
            // í•œê¸€ ìëª¨ ì…ë ¥ì„ ê³ ë ¤í•œ íŒ¨í„´ ë§¤ì¹­
            if (trimmedText === '/' || 
                trimmedText === '/ã…ˆ' ||
                trimmedText.startsWith('/ì£¼') ||
                trimmedText.startsWith('/ì£¼ì‚¬')) {
                // /ì£¼ì‚¬ìœ„ë¡œ ì™„ì„±ë˜ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ ì œì•ˆ
                if (trimmedText !== '/ì£¼ì‚¬ìœ„' && !trimmedText.startsWith('/ì£¼ì‚¬ìœ„')) {
                    return ['/ì£¼ì‚¬ìœ„'];
                }
            }
            
            return [];
        }
        
        // ìë™ì™„ì„± ì œì•ˆ ì°¾ê¸° (ëª¨ë“  ì¼ì¹˜ í•­ëª©)
        function findAutocompleteSuggestions(text) {
            if (!text || text.trim() === '') {
                return [];
            }
            
            const lowerText = text.toLowerCase();
            const suggestions = [];
            
            // ë©”ë‰´ ëª©ë¡ì—ì„œ ì¼ì¹˜í•˜ëŠ” ëª¨ë“  í•­ëª© ì°¾ê¸°
            for (const menu of frequentMenus) {
                if (menu.toLowerCase().startsWith(lowerText)) {
                    // ì´ë¯¸ ì™„ì „íˆ ì…ë ¥í•œ ê²½ìš°ëŠ” ì œì•ˆí•˜ì§€ ì•ŠìŒ
                    if (menu.toLowerCase() !== lowerText) {
                        suggestions.push(menu);
                    }
                }
            }
            
            return suggestions;
        }
        
        // ìë™ì™„ì„± ì œì•ˆ ì—…ë°ì´íŠ¸
        function updateAutocompleteSuggestion() {
            const orderInput = document.getElementById('myOrderInput');
            const suggestionDiv = document.getElementById('autocompleteSuggestion');
            const dropdownDiv = document.getElementById('autocompleteDropdown');
            const text = orderInput.value;
            
            currentSuggestions = findAutocompleteSuggestions(text);
            selectedSuggestionIndex = -1;
            
            if (currentSuggestions.length > 0) {
                // ì²« ë²ˆì§¸ ì œì•ˆì„ íšŒìƒ‰ í…ìŠ¤íŠ¸ë¡œ í‘œì‹œ
                const firstSuggestion = currentSuggestions[0];
                const remainingText = firstSuggestion.substring(text.length);
                suggestionDiv.textContent = text + remainingText;
                suggestionDiv.style.display = 'block';
                
                // ì—¬ëŸ¬ ê°œì˜ ì œì•ˆì´ ìˆìœ¼ë©´ ë“œë¡­ë‹¤ìš´ í‘œì‹œ
                if (currentSuggestions.length > 1) {
                    renderAutocompleteDropdown();
                    dropdownDiv.style.display = 'block';
                } else {
                    dropdownDiv.style.display = 'none';
                }
            } else {
                suggestionDiv.textContent = '';
                suggestionDiv.style.display = 'none';
                dropdownDiv.style.display = 'none';
            }
        }
        
        // ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ ë Œë”ë§
        function renderAutocompleteDropdown() {
            const dropdownDiv = document.getElementById('autocompleteDropdown');
            const orderInput = document.getElementById('myOrderInput');
            const text = orderInput.value;
            
            dropdownDiv.innerHTML = '';
            
            currentSuggestions.forEach((menu, index) => {
                const item = document.createElement('div');
                item.className = 'autocomplete-item' + (index === selectedSuggestionIndex ? ' selected' : '');
                item.textContent = menu;
                
                // ì…ë ¥ëœ ë¶€ë¶„ ê°•ì¡°
                const prefix = document.createElement('strong');
                prefix.textContent = menu.substring(0, text.length);
                const suffix = document.createElement('span');
                suffix.textContent = menu.substring(text.length);
                
                item.innerHTML = '';
                item.appendChild(prefix);
                item.appendChild(suffix);
                
                item.addEventListener('click', () => {
                    applySuggestion(menu);
                });
                
                dropdownDiv.appendChild(item);
            });
        }
        
        // ì œì•ˆ ì ìš©
        function applySuggestion(menu) {
            const orderInput = document.getElementById('myOrderInput');
            orderInput.value = menu;
            currentSuggestions = [];
            selectedSuggestionIndex = -1;
            document.getElementById('autocompleteSuggestion').style.display = 'none';
            document.getElementById('autocompleteDropdown').style.display = 'none';
            orderInput.focus();
        }
        
        // Tab í‚¤ë¡œ ìë™ì™„ì„± ì ìš©
        function setupAutocomplete() {
            const orderInput = document.getElementById('myOrderInput');
            const dropdownDiv = document.getElementById('autocompleteDropdown');
            
            orderInput.addEventListener('input', () => {
                updateAutocompleteSuggestion();
            });
            
            orderInput.addEventListener('keydown', (e) => {
                // Enter í‚¤ ì²˜ë¦¬
                if (e.key === 'Enter') {
                    // ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ì´ ì—´ë ¤ìˆìœ¼ë©´ ìë™ì™„ì„± ì ìš©
                    if (currentSuggestions.length > 0) {
                        e.preventDefault();
                        const menuToApply = selectedSuggestionIndex >= 0 
                            ? currentSuggestions[selectedSuggestionIndex] 
                            : currentSuggestions[0];
                        applySuggestion(menuToApply);
                        return;
                    }
                    // ë“œë¡­ë‹¤ìš´ì´ ì—†ìœ¼ë©´ ì£¼ë¬¸ ì €ì¥
                    e.preventDefault();
                    updateMyOrder();
                    return;
                }
                
                // Tabìœ¼ë¡œ ìë™ì™„ì„± ì ìš©
                if (e.key === 'Tab' && currentSuggestions.length > 0) {
                    e.preventDefault();
                    const menuToApply = selectedSuggestionIndex >= 0 
                        ? currentSuggestions[selectedSuggestionIndex] 
                        : currentSuggestions[0];
                    applySuggestion(menuToApply);
                    return;
                }
                
                // ë°©í–¥í‚¤ë¡œ ì œì•ˆ ì„ íƒ
                if (e.key === 'ArrowDown' && currentSuggestions.length > 0) {
                    e.preventDefault();
                    selectedSuggestionIndex = (selectedSuggestionIndex + 1) % currentSuggestions.length;
                    renderAutocompleteDropdown();
                    updateSuggestionDisplay();
                    return;
                }
                
                if (e.key === 'ArrowUp' && currentSuggestions.length > 0) {
                    e.preventDefault();
                    selectedSuggestionIndex = selectedSuggestionIndex <= 0 
                        ? currentSuggestions.length - 1 
                        : selectedSuggestionIndex - 1;
                    renderAutocompleteDropdown();
                    updateSuggestionDisplay();
                    return;
                }
                
                // Escapeë¡œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
                if (e.key === 'Escape') {
                    currentSuggestions = [];
                    selectedSuggestionIndex = -1;
                    dropdownDiv.style.display = 'none';
                    document.getElementById('autocompleteSuggestion').style.display = 'none';
                    return;
                }
            });
            
            // í¬ì»¤ìŠ¤ ìƒì„ ë•Œ ì œì•ˆ ìˆ¨ê¸°ê¸°
            orderInput.addEventListener('blur', () => {
                setTimeout(() => {
                    document.getElementById('autocompleteSuggestion').style.display = 'none';
                    dropdownDiv.style.display = 'none';
                }, 200);
            });
            
            // í¬ì»¤ìŠ¤ ë°›ì„ ë•Œ ì œì•ˆ ì—…ë°ì´íŠ¸
            orderInput.addEventListener('focus', () => {
                updateAutocompleteSuggestion();
            });
        }
        
        // ì„ íƒëœ ì œì•ˆì— ë§ê²Œ íšŒìƒ‰ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        function updateSuggestionDisplay() {
            const suggestionDiv = document.getElementById('autocompleteSuggestion');
            const orderInput = document.getElementById('myOrderInput');
            const text = orderInput.value;
            
            if (selectedSuggestionIndex >= 0 && currentSuggestions[selectedSuggestionIndex]) {
                const selectedMenu = currentSuggestions[selectedSuggestionIndex];
                const remainingText = selectedMenu.substring(text.length);
                suggestionDiv.textContent = text + remainingText;
                suggestionDiv.style.display = 'block';
            } else if (currentSuggestions.length > 0) {
                const firstMenu = currentSuggestions[0];
                const remainingText = firstMenu.substring(text.length);
                suggestionDiv.textContent = text + remainingText;
                suggestionDiv.style.display = 'block';
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        let currentRoomId = null;
        let selectedRoomId = null;
        let roomsList = [];
        
        // ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§ ë° ì´ˆê¸°í™”
        socket.on('connect', () => {
            document.getElementById('connectionStatus').textContent = 'â— ì—°ê²°ë¨';
            document.getElementById('connectionStatus').className = 'connection-status connected';
            
            const createRoomConnectionStatus = document.getElementById('createRoomConnectionStatus');
            if (createRoomConnectionStatus) {
                createRoomConnectionStatus.textContent = 'â— ì—°ê²°ë¨';
                createRoomConnectionStatus.className = 'connection-status connected';
            }
            
            // ë°© ëª©ë¡ ìš”ì²­ ë° ì´ˆê¸° body í´ë˜ìŠ¤ ì„¤ì •
            if (document.getElementById('lobbySection').classList.contains('active')) {
                document.body.classList.add('lobby-active');
                refreshRooms();
            }
        });

        socket.on('disconnect', () => {
            document.getElementById('connectionStatus').textContent = 'â— ì—°ê²° ëŠê¹€';
            document.getElementById('connectionStatus').className = 'connection-status disconnected';
            
            const createRoomConnectionStatus = document.getElementById('createRoomConnectionStatus');
            if (createRoomConnectionStatus) {
                createRoomConnectionStatus.textContent = 'â— ì—°ê²° ëŠê¹€';
                createRoomConnectionStatus.className = 'connection-status disconnected';
            }
        });

        // ë°© ëª©ë¡ ì—…ë°ì´íŠ¸
        socket.on('roomsList', (rooms) => {
            roomsList = rooms;
            renderRoomsList();
        });
        
        socket.on('roomsListUpdated', (rooms) => {
            roomsList = rooms;
            renderRoomsList();
        });
        
        // ë°© ëª©ë¡ ë Œë”ë§
        function renderRoomsList() {
            const roomsListEl = document.getElementById('roomsList');
            
            if (roomsList.length === 0) {
                roomsListEl.innerHTML = '<div style="color: #999; text-align: center; padding: 20px;">ìƒì„±ëœ ë°©ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }
            
            roomsListEl.innerHTML = '';
            
            roomsList.forEach(room => {
                const roomItem = document.createElement('div');
                const isMyRoom = room.roomId === currentRoomId;
                let className = 'room-item';
                if (isMyRoom) {
                    className += ' my-room';
                } else if (room.roomId === selectedRoomId) {
                    className += ' active';
                }
                roomItem.className = className;
                
                let statusClass = 'waiting';
                let statusText = 'ëŒ€ê¸° ì¤‘';
                if (room.isGameActive) {
                    statusClass = 'playing';
                    statusText = 'ê²Œì„ ì§„í–‰ ì¤‘';
                } else if (room.isOrderActive) {
                    statusClass = 'ordering';
                    statusText = 'ì£¼ë¬¸ë°›ê¸° ì¤‘';
                }
                
                const roomNameHtml = isMyRoom 
                    ? `${room.roomName}<span class="my-room-badge">ì°¸ì—¬ ì¤‘</span>`
                    : room.roomName;
                
                // ë¹„ê³µê°œ ë°© í‘œì‹œ
                const privateBadge = room.isPrivate 
                    ? '<span style="color: #ff6b6b; font-weight: bold; margin-left: 5px;">ğŸ”’ ë¹„ê³µê°œ</span>' 
                    : '';
                
                // ê²Œì„ íƒ€ì… í‘œì‹œ
                const gameTypeBadge = room.gameType === 'ladder'
                    ? '<span style="color: #667eea; font-weight: bold; margin-left: 5px;">ğŸªœ ì‚¬ë‹¤ë¦¬íƒ€ê¸°</span>'
                    : '<span style="color: #667eea; font-weight: bold; margin-left: 5px;">ğŸ² ì£¼ì‚¬ìœ„</span>';
                
                const buttonText = isMyRoom ? 'ì¬ì…ì¥' : 'ì…ì¥í•˜ê¸°';
                
                roomItem.innerHTML = `
                    <div class="room-info">
                        <div class="room-name">${roomNameHtml}${privateBadge}${gameTypeBadge}</div>
                        <div class="room-details">
                            í˜¸ìŠ¤íŠ¸: ${room.hostName} | ì¸ì›: ${room.playerCount}ëª…
                        </div>
                        <span class="room-status ${statusClass}">${statusText}</span>
                    </div>
                    <div class="room-action">
                        <button onclick="joinRoomDirectly('${room.roomId}')">${buttonText}</button>
                    </div>
                `;
                
                roomsListEl.appendChild(roomItem);
            });
        }
        
        // ë°© ë°”ë¡œ ì…ì¥
        function joinRoomDirectly(roomId) {
            selectedRoomId = roomId;
            
            const globalNameInput = document.getElementById('globalUserNameInput');
            const userName = globalNameInput ? globalNameInput.value.trim() : '';
            
            if (userName === '') {
                alert('âš ï¸ ì´ë¦„ì„ ì…ë ¥í•´ì•¼ ì…ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                if (globalNameInput) {
                    globalNameInput.focus();
                }
                return;
            }
            
            // ë°© ì •ë³´ í™•ì¸ (ë¹„ê³µê°œ ë°©ì¸ì§€ ì²´í¬)
            const room = roomsList.find(r => r.roomId === roomId);
            if (room && room.isPrivate) {
                // ë¹„ê³µê°œ ë°©ì´ë©´ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ëª¨ë‹¬ í‘œì‹œ
                showPasswordModal(roomId, userName);
            } else {
                // ê³µê°œ ë°©ì´ë©´ ë°”ë¡œ ì…ì¥
                socket.emit('joinRoom', {
                    roomId: roomId,
                    userName: userName,
                    isHost: false,
                    password: ''
                });
            }
        }
        
        // ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ëª¨ë‹¬ í‘œì‹œ
        function showPasswordModal(roomId, userName) {
            const password = prompt('ğŸ”’ ë¹„ê³µê°œ ë°©ì…ë‹ˆë‹¤.\në¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:');
            
            if (password === null) {
                // ì·¨ì†Œ
                return;
            }
            
            if (password === '') {
                alert('âš ï¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                showPasswordModal(roomId, userName); // ë‹¤ì‹œ ëª¨ë‹¬ í‘œì‹œ
                return;
            }
            
            // ë¹„ë°€ë²ˆí˜¸ì™€ í•¨ê»˜ ì…ì¥ ìš”ì²­
            socket.emit('joinRoom', {
                roomId: roomId,
                userName: userName,
                isHost: false,
                password: password
            });
        }
        
        // ë°© ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        function refreshRooms() {
            socket.emit('getRooms');
        }
        
        // ë°© ìƒì„± í˜ì´ì§€ë¡œ ì´ë™
        function showCreateRoomPage() {
            document.getElementById('lobbySection').classList.remove('active');
            document.getElementById('createRoomSection').classList.add('active');
            
            // ê¸°ë³¸ê°’ ì„¤ì •
            document.getElementById('createRoomNameInput').value = '';
            document.getElementById('createRoomHostNameInput').value = '';
            document.getElementById('createRoomPrivateCheckbox').checked = false;
            document.getElementById('createRoomPasswordInput').value = '';
            document.getElementById('createRoomPasswordContainer').style.display = 'none';
            
            // ì „ì—­ ì´ë¦„ ì…ë ¥ê°’ì„ ê°€ì ¸ì™€ì„œ í˜¸ìŠ¤íŠ¸ ì´ë¦„ ì…ë ¥ì¹¸ì— ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì • (ìˆìœ¼ë©´)
            const globalNameInput = document.getElementById('globalUserNameInput');
            if (globalNameInput && globalNameInput.value.trim()) {
                const hostName = globalNameInput.value.trim();
                document.getElementById('createRoomHostNameInput').value = hostName;
                // ë°© ì œëª© ìë™ ìƒì„±
                document.getElementById('createRoomNameInput').value = `${hostName}ë‹˜ì˜ Dice`;
            }
            
            // í˜¸ìŠ¤íŠ¸ ì´ë¦„ ì…ë ¥ì°½ì— í¬ì»¤ìŠ¤
            setTimeout(() => {
                document.getElementById('createRoomHostNameInput').focus();
            }, 100);
        }
        
        // ë¹„ê³µê°œ ë°© ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
        document.addEventListener('DOMContentLoaded', () => {
            const privateCheckbox = document.getElementById('createRoomPrivateCheckbox');
            const passwordContainer = document.getElementById('createRoomPasswordContainer');
            
            if (privateCheckbox && passwordContainer) {
                privateCheckbox.addEventListener('change', function() {
                    if (this.checked) {
                        passwordContainer.style.display = 'block';
                        document.getElementById('createRoomPasswordInput').focus();
                    } else {
                        passwordContainer.style.display = 'none';
                        document.getElementById('createRoomPasswordInput').value = '';
                    }
                });
            }
        });
        
        // ëŒ€ê¸°ì‹¤ë¡œ ëŒì•„ê°€ê¸°
        function goBackToLobby() {
            document.getElementById('createRoomSection').classList.remove('active');
            document.getElementById('lobbySection').classList.add('active');
            
            // body í´ë˜ìŠ¤ ë³€ê²½
            document.body.classList.remove('game-active');
            document.body.classList.add('lobby-active');
        }
        
        // ë°© ìƒì„± ìµœì¢… í™•ì¸ ë° ìƒì„±
        function finalizeRoomCreation() {
            const hostNameInput = document.getElementById('createRoomHostNameInput');
            const roomNameInput = document.getElementById('createRoomNameInput');
            
            const hostName = hostNameInput.value.trim();
            const roomName = roomNameInput.value.trim();
            
            if (roomName === '') {
                alert('âš ï¸ ë°© ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                roomNameInput.focus();
                return;
            }
            
            if (hostName === '') {
                alert('âš ï¸ í˜¸ìŠ¤íŠ¸ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                hostNameInput.focus();
                return;
            }
            
            // ë¹„ê³µê°œ ë°© ì„¤ì • í™•ì¸
            const isPrivate = document.getElementById('createRoomPrivateCheckbox').checked;
            const password = document.getElementById('createRoomPasswordInput').value.trim();
            
            if (isPrivate) {
                if (password === '') {
                    alert('âš ï¸ ë¹„ê³µê°œ ë°©ì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                    document.getElementById('createRoomPasswordInput').focus();
                    return;
                }
                
                if (password.length < 4 || password.length > 20) {
                    alert('âš ï¸ ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒ 20ì ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤!');
                    document.getElementById('createRoomPasswordInput').focus();
                    return;
                }
            }
            
            // ê²Œì„ íƒ€ì… ê°€ì ¸ì˜¤ê¸° (ì‚¬ë‹¤ë¦¬íƒ€ê¸°ëŠ” ì„ì‹œë¡œ ë¹„í™œì„±í™”)
            const gameTypeRadio = document.querySelector('input[name="gameType"]:checked');
            let gameType = gameTypeRadio ? gameTypeRadio.value : 'dice';
            
            // ì‚¬ë‹¤ë¦¬íƒ€ê¸°ëŠ” ì„ì‹œë¡œ ì°¨ë‹¨
            if (gameType === 'ladder') {
                alert('âš ï¸ ì‚¬ë‹¤ë¦¬íƒ€ê¸° ê²Œì„ì€ í˜„ì¬ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. ì£¼ì‚¬ìœ„ ê²Œì„ì„ ì´ìš©í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ë°© ìƒì„± (ì£¼ì‚¬ìœ„ ë²”ìœ„ì™€ ê²Œì„ ë£°ì€ ë°© ìƒì„± í›„ ì„¤ì •)
            socket.emit('createRoom', { 
                userName: hostName,
                roomName: roomName,
                isPrivate: isPrivate,
                password: isPrivate ? password : '',
                gameType: 'dice' // í•­ìƒ ì£¼ì‚¬ìœ„ ê²Œì„ìœ¼ë¡œ ê³ ì •
            });
        }
        
        // ë°© ì…ì¥
        function joinSelectedRoom() {
            if (!selectedRoomId) {
                alert('ë°©ì„ ì„ íƒí•´ì£¼ì„¸ìš”!');
                return;
            }
            
            const globalNameInput = document.getElementById('globalUserNameInput');
            const userName = globalNameInput.value.trim();
            
            if (userName === '') {
                alert('âš ï¸ ì´ë¦„ì„ ì…ë ¥í•´ì•¼ ì…ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                globalNameInput.focus();
                return;
            }
            
            // ë°© ì •ë³´ í™•ì¸ (ë¹„ê³µê°œ ë°©ì¸ì§€ ì²´í¬)
            const room = roomsList.find(r => r.roomId === selectedRoomId);
            if (room && room.isPrivate) {
                // ë¹„ê³µê°œ ë°©ì´ë©´ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ëª¨ë‹¬ í‘œì‹œ
                showPasswordModal(selectedRoomId, userName);
            } else {
                // ê³µê°œ ë°©ì´ë©´ ë°”ë¡œ ì…ì¥
                socket.emit('joinRoom', {
                    roomId: selectedRoomId,
                    userName: userName,
                    isHost: false,
                    password: ''
                });
            }
        }
        
        // ì „ì—­ ì´ë¦„ ì…ë ¥ì°½ ì´ˆê¸°í™” (localStorageì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°)
        document.addEventListener('DOMContentLoaded', () => {
            const globalNameInput = document.getElementById('globalUserNameInput');
            if (globalNameInput) {
                // localStorageì—ì„œ ì´ë¦„ ë¶ˆëŸ¬ì˜¤ê¸°
                const savedName = localStorage.getItem('diceGameUserName');
                if (savedName) {
                    globalNameInput.value = savedName;
                }
                
                // ì´ë¦„ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ localStorageì— ì €ì¥
                globalNameInput.addEventListener('input', () => {
                    const userName = globalNameInput.value.trim();
                    if (userName) {
                        localStorage.setItem('diceGameUserName', userName);
                    }
                });
            }
            
            // í˜¸ìŠ¤íŠ¸ ì´ë¦„ ì…ë ¥ì°½ì—ì„œ ë°© ì œëª© ìë™ ì—…ë°ì´íŠ¸
            const hostNameInput = document.getElementById('createRoomHostNameInput');
            const roomNameInput = document.getElementById('createRoomNameInput');
            if (hostNameInput && roomNameInput) {
                let isUpdating = false;
                hostNameInput.addEventListener('input', () => {
                    if (isUpdating) return;
                    const hostName = hostNameInput.value.trim();
                    // ë°© ì œëª©ì´ ê¸°ë³¸ í˜•ì‹ì´ê±°ë‚˜ ë¹„ì–´ìˆì„ ë•Œë§Œ ìë™ ì—…ë°ì´íŠ¸
                    const currentRoomName = roomNameInput.value.trim();
                    if (!currentRoomName || currentRoomName.endsWith('ë‹˜ì˜ Dice')) {
                        isUpdating = true;
                        roomNameInput.value = hostName ? `${hostName}ë‹˜ì˜ Dice` : '';
                        isUpdating = false;
                    }
                });
            }
        });
        
        // ë°© ìƒì„± ì„±ê³µ
        socket.on('roomCreated', (data) => {
            currentRoomId = data.roomId;
            // ë°© ìƒì„± ì‹œ ì…ë ¥í•œ í˜¸ìŠ¤íŠ¸ ì´ë¦„ ì‚¬ìš©
            const hostNameInput = document.getElementById('createRoomHostNameInput');
            currentUser = hostNameInput ? hostNameInput.value.trim() : data.userName;
            isHost = true;
            
            // ê²Œì„ íƒ€ì…ì— ë”°ë¼ ì ì ˆí•œ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            const gameType = data.gameType || 'dice';
            if (gameType === 'ladder') {
                // ì‚¬ìš©ì ì´ë¦„ì„ localStorageì— ì €ì¥ (ë¦¬ë‹¤ì´ë ‰íŠ¸ í›„ ì¬ì—°ê²°ìš©)
                localStorage.setItem('ladder_userName', currentUser);
                // ì‚¬ë‹¤ë¦¬íƒ€ê¸° ê²Œì„ í˜ì´ì§€ë¡œ ì´ë™
                // ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ì–´ roomCreated ì´ë²¤íŠ¸ ì²˜ë¦¬ê°€ ì™„ë£Œë˜ë„ë¡ í•¨
                setTimeout(() => {
                    window.location.href = `/ladder?roomId=${data.roomId}`;
                }, 100);
                return;
            }
            
            document.getElementById('lobbySection').classList.remove('active');
            document.getElementById('createRoomSection').classList.remove('active');
            document.getElementById('gameSection').classList.add('active');
            
            // body í´ë˜ìŠ¤ ë³€ê²½
            document.body.classList.remove('lobby-active');
            document.body.classList.add('game-active');
            
            // ê²Œì„ ê¸°ë¡ ì„¹ì…˜ í‘œì‹œ
            document.querySelector('.history-section').classList.add('visible');
            
            initializeGameScreen(data);
        });
        
        // ë°© ì…ì¥ ì„±ê³µ
        socket.on('roomJoined', (data) => {
            currentRoomId = data.roomId;
            const globalNameInput = document.getElementById('globalUserNameInput');
            currentUser = globalNameInput ? globalNameInput.value.trim() : data.userName; // ì „ì—­ ì´ë¦„ ì‚¬ìš©
            isHost = data.isHost;
            
            // ê²Œì„ íƒ€ì…ì— ë”°ë¼ ì ì ˆí•œ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            const gameType = data.gameType || 'dice';
            if (gameType === 'ladder') {
                // ì‚¬ë‹¤ë¦¬íƒ€ê¸° ê²Œì„ í˜ì´ì§€ë¡œ ì´ë™
                window.location.href = `/ladder?roomId=${data.roomId}`;
                return;
            }
            
            document.getElementById('lobbySection').classList.remove('active');
            document.getElementById('gameSection').classList.add('active');
            
            // body í´ë˜ìŠ¤ ë³€ê²½
            document.body.classList.remove('lobby-active');
            document.body.classList.add('game-active');
            
            // ê²Œì„ ê¸°ë¡ ì„¹ì…˜ í‘œì‹œ
            document.querySelector('.history-section').classList.add('visible');
            
            initializeGameScreen(data);
        });
        
        // ê²Œì„ í™”ë©´ ì´ˆê¸°í™”
        function initializeGameScreen(data) {
            hasRolledInCurrentGame = data.hasRolled;
            myDiceSettings = data.diceSettings || { max: 100 };
            isGameActive = data.isGameActive;
            isOrderActive = data.isOrderActive;
            
            // ê²Œì„ ê¸°ë¡ ì œëª© ì„¤ì •
            const historyTitle = document.getElementById('historyTitle');
            if (historyTitle) {
                historyTitle.textContent = isGameActive ? 'ğŸ“‹ ê²Œì„' : 'ğŸ“‹ ì—°ìŠµ';
            }
            
            // ë¹„ê³µê°œ ë°© ë¹„ë°€ë²ˆí˜¸ í‘œì‹œ
            const passwordDisplay = document.getElementById('roomPasswordDisplay');
            if (data.isPrivate && data.password) {
                passwordDisplay.textContent = `ğŸ”’ ë¹„ë°€ë²ˆí˜¸: ${data.password}`;
                passwordDisplay.style.display = 'inline-block';
            } else {
                passwordDisplay.style.display = 'none';
            }
            
            // ë°© ì œëª© í‘œì‹œ
            document.getElementById('roomNameText').textContent = data.roomName || 'ë°©';
            
            // í˜¸ìŠ¤íŠ¸ë©´ ë°© ì œëª© ë³€ê²½ ë²„íŠ¼ í‘œì‹œ
            if (isHost) {
                document.getElementById('editRoomNameButton').style.display = 'inline-block';
            } else {
                document.getElementById('editRoomNameButton').style.display = 'none';
            }
            
            document.getElementById('currentUser').textContent = currentUser;

            // ë‚´ ì£¼ë¬¸ ë¶ˆëŸ¬ì˜¤ê¸°
            document.getElementById('myOrderInput').value = data.myOrder || '';

            if (isHost) {
                document.getElementById('hostBadge').style.display = 'inline-block';
                document.getElementById('hostControls').style.display = 'grid';
            }
            
            // ê²Œì„ ë£° ë¶ˆëŸ¬ì˜¤ê¸°
            if (data.gameRules !== undefined) {
                document.getElementById('gameRulesInput').value = data.gameRules || '';
            }
            
            // ìì£¼ ì“°ëŠ” ë©”ë‰´ ë¶ˆëŸ¬ì˜¤ê¸°
            if (data.frequentMenus !== undefined) {
                frequentMenus = data.frequentMenus;
                renderMenuList();
            } else {
                loadFrequentMenus();
            }
            
            // ì¤€ë¹„ ìƒíƒœ ì´ˆê¸°í™”
            readyUsers = data.readyUsers || [];
            isReady = data.isReady || false;
            
            // ê²Œì„ ë£° UI ì—…ë°ì´íŠ¸ (ì´ˆê¸°í™” í›„ ë°˜ë“œì‹œ í˜¸ì¶œ)
            setTimeout(() => {
                updateGameRulesUI();
            }, 100);
            renderReadyUsers();
            updateReadyButton();
            
            // ê²Œì„ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì¤€ë¹„ ì„¹ì…˜ í‘œì‹œ
            if (!isGameActive) {
                document.getElementById('readySection').style.display = 'block';
            } else {
                document.getElementById('readySection').style.display = 'none';
            }
            
            // ê²Œì„ ìƒíƒœ ë°˜ì˜
            if (data.gameState) {
                historyData = data.gameState.history || [];
                ordersData = data.gameState.userOrders || {};
                usersList = data.gameState.users || [];
                renderHistory();
                renderOrders();
                updateUsers(usersList);
            }
            
            // ì£¼ë¬¸ë°›ê¸°ê°€ í™œì„±í™”ëœ ìƒíƒœë©´ ì£¼ë¬¸í•˜ì§€ ì•Šì€ ì‚¬ëŒ ëª©ë¡ë„ í‘œì‹œ
            if (isOrderActive) {
                setTimeout(() => {
                    renderNotOrderedUsers();
                }, 100);
            }

            // ì¬ì ‘ì† ì²˜ë¦¬
            if (isGameActive && data.isGamePlayer) {
                document.getElementById('gameStatus').textContent = 'ê²Œì„ ì§„í–‰ ì¤‘!';
                document.getElementById('gameStatus').classList.remove('waiting');
                document.getElementById('gameStatus').classList.add('playing');
                document.getElementById('progressSection').style.display = 'block';
                
                if (isHost) {
                    document.getElementById('startButton').style.display = 'none';
                    document.getElementById('endButton').style.display = 'block';
                }
                
                const reconnectNotice = document.getElementById('reconnectNotice');
                const reconnectMessage = document.getElementById('reconnectMessage');
                
                if (data.hasRolled && data.myResult) {
                    reconnectNotice.style.display = 'block';
                    reconnectMessage.textContent = `ì´ë¯¸ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë ¸ìŠµë‹ˆë‹¤. ê²°ê³¼: ${data.myResult.result}`;
                } else {
                    hasRolledInCurrentGame = false;
                    
                    reconnectNotice.style.display = 'block';
                    reconnectMessage.textContent = 'ì•„ì§ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë¦¬ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. /ì£¼ì‚¬ìœ„ ëª…ë ¹ì–´ë¡œ êµ´ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤!';
                    reconnectMessage.style.color = '#155724';
                    reconnectNotice.style.background = '#d4edda';
                    reconnectNotice.style.borderColor = '#28a745';
                }
            }
            
            // ì£¼ë¬¸ë°›ê¸° ì„¹ì…˜ í•­ìƒ í‘œì‹œ
            document.getElementById('ordersSection').style.display = 'block';
            
            // ì£¼ë¬¸ë°›ê¸° ìƒíƒœ ë°˜ì˜
            if (isOrderActive) {
                document.getElementById('ordersSection').classList.add('active');
                document.getElementById('myOrderInput').disabled = false;
                document.getElementById('orderSaveButton').disabled = false;
                document.getElementById('gameStatus').textContent = 'ì£¼ë¬¸ë°›ê¸° ì§„í–‰ ì¤‘!';
                document.getElementById('gameStatus').classList.add('ordering');
                
                if (isHost) {
                    document.getElementById('startOrderButton').style.display = 'none';
                    document.getElementById('endOrderButton').style.display = 'block';
                }
                
                // ì£¼ë¬¸ ëª©ë¡ê³¼ ì£¼ë¬¸í•˜ì§€ ì•Šì€ ì‚¬ëŒ ëª©ë¡ í‘œì‹œ
                renderOrders();
                renderNotOrderedUsers();
            } else if (isHost && !isGameActive) {
                // ê²Œì„ì´ ë¹„í™œì„±í™”ë˜ê³  ì£¼ë¬¸ë°›ê¸°ë„ ë¹„í™œì„±í™”ëœ ìƒíƒœì—ì„œ Hostì—ê²Œ ì£¼ë¬¸ë°›ê¸° ì‹œì‘ ë²„íŠ¼ í‘œì‹œ
                document.getElementById('startOrderButton').style.display = 'block';
                document.getElementById('endOrderButton').style.display = 'none';
                
                // ì£¼ë¬¸ë°›ê¸°ê°€ ì¢…ë£Œë˜ì–´ë„ ì£¼ë¬¸ ëª©ë¡ì€ í‘œì‹œ
                renderOrders();
                renderNotOrderedUsers();
            }
        }
        
        // ë°© ì—ëŸ¬ ì²˜ë¦¬
        socket.on('roomError', (message) => {
            alert(message);
        });
        
        // ë°© ì‚­ì œ ì•Œë¦¼ (ëª¨ë“  ì‚¬ìš©ìê°€ ë‚˜ê°)
        socket.on('roomDeleted', (data) => {
            alert(data.message || 'ëª¨ë“  ì‚¬ìš©ìê°€ ë°©ì„ ë– ë‚¬ìŠµë‹ˆë‹¤.');
            document.getElementById('gameSection').classList.remove('active');
            document.getElementById('lobbySection').classList.add('active');
            
            // body í´ë˜ìŠ¤ ë³€ê²½
            document.body.classList.remove('game-active');
            document.body.classList.add('lobby-active');
            
            currentRoomId = null;
            currentUser = '';
            isHost = false;
            refreshRooms();
        });
        
        // í˜¸ìŠ¤íŠ¸ UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateHostUI() {
            if (isHost) {
                // í˜¸ìŠ¤íŠ¸ ë°°ì§€ í‘œì‹œ
                const hostBadge = document.getElementById('hostBadge');
                if (hostBadge) {
                    hostBadge.style.display = 'inline-block';
                }
                
                // í˜¸ìŠ¤íŠ¸ ì „ìš© ì»¨íŠ¸ë¡¤ í‘œì‹œ
                const hostControls = document.getElementById('hostControls');
                if (hostControls) {
                    hostControls.style.display = 'grid';
                }
                
                // ë°© ì œëª© ë³€ê²½ ë²„íŠ¼ í‘œì‹œ
                const editRoomNameButton = document.getElementById('editRoomNameButton');
                if (editRoomNameButton) {
                    editRoomNameButton.style.display = 'inline-block';
                }
                
                // ì£¼ë¬¸ë°›ê¸° ë²„íŠ¼ì€ ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
                
                // ê²Œì„ ë£° ì €ì¥ ë²„íŠ¼ í‘œì‹œ
                updateGameRulesUI();
            } else {
                // í˜¸ìŠ¤íŠ¸ ë°°ì§€ ìˆ¨ê¹€
                const hostBadge = document.getElementById('hostBadge');
                if (hostBadge) {
                    hostBadge.style.display = 'none';
                }
                
                // í˜¸ìŠ¤íŠ¸ ì „ìš© ì»¨íŠ¸ë¡¤ ìˆ¨ê¹€
                const hostControls = document.getElementById('hostControls');
                if (hostControls) {
                    hostControls.style.display = 'none';
                }
                
                // ë°© ì œëª© ë³€ê²½ ë²„íŠ¼ ìˆ¨ê¹€
                const editRoomNameButton = document.getElementById('editRoomNameButton');
                if (editRoomNameButton) {
                    editRoomNameButton.style.display = 'none';
                }
                
                // ê²Œì„ ë£° ì €ì¥ ë²„íŠ¼ ìˆ¨ê¹€
                updateGameRulesUI();
            }
        }
        
        // í˜¸ìŠ¤íŠ¸ ê¶Œí•œ ì „ë‹¬ ì•Œë¦¼
        socket.on('hostTransferred', (data) => {
            alert(data.message || 'í˜¸ìŠ¤íŠ¸ ê¶Œí•œì´ ì „ë‹¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            isHost = true;
            // í˜¸ìŠ¤íŠ¸ ì „ìš© UI ì—…ë°ì´íŠ¸
            updateHostUI();
            // ê²Œì„ ë£° UI ì—…ë°ì´íŠ¸
            updateGameRulesUI();
        });
        
        // í˜¸ìŠ¤íŠ¸ ë³€ê²½ ì•Œë¦¼
        socket.on('hostChanged', (data) => {
            // ìƒˆ í˜¸ìŠ¤íŠ¸ IDëŠ” socket.idê°€ ì•„ë‹ˆë¼ ì‚¬ìš©ì IDì´ë¯€ë¡œ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ í™•ì¸ í•„ìš”
            // ì„œë²„ì—ì„œ ë³´ë‚¸ newHostIdë¥¼ ì‚¬ìš©ìì˜ socket.idì™€ ë¹„êµí•˜ê¸° ìœ„í•´ 
            // updateUsers ì´ë²¤íŠ¸ë¥¼ í†µí•´ í™•ì¸
            console.log('í˜¸ìŠ¤íŠ¸ ë³€ê²½ ì•Œë¦¼:', data.message);
        });
        
        // í˜¸ìŠ¤íŠ¸ ìƒíƒœ ë³€ê²½ ì¶”ì  ë³€ìˆ˜
        let lastHostStatus = false;
        
        // ë°© ì œëª© ì—…ë°ì´íŠ¸
        socket.on('roomNameUpdated', (roomName) => {
            document.getElementById('roomNameText').textContent = roomName;
            cancelRoomNameEdit();
        });
        
        // ë°© ì œëª© í¸ì§‘
        function editRoomName() {
            const currentName = document.getElementById('roomNameText').textContent;
            document.getElementById('roomNameInput').value = currentName;
            document.getElementById('roomNameDisplay').style.display = 'none';
            document.getElementById('roomNameEditSection').style.display = 'block';
            document.getElementById('editRoomNameButton').style.display = 'none';
        }
        
        // ë°© ì œëª© ì €ì¥
        function saveRoomName() {
            const newName = document.getElementById('roomNameInput').value.trim();
            
            if (newName === '') {
                alert('ë°© ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            socket.emit('updateRoomName', { roomName: newName });
        }
        
        // ë°© ì œëª© í¸ì§‘ ì·¨ì†Œ
        function cancelRoomNameEdit() {
            document.getElementById('roomNameDisplay').style.display = 'block';
            document.getElementById('roomNameEditSection').style.display = 'none';
            if (isHost) {
                document.getElementById('editRoomNameButton').style.display = 'inline-block';
            }
        }

        // ë¡œê·¸ì¸ ì„±ê³µ (í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€, ì‚¬ìš© ì•ˆ í•¨)
        socket.on('loginSuccess', (data) => {
            hasRolledInCurrentGame = data.hasRolled;
            myDiceSettings = data.diceSettings;
            isGameActive = data.isGameActive;
            isOrderActive = data.isOrderActive;
            
            document.getElementById('loginSection').classList.remove('active');
            document.getElementById('gameSection').classList.add('active');
            document.getElementById('currentUser').textContent = currentUser;

            // ë‚´ ì£¼ë¬¸ ë¶ˆëŸ¬ì˜¤ê¸°
            document.getElementById('myOrderInput').value = data.myOrder || '';

            if (isHost) {
                document.getElementById('hostBadge').style.display = 'inline-block';
                document.getElementById('hostControls').style.display = 'grid';
            }
            
            // ê²Œì„ ë£° ë¶ˆëŸ¬ì˜¤ê¸°
            if (data.gameRules !== undefined) {
                document.getElementById('gameRulesInput').value = data.gameRules || '';
            }
            
            // ìì£¼ ì“°ëŠ” ë©”ë‰´ ë¶ˆëŸ¬ì˜¤ê¸° (ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ë°ì´í„° ì‚¬ìš©)
            if (data.frequentMenus !== undefined) {
                frequentMenus = data.frequentMenus;
                renderMenuList();
            } else {
                // ì„œë²„ì—ì„œ ê°€ì ¸ì˜¤ê¸°
                loadFrequentMenus();
            }
            
            // ê²Œì„ ë£° UI ì—…ë°ì´íŠ¸ (ì´ˆê¸°í™” í›„ ë°˜ë“œì‹œ í˜¸ì¶œ)
            setTimeout(() => {
                updateGameRulesUI();
            }, 100);
            
            // ì£¼ë¬¸ë°›ê¸°ê°€ í™œì„±í™”ëœ ìƒíƒœë©´ ì£¼ë¬¸í•˜ì§€ ì•Šì€ ì‚¬ëŒ ëª©ë¡ë„ í‘œì‹œ
            if (isOrderActive) {
                setTimeout(() => {
                    renderNotOrderedUsers();
                }, 100);
            }

            // ì¬ì ‘ì† ì²˜ë¦¬
            if (isGameActive && data.isGamePlayer) {
                document.getElementById('gameStatus').textContent = 'ê²Œì„ ì§„í–‰ ì¤‘!';
                document.getElementById('gameStatus').classList.remove('waiting');
                document.getElementById('gameStatus').classList.add('playing');
                document.getElementById('progressSection').style.display = 'block';
                
                if (isHost) {
                    document.getElementById('startButton').style.display = 'none';
                    document.getElementById('endButton').style.display = 'block';
                }
                
                const reconnectNotice = document.getElementById('reconnectNotice');
                const reconnectMessage = document.getElementById('reconnectMessage');
                
                if (data.hasRolled && data.myResult) {
                    reconnectNotice.style.display = 'block';
                    reconnectMessage.textContent = `ì´ë¯¸ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë ¸ìŠµë‹ˆë‹¤. ê²°ê³¼: ${data.myResult.result}`;
                } else {
                    hasRolledInCurrentGame = false;
                    
                    reconnectNotice.style.display = 'block';
                    reconnectMessage.textContent = 'ì•„ì§ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë¦¬ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. /ì£¼ì‚¬ìœ„ ëª…ë ¹ì–´ë¡œ êµ´ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤!';
                    reconnectMessage.style.color = '#155724';
                    reconnectNotice.style.background = '#d4edda';
                    reconnectNotice.style.borderColor = '#28a745';
                }
            }

            // ì£¼ë¬¸ë°›ê¸° ì„¹ì…˜ í•­ìƒ í‘œì‹œ
            document.getElementById('ordersSection').style.display = 'block';
            
            // ì£¼ë¬¸ë°›ê¸° ìƒíƒœ ë°˜ì˜
            if (isOrderActive) {
                document.getElementById('ordersSection').classList.add('active');
                document.getElementById('myOrderInput').disabled = false;
                document.getElementById('orderSaveButton').disabled = false;
                document.getElementById('gameStatus').textContent = 'ì£¼ë¬¸ë°›ê¸° ì§„í–‰ ì¤‘!';
                document.getElementById('gameStatus').classList.add('ordering');
                
                if (isHost) {
                    document.getElementById('startOrderButton').style.display = 'none';
                    document.getElementById('endOrderButton').style.display = 'block';
                }
                
                // ì£¼ë¬¸ ëª©ë¡ê³¼ ì£¼ë¬¸í•˜ì§€ ì•Šì€ ì‚¬ëŒ ëª©ë¡ í‘œì‹œ
                renderOrders();
                renderNotOrderedUsers();
            } else if (isHost && !isGameActive) {
                // ê²Œì„ì´ ë¹„í™œì„±í™”ë˜ê³  ì£¼ë¬¸ë°›ê¸°ë„ ë¹„í™œì„±í™”ëœ ìƒíƒœì—ì„œ Hostì—ê²Œ ì£¼ë¬¸ë°›ê¸° ì‹œì‘ ë²„íŠ¼ í‘œì‹œ
                document.getElementById('startOrderButton').style.display = 'block';
                document.getElementById('endOrderButton').style.display = 'none';
                
                // ì£¼ë¬¸ë°›ê¸°ê°€ ì¢…ë£Œë˜ì–´ë„ ì£¼ë¬¸ ëª©ë¡ì€ í‘œì‹œ
                renderOrders();
                renderNotOrderedUsers();
            }
        });

        // ë¡œê·¸ì¸ ì—ëŸ¬
        socket.on('loginError', (message) => {
            alert(message);
            logout();
        });

        // ë¡œê·¸ì•„ì›ƒ (ë°© ë‚˜ê°€ê¸°)
        function logout() {
            if (currentRoomId) {
                socket.emit('leaveRoom');
            } else {
            socket.disconnect();
            location.reload();
            }
        }
        
        // ë°© ë‚˜ê°€ê¸° ì™„ë£Œ
        socket.on('roomLeft', () => {
            // ê²Œì„ ê¸°ë¡ ì„¹ì…˜ ìˆ¨ê¹€
            document.querySelector('.history-section').classList.remove('visible');
            
            // body í´ë˜ìŠ¤ ë³€ê²½
            document.body.classList.remove('game-active');
            document.body.classList.add('lobby-active');
            
            currentRoomId = null;
            currentUser = '';
            isHost = false;
            document.getElementById('gameSection').classList.remove('active');
            document.getElementById('lobbySection').classList.add('active');
            
            refreshRooms();
        });

        // ì£¼ë¬¸ë¦¬ìŠ¤íŠ¸ ë³´ê¸°
        function showOrderList() {
            if (!isOrderActive) {
                alert('ì£¼ë¬¸ë°›ê¸°ê°€ ì§„í–‰ ì¤‘ì¼ ë•Œë§Œ ì£¼ë¬¸ë¦¬ìŠ¤íŠ¸ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤!');
                return;
            }
            
            // í˜„ì¬ ì£¼ë¬¸ë¦¬ìŠ¤íŠ¸ ìˆ˜ì§‘
            let orderListText = '';
            
            // ë©”ë‰´ë³„ë¡œ ê·¸ë£¹í™” (ê°€ë‚˜ë‹¤ìˆœ ì •ë ¬)
            const groupedOrders = groupOrdersByMenu(ordersData, 'asc');
            
            if (groupedOrders.length === 0) {
                orderListText += 'ì•„ì§ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.\n';
            } else {
                // ê·¸ë£¹í™”ëœ ì£¼ë¬¸ ëª©ë¡ í‘œì‹œ (ì§§ì€ í˜•ì‹)
                groupedOrders.forEach((group, index) => {
                    // ì‚¬ìš©ì ì´ë¦„ë“¤ì„ í•œ ì¤„ì— í‘œì‹œ (ì´ë¦„ìˆœ ì •ë ¬, (ë‚˜) í‘œì‹œ ì œê±°)
                    const sortedUsers = [...group.users].sort((a, b) => {
                        return a.localeCompare(b, 'ko');
                    });
                    
                    const userNames = sortedUsers.join(',');
                    
                    // ì‚¬ìš©ì ì´ë¦„ê³¼ ë©”ë‰´ë¥¼ í•œ ì¤„ë¡œ í‘œì‹œ (ì—¬ëŸ¬ ëª…ì´ë©´ ê°œìˆ˜ í‘œì‹œ)
                    if (group.users.length > 1) {
                        orderListText += `${userNames} : ${group.menu} (${group.users.length}ëª…)\n`;
                    } else {
                        orderListText += `${userNames} : ${group.menu}\n`;
                    }
                });
                
                orderListText += `\nì´ ${groupedOrders.length}ê°œ ë©”ë‰´`;
            }
            
            // ì£¼ë¬¸í•˜ì§€ ì•Šì€ ì‚¬ëŒ ëª©ë¡
            const allUsers = usersList.map(u => u.name);
            const orderedUsers = groupedOrders.flatMap(group => group.users);
            const notOrderedUsers = allUsers.filter(user => !orderedUsers.includes(user));
            
            if (notOrderedUsers.length > 0) {
                orderListText += `\n\nì£¼ë¬¸í•˜ì§€ ì•Šì€ ì‚¬ëŒ (${notOrderedUsers.length}ëª…):\n`;
                notOrderedUsers.forEach((user, index) => {
                    orderListText += `${index + 1}. ${user}\n`;
                });
            }
            
            // ì»¤ìŠ¤í…€ ëª¨ë‹¬ë¡œ í‘œì‹œ
            showOrderListModal(orderListText);
        }
        
        // ì£¼ë¬¸ë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬ í‘œì‹œ
        function showOrderListModal(content) {
            // ê¸°ì¡´ ëª¨ë‹¬ì´ ìˆìœ¼ë©´ ì œê±°
            const existingModal = document.getElementById('orderListModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ ìƒì„±
            const modalOverlay = document.createElement('div');
            modalOverlay.id = 'orderListModal';
            modalOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 10000;
                display: flex;
                justify-content: center;
                align-items: center;
            `;
            
            // ëª¨ë‹¬ ì»¨í…ì¸  ìƒì„± (ë‚´ìš©ì— ë§ê²Œ ìë™ í¬ê¸° ì¡°ì ˆ)
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white;
                border-radius: 20px;
                padding: 30px;
                max-width: 90vw;
                max-height: 90vh;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                display: inline-block;
            `;
            
            // ì œëª©
            const title = document.createElement('div');
            title.textContent = '=== í˜„ì¬ ì£¼ë¬¸ë¦¬ìŠ¤íŠ¸ ===';
            title.style.cssText = `
                font-size: 20px;
                font-weight: bold;
                color: #667eea;
                margin-bottom: 20px;
                text-align: center;
            `;
            
            // ë‚´ìš© ì˜ì—­
            const contentDiv = document.createElement('div');
            contentDiv.style.cssText = `
                font-size: 16px;
                line-height: 1.8;
                color: #333;
                white-space: pre-wrap;
                word-break: break-word;
                margin-bottom: 20px;
            `;
            contentDiv.textContent = content;
            
            // ë‹«ê¸° ë²„íŠ¼
            const closeButton = document.createElement('button');
            closeButton.textContent = 'í™•ì¸';
            closeButton.style.cssText = `
                padding: 12px 30px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                width: 100%;
            `;
            closeButton.onclick = () => {
                modalOverlay.remove();
            };
            
            // ESC í‚¤ë¡œ ë‹«ê¸°
            const handleEsc = (e) => {
                if (e.key === 'Escape') {
                    modalOverlay.remove();
                    document.removeEventListener('keydown', handleEsc);
                }
            };
            document.addEventListener('keydown', handleEsc);
            
            // ì˜¤ë²„ë ˆì´ í´ë¦­ ì‹œ ë‹«ê¸°
            modalOverlay.onclick = (e) => {
                if (e.target === modalOverlay) {
                    modalOverlay.remove();
                    document.removeEventListener('keydown', handleEsc);
                }
            };
            
            modalContent.appendChild(title);
            modalContent.appendChild(contentDiv);
            modalContent.appendChild(closeButton);
            modalOverlay.appendChild(modalContent);
            document.body.appendChild(modalOverlay);
        }

        // ì£¼ë¬¸ë°›ê¸° ì‹œì‘
        function startOrder() {
            socket.emit('startOrder');
        }
        
        // ì£¼ë¬¸ë°›ê¸° ì¢…ë£Œ
        function endOrder() {
            socket.emit('endOrder');
        }
        
        socket.on('orderStarted', () => {
            isOrderActive = true;
            document.getElementById('ordersSection').classList.add('active');
            document.getElementById('ordersSection').style.display = 'block';
            const orderInput = document.getElementById('myOrderInput');
            orderInput.disabled = false;
            orderInput.value = '';
            document.getElementById('orderSaveButton').disabled = false;
            document.getElementById('gameStatus').textContent = 'ì£¼ë¬¸ë°›ê¸° ì§„í–‰ ì¤‘!';
            document.getElementById('gameStatus').classList.remove('waiting');
            document.getElementById('gameStatus').classList.add('ordering');
            
            // ìë™ì™„ì„± ê¸°ëŠ¥ í™œì„±í™”
            setupAutocomplete();
            
            // ì£¼ë¬¸ë¦¬ìŠ¤íŠ¸ ë³´ê¸° ë²„íŠ¼ì€ í•­ìƒ í‘œì‹œ
            document.getElementById('showOrderListButton').style.display = 'block';
            
            if (isHost) {
                document.getElementById('startOrderButton').style.display = 'none';
                document.getElementById('endOrderButton').style.display = 'block';
            }
            
            // ì£¼ë¬¸ ëª©ë¡ê³¼ ì£¼ë¬¸í•˜ì§€ ì•Šì€ ì‚¬ëŒ ëª©ë¡ í‘œì‹œ
            renderOrders();
            renderNotOrderedUsers();
            
            console.log('ì£¼ë¬¸ë°›ê¸°ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!');
        });
        
        socket.on('orderEnded', () => {
            isOrderActive = false;
            document.getElementById('myOrderInput').disabled = true;
            document.getElementById('orderSaveButton').disabled = true;
            document.getElementById('gameStatus').textContent = 'ê²Œì„ ëŒ€ê¸° ì¤‘...';
            document.getElementById('gameStatus').classList.remove('ordering');
            document.getElementById('gameStatus').classList.add('waiting');
            
            // ì£¼ë¬¸ë°›ê¸° ì„¹ì…˜ì€ ìœ ì§€í•˜ë˜ ì…ë ¥ë§Œ ë¹„í™œì„±í™” (ì£¼ë¬¸ ëª©ë¡ì€ ê³„ì† í‘œì‹œ)
            // document.getElementById('ordersSection').style.display = 'block';
            
            if (isHost) {
                document.getElementById('startButton').style.display = 'block';
                document.getElementById('endButton').style.display = 'none';
                // ê²Œì„ì´ ë¹„í™œì„±í™”ëœ ìƒíƒœë©´ ì£¼ë¬¸ë°›ê¸° ì‹œì‘ ë²„íŠ¼ í‘œì‹œ
                if (!isGameActive) {
                    document.getElementById('startOrderButton').style.display = 'block';
                } else {
                    document.getElementById('startOrderButton').style.display = 'none';
                }
                document.getElementById('endOrderButton').style.display = 'none';
                // ì£¼ë¬¸ë¦¬ìŠ¤íŠ¸ ë³´ê¸° ë²„íŠ¼ì€ ê³„ì† í‘œì‹œ
                document.getElementById('showOrderListButton').style.display = 'block';
            }
            
            // ì£¼ë¬¸ ëª©ë¡ê³¼ ì£¼ë¬¸í•˜ì§€ ì•Šì€ ì‚¬ëŒ ëª©ë¡ì€ ê³„ì† í‘œì‹œ
            renderOrders();
            renderNotOrderedUsers();
            
            alert('ì£¼ë¬¸ë°›ê¸°ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
        });

        // ì£¼ë¬¸ ì—…ë°ì´íŠ¸
        function updateMyOrder() {
            const orderInput = document.getElementById('myOrderInput');
            const order = orderInput.value.trim();
            
            if (!currentUser) {
                alert('ì‚¬ìš©ì ì´ë¦„ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                return;
            }

            console.log('ì£¼ë¬¸ ì „ì†¡:', { userName: currentUser, order: order });
            socket.emit('updateOrder', {
                userName: currentUser,
                order: order
            });
        }

        socket.on('orderUpdated', (data) => {
            console.log('ì£¼ë¬¸ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤:', data.order);
            
            // ì£¼ë¬¸ ì €ì¥ ì„±ê³µ í”¼ë“œë°±
            const orderInput = document.getElementById('myOrderInput');
            if (orderInput) {
                // ì‹œê°ì  í”¼ë“œë°± (ë°°ê²½ìƒ‰ ë³€ê²½)
                const originalBg = orderInput.style.backgroundColor;
                orderInput.style.backgroundColor = '#d4edda';
                setTimeout(() => {
                    orderInput.style.backgroundColor = originalBg || '';
                }, 500);
            }
            
            // ì£¼ë¬¸ ëª©ë¡ í•­ìƒ ì—…ë°ì´íŠ¸
            renderOrders();
            renderNotOrderedUsers();
        });

        socket.on('orderError', (message) => {
            alert(message);
        });

        // ì£¼ë¬¸ ëª©ë¡ ì—…ë°ì´íŠ¸
        socket.on('updateOrders', (orders) => {
            ordersData = orders;
            // ì£¼ë¬¸ ëª©ë¡ í•­ìƒ ì—…ë°ì´íŠ¸ (ì£¼ë¬¸ë°›ê¸° ìƒíƒœì™€ ê´€ê³„ì—†ì´)
            renderOrders();
            renderNotOrderedUsers();
        });

        // ì£¼ë¬¸ ëª©ë¡ì„ ë©”ë‰´ë³„ë¡œ ê·¸ë£¹í™”í•˜ê³  ì •ë ¬
        function groupOrdersByMenu(data, mode) {
            const entries = Object.entries(data).filter(([name, order]) => order && order.trim() !== '');
            
            // ë©”ë‰´ë³„ë¡œ ê·¸ë£¹í™”
            const grouped = {};
            entries.forEach(([userName, order]) => {
                const menuKey = order.trim().toLowerCase(); // ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ì´ ê·¸ë£¹í™”
                if (!grouped[menuKey]) {
                    grouped[menuKey] = {
                        menu: order.trim(),
                        users: []
                    };
                }
                grouped[menuKey].users.push(userName);
            });
            
            // ì •ë ¬ ëª¨ë“œì— ë”°ë¼ ì •ë ¬
            const sortedGroups = Object.values(grouped).sort((a, b) => {
                if (mode === 'count') {
                    // ì£¼ë¬¸ ë§ì€ ìˆœ (ì¸ì›ìˆ˜ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ)
                    return b.users.length - a.users.length;
                } else if (mode === 'desc') {
                    return b.menu.localeCompare(a.menu, 'ko'); // ì—­ìˆœ
                } else {
                    return a.menu.localeCompare(b.menu, 'ko'); // ê°€ë‚˜ë‹¤ìˆœ
                }
            });
            
            return sortedGroups;
        }

        // ì£¼ë¬¸ ì •ë ¬ ë²„íŠ¼ í´ë¦­
        function sortOrders(mode) {
            currentOrderSortMode = mode;
            
            document.querySelectorAll('#ordersSection .sort-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (mode === 'asc') {
                document.getElementById('sortOrderAscBtn').classList.add('active');
            } else if (mode === 'desc') {
                document.getElementById('sortOrderDescBtn').classList.add('active');
            } else if (mode === 'count') {
                document.getElementById('sortOrderCountBtn').classList.add('active');
            }
            
            renderOrders();
        }

        // ì£¼ë¬¸ ëª©ë¡ ë Œë”ë§ (ê·¸ë£¹í™”ëœ í˜•íƒœ)
        function renderOrders() {
            const orderList = document.getElementById('orderList');
            const notOrderedSection = document.getElementById('notOrderedSection');
            const notOrderedList = document.getElementById('notOrderedList');
            
            const entries = Object.entries(ordersData).filter(([name, order]) => order && order.trim() !== '');
            
            if (entries.length === 0) {
                orderList.innerHTML = '<div style="color: #999; text-align: center; padding: 10px;">ì•„ì§ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                // ì£¼ë¬¸í•˜ì§€ ì•Šì€ ì‚¬ëŒ ëª©ë¡ í‘œì‹œ
                renderNotOrderedUsers();
                return;
            }
            
            // ë©”ë‰´ë³„ë¡œ ê·¸ë£¹í™”ëœ ì£¼ë¬¸ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
            const groupedOrders = groupOrdersByMenu(ordersData, currentOrderSortMode);
            
            orderList.innerHTML = '';
            
            groupedOrders.forEach(group => {
                // ê°™ì€ ë©”ë‰´ë¥¼ ì£¼ë¬¸í•œ ì‚¬ëŒë“¤ì´ ì—¬ëŸ¬ ëª…ì´ë©´ í•˜ë‚˜ì˜ í•­ëª©ìœ¼ë¡œ í‘œì‹œ
                const item = document.createElement('div');
                item.className = 'order-item';
                
                // ì™¼ìª½ ì˜ì—­
                const leftDiv = document.createElement('div');
                leftDiv.className = 'order-item-left';
                
                // ì‚¬ìš©ì ëª©ë¡ ìƒì„± (ë‚´ ì£¼ë¬¸ì´ë©´ ë§¨ ì•ì—)
                const sortedUsers = [...group.users].sort((a, b) => {
                    if (a === currentUser) return -1;
                    if (b === currentUser) return 1;
                    return 0;
                });
                
                const userNames = sortedUsers.map(name => 
                    name + (name === currentUser ? ' (ë‚˜)' : '')
                ).join(', ');
                
                const userDiv = document.createElement('div');
                userDiv.className = 'order-user';
                userDiv.textContent = userNames;
                
                const orderDiv = document.createElement('div');
                orderDiv.className = 'order-text';
                orderDiv.textContent = group.menu;
                
                leftDiv.appendChild(userDiv);
                leftDiv.appendChild(orderDiv);
                
                // ì˜¤ë¥¸ìª½ ì¸ì›ìˆ˜ (ì£¼ì‚¬ìœ„ ìˆ«ìì²˜ëŸ¼ í¬ê²Œ í‘œì‹œ)
                const countDiv = document.createElement('div');
                countDiv.className = 'order-count';
                countDiv.textContent = group.users.length;
                
                item.appendChild(leftDiv);
                item.appendChild(countDiv);
                orderList.appendChild(item);
            });
            
            // ì£¼ë¬¸í•˜ì§€ ì•Šì€ ì‚¬ëŒ ëª©ë¡ í‘œì‹œ
            renderNotOrderedUsers();
        }

        // ì£¼ë¬¸í•˜ì§€ ì•Šì€ ì‚¬ëŒ ëª©ë¡ ë Œë”ë§
        function renderNotOrderedUsers() {
            const notOrderedSection = document.getElementById('notOrderedSection');
            const notOrderedList = document.getElementById('notOrderedList');
            
            // ì£¼ë¬¸ë°›ê¸° ìƒíƒœì™€ ê´€ê³„ì—†ì´ ì£¼ë¬¸í•˜ì§€ ì•Šì€ ì‚¬ëŒ ëª©ë¡ í‘œì‹œ
            // ì£¼ë¬¸í•œ ì‚¬ëŒ ëª©ë¡
            const orderedUsers = Object.entries(ordersData)
                .filter(([name, order]) => order && order.trim() !== '')
                .map(([name]) => name);
            
            // ì£¼ë¬¸í•˜ì§€ ì•Šì€ ì‚¬ëŒ ëª©ë¡ (ì ‘ì†ì ì¤‘ì—ì„œ ì£¼ë¬¸í•˜ì§€ ì•Šì€ ì‚¬ëŒ)
            const notOrderedUsers = usersList
                .map(user => user.name)
                .filter(name => !orderedUsers.includes(name));
            
            if (notOrderedUsers.length === 0) {
                notOrderedSection.style.display = 'none';
                return;
            }
            
            // ì£¼ë¬¸í•˜ì§€ ì•Šì€ ì‚¬ëŒì´ ìˆìœ¼ë©´ í•­ìƒ í‘œì‹œ
            notOrderedSection.style.display = 'block';
            notOrderedList.innerHTML = '';
            
            // ê°€ë‚˜ë‹¤ìˆœìœ¼ë¡œ ì •ë ¬
            const sortedNotOrderedUsers = [...notOrderedUsers].sort((a, b) => a.localeCompare(b, 'ko'));
            sortedNotOrderedUsers.forEach(name => {
                const tag = document.createElement('div');
                tag.className = 'not-rolled-tag';
                tag.textContent = name + (name === currentUser ? ' (ë‚˜)' : '');
                notOrderedList.appendChild(tag);
            });
        }

        // ë‚´ ì£¼ì‚¬ìœ„ ì„¤ì • ì—…ë°ì´íŠ¸
        // ì£¼ì‚¬ìœ„ ì„¤ì • ì—…ë°ì´íŠ¸ (ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ, ëª…ë ¹ì–´ë¡œ ëŒ€ì²´)

        socket.on('settingsError', (message) => {
            alert(message);
        });

        // ê²Œì„ ë£° ì—…ë°ì´íŠ¸
        function updateGameRules() {
            const rulesInput = document.getElementById('gameRulesInput');
            const rules = rulesInput.value.trim();

            socket.emit('updateGameRules', {
                rules: rules
            });
        }

        // ê²Œì„ ë£° UI ì—…ë°ì´íŠ¸ (ê²Œì„ ì‹œì‘ ìƒíƒœì— ë”°ë¼ í¸ì§‘ ê°€ëŠ¥ ì—¬ë¶€ ê²°ì •)
        function updateGameRulesUI() {
            const rulesInput = document.getElementById('gameRulesInput');
            const rulesSaveButton = document.getElementById('gameRulesSaveButton');
            
            if (!rulesInput || !rulesSaveButton) {
                return; // ìš”ì†Œê°€ ì—†ìœ¼ë©´ ì¢…ë£Œ
            }
            
            // ì €ì¥ ë²„íŠ¼ì€ í˜¸ìŠ¤íŠ¸ë§Œ ë³´ì´ê²Œ
            if (isHost) {
                rulesSaveButton.style.display = 'inline-block';
            } else {
                rulesSaveButton.style.display = 'none';
            }
            
            // í˜¸ìŠ¤íŠ¸ì´ê³  ê²Œì„ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ì„ ë•Œë§Œ í¸ì§‘ ê°€ëŠ¥
            // isGameActiveê°€ undefinedì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ëª…ì‹œì ìœ¼ë¡œ ì²´í¬
            // ë°©ì— ì…ì¥í•˜ì§€ ì•Šì€ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ isHostë„ í™•ì¸
            const canEdit = isHost && (isGameActive === false || isGameActive === undefined || !isGameActive);
            
            if (canEdit) {
                rulesInput.disabled = false;
                rulesSaveButton.disabled = false;
                rulesInput.style.cursor = 'text';
                rulesInput.style.backgroundColor = '#ffffff';
            } else {
                rulesInput.disabled = true;
                rulesSaveButton.disabled = true;
                rulesInput.style.cursor = 'not-allowed';
                rulesInput.style.backgroundColor = '#f5f5f5';
            }
            
            console.log('ê²Œì„ ë£° UI ì—…ë°ì´íŠ¸:', { isHost, isGameActive, canEdit });
        }

        // ê²Œì„ ë£° ì—…ë°ì´íŠ¸ ìˆ˜ì‹ 
        socket.on('gameRulesUpdated', (rules) => {
            document.getElementById('gameRulesInput').value = rules || '';
            console.log('ê²Œì„ ë£°ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤:', rules);
            // UI ì—…ë°ì´íŠ¸
            updateGameRulesUI();
        });

        socket.on('rulesError', (message) => {
            alert(message);
        });
        
        socket.on('rulesSaved', (message) => {
            alert(message);
        });
        
        socket.on('gameError', (message) => {
            alert(message);
        });

        // ê²Œì„ ì‹œì‘
        function startGame() {
            // í˜¸ìŠ¤íŠ¸ì¸ ê²½ìš° ê²Œì„ ì‹œì‘ ì „ í˜„ì¬ ì…ë ¥ëœ ë£°ì„ ì„œë²„ì— ì €ì¥
            if (isHost) {
                const rulesInput = document.getElementById('gameRulesInput');
                const currentRules = rulesInput.value.trim();
                
                // ë£°ì´ ì…ë ¥ë˜ì–´ ìˆìœ¼ë©´ ì„œë²„ì— ì €ì¥ ìš”ì²­
                if (currentRules) {
                    socket.emit('updateGameRules', {
                        rules: currentRules
                    });
                }
            }
            
            socket.emit('startGame');
        }

        socket.on('gameStarted', (data) => {
            isGameActive = true;
            hasRolledInCurrentGame = false;
            rolledUsersInGame = []; // ê²Œì„ ì‹œì‘ ì‹œ êµ´ë¦° ì‚¬ìš©ì ëª©ë¡ ì´ˆê¸°í™”
            historyData = [];
            
            // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í”Œë˜ê·¸ ì´ˆê¸°í™” (ê²Œì„ ì¬ì‹œì‘ ì‹œ ì´ì „ ê°’ì´ ë‚¨ì•„ìˆì§€ ì•Šë„ë¡)
            window.lastRollerAnimationComplete = false;
            window.lastRollerAnimationCompleteTime = null;
            
            // ê²Œì„ ê¸°ë¡ ì œëª© ë³€ê²½
            document.getElementById('historyTitle').textContent = 'ğŸ“‹ ê²Œì„';
            
            // êµ´ë¦° ì¸ì› ì—…ë°ì´íŠ¸
            updateRolledUsersCount();
            
            // ì¤€ë¹„ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            document.getElementById('readySection').style.display = 'none';
            
            document.getElementById('reconnectNotice').style.display = 'none';
            
            document.getElementById('gameStatus').textContent = 'ê²Œì„ ì§„í–‰ ì¤‘!';
            document.getElementById('gameStatus').classList.remove('waiting');
            document.getElementById('gameStatus').classList.remove('ordering');
            document.getElementById('gameStatus').classList.add('playing');
            document.getElementById('startButton').style.display = 'none';
            document.getElementById('endButton').style.display = 'block';
            
            // ê²Œì„ ì‹œì‘ ì‹œ ë£° ìˆ˜ì • ë¶ˆê°€ëŠ¥í•˜ë„ë¡ UI ì—…ë°ì´íŠ¸
            updateGameRulesUI();
            
            // ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° ë²„íŠ¼ì€ ì œê±°ë¨ (ëª…ë ¹ì–´ë¡œ ëŒ€ì²´)
            
            document.getElementById('progressSection').style.display = 'block';
            document.getElementById('progressBar').style.background = 'linear-gradient(90deg, #667eea 0%, #764ba2 100%)';
            
            // ê²Œì„ ì‹œì‘ ì‹œ ì´ˆê¸° ì§„í–‰ ìƒí™© ì„¤ì •
            if (data.players && data.players.length > 0) {
                updateProgress({
                    rolled: 0,
                    total: data.players.length,
                    notRolledYet: data.players
                });
            }
            
            // ê²Œì„ ì‹œì‘ ì‹œ ì£¼ë¬¸ë°›ê¸° ì…ë ¥ë§Œ ë¹„í™œì„±í™” (ì£¼ë¬¸ ëª©ë¡ì€ ê³„ì† í‘œì‹œ)
            if (!isOrderActive) {
                document.getElementById('ordersSection').classList.remove('active');
            }
            
            // ê²Œì„ ì‹œì‘ ì‹œ ì£¼ë¬¸ë°›ê¸° ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            if (isHost) {
                document.getElementById('startOrderButton').style.display = 'none';
                document.getElementById('endOrderButton').style.display = 'none';
            }
            
            renderHistory();
        });

        // ê²Œì„ ì¢…ë£Œ
        function endGame() {
            socket.emit('endGame');
        }

        // ì´ì „ ê²Œì„ ë°ì´í„° ì‚­ì œ
        function clearGameData() {
            if (!confirm('ì •ë§ë¡œ ì´ì „ ê²Œì„ ë°ì´í„°ë¥¼ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ê²Œì„ ê¸°ë¡, ì£¼ë¬¸ ë‚´ì—­, ê²Œì„ ë£°ì´ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤)')) {
                return;
            }
            
            socket.emit('clearGameData');
        }

        // ê²Œì„ ë°ì´í„° ì‚­ì œ ì„±ê³µ
        socket.on('gameDataCleared', () => {
            historyData = [];
            ordersData = {};
            
            renderHistory();
            renderOrders();
            
            // ê²Œì„ ë£° ì´ˆê¸°í™”
            document.getElementById('gameRulesInput').value = '';
            
            alert('ì´ì „ ê²Œì„ ë°ì´í„°ê°€ ëª¨ë‘ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
        });

        // ê²Œì„ ë°ì´í„° ì‚­ì œ ì—ëŸ¬
        socket.on('clearDataError', (message) => {
            alert(message);
        });

        socket.on('gameEnded', (history) => {
            isGameActive = false;
            hasRolledInCurrentGame = false;
            rolledUsersInGame = []; // ê²Œì„ ì¢…ë£Œ ì‹œ êµ´ë¦° ì‚¬ìš©ì ëª©ë¡ ì´ˆê¸°í™”
            
            // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í”Œë˜ê·¸ ì´ˆê¸°í™” (ê²Œì„ ì¢…ë£Œ ì‹œ)
            window.lastRollerAnimationComplete = false;
            window.lastRollerAnimationCompleteTime = null;
            historyData = history;
            
            // ê²Œì„ ê¸°ë¡ ì œëª© ë³€ê²½ (ì—°ìŠµê²½ê¸°ë¡œ)
            document.getElementById('historyTitle').textContent = 'ğŸ“‹ ì—°ìŠµ';
            
            // êµ´ë¦° ì¸ì› ì—…ë°ì´íŠ¸
            updateRolledUsersCount();
            
            // ê²Œì„ ì¢…ë£Œ ì‹œ ì¤€ë¹„ ìƒíƒœ ì´ˆê¸°í™”
            isReady = false;
            readyUsers = [];
            renderReadyUsers();
            updateReadyButton();
            
            // ê²Œì„ ì¢…ë£Œ ì‹œ ì¤€ë¹„ ì„¹ì…˜ ë‹¤ì‹œ í‘œì‹œ
            document.getElementById('readySection').style.display = 'block';
            
            document.getElementById('gameStatus').textContent = 'ê²Œì„ ì¢…ë£Œë¨';
            document.getElementById('gameStatus').classList.remove('playing');
            document.getElementById('gameStatus').classList.add('waiting');
            document.getElementById('startButton').style.display = 'block';
            document.getElementById('endButton').style.display = 'none';
            // ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° ë²„íŠ¼ì€ ì œê±°ë¨
            document.getElementById('progressSection').style.display = 'none';
            
            // ì£¼ë¬¸ë°›ê¸° ì‹œì‘ ë²„íŠ¼ í‘œì‹œ (Hostë§Œ)
            if (isHost) {
                document.getElementById('startOrderButton').style.display = 'block';
            }
            
            // ê²Œì„ ì¢…ë£Œ ì‹œ ë£° ìˆ˜ì • ê°€ëŠ¥í•˜ë„ë¡ UI ì—…ë°ì´íŠ¸ (í˜¸ìŠ¤íŠ¸ë§Œ)
            updateGameRulesUI();
            
            renderHistory();
            
            let resultsText = 'ê²Œì„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n\n=== ìµœì¢… ê²°ê³¼ ===\n\n';
            
            const sortedHistory = sortHistoryData([...history], currentSortMode);
            
            sortedHistory.forEach((record, index) => {
                const maxValue = record.range && record.range.includes('~') ? record.range.split('~')[1] : (record.range || '100');
                resultsText += `${index + 1}. ${record.user}: ${record.result} (${maxValue})\n`;
            });
            
            resultsText += `\nì´ ${history.length}ë²ˆì˜ ì£¼ì‚¬ìœ„ê°€ êµ´ë ¤ì¡ŒìŠµë‹ˆë‹¤.`;
            
            alert(resultsText);
            
            // ì£¼ì‚¬ìœ„ UIê°€ ì œê±°ë˜ì–´ ê²°ê³¼ëŠ” ê²Œì„ ê¸°ë¡ì—ì„œë§Œ í™•ì¸ ê°€ëŠ¥
        });

        // í´ë¼ì´ì–¸íŠ¸ ì‹œë“œ ìƒì„±
        function generateClientSeed() {
            return Date.now().toString() + Math.random().toString(36).substring(2);
        }

        // ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°
        let diceAnimationInterval = null;

        // rollDice í•¨ìˆ˜ëŠ” ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ (ëª…ë ¹ì–´ë¡œ ëŒ€ì²´)
        function rollDice() {
            // ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°ëŠ” /ì£¼ì‚¬ìœ„ ëª…ë ¹ì–´ë¡œë§Œ ê°€ëŠ¥
            alert('ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°ëŠ” /ì£¼ì‚¬ìœ„ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”!\nì˜ˆ: /ì£¼ì‚¬ìœ„ 100');
        }

        // ì£¼ì‚¬ìœ„ ê²°ê³¼ ìˆ˜ì‹ 
        socket.on('diceRolled', (record) => {
            // ì¤€ë¹„í•˜ì§€ ì•Šì€ ì‚¬ëŒì¸ì§€ í™•ì¸
            const isNotReady = record.isNotReady === true;
            
            // ê²Œì„ ì§„í–‰ ì¤‘ì´ë©´ ìµœì´ˆ 1íšŒë§Œ ê¸°ë¡ì— ì €ì¥ (ì¤€ë¹„í•˜ì§€ ì•Šì€ ì‚¬ëŒ ì œì™¸)
            const isFirstRollInGame = isGameActive && !rolledUsersInGame.includes(record.user) && !isNotReady;
            const isNotGameActive = !isGameActive;
            const shouldSaveToHistory = (isNotGameActive || isFirstRollInGame) && !isNotReady;
            const isLastRoller = record.isLastRoller === true;
            
            // ë§ˆì§€ë§‰ êµ´ë¦¬ëŠ” ì‚¬ëŒì€ ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í›„ ê¸°ë¡ì— ì €ì¥ (ì• ë‹ˆë©”ì´ì…˜ ì¤‘ì—ëŠ” ì €ì¥í•˜ì§€ ì•ŠìŒ)
            // ë‹¤ë¥¸ ì‚¬ëŒë“¤ì€ ì¦‰ì‹œ ê¸°ë¡ì— ì €ì¥
            if (shouldSaveToHistory && !(isLastRoller && isGameActive)) {
                historyData.push(record);
            }
            
            // ê²Œì„ ì§„í–‰ ì¤‘ì´ê³  í•´ë‹¹ ì‚¬ìš©ìê°€ ì²˜ìŒ êµ´ë ¸ë‹¤ë©´ ëª©ë¡ì— ì¶”ê°€ (ì¤€ë¹„í•˜ì§€ ì•Šì€ ì‚¬ëŒ ì œì™¸)
            if (isGameActive && !rolledUsersInGame.includes(record.user) && !isNotReady) {
                rolledUsersInGame.push(record.user);
            }
            
            // í˜„ì¬ ì‚¬ìš©ìê°€ êµ´ë ¸ë‹¤ë©´ hasRolledInCurrentGame í”Œë˜ê·¸ ì„¤ì •
            if (isGameActive && record.user === currentUser) {
                hasRolledInCurrentGame = true;
            }
            
            // êµ´ë¦° ì¸ì› ì—…ë°ì´íŠ¸
            updateRolledUsersCount();
            
            // /ì£¼ì‚¬ìœ„ ëª…ë ¹ì–´ ë©”ì‹œì§€ë¥¼ ì°¾ì•„ì„œ ì£¼ì‚¬ìœ„ ê²°ê³¼ ì¶”ê°€ ë° ì´ë¦„ ì•ì— ë””ë°”ì´ìŠ¤ ì•„ì´ì½˜ ì¶”ê°€
            const chatMessages = document.getElementById('chatMessages');
            const diceCommandMessages = Array.from(chatMessages.children).filter(div => 
                div.getAttribute('data-dice-command') === 'true' && 
                div.getAttribute('data-user-name') === record.user
            );
            
            // ì£¼ì‚¬ìœ„ ê²°ê³¼ëŠ” í•­ìƒ í‘œì‹œí•˜ë˜, ê¸°ë¡ì— ì €ì¥ë˜ëŠ” ê²½ìš°ì—ë§Œ ì•„ì´ì½˜ í‘œì‹œ
            if (diceCommandMessages.length > 0) {
                // ë§ˆì§€ë§‰ /ì£¼ì‚¬ìœ„ ë©”ì‹œì§€ë¥¼ ì°¾ì•„ì„œ ê²°ê³¼ ì¶”ê°€
                const lastDiceCommandMsg = diceCommandMessages[diceCommandMessages.length - 1];
                
                // ì´ë¦„ ì•ì— ë””ë°”ì´ìŠ¤ ì•„ì´ì½˜ ì¶”ê°€ (í•­ìƒ í‘œì‹œ)
                const userNameSpan = lastDiceCommandMsg.querySelector('span[data-user-name-display="' + record.user + '"]');
                if (userNameSpan && record.deviceType) {
                    const deviceIcon = getDeviceIcon(record.deviceType);
                    const currentText = userNameSpan.textContent;
                    // ì•„ì´ì½˜ì´ ì—†ìœ¼ë©´ ì¶”ê°€ (í•­ìƒ í‘œì‹œë˜ë„ë¡ ë³´ì¥)
                    if (!currentText.includes(deviceIcon)) {
                        // í˜¸ìŠ¤íŠ¸ ì•„ì´ì½˜ì´ ìˆìœ¼ë©´ ê·¸ ë’¤ì—, ì—†ìœ¼ë©´ ë§¨ ì•ì— ë””ë°”ì´ìŠ¤ ì•„ì´ì½˜ ì¶”ê°€
                        if (currentText.includes('ğŸ‘‘')) {
                            userNameSpan.textContent = currentText.replace('ğŸ‘‘', `ğŸ‘‘ ${deviceIcon}`);
                        } else {
                            userNameSpan.textContent = `${deviceIcon} ${currentText}`;
                        }
                    } else {
                        // ì•„ì´ì½˜ì´ ì´ë¯¸ ìˆì§€ë§Œ ì‚¬ë¼ì¡Œì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë‹¤ì‹œ í™•ì¸í•˜ì—¬ ì¶”ê°€
                        // (ë‚˜) í…ìŠ¤íŠ¸ë¥¼ ì œì™¸í•œ ìˆœìˆ˜ ì´ë¦„ ë¶€ë¶„ì— ì•„ì´ì½˜ì´ ìˆëŠ”ì§€ í™•ì¸
                        const nameWithoutMe = currentText.replace(' (ë‚˜)', '');
                        if (!nameWithoutMe.includes(deviceIcon)) {
                            if (currentText.includes('ğŸ‘‘')) {
                                userNameSpan.textContent = currentText.replace('ğŸ‘‘', `ğŸ‘‘ ${deviceIcon}`);
                            } else {
                                userNameSpan.textContent = `${deviceIcon} ${currentText}`;
                            }
                        }
                    }
                }
                
                const resultContainer = lastDiceCommandMsg.querySelector('span[data-dice-result-container="true"]');
                if (resultContainer) {
                    // ì´ë¯¸ ì£¼ì‚¬ìœ„ ê²°ê³¼ê°€ ì¶”ê°€ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
                    const existingResult = resultContainer.querySelector('span[data-dice-result]');
                    if (!existingResult) {
                        // ì£¼ì‚¬ìœ„ ê²°ê³¼ë¥¼ ì˜¤ë¥¸ìª½ ì»¨í…Œì´ë„ˆì— ì¶”ê°€
                        const diceResultSpan = document.createElement('span');
                        diceResultSpan.setAttribute('data-dice-result', 'true');
                        // ì¤€ë¹„í•˜ì§€ ì•Šì€ ì‚¬ëŒì´ê±°ë‚˜ ê¸°ë¡ì— ì €ì¥ë˜ì§€ ì•ŠëŠ” ê²½ìš° ìˆ«ìë§Œ í‘œì‹œ
                        const isNotReady = record.isNotReady === true;
                        
                        const finalResult = record.result;
                        const diceIcon = (shouldSaveToHistory && !isNotReady) ? 'ğŸ² ' : '';
                        
                        // ì• ë‹ˆë©”ì´ì…˜ì€ ë³¸ê²Œì„ì—ì„œ ìµœì´ˆ 1íšŒë§Œ ì¬ìƒ (ê¸°ë¡ì— ì €ì¥ë˜ëŠ” ê²½ìš°ì—ë§Œ)
                        const shouldAnimate = shouldSaveToHistory && !isNotReady;
                        
                        // ì´ˆê¸° ìŠ¤íƒ€ì¼ ì„¤ì •
                        if (shouldSaveToHistory && !isNotReady) {
                            diceResultSpan.style.cssText = 'font-weight: 600; color: #333;';
                            diceResultSpan.textContent = diceIcon;
                        } else {
                            diceResultSpan.style.cssText = 'font-weight: 600; color: #333;';
                            diceResultSpan.textContent = '';
                            // resultContainerë¥¼ ì˜¤ë¥¸ìª½ ëì— ë¶™ë„ë¡ ìŠ¤íƒ€ì¼ ì¡°ì •
                            resultContainer.style.cssText = 'min-width: 60px; display: flex; justify-content: flex-end;';
                        }
                        resultContainer.appendChild(diceResultSpan);
                        
                        // ì• ë‹ˆë©”ì´ì…˜ì€ ë§ˆì§€ë§‰ êµ´ë¦¬ëŠ” ì‚¬ëŒì—ê²Œë§Œ ì¬ìƒ (í…ŒìŠ¤íŠ¸ìš© 1001~1006ì€ ì˜ˆì™¸)
                        const isLastRoller = record.isLastRoller === true;
                        const isTestAnimation = finalResult >= 1001 && finalResult <= 1006;
                        if (shouldAnimate && (isLastRoller || isTestAnimation)) {
                            // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ ì½œë°± í•¨ìˆ˜
                            const onAnimationComplete = () => {
                                // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í›„ ê¸°ë¡ì— ì €ì¥ ë° ì¢…ë£Œ ë©”ì‹œì§€ í‘œì‹œ í”Œë˜ê·¸ ì„¤ì •
                                window.lastRollerAnimationComplete = true;
                                window.lastRollerAnimationCompleteTime = Date.now();
                                
                                // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í›„ ê¸°ë¡ì— ì €ì¥
                                if (shouldSaveToHistory && !isNotReady) {
                                    historyData.push(record);
                                    updateRolledUsersCount();
                                    renderHistory();
                                }
                            };
                            
                            // í…ŒìŠ¤íŠ¸ìš©: 1001~1006 ë²”ìœ„ë©´ í•´ë‹¹ ì• ë‹ˆë©”ì´ì…˜ ê°•ì œ ì„ íƒ
                            let animationIndex = null;
                            if (finalResult >= 1001 && finalResult <= 1006) {
                                animationIndex = finalResult - 1001; // 1001â†’0, 1002â†’1, ..., 1006â†’5
                            }
                            
                            // ëœë¤ìœ¼ë¡œ ì—°ì¶œ íš¨ê³¼ ì„ íƒí•˜ì—¬ ì¬ìƒ (ë˜ëŠ” í…ŒìŠ¤íŠ¸ìš© íŠ¹ì • íš¨ê³¼)
                            playRandomDiceAnimation(diceResultSpan, diceIcon, finalResult, onAnimationComplete, animationIndex);
                        } else {
                            // ì• ë‹ˆë©”ì´ì…˜ ì—†ì´ ë°”ë¡œ ìµœì¢… ìˆ«ì í‘œì‹œ
                            diceResultSpan.textContent = diceIcon + finalResult;
                        }
                    }
                }
            }
            
            if (record.user === currentUser) {
                // ì£¼ì‚¬ìœ„ëŠ” ììœ ë¡­ê²Œ êµ´ë¦´ ìˆ˜ ìˆìŒ (hasRolledInCurrentGame ì‚¬ìš© ì•ˆí•¨)
                
                if (diceAnimationInterval) {
                    clearInterval(diceAnimationInterval);
                    diceAnimationInterval = null;
                }

                // ì£¼ì‚¬ìœ„ UIê°€ ì œê±°ë˜ì–´ ê²°ê³¼ëŠ” ê²Œì„ ê¸°ë¡ì—ì„œë§Œ í™•ì¸ ê°€ëŠ¥
                
                // ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° ë²„íŠ¼ì€ ì œê±°ë¨ (ëª…ë ¹ì–´ë¡œ ëŒ€ì²´)
            }
            
            renderHistory();
        });

        // ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
        socket.on('rollProgress', (progress) => {
            updateProgress(progress);
            updateRolledUsersCount();
        });

        // ëª¨ë‘ ì™„ë£Œ ì•Œë¦¼
        socket.on('allPlayersRolled', (data) => {
            // íŒì—… ì œê±° - ë°©ì¥ì´ ê²Œì„ì¢…ë£Œ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œë§Œ íŒì—… í‘œì‹œ
            document.getElementById('progressBar').style.background = 'linear-gradient(90deg, #28a745 0%, #20c997 100%)';
        });

        // ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° ì—ëŸ¬
        socket.on('rollError', (message) => {
            alert(message);
            
            if (diceAnimationInterval) {
                clearInterval(diceAnimationInterval);
                diceAnimationInterval = null;
            }
        });

        // ì—ëŸ¬ ì²˜ë¦¬
        socket.on('connectionError', (message) => {
            alert(message);
            setTimeout(() => location.reload(), 2000);
        });

        socket.on('rateLimitError', (message) => {
            alert(message);
        });

        socket.on('permissionError', (message) => {
            alert(message);
        });

        socket.on('rangeError', (message) => {
            alert(message);
        });

        // ì‚¬ìš©ì ëª©ë¡ ì—…ë°ì´íŠ¸
        socket.on('updateUsers', (users) => {
            // í˜¸ìŠ¤íŠ¸ ìƒíƒœ í™•ì¸ ë° ì—…ë°ì´íŠ¸
            const myUser = users.find(u => u.name === currentUser);
            if (myUser && myUser.isHost !== isHost) {
                const wasHost = isHost;
                isHost = myUser.isHost;
                if (isHost && !wasHost && lastHostStatus !== isHost) {
                    // í˜¸ìŠ¤íŠ¸ ê¶Œí•œì´ ì „ë‹¬ë˜ì—ˆì„ ë•Œ
                    alert('í˜¸ìŠ¤íŠ¸ ê¶Œí•œì´ ì „ë‹¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    updateHostUI();
                } else if (!isHost && wasHost) {
                    // í˜¸ìŠ¤íŠ¸ ê¶Œí•œì´ ì œê±°ë˜ì—ˆì„ ë•Œ
                    updateHostUI();
                }
                lastHostStatus = isHost;
            }
            
            usersList = users;
            updateUsers(users);
            updateHostCheckbox(users);
            // ì£¼ë¬¸ë°›ê¸°ê°€ í™œì„±í™”ëœ ìƒíƒœë©´ ì£¼ë¬¸í•˜ì§€ ì•Šì€ ì‚¬ëŒ ëª©ë¡ë„ ì—…ë°ì´íŠ¸
            if (isOrderActive) {
                renderNotOrderedUsers();
            }
        });

        function updateUsers(users) {
            const usersList = document.getElementById('usersList');
            const userCount = document.getElementById('userCount');
            
            userCount.textContent = users.length;
            
            if (users.length === 0) {
                usersList.innerHTML = '<div style="color: #999; text-align: center; padding: 10px; width: 100%;">ì ‘ì†ìê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }
            
            usersList.innerHTML = '';
            
            users.forEach((user) => {
                const userTag = document.createElement('div');
                userTag.className = 'user-tag' + (user.isHost ? ' host' : '');
                
                let content = user.name;
                if (user.isHost) {
                    content += ' ğŸ‘‘';
                }
                
                if (user.name === currentUser) {
                    content += ' (ë‚˜)';
                }
                
                userTag.textContent = content;
                usersList.appendChild(userTag);
            });
        }
        
        // ì¤€ë¹„ ìƒíƒœ í† ê¸€
        function toggleReady() {
            socket.emit('toggleReady');
        }
        
        // ì¤€ë¹„ ìƒíƒœ ë³€ê²½ ìˆ˜ì‹ 
        socket.on('readyStateChanged', (data) => {
            isReady = data.isReady;
            updateReadyButton();
        });
        
        // ì¤€ë¹„ ëª©ë¡ ì—…ë°ì´íŠ¸
        socket.on('readyUsersUpdated', (users) => {
            readyUsers = users;
            renderReadyUsers();
        });
        
        // ì¤€ë¹„ ì—ëŸ¬ ì²˜ë¦¬
        socket.on('readyError', (message) => {
            alert(message);
        });
        
        // ì¤€ë¹„í•œ ì‚¬ëŒ ëª©ë¡ ë Œë”ë§
        function renderReadyUsers() {
            const readyUsersList = document.getElementById('readyUsersList');
            const readyCount = document.getElementById('readyCount');
            
            readyCount.textContent = readyUsers.length;
            
            if (readyUsers.length === 0) {
                readyUsersList.innerHTML = '<div style="color: #999; text-align: center; padding: 10px; width: 100%;">ì•„ì§ ì¤€ë¹„í•œ ì‚¬ëŒì´ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }
            
            readyUsersList.innerHTML = '';
            
            // ê°€ë‚˜ë‹¤ìˆœìœ¼ë¡œ ì •ë ¬
            const sortedReadyUsers = [...readyUsers].sort((a, b) => a.localeCompare(b, 'ko'));
            
            sortedReadyUsers.forEach((userName) => {
                const userTag = document.createElement('div');
                userTag.className = 'user-tag';
                userTag.style.background = '#d4edda';
                userTag.style.borderColor = '#28a745';
                userTag.style.color = '#155724';
                
                let content = userName;
                if (userName === currentUser) {
                    content += ' (ë‚˜)';
                }
                
                userTag.textContent = content;
                readyUsersList.appendChild(userTag);
            });
        }
        
        // ì¤€ë¹„ ë²„íŠ¼ ì—…ë°ì´íŠ¸
        function updateReadyButton() {
            const readyButton = document.getElementById('readyButton');
            if (isReady) {
                readyButton.textContent = 'ì¤€ë¹„ ì·¨ì†Œ';
                readyButton.style.background = 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)';
            } else {
                readyButton.textContent = 'ì¤€ë¹„';
                readyButton.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
            }
        }
        
        // ì±„íŒ… ë©”ì‹œì§€ ì „ì†¡
        function sendChatMessage() {
            const chatInput = document.getElementById('chatInput');
            const message = chatInput.value.trim();
            
            if (message === '') {
                return;
            }
            
            // /í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´ ì²˜ë¦¬ (ì• ë‹ˆë©”ì´ì…˜ í…ŒìŠ¤íŠ¸ìš©)
            if (message.startsWith('/í…ŒìŠ¤íŠ¸')) {
                handleTestCommand(message);
                chatInput.value = '';
                return;
            }
            
            // /ì£¼ì‚¬ìœ„ ëª…ë ¹ì–´ ì²˜ë¦¬
            if (message.startsWith('/ì£¼ì‚¬ìœ„')) {
                // ë¨¼ì € ì±„íŒ… ë©”ì‹œì§€ë¡œ ì „ì†¡ (ëª…ë ¹ì–´ë„ ì±„íŒ…ì— ë³´ì´ê²Œ)
                socket.emit('sendMessage', { message: message });
                // ê·¸ ë‹¤ìŒ ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° ì‹¤í–‰
                handleDiceCommand(message);
                chatInput.value = '';
                return;
            }
            
            socket.emit('sendMessage', { message: message });
            chatInput.value = '';
        }
        
        // í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´ ì²˜ë¦¬ (ì• ë‹ˆë©”ì´ì…˜ í…ŒìŠ¤íŠ¸ìš©)
        function handleTestCommand(command) {
            const parts = command.trim().split(/\s+/);
            if (parts.length < 2) {
                alert('ì‚¬ìš©ë²•: /í…ŒìŠ¤íŠ¸ [ì• ë‹ˆë©”ì´ì…˜ë²ˆí˜¸]\nì˜ˆ: /í…ŒìŠ¤íŠ¸ 1001, /í…ŒìŠ¤íŠ¸ 1002, /í…ŒìŠ¤íŠ¸ 1003');
                return;
            }
            
            const animationNum = parseInt(parts[1]);
            if (isNaN(animationNum) || (animationNum < 1001 || animationNum > 1003)) {
                alert('ì• ë‹ˆë©”ì´ì…˜ ë²ˆí˜¸ëŠ” 1001, 1002, 1003 ì¤‘ í•˜ë‚˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            // ëœë¤ ìˆ«ì ìƒì„± (1~99)
            const randomResult = Math.floor(Math.random() * 99) + 1;
            
            // ì±„íŒ… ë©”ì‹œì§€ ë¨¼ì € ì „ì†¡
            socket.emit('sendMessage', { message: `/í…ŒìŠ¤íŠ¸ ${animationNum}` });
            
            // ê°€ì§œ ì£¼ì‚¬ìœ„ ê²°ê³¼ ìƒì„± (ì• ë‹ˆë©”ì´ì…˜ í…ŒìŠ¤íŠ¸ìš©)
            const testRecord = {
                user: currentUser,
                result: randomResult,
                time: new Date().toLocaleTimeString('ko-KR', { timeZone: 'Asia/Seoul' }),
                seed: 'test',
                range: '1~100',
                isNotReady: false,
                deviceType: isMobileDevice() ? (/iPhone|iPad|iPod/i.test(navigator.userAgent) ? 'ios' : 'android') : 'pc',
                isLastRoller: true // ì• ë‹ˆë©”ì´ì…˜ì„ ì¬ìƒí•˜ê¸° ìœ„í•´ trueë¡œ ì„¤ì •
            };
            
            // diceRolled ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë¡œì§ì„ ì§ì ‘ ì‹¤í–‰ (í…ŒìŠ¤íŠ¸ìš©)
            setTimeout(() => {
                // socket.on('diceRolled') í•¸ë“¤ëŸ¬ì˜ ë¡œì§ì„ ì§ì ‘ ì‹¤í–‰
                const isNotReady = testRecord.isNotReady === true;
                const isFirstRollInGame = isGameActive && !rolledUsersInGame.includes(testRecord.user) && !isNotReady;
                const isNotGameActive = !isGameActive;
                const shouldSaveToHistory = (isNotGameActive || isFirstRollInGame) && !isNotReady;
                
                // ì£¼ì‚¬ìœ„ ê²°ê³¼ í‘œì‹œ ë¡œì§ ì‹¤í–‰
                const chatMessages = document.getElementById('chatMessages');
                const diceCommandMessages = Array.from(chatMessages.children).filter(div => 
                    div.getAttribute('data-dice-command') === 'true' && 
                    div.getAttribute('data-user-name') === testRecord.user
                );
                
                if (diceCommandMessages.length > 0) {
                    const lastDiceCommandMsg = diceCommandMessages[diceCommandMessages.length - 1];
                    const resultContainer = lastDiceCommandMsg.querySelector('span[data-dice-result-container="true"]');
                    if (resultContainer) {
                        const existingResult = resultContainer.querySelector('span[data-dice-result]');
                        if (!existingResult) {
                            const diceResultSpan = document.createElement('span');
                            diceResultSpan.setAttribute('data-dice-result', 'true');
                            const finalResult = testRecord.result;
                            const diceIcon = (shouldSaveToHistory && !isNotReady) ? 'ğŸ² ' : '';
                            
                            diceResultSpan.style.cssText = 'font-weight: 600; color: #333;';
                            diceResultSpan.textContent = diceIcon;
                            resultContainer.appendChild(diceResultSpan);
                            
                            // í…ŒìŠ¤íŠ¸ìš© ì• ë‹ˆë©”ì´ì…˜ ì¬ìƒ
                            const onAnimationComplete = () => {
                                window.lastRollerAnimationComplete = true;
                                window.lastRollerAnimationCompleteTime = Date.now();
                            };
                            
                            const animationIndex = animationNum - 1001; // 1001â†’0, 1002â†’1, 1003â†’2
                            playRandomDiceAnimation(diceResultSpan, diceIcon, finalResult, onAnimationComplete, animationIndex);
                        }
                    }
                }
            }, 500); // ì±„íŒ… ë©”ì‹œì§€ê°€ ë¨¼ì € ë Œë”ë§ë˜ë„ë¡ ì•½ê°„ì˜ ì§€ì—°
        }
        
        // ì£¼ì‚¬ìœ„ ëª…ë ¹ì–´ ì²˜ë¦¬
        function handleDiceCommand(command) {
            // ì£¼ì‚¬ìœ„ëŠ” ê²Œì„ ì§„í–‰ ì „/í›„ ëª¨ë‘ ììœ ë¡­ê²Œ êµ´ë¦´ ìˆ˜ ìˆìŒ
            
            // /ì£¼ì‚¬ìœ„ ëª…ë ¹ì–´ íŒŒì‹±
            const parts = command.trim().split(/\s+/);
            let maxValue = 100; // ê¸°ë³¸ê°’ 100
            
            // ìˆ«ìê°€ ì œê³µëœ ê²½ìš°
            if (parts.length >= 2) {
                const parsedValue = parseInt(parts[1]);
                if (!isNaN(parsedValue) && parsedValue >= 1) {
                    maxValue = parsedValue;
                }
            }
            
            
            // ë²”ìœ„ ê²€ì¦
            if (maxValue < 1) {
                alert('ì˜¬ë°”ë¥¸ ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”! (1 ì´ìƒ)');
                return;
            }
            
            if (maxValue > 100000) {
                alert('ìµœëŒ€ê°’ì€ 100000ê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤!');
                return;
            }
            
            // ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° (ì§€ì •í•œ ë²”ìœ„ë¡œ)
            rollDiceWithRange(1, maxValue);
        }
        
        // ì§€ì •í•œ ë²”ìœ„ë¡œ ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°
        function rollDiceWithRange(min, max) {
            // ì£¼ì‚¬ìœ„ UIê°€ ì œê±°ë˜ì–´ ì• ë‹ˆë©”ì´ì…˜ ì—†ì´ ë°”ë¡œ ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° ìš”ì²­ ì „ì†¡
            if (diceAnimationInterval) {
                clearInterval(diceAnimationInterval);
                diceAnimationInterval = null;
            }

            const clientSeed = generateClientSeed();
            socket.emit('requestRoll', { 
                userName: currentUser,
                clientSeed: clientSeed,
                min: min,
                max: max
            });
        }
        
        // ì±„íŒ… ì…ë ¥ì°½ ìë™ì™„ì„± ê´€ë ¨ ë³€ìˆ˜
        let chatCurrentSuggestions = [];
        let chatSelectedSuggestionIndex = -1;
        
        // ì±„íŒ… ì…ë ¥ì°½ ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ ë Œë”ë§
        function renderChatAutocompleteDropdown() {
            const dropdownDiv = document.getElementById('chatAutocompleteDropdown');
            const chatInput = document.getElementById('chatInput');
            const text = chatInput.value;
            
            dropdownDiv.innerHTML = '';
            
            chatCurrentSuggestions.forEach((suggestion, index) => {
                const item = document.createElement('div');
                item.className = 'autocomplete-item' + (index === chatSelectedSuggestionIndex ? ' selected' : '');
                item.textContent = suggestion;
                
                // ì…ë ¥ëœ ë¶€ë¶„ ê°•ì¡°
                const prefix = document.createElement('strong');
                prefix.textContent = suggestion.substring(0, text.length);
                const suffix = document.createElement('span');
                suffix.textContent = suggestion.substring(text.length);
                
                item.innerHTML = '';
                item.appendChild(prefix);
                item.appendChild(suffix);
                
                item.addEventListener('click', () => {
                    applyChatSuggestion(suggestion);
                });
                
                dropdownDiv.appendChild(item);
            });
        }
        
        // ì±„íŒ… ì…ë ¥ì°½ ìë™ì™„ì„± ì—…ë°ì´íŠ¸
        function updateChatAutocompleteSuggestion() {
            const chatInput = document.getElementById('chatInput');
            const suggestionDiv = document.getElementById('chatAutocompleteSuggestion');
            const dropdownDiv = document.getElementById('chatAutocompleteDropdown');
            const text = chatInput.value;
            
            chatCurrentSuggestions = findChatAutocompleteSuggestions(text);
            chatSelectedSuggestionIndex = -1;
            
            // ëª¨ë°”ì¼ì—ì„œë§Œ ë“œë¡­ë‹¤ìš´ í‘œì‹œ
            if (chatCurrentSuggestions.length > 0 && isMobileDevice()) {
                // íšŒìƒ‰ í…ìŠ¤íŠ¸ëŠ” í‘œì‹œí•˜ì§€ ì•ŠìŒ (ë“œë¡­ë‹¤ìš´ë§Œ í‘œì‹œ)
                suggestionDiv.style.display = 'none';
                
                // ë“œë¡­ë‹¤ìš´ í‘œì‹œ (ì£¼ë¬¸ ë©”ë‰´ì²˜ëŸ¼)
                renderChatAutocompleteDropdown();
                dropdownDiv.style.display = 'block';
            } else {
                suggestionDiv.textContent = '';
                suggestionDiv.style.display = 'none';
                dropdownDiv.style.display = 'none';
            }
        }
        
        // ì±„íŒ… ì…ë ¥ì°½ ìë™ì™„ì„± ì ìš©
        function applyChatSuggestion(suggestion) {
            const chatInput = document.getElementById('chatInput');
            chatInput.value = suggestion;
            chatCurrentSuggestions = [];
            chatSelectedSuggestionIndex = -1;
            document.getElementById('chatAutocompleteSuggestion').style.display = 'none';
            document.getElementById('chatAutocompleteDropdown').style.display = 'none';
            chatInput.focus();
        }
        
        // ì±„íŒ… ì…ë ¥ì°½ì—ì„œ Enter í‚¤ë¡œ ì „ì†¡ ë° ìë™ì™„ì„±
        document.addEventListener('DOMContentLoaded', () => {
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                // /, /ã…ˆ, /ì£¼, /ì£¼ã……, /ì£¼ì‚¬, /ì£¼ì‚¬ã…‡, /ì£¼ì‚¬ìš° ë“±ìœ¼ë¡œ ì‹œì‘í•  ë•Œë§Œ ìë™ì™„ì„± ì‘ë™
                chatInput.addEventListener('input', () => {
                    const text = chatInput.value.trim();
                    if (text === '/' ||
                        text === '/ã…ˆ' ||
                        text.startsWith('/ì£¼') ||
                        text.startsWith('/ì£¼ì‚¬')) {
                        updateChatAutocompleteSuggestion();
                    } else {
                        // í•´ë‹¹í•˜ì§€ ì•Šìœ¼ë©´ ìë™ì™„ì„± ìˆ¨ê¸°ê¸°
                        const suggestionDiv = document.getElementById('chatAutocompleteSuggestion');
                        const dropdownDiv = document.getElementById('chatAutocompleteDropdown');
                        if (suggestionDiv) suggestionDiv.style.display = 'none';
                        if (dropdownDiv) dropdownDiv.style.display = 'none';
                        chatCurrentSuggestions = [];
                        chatSelectedSuggestionIndex = -1;
                    }
                });
                
                chatInput.addEventListener('keydown', (e) => {
                    // Tabìœ¼ë¡œ ìë™ì™„ì„± ì ìš©
                    if (e.key === 'Tab' && chatCurrentSuggestions.length > 0) {
                        e.preventDefault();
                        const suggestionToApply = chatSelectedSuggestionIndex >= 0 
                            ? chatCurrentSuggestions[chatSelectedSuggestionIndex] 
                            : chatCurrentSuggestions[0];
                        applyChatSuggestion(suggestionToApply);
                        return;
                    }
                    
                    // ë°©í–¥í‚¤ë¡œ ì œì•ˆ ì„ íƒ
                    if (e.key === 'ArrowDown' && chatCurrentSuggestions.length > 0) {
                        e.preventDefault();
                        chatSelectedSuggestionIndex = (chatSelectedSuggestionIndex + 1) % chatCurrentSuggestions.length;
                        renderChatAutocompleteDropdown();
                        return;
                    }
                    
                    if (e.key === 'ArrowUp' && chatCurrentSuggestions.length > 0) {
                        e.preventDefault();
                        chatSelectedSuggestionIndex = chatSelectedSuggestionIndex <= 0 
                            ? chatCurrentSuggestions.length - 1 
                            : chatSelectedSuggestionIndex - 1;
                        renderChatAutocompleteDropdown();
                        return;
                    }
                    
                    // Escapeë¡œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
                    if (e.key === 'Escape') {
                        chatCurrentSuggestions = [];
                        chatSelectedSuggestionIndex = -1;
                        document.getElementById('chatAutocompleteSuggestion').style.display = 'none';
                        document.getElementById('chatAutocompleteDropdown').style.display = 'none';
                        return;
                    }
                    
                    // Enter í‚¤ ì²˜ë¦¬
                    if (e.key === 'Enter') {
                        // ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ì´ ì—´ë ¤ìˆìœ¼ë©´ ìë™ì™„ì„± ì ìš©
                        if (chatCurrentSuggestions.length > 0) {
                            e.preventDefault();
                            const suggestionToApply = chatSelectedSuggestionIndex >= 0 
                                ? chatCurrentSuggestions[chatSelectedSuggestionIndex] 
                                : chatCurrentSuggestions[0];
                            applyChatSuggestion(suggestionToApply);
                            return;
                        }
                        e.preventDefault();
                        sendChatMessage();
                    }
                });
            }
            
        });
        
        // ìƒˆ ë©”ì‹œì§€ ìˆ˜ì‹ 
        socket.on('newMessage', (chatMessage) => {
            const chatMessages = document.getElementById('chatMessages');
            
            // ì²« ë©”ì‹œì§€ë©´ ë¹ˆ ìƒíƒœ ë©”ì‹œì§€ ì œê±°
            if (chatMessages.children.length === 1 && chatMessages.children[0].textContent === 'ì±„íŒ… ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤') {
                chatMessages.innerHTML = '';
            }
            
            const messageDiv = document.createElement('div');
            
            // ì‹œìŠ¤í…œ ë©”ì‹œì§€ì¸ì§€ í™•ì¸
            const isSystemMessage = chatMessage.isSystemMessage || chatMessage.userName === 'ì‹œìŠ¤í…œ';
            
            // /ì£¼ì‚¬ìœ„ ë˜ëŠ” /í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´ì¸ì§€ í™•ì¸
            const isDiceCommand = chatMessage.message.startsWith('/ì£¼ì‚¬ìœ„') || chatMessage.message.startsWith('/í…ŒìŠ¤íŠ¸');
            
            // ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì²˜ë¦¬
            if (isSystemMessage) {
                messageDiv.style.cssText = 'margin: 20px 0; padding: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);';
                
                // ê²Œì„ ì‹œì‘ ë©”ì‹œì§€ íŒŒì‹±
                const lines = chatMessage.message.split('\n');
                const titleLine = lines.find(line => line.includes('ê²Œì„ì‹œì‘'));
                // êµ¬ë¶„ì„ ê³¼ ì œëª©ì„ ì œì™¸í•œ ëª¨ë“  ë£° ì¤„ ì¶”ì¶œ
                const rulesLines = lines.filter(line => 
                    !line.includes('---') && 
                    !line.includes('ê²Œì„ì‹œì‘') && 
                    line.trim().length > 0
                );
                
                // ëª¨ë“  ì°¸ì—¬ìê°€ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë ¸ë‹¤ëŠ” ë©”ì‹œì§€ì¸ì§€ í™•ì¸
                const isAllRolledMessage = chatMessage.message.includes('ëª¨ë“  ì°¸ì—¬ìê°€ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë ¸ìŠµë‹ˆë‹¤');
                
                if (isAllRolledMessage) {
                    // ë©”ì‹œì§€ divëŠ” ë¨¼ì € ì¶”ê°€í•˜ë˜ ë‚´ìš©ì€ ë¹„ì›Œë‘ 
                    messageDiv.style.display = 'none'; // ë¨¼ì € ìˆ¨ê¹€
                    chatMessages.appendChild(messageDiv);
                    
                    // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í›„ 3ì´ˆ ë’¤ì— ë©”ì‹œì§€ í‘œì‹œ
                    const showMessage = () => {
                        const titleDiv = document.createElement('div');
                        titleDiv.style.cssText = 'font-size: 18px; font-weight: bold; color: white; margin-bottom: 12px; text-shadow: 0 2px 4px rgba(0,0,0,0.2);';
                        titleDiv.textContent = 'ğŸ‰ ì£¼ì‚¬ìœ„ ë‹¤ êµ´ë ¸ìŠµë‹ˆë‹¤!';
                        messageDiv.appendChild(titleDiv);
                        messageDiv.style.display = 'block'; // í‘œì‹œ
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    };
                    
                    const checkAndShow = () => {
                        if (window.lastRollerAnimationComplete && window.lastRollerAnimationCompleteTime) {
                            const elapsed = Date.now() - window.lastRollerAnimationCompleteTime;
                            if (elapsed >= 1500) {
                                showMessage();
                                return true;
                            }
                        }
                        return false;
                    };
                    
                    // ì¦‰ì‹œ í™•ì¸ (ì´ë¯¸ 3ì´ˆê°€ ì§€ë‚¬ì„ ìˆ˜ ìˆìŒ)
                    if (!checkAndShow()) {
                        // ì•„ì§ ì‹œê°„ì´ ì•ˆ ì§€ë‚¬ìœ¼ë©´ ëŒ€ê¸°
                        const waitInterval = setInterval(() => {
                            if (checkAndShow()) {
                                clearInterval(waitInterval);
                            }
                        }, 100);
                        
                        // ìµœëŒ€ 10ì´ˆ ëŒ€ê¸° í›„ ê°•ì œ í‘œì‹œ
                        setTimeout(() => {
                            clearInterval(waitInterval);
                            if (!messageDiv.querySelector('div')) {
                                showMessage();
                            }
                        }, 10000);
                    } else {
                        showMessage();
                    }
                    
                    return; // ì—¬ê¸°ì„œ ì¢…ë£Œí•˜ì—¬ ì•„ë˜ ì½”ë“œ ì‹¤í–‰ ë°©ì§€
                } else if (titleLine) {
                    const titleDiv = document.createElement('div');
                    titleDiv.style.cssText = 'font-size: 18px; font-weight: bold; color: white; margin-bottom: 12px; text-shadow: 0 2px 4px rgba(0,0,0,0.2);';
                    titleDiv.textContent = 'ğŸ® ê²Œì„ ì‹œì‘';
                    messageDiv.appendChild(titleDiv);
                }
                
                if (rulesLines.length > 0) {
                    const rulesDiv = document.createElement('div');
                    rulesDiv.style.cssText = 'font-size: 15px; color: #fff; background: rgba(255,255,255,0.2); padding: 12px; border-radius: 8px; margin: 8px 0; backdrop-filter: blur(10px); line-height: 1.6; white-space: pre-wrap; word-break: break-word; text-align: center;';
                    // ëª¨ë“  ë£° ì¤„ì„ ì¤„ë°”ê¿ˆìœ¼ë¡œ ì—°ê²°
                    rulesDiv.textContent = rulesLines.map(line => line.trim()).join('\n');
                    messageDiv.appendChild(rulesDiv);
                }
                
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                return;
            }
            
            // ì¼ë°˜ ë©”ì‹œì§€ëŠ” ì™¼ìª½ ì •ë ¬
            messageDiv.style.cssText = 'margin-bottom: 10px; padding: 8px; background: white; border-radius: 6px; border-left: 3px solid #667eea;';
            
            // /ì£¼ì‚¬ìœ„ ëª…ë ¹ì–´ì¸ ê²½ìš° ë‚˜ì¤‘ì— ê²°ê³¼ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë„ë¡ í‘œì‹œ
            if (isDiceCommand) {
                messageDiv.setAttribute('data-dice-command', 'true');
                messageDiv.setAttribute('data-user-name', chatMessage.userName);
                // /ì£¼ì‚¬ìœ„ ëª…ë ¹ì–´ëŠ” ì²« ì¤„ì„ flexë¡œ ë§Œë“¤ì–´ì„œ ê²°ê³¼ë¥¼ ì˜¤ë¥¸ìª½ ëìœ¼ë¡œ ì •ë ¬
                messageDiv.style.cssText = 'margin-bottom: 10px; padding: 8px; background: white; border-radius: 6px; border-left: 3px solid #667eea; display: flex; flex-direction: column;';
                const firstLineDiv = document.createElement('div');
                firstLineDiv.style.cssText = 'display: flex; justify-content: space-between; align-items: center; width: 100%;';
                messageDiv.appendChild(firstLineDiv);
                
                const leftContentSpan = document.createElement('span');
                leftContentSpan.style.cssText = 'display: flex; align-items: center;';
                
                const userNameSpan = document.createElement('span');
                userNameSpan.style.cssText = 'font-weight: 600; color: #667eea; margin-right: 8px;';
                userNameSpan.setAttribute('data-user-name-display', chatMessage.userName);
                // ë””ë°”ì´ìŠ¤ ì•„ì´ì½˜ ì¶”ê°€
                let userNameText = chatMessage.isHost ? `ğŸ‘‘ ${chatMessage.userName}` : chatMessage.userName;
                if (chatMessage.deviceType) {
                    const deviceIcon = getDeviceIcon(chatMessage.deviceType);
                    if (chatMessage.isHost) {
                        userNameText = `ğŸ‘‘ ${deviceIcon} ${chatMessage.userName}`;
                    } else {
                        userNameText = `${deviceIcon} ${chatMessage.userName}`;
                    }
                }
                userNameSpan.textContent = userNameText;
                if (chatMessage.userName === currentUser) {
                    userNameSpan.textContent += ' (ë‚˜)';
                    userNameSpan.style.color = '#764ba2';
                }
                
                const messageSpan = document.createElement('span');
                messageSpan.style.color = '#333';
                messageSpan.textContent = chatMessage.message;
                messageSpan.setAttribute('data-dice-message', 'true');
                
                leftContentSpan.appendChild(userNameSpan);
                leftContentSpan.appendChild(messageSpan);
                firstLineDiv.appendChild(leftContentSpan);
                
                // ì˜¤ë¥¸ìª½ì— ì£¼ì‚¬ìœ„ ê²°ê³¼ë¥¼ ë„£ì„ ê³µê°„ì„ ë¯¸ë¦¬ ì¤€ë¹„ (ë‚˜ì¤‘ì— ì±„ì›Œì§)
                const rightContentSpan = document.createElement('span');
                rightContentSpan.setAttribute('data-dice-result-container', 'true');
                rightContentSpan.style.cssText = 'min-width: 60px;';
                firstLineDiv.appendChild(rightContentSpan);
                
                const timeSpan = document.createElement('span');
                timeSpan.style.cssText = 'font-size: 11px; color: #999; margin-top: 4px;';
                timeSpan.textContent = chatMessage.time;
                messageDiv.appendChild(timeSpan);
            } else {
                // ì¼ë°˜ ë©”ì‹œì§€ëŠ” ì™¼ìª½ ì •ë ¬
                const userNameSpan = document.createElement('span');
                userNameSpan.style.cssText = 'font-weight: 600; color: #667eea; margin-right: 8px;';
                // ë””ë°”ì´ìŠ¤ ì•„ì´ì½˜ ì¶”ê°€
                let userNameText = chatMessage.isHost ? `ğŸ‘‘ ${chatMessage.userName}` : chatMessage.userName;
                if (chatMessage.deviceType) {
                    const deviceIcon = getDeviceIcon(chatMessage.deviceType);
                    if (chatMessage.isHost) {
                        userNameText = `ğŸ‘‘ ${deviceIcon} ${chatMessage.userName}`;
                    } else {
                        userNameText = `${deviceIcon} ${chatMessage.userName}`;
                    }
                }
                userNameSpan.textContent = userNameText;
                if (chatMessage.userName === currentUser) {
                    userNameSpan.textContent += ' (ë‚˜)';
                    userNameSpan.style.color = '#764ba2';
                }
                
                const messageSpan = document.createElement('span');
                messageSpan.style.color = '#333';
                messageSpan.textContent = chatMessage.message;
                
                const timeSpan = document.createElement('span');
                timeSpan.style.cssText = 'font-size: 11px; color: #999; margin-left: 8px;';
                timeSpan.textContent = chatMessage.time;
                
                messageDiv.appendChild(userNameSpan);
                messageDiv.appendChild(messageSpan);
                messageDiv.appendChild(document.createElement('br'));
                messageDiv.appendChild(timeSpan);
            }
            
            chatMessages.appendChild(messageDiv);
            
            // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
            chatMessages.scrollTop = chatMessages.scrollHeight;
        });
        
        // ì±„íŒ… ì—ëŸ¬ ì²˜ë¦¬
        socket.on('chatError', (message) => {
            alert(message);
        });

        function updateHostCheckbox(users) {
            const hostCheckbox = document.getElementById('hostCheckbox');
            const hasHost = users.some(user => user.isHost === true);
            
            if (hasHost) {
                hostCheckbox.disabled = true;
                hostCheckbox.checked = false;
                const label = document.querySelector('label[for="hostCheckbox"]');
                if (label) {
                    label.textContent = 'Hostë¡œ ì…ì¥ (ì´ë¯¸ í˜¸ìŠ¤íŠ¸ê°€ ìˆìŠµë‹ˆë‹¤)';
                    label.style.color = '#999';
                }
            } else {
                hostCheckbox.disabled = false;
                const label = document.querySelector('label[for="hostCheckbox"]');
                if (label) {
                    label.textContent = 'Hostë¡œ ì…ì¥';
                    label.style.color = '';
                }
            }
        }

        function updateProgress(progress) {
            const { rolled, total, notRolledYet } = progress;
            const percentage = total > 0 ? (rolled / total) * 100 : 0;
            
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = percentage + '%';
            progressBar.textContent = Math.round(percentage) + '%';
            
            document.getElementById('progressCount').textContent = `${rolled}/${total}`;
            
            const notRolledList = document.getElementById('notRolledList');
            
            if (notRolledYet.length === 0) {
                notRolledList.innerHTML = '<div class="empty-not-rolled">âœ… ëª¨ë‘ ì™„ë£Œ!</div>';
            } else {
                notRolledList.innerHTML = '';
                // ê°€ë‚˜ë‹¤ìˆœìœ¼ë¡œ ì •ë ¬
                const sortedNotRolledYet = [...notRolledYet].sort((a, b) => a.localeCompare(b, 'ko'));
                sortedNotRolledYet.forEach(name => {
                    const tag = document.createElement('div');
                    tag.className = 'not-rolled-tag';
                    tag.textContent = name;
                    if (name === currentUser) {
                        tag.textContent += ' (ë‚˜)';
                    }
                    notRolledList.appendChild(tag);
                });
            }
        }

        // íˆìŠ¤í† ë¦¬ ì •ë ¬ í•¨ìˆ˜
        function sortHistoryData(data, mode) {
            const sorted = [...data];
            
            if (mode === 'asc') {
                sorted.sort((a, b) => a.result - b.result);
            } else if (mode === 'desc') {
                sorted.sort((a, b) => b.result - a.result);
            } else if (mode === 'time') {
                sorted.reverse();
            }
            
            return sorted;
        }

        // ì •ë ¬ ë²„íŠ¼ í´ë¦­
        function sortHistory(mode) {
            currentSortMode = mode;
            
            document.querySelectorAll('.sort-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (mode === 'time') {
                document.getElementById('sortTimeBtn').classList.add('active');
            } else if (mode === 'asc') {
                document.getElementById('sortAscBtn').classList.add('active');
            } else if (mode === 'desc') {
                document.getElementById('sortDescBtn').classList.add('active');
            }
            
            renderHistory();
        }

        // êµ´ë¦° ì¸ì› ì—…ë°ì´íŠ¸
        function updateRolledUsersCount() {
            const rolledUsersCountElement = document.getElementById('rolledUsersCount');
            if (!rolledUsersCountElement) return;
            
            let count = 0;
            if (isGameActive) {
                // ê²Œì„ ì§„í–‰ ì¤‘ì¼ ë•ŒëŠ” ê²Œì„ ì¤‘ êµ´ë¦° ì‚¬ìš©ì ìˆ˜ í‘œì‹œ
                count = rolledUsersInGame.length;
            } else {
                // ê²Œì„ ì§„í–‰ ì¤‘ì´ ì•„ë‹ ë•ŒëŠ” ì „ì²´ ê¸°ë¡ ìˆ˜ í‘œì‹œ
                count = historyData.length;
            }
            
            rolledUsersCountElement.textContent = count;
        }

        // íˆìŠ¤í† ë¦¬ ë Œë”ë§
        function renderHistory() {
            const historyList = document.getElementById('historyList');
            
            if (historyData.length === 0) {
                historyList.innerHTML = '<div class="empty-history">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                updateRolledUsersCount();
                return;
            }
            
            const sortedData = sortHistoryData(historyData, currentSortMode);
            
            historyList.innerHTML = '';
            
            sortedData.forEach(record => {
                const item = document.createElement('div');
                item.className = 'history-item';
                item.innerHTML = `
                    <div>
                        <div class="history-user">${record.user}</div>
                        <div class="history-range">${record.range ? (record.range.includes('~') ? record.range.split('~')[1] : record.range) : '100'}</div>
                        <div class="history-time">${record.time}</div>
                    </div>
                    <div class="history-result">ğŸ² ${record.result}</div>
                `;
                historyList.appendChild(item);
            });
            
            updateRolledUsersCount();
        }
    </script>
</body>
</html>
