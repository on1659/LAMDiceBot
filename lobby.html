<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>LAM Dice :)</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Yeon+Sung&display=swap" rel="stylesheet">
    <!-- Google AdSense -->
    <meta name="google-adsense-account" content="ca-pub-1608259764663412">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1608259764663412" crossorigin="anonymous"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 0;
            position: relative;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            margin: 20px auto;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .lobby-section, .create-room-section {
            display: none;
        }

        .lobby-section.active, .create-room-section.active {
            display: block;
        }

        .rooms-list {
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
        }

        .room-item {
            background: white;
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .room-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        /* ê²½ë§ˆ ë²„íŠ¼ íˆ´íŒ */
        #horseRaceLabel {
            position: relative;
        }

        #horseRaceLabel::after {
            content: 'ì´ë¦„ ì¶”ì²œë°›ì•„ìš”~ ë¬¸ì˜í•˜ê¸°ì— ë‚¨ê²¨ì£¼ì„¸ìš”!';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 8px;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            font-size: 12px;
            white-space: nowrap;
            border-radius: 6px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        #horseRaceLabel::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 2px;
            border: 6px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.85);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        #horseRaceLabel:hover::after,
        #horseRaceLabel:hover::before {
            opacity: 1;
        }

        .room-item.active {
            background: #e3f2fd;
            border-color: #2196f3;
        }

        .room-item.my-room {
            background: #fff3cd;
            border-color: #ffc107;
            border-width: 3px;
        }

        .my-room-badge {
            display: inline-block;
            background: #ffc107;
            color: #333;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }

        .room-info {
            flex: 1;
        }

        .room-name {
            font-size: 18px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 5px;
        }

        .room-details {
            font-size: 14px;
            color: #666;
        }

        .room-status {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
            margin-top: 5px;
            display: inline-block;
        }

        .room-status.playing {
            background: #d4edda;
            color: #155724;
        }

        .room-status.ordering {
            background: #fff9e6;
            color: #856404;
        }

        .room-status.waiting {
            background: #e0e0e0;
            color: #666;
        }

        .room-action {
            margin-left: 15px;
        }

        .room-action button {
            width: auto;
            padding: 10px 20px;
        }

        .create-room-section, .join-room-section {
            background: #f8f9fa;
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        /* ì—…ë°ì´íŠ¸ ë‚´ì—­ ì„¹ì…˜ */
        .update-log-section {
            background: linear-gradient(145deg, #fafbff 0%, #f0f2ff 100%);
            border: 1px solid rgba(102, 126, 234, 0.35);
            border-radius: 16px;
            padding: 24px;
            margin-top: 24px;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.12);
        }
        .update-log-section h2 {
            margin-bottom: 16px;
            color: #667eea;
            font-size: 1.25rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .update-log-content {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            max-height: 320px;
            overflow-y: auto;
            line-height: 1.85;
            color: #374151;
            font-size: 14px;
            white-space: pre-wrap;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.04);
        }
        .update-log-content::-webkit-scrollbar {
            width: 8px;
        }
        .update-log-content::-webkit-scrollbar-track {
            background: #f1f3f5;
            border-radius: 4px;
        }
        .update-log-content::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }
        .update-log-content::-webkit-scrollbar-thumb:hover {
            background: #5a6fd6;
        }
        .update-log-content b {
            color: #1f2937;
            font-weight: 700;
        }
        .update-log-content .update-log-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.25), transparent);
            margin: 18px 0;
            border: none;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        input[type="text"], input[type="number"], input[type="password"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        input[type="text"]:focus, input[type="number"]:focus, input[type="password"]:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .connection-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .connection-status.connected {
            background: #28a745;
            color: white;
        }

        .connection-status.disconnected {
            background: #dc3545;
            color: white;
        }

        @keyframes newBadgePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
                max-height: none;
            }
            h1 {
                font-size: 1.8em;
            }
            .room-item {
                flex-direction: column;
                align-items: flex-start;
            }
            .room-action {
                margin-left: 0;
                margin-top: 10px;
                width: 100%;
            }
            .room-action button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <header style="background-color: #f8f9fa; padding: 15px 20px; border-bottom: 1px solid #e7e7e7;">
        <nav style="display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto;">
            <h1 style="margin: 0; font-size: 1.5em;"><a href="/" style="text-decoration: none; color: #333;">LAMDice ì£¼ì‚¬ìœ„ ê²Œì„</a></h1>
            <div class="nav-links">
                <a href="dice-rules-guide.html" style="margin-left: 20px; text-decoration: none; color: #007bff;">ë‹¤ì–‘í•œ ì£¼ì‚¬ìœ„ ê·œì¹™</a>
                <a href="probability-analysis.html" style="margin-left: 20px; text-decoration: none; color: #007bff;">í™•ë¥  ë¶„ì„ ë° íŒ</a>
                <a href="about-us.html" style="margin-left: 20px; text-decoration: none; color: #007bff;">ì‚¬ì´íŠ¸ ì†Œê°œ</a>
            </div>
        </nav>
    </header>
    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h1 style="margin: 0;">ğŸ² LAM Dice :)</h1>
            <div id="visitorStats" style="text-align: right; color: #667eea; font-size: 14px; line-height: 1.6;">
                <div style="font-size:11px;color:#999;margin-bottom:2px;">ì „ì²´ ì„œë²„ í†µí•©</div>
                <div>ì˜¤ëŠ˜ ë°©ë¬¸ì ìˆ˜: <strong id="todayVisitorCount">0</strong>ëª…</div>
                <div>ì˜¤ëŠ˜ í”Œë ˆì´ íšŸìˆ˜: <strong id="todayPlayCount">0</strong>íšŒ</div>
                <div>ì´ í”Œë ˆì´ íšŸìˆ˜: <strong id="totalPlayCount">0</strong>íšŒ</div>
            </div>
        </div>

        <!-- ëŒ€ê¸°ì‹¤ ì„¹ì…˜ -->
        <div class="lobby-section" id="lobbySection">
            <!-- ì„œë²„ ì •ë³´ ë°” (ì„œë²„ ì„ íƒ ì‹œ í‘œì‹œ) -->
            <div id="serverInfoBar" style="display:none; background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1)); border: 1px solid #667eea; border-radius: 8px; padding: 10px 15px; margin-bottom: 15px; align-items: center; justify-content: space-between;">
                <button onclick="sessionStorage.removeItem('diceSession'); sessionStorage.removeItem('diceActiveRoom'); window.location.href='/';" style="width: auto; padding: 6px 12px; font-size: 13px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer;">â† ì„œë²„ ëª©ë¡</button>
                <span id="serverInfoName" style="font-weight: bold; color: #667eea;"></span>
                <span id="serverInfoUserName" style="font-weight: 600; color: #764ba2; display: none;">ğŸ‘¤ </span>
                <button id="serverMembersBtn" onclick="ServerSelectModule.showMembersModal()" style="width: auto; padding: 6px 12px; font-size: 13px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">ğŸ‘¥ ë©¤ë²„</button>
            </div>
            <div class="create-room-button-section" style="background: #f8f9fa; border: 2px solid #667eea; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                <h2 style="margin-bottom: 15px; color: #667eea;">ë°© ë§Œë“¤ê¸°</h2>
                <button onclick="showCreateRoomPage()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin-bottom: 15px;">ë°© ìƒì„±í•˜ê¸°</button>
                <button onclick="RankingModule.show()" style="background: white; border: 2px solid #667eea; color: #667eea; margin-bottom: 15px; font-weight: 600;">ë­í‚¹</button>
                <div class="input-group" style="margin: 0; display: none;">
                    <label for="globalUserNameInput">ì´ë¦„</label>
                    <input type="text" id="globalUserNameInput" placeholder="ì´ë¦„ ì…ë ¥" maxlength="20" />
                    <div id="userNameError" style="color: #dc3545; font-size: 12px; margin-top: 5px; display: none;"></div>
                </div>
            </div>

            <div class="join-room-section">
                <h2 style="margin-bottom: 15px; color: #667eea;">ë°© ëª©ë¡</h2>
                <button onclick="refreshRooms()" style="width: auto; padding: 8px 16px; margin-bottom: 15px; background: #6c757d;">ìƒˆë¡œê³ ì¹¨</button>
                <div class="rooms-list" id="roomsList">
                    <div style="color: #999; text-align: center; padding: 20px;">ë°© ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>

                <!-- Google AdSense ê´‘ê³ : ë°˜ì‘í˜• ë°•ìŠ¤ -->
                <div style="margin: 20px 0; text-align: center;">
                    <ins class="adsbygoogle"
                         style="display:block"
                         data-ad-client="ca-pub-1608259764663412"
                         data-ad-slot="YOUR_SLOT_ID"
                         data-ad-format="auto"
                         data-full-width-responsive="true"></ins>
                    <script>
                        (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                </div>

            </div>

            <!-- ì—…ë°ì´íŠ¸ ë‚´ì—­ -->
            <div class="update-log-section">
                <h2>ğŸ“ ì—…ë°ì´íŠ¸ ë‚´ì—­</h2>
                <div class="update-log-content" id="updateLogContent">ì—…ë°ì´íŠ¸ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
        </div>

        <!-- ë°© ìƒì„± í˜ì´ì§€ -->
        <div class="create-room-section" id="createRoomSection">
            <div style="margin-bottom: 20px;">
                <button onclick="goBackToLobby()" style="width: auto; padding: 10px 20px; margin-bottom: 15px; background: #6c757d;">â† ëŒ€ê¸°ì‹¤ë¡œ ëŒì•„ê°€ê¸°</button>
                <h2 style="margin-bottom: 20px; color: #667eea;">ë°© ë§Œë“¤ê¸°</h2>
            </div>

            <!-- ë¡œê³  ë° ì—°ê²° ìƒíƒœ -->
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="display: inline-flex; align-items: center; gap: 10px;">
                    <span style="font-size: 24px;">ğŸ²</span>
                    <span style="font-size: 20px; font-weight: 600; color: #667eea;">LAM Dice :)</span>
                    <span class="connection-status connected" id="createRoomConnectionStatus">â— ì—°ê²°ë¨</span>
                </div>
            </div>

            <!-- ë°© ì œëª© ì…ë ¥ -->
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 2px solid #667eea;">
                <div class="input-group" style="margin-bottom: 0;">
                    <label for="createRoomNameInput">ë°© ì œëª©</label>
                    <input type="text" id="createRoomNameInput" placeholder="ë°© ì œëª© ì…ë ¥" maxlength="30" />
                </div>
            </div>

            <!-- ê³µê°œ/ë¹„ê³µê°œ ì„¤ì • -->
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 2px solid #667eea;">
                <div style="display: flex; align-items: center; margin-bottom: 15px;">
                    <input type="checkbox" id="createRoomPrivateCheckbox" style="width: 20px; height: 20px; margin-right: 10px; cursor: pointer;" />
                    <label for="createRoomPrivateCheckbox" style="cursor: pointer; font-weight: 500; margin: 0;">ë¹„ê³µê°œ ë°©</label>
                </div>
                <div id="createRoomPasswordContainer" style="display: none;">
                    <div class="input-group" style="margin-bottom: 0;">
                        <label for="createRoomPasswordInput">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="createRoomPasswordInput" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ (4~20ì)" maxlength="20" />
                    </div>
                </div>
            </div>

            <!-- ë°© ìœ ì§€ ì‹œê°„ ì„¤ì • -->
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 2px solid #667eea;">
                <label style="display: block; margin-bottom: 10px; font-weight: 500;">â° ë°© ìœ ì§€ ì‹œê°„</label>
                <div style="display: flex; gap: 10px;">
                    <label style="display: flex; align-items: center; cursor: pointer; flex: 1;">
                        <input type="radio" name="roomExpiryTime" value="1" style="width: 20px; height: 20px; margin-right: 8px; cursor: pointer;" />
                        <span>1ì‹œê°„</span>
                    </label>
                    <label style="display: flex; align-items: center; cursor: pointer; flex: 1;">
                        <input type="radio" name="roomExpiryTime" value="3" checked style="width: 20px; height: 20px; margin-right: 8px; cursor: pointer;" />
                        <span>3ì‹œê°„ (ê¸°ë³¸)</span>
                    </label>
                    <label style="display: flex; align-items: center; cursor: pointer; flex: 1;">
                        <input type="radio" name="roomExpiryTime" value="6" style="width: 20px; height: 20px; margin-right: 8px; cursor: pointer;" />
                        <span>6ì‹œê°„</span>
                    </label>
                </div>
            </div>

            <!-- ê²Œì„ íƒ€ì… ì„ íƒ -->
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 2px solid #667eea;">
                <label style="display: block; margin-bottom: 10px; font-weight: 500;">ğŸ® ê²Œì„ íƒ€ì…</label>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <label style="display: flex; align-items: center; cursor: pointer; flex: 1; min-width: 120px; padding: 15px; background: white; border-radius: 8px; border: 2px solid #667eea;">
                        <input type="radio" name="gameType" value="dice" checked style="width: 20px; height: 20px; margin-right: 10px; cursor: pointer;" />
                        <span style="font-size: 24px; margin-right: 8px;">ğŸ²</span>
                        <span style="font-weight: 600;">ì£¼ì‚¬ìœ„</span>
                    </label>
                    <label style="display: flex; align-items: center; cursor: pointer; flex: 1; min-width: 120px; padding: 15px; background: white; border-radius: 8px; border: 2px solid #e91e63;">
                        <input type="radio" name="gameType" value="roulette" style="width: 20px; height: 20px; margin-right: 10px; cursor: pointer;" />
                        <span style="font-size: 24px; margin-right: 8px;">ğŸ°</span>
                        <span style="font-weight: 600;">ë£°ë ›</span>
                    </label>
                    <label id="horseRaceLabel" style="display: flex; align-items: center; cursor: pointer; flex: 1; min-width: 120px; padding: 15px; background: white; border-radius: 8px; border: 2px solid #8b4513; position: relative;">
                        <input type="radio" name="gameType" value="horse-race" id="horseRaceRadio" style="width: 20px; height: 20px; margin-right: 10px; cursor: pointer;" />
                        <span style="font-size: 24px; margin-right: 8px;">ğŸ</span>
                        <span style="font-weight: 600;">ê²½ë§ˆ</span>
                        <span id="horseRaceNewBadge" style="display: none; position: absolute; top: -8px; right: -8px; background: #e94560; color: #fff; font-size: 10px; font-weight: bold; padding: 2px 8px; border-radius: 10px; letter-spacing: 1px; box-shadow: 0 2px 6px rgba(233,69,96,0.4); animation: newBadgePulse 2s ease-in-out infinite;">NEW</span>
                    </label>
                    <label style="display: flex; align-items: center; cursor: pointer; flex: 1; min-width: 120px; padding: 15px; background: white; border-radius: 8px; border: 2px solid #9c27b0; position: relative;">
                        <input type="radio" name="gameType" value="crane-game" style="width: 20px; height: 20px; margin-right: 10px; cursor: pointer;" />
                        <span style="font-size: 24px; margin-right: 8px;">ğŸª„</span>
                        <span style="font-weight: 600;">ì¸í˜•ë½‘ê¸°</span>
                        <span style="position: absolute; top: -8px; right: -8px; background: #e94560; color: #fff; font-size: 10px; font-weight: bold; padding: 2px 8px; border-radius: 10px; letter-spacing: 1px; box-shadow: 0 2px 6px rgba(233,69,96,0.4); animation: newBadgePulse 2s ease-in-out infinite;">NEW</span>
                    </label>

                </div>
                <div id="gameTypeInfo" style="margin-top: 8px; font-size: 12px; color: #666;">
                    ë£°ë ›/ê²½ë§ˆ/ì¸í˜•ë½‘ê¸°ë¥¼ ì„ íƒí•˜ë©´ ì „ìš© í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.
                </div>
                <script>
                    // ê²Œì„ íƒ€ì… ì„ íƒ ì‹œ ì‹œê°ì  ê°•ì¡° (ì€ì€í•œ í‹´íŠ¸)
                    (function() {
                        const colorMap = { dice: '#667eea', roulette: '#e91e63', 'horse-race': '#8b4513', 'crane-game': '#9c27b0' };
                        function updateGameTypeStyle() {
                            document.querySelectorAll('input[name="gameType"]').forEach(radio => {
                                const label = radio.closest('label');
                                const color = colorMap[radio.value] || '#667eea';
                                if (radio.checked) {
                                    label.style.background = `${color}12`;
                                    label.style.color = '';
                                    label.style.borderColor = color;
                                    label.style.borderWidth = '2.5px';
                                    label.style.boxShadow = `0 2px 8px ${color}20`;
                                    label.querySelectorAll('span:not([id])').forEach(s => s.style.color = '');
                                } else {
                                    label.style.background = 'white';
                                    label.style.color = '';
                                    label.style.borderColor = '#e0e0e0';
                                    label.style.borderWidth = '1px';
                                    label.style.boxShadow = 'none';
                                    label.querySelectorAll('span:not([id])').forEach(s => s.style.color = '');
                                }
                            });
                        }
                        document.querySelectorAll('input[name="gameType"]').forEach(r => r.addEventListener('change', updateGameTypeStyle));
                        updateGameTypeStyle();
                    })();
                    // ê²½ë§ˆ NEW ë°°ì§€ + íˆ´íŒ: 2026-02-08 ì´í›„ ìˆ¨ê¹€
                    (function() {
                        const hideDate = new Date('2026-02-08T00:00:00+09:00');
                        if (new Date() > hideDate) {
                            const badge = document.getElementById('horseRaceNewBadge');
                            if (badge) badge.style.display = 'none';
                            const style = document.createElement('style');
                            style.textContent = '#horseRaceLabel::after, #horseRaceLabel::before { display: none !important; }';
                            document.head.appendChild(style);
                        }
                    })();
                </script>
            </div>

            <!-- ë°© ìƒì„±í•˜ê¸° ë²„íŠ¼ (ë§¨ ì•„ë˜) -->
            <button onclick="finalizeRoomCreation()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin-top: 30px; width: 100%;">ë°© ìƒì„±í•˜ê¸°</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/page-history-shared.js"></script>
    <script src="/server-select-shared.js"></script>
    <script src="/ranking-shared.js"></script>
    <script>
        const socket = io();
        let currentServerId = null;
        let currentServerName = null;
        let currentRoomId = null;
        let selectedRoomId = null;
        let roomsList = [];
        let roomListRefreshInterval = null;
        const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' || window.location.hostname === '';

        // íƒ­ ì„¸ì…˜ ID (ìƒˆë¡œê³ ì¹¨: ìœ ì§€, ìƒˆ íƒ­: ìƒˆë¡œ ìƒì„±)
        if (!sessionStorage.getItem('tabId')) {
            sessionStorage.setItem('tabId', Math.random().toString(36).substr(2, 9) + Date.now());
        }
        function getTabId() { return sessionStorage.getItem('tabId'); }

        // ë””ë°”ì´ìŠ¤ ID
        function getDeviceId() {
            let id = localStorage.getItem('deviceId');
            if (!id) {
                id = 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('deviceId', id);
            }
            return id;
        }

        // ì•„ì´ë”” ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜
        function validateUserId(userId) {
            if (!userId || typeof userId !== 'string') return false;
            const pattern = /^[ê°€-í£ã„±-ã…ã…-ã…£a-z0-9_-]+$/;
            return pattern.test(userId);
        }

        // ì„œë²„ ì„ íƒ ëª¨ë“ˆ ì´ˆê¸°í™”
        ServerSelectModule.init(socket, () => {}, () => {});
        // íˆìŠ¤í† ë¦¬ ë§¤ë‹ˆì € ì´ˆê¸°í™”
        PageHistoryManager.init({
            onServerSelect: function () {
                sessionStorage.removeItem('diceSession');
                window.location.href = '/';
            },
            onLobby: function () {
                document.getElementById('createRoomSection').classList.remove('active');
                document.getElementById('lobbySection').classList.add('active');
            },
            onLeaveRoom: function () {},
            onHideRanking: function () {
                RankingModule.forceHide();
            },
            getCurrentPage: function () {
                if (document.getElementById('ranking-overlay')) return 'ranking';
                if (document.getElementById('createRoomSection').classList.contains('active')) return 'createRoom';
                return 'lobby';
            }
        });

        // ì„¸ì…˜ ë³µì›: ë‹¤ë¥¸ ê²Œì„ì—ì„œ ëŒì•„ì˜¨ ê²½ìš° ë˜ëŠ” ìƒˆë¡œê³ ì¹¨ ì‹œ ë¡œë¹„ ìœ ì§€
        const _returnData = sessionStorage.getItem('returnToLobby') || sessionStorage.getItem('diceSession');
        if (_returnData) {
            sessionStorage.removeItem('returnToLobby');
            let _restoredServerName = null;
            let _restoredHostName = null;
            try {
                const rd = JSON.parse(_returnData);
                currentServerId = rd.serverId || null;
                currentServerName = rd.serverName || null;
                _restoredServerName = rd.serverName || null;
                _restoredHostName = rd.hostName || null;
            } catch(e) {}
            // ì†Œì¼“ì— ì„œë²„ ID ì„¤ì •
            if (currentServerId) {
                socket.emit('setServerId', { serverId: currentServerId });
                ServerSelectModule.setCurrentServer({ id: currentServerId, name: currentServerName, hostName: _restoredHostName || '' });
            }
            // ì„œë²„ ì •ë³´ ë°” í‘œì‹œ
            const infoBar = document.getElementById('serverInfoBar');
            infoBar.style.display = 'flex';
            const membersBtn = document.getElementById('serverMembersBtn');
            const userName = localStorage.getItem('userName') || '';
            if (currentServerId) {
                if (_restoredServerName) {
                    document.getElementById('serverInfoName').textContent = `ğŸ–¥ï¸ ${_restoredServerName}`;
                    document.getElementById('serverInfoName').style.display = '';
                    document.title = `${_restoredServerName} - LAM Dice :)`;
                }
                if (membersBtn) membersBtn.style.display = '';
            } else {
                document.getElementById('serverInfoName').style.display = 'none';
                if (membersBtn) membersBtn.style.display = 'none';
            }
            const userNameSpan = document.getElementById('serverInfoUserName');
            if (userName && userNameSpan) {
                userNameSpan.textContent = `ğŸ‘¤ ${userName}`;
                userNameSpan.style.display = '';
            }
            const globalInput = document.getElementById('globalUserNameInput');
            if (globalInput && userName && !globalInput.value) globalInput.value = userName;
            document.getElementById('lobbySection').classList.add('active');
            RankingModule.init(currentServerId, userName || '');
            PageHistoryManager.replacePage('lobby');

            // ë°© ëª©ë¡ ë¡œë“œ
            socket.emit('getRooms');
            if (currentServerId) socket.emit('setServerId', { serverId: currentServerId });
        } else {
            // ì„¸ì…˜ ì—†ìŒ â†’ ì„œë²„ ì„ íƒ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            window.location.replace('/');
        }

        // ì†Œì¼“ ì—°ê²°/í•´ì œ
        socket.on('connect', () => {
            const createRoomConnectionStatus = document.getElementById('createRoomConnectionStatus');
            if (createRoomConnectionStatus) {
                createRoomConnectionStatus.textContent = 'â— ì—°ê²°ë¨';
                createRoomConnectionStatus.className = 'connection-status connected';
            }

            if (document.getElementById('lobbySection').classList.contains('active')) {
                refreshRooms();
                refreshVisitorStats();
            }
        });

        socket.on('disconnect', () => {
            const createRoomConnectionStatus = document.getElementById('createRoomConnectionStatus');
            if (createRoomConnectionStatus) {
                createRoomConnectionStatus.textContent = 'â— ì—°ê²° ëŠê¹€';
                createRoomConnectionStatus.className = 'connection-status disconnected';
            }
        });

        // ë°© ëª©ë¡ ì—…ë°ì´íŠ¸
        socket.on('roomsList', (rooms) => {
            roomsList = rooms;
            renderRoomsList();
        });

        socket.on('roomsListUpdated', (rooms) => {
            roomsList = rooms;
            renderRoomsList();
        });

        // ë°©ë¬¸ì/í”Œë ˆì´ í†µê³„ ìˆ˜ì‹ 
        socket.on('visitorStats', (stats) => {
            document.getElementById('todayVisitorCount').textContent = stats.todayVisitors ?? 0;
            document.getElementById('todayPlayCount').textContent = stats.todayPlays ?? 0;
            document.getElementById('totalPlayCount').textContent = stats.totalPlays ?? 0;
        });

        // ì—…ë°ì´íŠ¸ ë‚´ì—­ íŒŒì¼ ë¡œë“œ
        function loadUpdateLog() {
            const updateLogContent = document.getElementById('updateLogContent');
            if (!updateLogContent) return;

            fetch('update-log.txt')
                .then(response => {
                    if (!response.ok) throw new Error('ì—…ë°ì´íŠ¸ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return response.text();
                })
                .then(text => {
                    const html = text.replace(/(\r?\n)---(\r?\n)/g, '$1<hr class="update-log-divider">$2');
                    updateLogContent.innerHTML = html;
                })
                .catch(error => {
                    console.error('ì—…ë°ì´íŠ¸ ë‚´ì—­ ë¡œë“œ ì‹¤íŒ¨:', error);
                    updateLogContent.innerHTML = 'ì—…ë°ì´íŠ¸ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                });
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadUpdateLog();
        });

        // ë°© ëª©ë¡ ë Œë”ë§
        function renderRoomsList() {
            const roomsListEl = document.getElementById('roomsList');

            if (roomsList.length === 0) {
                roomsListEl.innerHTML = '<div style="color: #999; text-align: center; padding: 20px;">ìƒì„±ëœ ë°©ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            roomsListEl.innerHTML = '';

            roomsList.forEach(room => {
                const roomItem = document.createElement('div');
                const isMyRoom = room.roomId === currentRoomId;
                let className = 'room-item';
                if (isMyRoom) {
                    className += ' my-room';
                } else if (room.roomId === selectedRoomId) {
                    className += ' active';
                }
                roomItem.className = className;

                let statusClass = 'waiting';
                let statusText = 'ëŒ€ê¸° ì¤‘';
                if (room.isGameActive) {
                    statusClass = 'playing';
                    statusText = 'ê²Œì„ ì§„í–‰ ì¤‘';
                } else if (room.isOrderActive) {
                    statusClass = 'ordering';
                    statusText = 'ì£¼ë¬¸ë°›ê¸° ì¤‘';
                }

                const roomNameHtml = isMyRoom
                    ? `${room.roomName}<span class="my-room-badge">ì°¸ì—¬ ì¤‘</span>`
                    : room.roomName;

                const privateBadge = room.isPrivate
                    ? '<span style="color: #ff6b6b; font-weight: bold; margin-left: 5px;">ğŸ”’ ë¹„ê³µê°œ</span>'
                    : '';

                let gameTypeIcon = 'ğŸ²';
                let gameTypeLabel = 'ì£¼ì‚¬ìœ„';
                let gameTypeColor = '#667eea';
                if (room.gameType === 'roulette') {
                    gameTypeIcon = 'ğŸ°';
                    gameTypeLabel = 'ë£°ë ›';
                    gameTypeColor = '#7c4dff';
                } else if (room.gameType === 'horse-race') {
                    gameTypeIcon = 'ğŸ';
                    gameTypeLabel = 'ê²½ë§ˆ';
                    gameTypeColor = '#8b4513';
                } else if (room.gameType === 'crane-game') {
                    gameTypeIcon = 'ğŸª„';
                    gameTypeLabel = 'ì¸í˜•ë½‘ê¸°';
                    gameTypeColor = '#9c27b0';
                }
                const gameTypeBadge = `<span style="display: inline-flex; align-items: center; background: ${gameTypeColor}; color: white; padding: 3px 8px; border-radius: 12px; font-size: 12px; font-weight: 600; margin-right: 8px;">${gameTypeIcon} ${gameTypeLabel}</span>`;

                let remainingTimeText = '';
                if (room.createdAt) {
                    const createdAt = new Date(room.createdAt);
                    const now = new Date();
                    const expiryHours = room.expiryHours || 3;
                    const expiryHoursInMs = expiryHours * 60 * 60 * 1000;
                    const expiryTime = createdAt.getTime() + expiryHoursInMs;
                    const remaining = expiryTime - now.getTime();

                    if (remaining > 0) {
                        const hours = Math.floor(remaining / (1000 * 60 * 60));
                        const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                        remainingTimeText = ` | ë‚¨ì€ ì‹œê°„: ${hours}ì‹œê°„ ${minutes}ë¶„`;
                    } else {
                        remainingTimeText = ` | <span style="color: #dc3545; font-weight: bold;">í­íŒŒ ì˜ˆì •</span>`;
                    }
                }

                const buttonText = isMyRoom ? 'ì¬ì…ì¥' : 'ì…ì¥í•˜ê¸°';

                roomItem.innerHTML = `
                    <div class="room-info">
                        <div class="room-name">${roomNameHtml}${privateBadge}</div>
                        <div class="room-details">
                            í˜¸ìŠ¤íŠ¸: ${room.hostName} | ì¸ì›: ${room.playerCount}ëª…${remainingTimeText}
                        </div>
                        <span class="room-status ${statusClass}">${statusText}</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        ${gameTypeBadge}
                        <div class="room-action">
                            <button onclick="joinRoomDirectly('${room.roomId}')">${buttonText}</button>
                        </div>
                    </div>
                `;

                roomsListEl.appendChild(roomItem);
            });

            // ë¡œë¹„ ì„¹ì…˜ì´ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ ì£¼ê¸°ì ìœ¼ë¡œ ë°© ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            const lobbySection = document.getElementById('lobbySection');
            if (lobbySection && lobbySection.classList.contains('active')) {
                if (roomListRefreshInterval) {
                    clearInterval(roomListRefreshInterval);
                }
                roomListRefreshInterval = setInterval(() => {
                    if (lobbySection.classList.contains('active')) {
                        refreshRooms();
                    } else {
                        clearInterval(roomListRefreshInterval);
                        roomListRefreshInterval = null;
                    }
                }, 30000);
            }
        }

        // ë°© ë°”ë¡œ ì…ì¥
        function joinRoomDirectly(roomId) {
            selectedRoomId = roomId;

            const globalNameInput = document.getElementById('globalUserNameInput');
            const userName = globalNameInput ? globalNameInput.value.trim() : '';

            if (userName === '') {
                showCustomAlert('ì´ë¦„ì„ ì…ë ¥í•´ì•¼ ì…ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'warning');
                if (globalNameInput) globalNameInput.focus();
                return;
            }

            if (!validateUserId(userName)) {
                showCustomAlert('í•œê¸€, ì˜ë¬¸ ì†Œë¬¸ì, ìˆ«ì, _, -ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'warning');
                if (globalNameInput) globalNameInput.focus();
                return;
            }

            const room = roomsList.find(r => r.roomId === roomId);

            // ë£°ë › ë°©ì´ë©´ ë£°ë › í˜ì´ì§€ë¡œ ì´ë™
            if (room && room.gameType === 'roulette') {
                localStorage.setItem('rouletteUserName', userName);
                localStorage.setItem('pendingRouletteJoin', JSON.stringify({
                    roomId: roomId, userName: userName, isPrivate: room.isPrivate,
                    serverId: currentServerId, serverName: currentServerName
                }));
                window.location.href = '/roulette?joinRoom=true';
                return;
            }

            // ê²½ë§ˆ ë°©ì´ë©´ ê²½ë§ˆ í˜ì´ì§€ë¡œ ì´ë™
            if (room && room.gameType === 'horse-race') {
                localStorage.setItem('horseRaceUserName', userName);
                localStorage.setItem('pendingHorseRaceJoin', JSON.stringify({
                    roomId: roomId, userName: userName, isPrivate: room.isPrivate,
                    serverId: currentServerId, serverName: currentServerName
                }));
                window.location.href = '/horse-race?joinRoom=true';
                return;
            }

            // ì¸í˜•ë½‘ê¸° ë°©ì´ë©´ ì¸í˜•ë½‘ê¸° í˜ì´ì§€ë¡œ ì´ë™
            if (room && room.gameType === 'crane-game') {
                localStorage.setItem('craneGameUserName', userName);
                localStorage.setItem('pendingCraneGameJoin', JSON.stringify({
                    roomId: roomId, userName: userName, isPrivate: room.isPrivate,
                    serverId: currentServerId, serverName: currentServerName
                }));
                window.location.href = '/crane-game?joinRoom=true';
                return;
            }

            // ì£¼ì‚¬ìœ„ ë°©: ë¹„ê³µê°œ ë°©ì´ë©´ ë¹„ë°€ë²ˆí˜¸, ì•„ë‹ˆë©´ ë°”ë¡œ dice í˜ì´ì§€ë¡œ
            if (room && room.isPrivate) {
                const password = prompt('ğŸ”’ ë¹„ê³µê°œ ë°©ì…ë‹ˆë‹¤.\në¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:');
                if (password === null) return;
                if (password === '') {
                    showCustomAlert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'warning');
                    return;
                }
                // ë¹„ë°€ë²ˆí˜¸ì™€ í•¨ê»˜ ì£¼ì‚¬ìœ„ í˜ì´ì§€ë¡œ ì´ë™
                localStorage.setItem('diceGameUserName', userName);
                localStorage.setItem('pendingDiceJoin', JSON.stringify({
                    roomId: roomId, userName: userName, isPrivate: true, password: password,
                    serverId: currentServerId, serverName: currentServerName
                }));
                window.location.href = '/dice?joinRoom=true';
            } else {
                // ê³µê°œ ì£¼ì‚¬ìœ„ ë°©
                localStorage.setItem('diceGameUserName', userName);
                localStorage.setItem('pendingDiceJoin', JSON.stringify({
                    roomId: roomId, userName: userName, isPrivate: false,
                    serverId: currentServerId, serverName: currentServerName
                }));
                window.location.href = '/dice?joinRoom=true';
            }
        }

        // ë°© ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        function refreshRooms() {
            socket.emit('getRooms');
            refreshVisitorStats();
        }

        // ë°©ë¬¸ì í†µê³„ ìƒˆë¡œê³ ì¹¨
        function refreshVisitorStats() {
            socket.emit('getVisitorStats');
        }

        // ì»¤ìŠ¤í…€ ì–¼ëŸ¿
        function showCustomAlert(message, type = 'info') {
            const existingAlert = document.getElementById('customAlert');
            if (existingAlert) existingAlert.remove();

            let bgColor, borderColor, icon;
            switch(type) {
                case 'error': bgColor = '#fee'; borderColor = '#f66'; icon = 'âš ï¸'; break;
                case 'warning': bgColor = '#fff9e6'; borderColor = '#ffa500'; icon = 'âš ï¸'; break;
                case 'success': bgColor = '#e8f5e9'; borderColor = '#4caf50'; icon = 'âœ…'; break;
                default: bgColor = '#e3f2fd'; borderColor = '#2196f3'; icon = 'â„¹ï¸';
            }

            const alertOverlay = document.createElement('div');
            alertOverlay.id = 'customAlert';
            alertOverlay.style.cssText = `position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.4);z-index:10001;display:flex;justify-content:center;align-items:center;animation:fadeIn 0.2s ease-out;`;

            const alertContent = document.createElement('div');
            alertContent.style.cssText = `background:white;border-radius:16px;padding:25px 30px;max-width:500px;width:90vw;box-shadow:0 10px 40px rgba(0,0,0,0.2);border:2px solid ${borderColor};animation:slideDown 0.3s ease-out;`;

            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `font-size:16px;line-height:1.6;color:#333;white-space:pre-wrap;word-break:break-word;text-align:center;margin-bottom:20px;`;
            messageDiv.innerHTML = `<span style="font-size:24px;margin-right:8px;">${icon}</span>${message}`;

            const confirmButton = document.createElement('button');
            confirmButton.textContent = 'í™•ì¸';
            confirmButton.style.cssText = `padding:10px 25px;background:linear-gradient(135deg,${borderColor} 0%,${borderColor}dd 100%);color:white;border:none;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;`;
            confirmButton.onclick = () => {
                alertOverlay.style.animation = 'fadeOut 0.2s ease-out';
                setTimeout(() => alertOverlay.remove(), 200);
            };

            alertOverlay.onclick = (e) => { if (e.target === alertOverlay) confirmButton.click(); };
            document.addEventListener('keydown', function _esc(e) {
                if (e.key === 'Escape') { confirmButton.click(); document.removeEventListener('keydown', _esc); }
            });

            alertContent.appendChild(messageDiv);
            alertContent.appendChild(confirmButton);
            alertOverlay.appendChild(alertContent);
            document.body.appendChild(alertOverlay);
            confirmButton.focus();
        }

        // ë°© ìƒì„± í˜ì´ì§€ í‘œì‹œ
        function showCreateRoomPage() {
            const globalNameInput = document.getElementById('globalUserNameInput');
            const hostName = globalNameInput ? globalNameInput.value.trim() : '';

            if (hostName === '') {
                showCustomAlert('ì´ë¦„ì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”!', 'warning');
                if (globalNameInput) globalNameInput.focus();
                return;
            }

            if (!validateUserId(hostName)) {
                showCustomAlert('í•œê¸€, ì˜ë¬¸ ì†Œë¬¸ì, ìˆ«ì, _, -ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'warning');
                if (globalNameInput) globalNameInput.focus();
                return;
            }

            document.getElementById('lobbySection').classList.remove('active');
            document.getElementById('createRoomSection').classList.add('active');
            PageHistoryManager.pushPage('createRoom');

            document.getElementById('createRoomPrivateCheckbox').checked = false;
            document.getElementById('createRoomPasswordInput').value = '';
            document.getElementById('createRoomPasswordContainer').style.display = 'none';
            const createRoomNameInput = document.getElementById('createRoomNameInput');
            if (createRoomNameInput) {
                createRoomNameInput.value = isLocalhost ? 'test' : (hostName ? `${hostName}ë‹˜ì˜ Dice` : '');
                setTimeout(() => createRoomNameInput.focus(), 100);
            }
        }

        function goBackToLobby() {
            history.back();
        }

        // ë°© ìƒì„± ìµœì¢… í™•ì¸ ë° ìƒì„±
        function finalizeRoomCreation() {
            const globalNameInput = document.getElementById('globalUserNameInput');
            const roomNameInput = document.getElementById('createRoomNameInput');
            const hostName = globalNameInput ? globalNameInput.value.trim() : '';
            const roomName = roomNameInput ? roomNameInput.value.trim() : '';

            if (hostName === '') {
                showCustomAlert('ì´ë¦„ì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”! ëŒ€ê¸°ì‹¤ë¡œ ëŒì•„ê°€ì„œ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.', 'warning');
                goBackToLobby();
                if (globalNameInput) globalNameInput.focus();
                return;
            }

            if (!validateUserId(hostName)) {
                showCustomAlert('í•œê¸€, ì˜ë¬¸ ì†Œë¬¸ì, ìˆ«ì, _, -ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'warning');
                goBackToLobby();
                if (globalNameInput) globalNameInput.focus();
                return;
            }

            if (roomName === '') {
                showCustomAlert('ë°© ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'warning');
                if (roomNameInput) roomNameInput.focus();
                return;
            }

            const isPrivate = document.getElementById('createRoomPrivateCheckbox').checked;
            const password = document.getElementById('createRoomPasswordInput').value.trim();

            if (isPrivate) {
                if (password === '') {
                    showCustomAlert('ë¹„ê³µê°œ ë°©ì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'warning');
                    document.getElementById('createRoomPasswordInput').focus();
                    return;
                }
                if (password.length < 4 || password.length > 20) {
                    showCustomAlert('ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒ 20ì ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤!', 'warning');
                    document.getElementById('createRoomPasswordInput').focus();
                    return;
                }
            }

            const expiryTimeRadio = document.querySelector('input[name="roomExpiryTime"]:checked');
            const expiryHours = expiryTimeRadio ? parseInt(expiryTimeRadio.value) : 3;

            const ipBlockCheckbox = document.getElementById('createRoomIPBlockCheckbox');
            const blockIPPerUser = ipBlockCheckbox ? ipBlockCheckbox.checked : false;

            let gameType = 'dice';
            const gameTypeRadios = document.querySelectorAll('input[name="gameType"]');
            const checkedRadio = Array.from(gameTypeRadios).find(r => r.checked);
            if (checkedRadio) gameType = checkedRadio.value;

            const roomData = {
                userName: hostName,
                roomName: roomName,
                isPrivate: isPrivate,
                password: isPrivate ? password : '',
                expiryHours: expiryHours,
                blockIPPerUser: blockIPPerUser,
                serverId: currentServerId,
                serverName: currentServerName
            };

            // ë£°ë ›
            if (gameType === 'roulette') {
                localStorage.setItem('rouletteUserName', hostName);
                localStorage.setItem('pendingRouletteRoom', JSON.stringify(roomData));
                window.location.href = '/roulette?createRoom=true';
                return;
            }

            // ê²½ë§ˆ
            if (gameType === 'horse-race') {
                localStorage.setItem('horseRaceUserName', hostName);
                localStorage.setItem('pendingHorseRaceRoom', JSON.stringify(roomData));
                window.location.href = '/horse-race?createRoom=true';
                return;
            }

            // ì¸í˜•ë½‘ê¸°
            if (gameType === 'crane-game') {
                localStorage.setItem('craneGameUserName', hostName);
                localStorage.setItem('pendingCraneGameRoom', JSON.stringify(roomData));
                window.location.href = '/crane-game?createRoom=true';
                return;
            }

            // ì£¼ì‚¬ìœ„: ë¡œë¹„ì—ì„œ ì§ì ‘ ì†Œì¼“ emit ëŒ€ì‹  dice í˜ì´ì§€ë¡œ ì´ë™
            localStorage.setItem('diceGameUserName', hostName);
            localStorage.setItem('pendingDiceRoom', JSON.stringify({
                ...roomData,
                gameType: 'dice'
            }));
            window.location.href = '/dice?createRoom=true';
        }

        // ë¹„ê³µê°œ ì²´í¬ë°•ìŠ¤ í† ê¸€
        document.getElementById('createRoomPrivateCheckbox').addEventListener('change', function() {
            document.getElementById('createRoomPasswordContainer').style.display = this.checked ? 'block' : 'none';
        });

        // ì „ì—­ ì´ë¦„ ì…ë ¥ì°½ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            const globalNameInput = document.getElementById('globalUserNameInput');
            const userNameError = document.getElementById('userNameError');

            if (globalNameInput) {
                const savedName = localStorage.getItem('diceGameUserName');
                if (savedName) globalNameInput.value = savedName;

                globalNameInput.addEventListener('input', () => {
                    const userName = globalNameInput.value.trim();
                    if (userName && !validateUserId(userName)) {
                        if (userNameError) {
                            userNameError.textContent = 'í•œê¸€, ì˜ë¬¸ ì†Œë¬¸ì, ìˆ«ì, _, -ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤. (ê³µë°±/íŠ¹ìˆ˜ë¬¸ì ë¶ˆê°€)';
                            userNameError.style.display = 'block';
                        }
                        globalNameInput.style.borderColor = '#dc3545';
                    } else {
                        if (userNameError) userNameError.style.display = 'none';
                        globalNameInput.style.borderColor = '';
                        if (userName) localStorage.setItem('diceGameUserName', userName);
                    }
                });

                globalNameInput.addEventListener('blur', () => {
                    const userName = globalNameInput.value.trim();
                    if (userName && !validateUserId(userName)) {
                        const cleaned = userName.toLowerCase().replace(/[^ê°€-í£ã„±-ã…ã…-ã…£a-z0-9_-]/g, '');
                        globalNameInput.value = cleaned;
                        if (cleaned) localStorage.setItem('diceGameUserName', cleaned);
                        if (userNameError) userNameError.style.display = 'none';
                        globalNameInput.style.borderColor = '';
                    }
                });
            }
        });

        // ì—ëŸ¬ ì²˜ë¦¬
        socket.on('error', (data) => {
            showCustomAlert(data.message || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
        });
    </script>
    <hr>
    <footer style="text-align: center; padding: 20px 0; font-size: 0.9em; color: #555;">
        <p>Copyright Â© 2025 LAMDice. All rights reserved.</p>
        <div style="margin-top: 10px;">
            <a href="privacy-policy.html" style="margin: 0 10px; text-decoration: none; color: #007bff;">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</a> |
            <a href="terms-of-service.html" style="margin: 0 10px; text-decoration: none; color: #007bff;">ì´ìš© ì•½ê´€</a> |
            <a href="contact.html" style="margin: 0 10px; text-decoration: none; color: #007bff;">ë¬¸ì˜í•˜ê¸°</a>
        </div>
    </footer>
</body>
</html>
