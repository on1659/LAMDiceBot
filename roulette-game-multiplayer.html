<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>LAM Roulette ğŸ°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Yeon+Sung&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #8e99a4 0%, #7a8b99 50%, #6b7c8a 100%);
            min-height: 100vh;
            margin: 0;
            padding: 0;
            position: relative;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            margin: 20px auto;
        }
        
        body.lobby-active .container {
            margin-left: auto;
            margin-right: auto;
        }
        
        body.game-active .container {
            margin-left: calc((100vw - 1140px) / 2 + 160px);
            margin-right: auto;
            max-width: 800px;
        }
        
        body.game-active header,
        body.game-active footer {
            display: none;
        }

        h1 {
            text-align: center;
            color: #7c4dff;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .lobby-section, .game-section, .create-room-section {
            display: none;
        }

        .lobby-section.active, .game-section.active, .create-room-section.active {
            display: block;
        }
        
        .rooms-list {
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
        }
        
        .room-item {
            background: white;
            border: 2px solid #7c4dff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .room-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(233, 30, 99, 0.3);
        }
        
        .room-item.active {
            background: #fce4ec;
            border-color: #7c4dff;
        }
        
        .room-item.my-room {
            background: #fff3cd;
            border-color: #ffc107;
            border-width: 3px;
        }
        
        .my-room-badge {
            display: inline-block;
            background: #ffc107;
            color: #333;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .room-info {
            flex: 1;
        }
        
        .room-name {
            font-size: 18px;
            font-weight: 600;
            color: #7c4dff;
            margin-bottom: 5px;
        }
        
        .room-details {
            font-size: 14px;
            color: #666;
        }
        
        .room-status {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
            margin-top: 5px;
            display: inline-block;
        }
        
        .room-status.playing {
            background: #d4edda;
            color: #155724;
        }
        
        .room-status.waiting {
            background: #e0e0e0;
            color: #666;
        }
        
        .room-action {
            margin-left: 15px;
        }
        
        .room-action button {
            width: auto;
            padding: 10px 20px;
        }
        
        .create-room-section {
            background: #f8f9fa;
            border: 2px solid #7c4dff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        button {
            background: linear-gradient(135deg, #7c4dff 0%, #536dfe 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin-top: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(233, 30, 99, 0.3);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        input[type="text"], input[type="password"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 10px;
            transition: border-color 0.2s;
        }

        input[type="text"]:focus, input[type="password"]:focus {
            border-color: #7c4dff;
            outline: none;
        }

        .connection-status {
            text-align: center;
            padding: 5px;
            font-size: 12px;
            margin-bottom: 10px;
        }

        .connection-status.connected {
            color: #28a745;
        }

        .connection-status.disconnected {
            color: #dc3545;
        }

        /* ë£°ë › ì»¨í…Œì´ë„ˆ */
        .roulette-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .roulette-wrapper {
            position: relative;
            width: 350px;
            height: 350px;
            margin: 20px auto;
        }

        /* ë£°ë › íŒ */
        .roulette-wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.3), inset 0 0 20px rgba(0, 0, 0, 0.2);
            border: 8px solid #333;
            transition: transform 0.1s ease-out;
        }

        /* ë£°ë › ì¤‘ì•™ */
        .roulette-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #333 0%, #666 100%);
            border-radius: 50%;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        /* í™”ì‚´í‘œ (12ì‹œ ë°©í–¥ ê³ ì •) */
        .roulette-pointer {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 35px solid #ff1744;
            z-index: 20;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3));
        }

        /* ë£°ë › ì„¸ê·¸ë¨¼íŠ¸ */
        .roulette-segment {
            position: absolute;
            width: 50%;
            height: 50%;
            top: 0;
            right: 0;
            transform-origin: bottom left;
            overflow: hidden;
        }

        .segment-content {
            position: absolute;
            width: 200%;
            height: 200%;
            bottom: 0;
            left: 0;
            transform-origin: bottom left;
            display: flex;
            align-items: center;
            justify-content: center;
            padding-top: 20px;
        }

        .segment-text {
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translateX(-50%) rotate(90deg);
            font-size: 14px;
            font-weight: bold;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            white-space: nowrap;
            max-width: 80px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* ì¤€ë¹„ ì„¹ì…˜ */
        .ready-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 2px solid #7c4dff;
        }

        .users-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            min-height: 40px;
        }

        .user-tag {
            background: linear-gradient(135deg, #7c4dff 0%, #536dfe 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        /* ê²Œì„ ê¸°ë¡ */
        .history-section {
            position: fixed;
            right: 20px;
            top: 20px;
            width: 320px;
            max-height: calc(100vh - 40px);
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 20px;
            overflow-y: auto;
            display: none;
        }

        .history-section.visible {
            display: block;
        }

        .history-title {
            font-size: 18px;
            font-weight: bold;
            color: #7c4dff;
            margin-bottom: 15px;
            text-align: center;
        }

        .history-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid #7c4dff;
        }

        .history-round {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .history-participants {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .history-winner {
            font-size: 16px;
            font-weight: bold;
            color: #7c4dff;
        }

        /* ì±„íŒ… ì„¹ì…˜ */
        .chat-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            border: 2px solid #7c4dff;
        }

        .chat-messages {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }

        .chat-message.system {
            margin-bottom: 10px;
            padding: 12px;
            background: linear-gradient(135deg, #7c4dff 0%, #536dfe 100%);
            color: white;
            text-align: center;
            font-weight: bold;
            border-radius: 8px;
        }

        .chat-message.winner {
            background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%);
            color: #333;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            padding: 15px;
            animation: celebrate 0.5s ease-in-out infinite alternate;
            border-radius: 8px;
        }

        @keyframes celebrate {
            from { transform: scale(1); }
            to { transform: scale(1.02); }
        }

        /* ì ‘ì†ì ëª©ë¡ */
        .users-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 2px solid #7c4dff;
        }

        .users-title {
            font-weight: bold;
            color: #7c4dff;
            margin-bottom: 10px;
        }

        /* ë°© ì •ë³´ í—¤ë” */
        .room-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }

        .room-title {
            font-size: 24px;
            color: #7c4dff;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .host-badge {
            display: none;
            background: #ffc107;
            color: #333;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        /* í˜¸ìŠ¤íŠ¸ ì»¨íŠ¸ë¡¤ */
        .host-controls {
            display: none;
            background: linear-gradient(135deg, #fff3cd 0%, #ffe082 100%);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 2px solid #ffc107;
        }

        .start-button {
            background: linear-gradient(135deg, #4caf50 0%, #8bc34a 100%);
            font-size: 20px;
            padding: 15px 30px;
        }

        .start-button:disabled {
            background: #ccc;
        }

        .end-button {
            background: linear-gradient(135deg, #f44336 0%, #ff5722 100%);
        }

        /* ê²°ê³¼ ì˜¤ë²„ë ˆì´ */
        .result-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .result-overlay.visible {
            display: flex;
        }

        .result-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            animation: popup 0.5s ease-out;
        }

        @keyframes popup {
            from {
                transform: scale(0.5);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
            15% { opacity: 1; transform: translateX(-50%) translateY(0); }
            85% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
        }

        .result-title {
            font-size: 24px;
            color: #7c4dff;
            margin-bottom: 20px;
        }

        .result-winner {
            font-size: 48px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }

        .result-message {
            font-size: 18px;
            color: #666;
            margin-bottom: 30px;
        }

        /* ê²Œì„ íƒ€ì… ì•„ì´ì½˜ */
        .game-type-icon {
            font-size: 16px;
            margin-right: 5px;
        }

        /* ë°© í­íŒŒ ì¹´ìš´íŠ¸ë‹¤ìš´ */
        .room-expiry-section {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        @media (max-width: 1200px) {
            body.game-active .container {
                margin-left: auto;
                margin-right: auto;
            }
            
            .history-section {
                position: static;
                width: 100%;
                max-height: none;
                margin-top: 20px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
                border-radius: 15px;
            }

            h1 {
                font-size: 1.8em;
            }

            .roulette-wrapper {
                width: 280px;
                height: 280px;
            }
        }
    </style>
</head>
<body class="lobby-active">
    <!-- ë¡œë”© í™”ë©´ -->
    <div id="loadingScreen" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); z-index: 9999; display: none; flex-direction: column; justify-content: center; align-items: center;">
        <div style="text-align: center; color: white;">
            <div style="font-size: 80px; margin-bottom: 20px; animation: bounce 1s infinite;">ğŸ°</div>
            <h2 style="font-size: 24px; margin-bottom: 10px;">ë°©ì— ì…ì¥ ì¤‘...</h2>
            <p style="font-size: 16px; opacity: 0.8;">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</p>
            <div style="margin-top: 30px;">
                <div style="width: 50px; height: 50px; border: 4px solid rgba(255,255,255,0.3); border-top: 4px solid white; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
            </div>
        </div>
    </div>
    <style>
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
    </style>

    <div class="container">
        <!-- ë¡œë¹„ ì„¹ì…˜ -->
        <section class="lobby-section active" id="lobbySection">
            <h1>ğŸ° LAM Roulette</h1>
            <div class="connection-status connected" id="connectionStatus">â— ì—°ê²°ë¨</div>
            
            <!-- ì´ë¦„ ì…ë ¥ -->
            <div style="background: #fce4ec; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <label style="font-weight: bold; color: #7c4dff; display: block; margin-bottom: 8px;">ğŸ‘¤ ë‚´ ì´ë¦„</label>
                <input type="text" id="globalUserNameInput" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="20">
            </div>
            
            <!-- ë°© ë§Œë“¤ê¸° ë²„íŠ¼ -->
            <button onclick="showCreateRoomSection()" style="margin-bottom: 20px;">ğŸ° ìƒˆ ë£°ë › ë°© ë§Œë“¤ê¸°</button>
            
            <!-- ë°© ëª©ë¡ -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 style="color: #7c4dff;">ğŸ² ë°© ëª©ë¡</h3>
                <button onclick="refreshRooms()" style="width: auto; padding: 8px 15px; font-size: 14px;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            </div>
            <div class="rooms-list" id="roomsList">
                <div style="color: #999; text-align: center; padding: 20px;">ë°© ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
            
            <!-- ì£¼ì‚¬ìœ„ ê²Œì„ ë§í¬ -->
            <div style="text-align: center; margin-top: 20px;">
                <a href="/dice-game-multiplayer.html" style="color: #667eea; text-decoration: none;">ğŸ² ì£¼ì‚¬ìœ„ ê²Œì„ìœ¼ë¡œ ì´ë™</a>
            </div>
        </section>

        <!-- ë°© ìƒì„± ì„¹ì…˜ -->
        <section class="create-room-section" id="createRoomSection">
            <h2 style="color: #7c4dff; margin-bottom: 20px;">ğŸ° ìƒˆ ë£°ë › ë°© ë§Œë“¤ê¸°</h2>
            <div class="connection-status connected" id="createRoomConnectionStatus">â— ì—°ê²°ë¨</div>
            
            <div style="margin-bottom: 15px;">
                <label style="font-weight: bold; color: #333; display: block; margin-bottom: 5px;">í˜¸ìŠ¤íŠ¸ ì´ë¦„</label>
                <input type="text" id="createRoomHostNameInput" placeholder="í˜¸ìŠ¤íŠ¸ ì´ë¦„" maxlength="20">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="font-weight: bold; color: #333; display: block; margin-bottom: 5px;">ë°© ì œëª©</label>
                <input type="text" id="createRoomNameInput" placeholder="ë°© ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="30">
            </div>
            
            <!-- ë¹„ê³µê°œ ë°© ì„¤ì • -->
            <div style="margin-bottom: 15px;">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="checkbox" id="createRoomPrivateCheckbox" style="width: auto; margin: 0;">
                    <span style="font-weight: bold; color: #333;">ğŸ”’ ë¹„ê³µê°œ ë°©</span>
                </label>
                <div id="createRoomPasswordContainer" style="display: none; margin-top: 10px;">
                    <input type="password" id="createRoomPasswordInput" placeholder="ë¹„ë°€ë²ˆí˜¸ (4~20ì)" maxlength="20">
                </div>
            </div>
            
            <!-- ë°© ìœ ì§€ ì‹œê°„ -->
            <div style="margin-bottom: 15px;">
                <label style="font-weight: bold; color: #333; display: block; margin-bottom: 8px;">â° ë°© ìœ ì§€ ì‹œê°„</label>
                <div style="display: flex; gap: 15px;">
                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                        <input type="radio" name="roomExpiryTime" value="1" style="width: auto; margin: 0;">
                        <span>1ì‹œê°„</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                        <input type="radio" name="roomExpiryTime" value="3" checked style="width: auto; margin: 0;">
                        <span>3ì‹œê°„</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                        <input type="radio" name="roomExpiryTime" value="6" style="width: auto; margin: 0;">
                        <span>6ì‹œê°„</span>
                    </label>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px;">
                <button onclick="goBackToLobby()" style="background: #6c757d; flex: 1;">â† ì·¨ì†Œ</button>
                <button onclick="finalizeRoomCreation()" style="flex: 2;">ğŸ° ë°© ë§Œë“¤ê¸°</button>
            </div>
        </section>

        <!-- ê²Œì„ ì„¹ì…˜ -->
        <section class="game-section" id="gameSection">
            <!-- ë°© ì •ë³´ í—¤ë” -->
            <div class="room-header">
                <div style="display: flex; justify-content: center; align-items: center; gap: 10px;">
                    <span class="room-title" id="roomTitle">ë£°ë › ë°©</span>
                    <span class="host-badge" id="hostBadge">ğŸ‘‘ í˜¸ìŠ¤íŠ¸</span>
                </div>
                <button onclick="leaveRoom()" style="width: auto; padding: 8px 15px; font-size: 12px; background: #6c757d; margin-top: 10px;">ğŸšª ë‚˜ê°€ê¸°</button>
            </div>

            <!-- ë°© í­íŒŒ ì¹´ìš´íŠ¸ë‹¤ìš´ -->
            <div class="room-expiry-section" id="roomExpirySection" style="display: none;">
                <div style="color: #856404; font-weight: bold; font-size: 14px;">
                    â° ë°© í­íŒŒê¹Œì§€ ë‚¨ì€ ì‹œê°„: <span id="roomExpiryCountdown" style="color: #d9534f;">--:--:--</span>
                </div>
            </div>

            <!-- ì ‘ì†ì ëª©ë¡ -->
            <div class="users-section" id="usersSection">
                <div class="users-title">
                    ğŸ‘¥ ì ‘ì†ì (<span id="usersCount">0</span>ëª…)
                    <span id="dragHint" style="display: none; font-size: 12px; color: #7c4dff; margin-left: 10px; font-weight: normal;">ğŸ’¡ ë“œë˜ê·¸í•˜ì—¬ ì¤€ë¹„ì‹œí‚¤ê¸°</span>
                </div>
                <div class="users-list" id="usersList"></div>
            </div>

            <!-- ì¤€ë¹„ ì„¹ì…˜ -->
            <div class="ready-section" id="readySection">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div class="users-title" style="margin: 0;">âœ… ì¤€ë¹„í•œ ì‚¬ëŒ (<span id="readyCount">0</span>ëª…)</div>
                    <button id="readyButton" onclick="toggleReady()" style="width: auto; padding: 10px 20px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">ì¤€ë¹„</button>
                </div>
                <div class="users-list" id="readyUsersList">
                    <div style="color: #999; text-align: center; padding: 10px; width: 100%;">ì•„ì§ ì¤€ë¹„í•œ ì‚¬ëŒì´ ì—†ìŠµë‹ˆë‹¤</div>
                </div>
            </div>

            <!-- í˜¸ìŠ¤íŠ¸ ì»¨íŠ¸ë¡¤ -->
            <div class="host-controls" id="hostControls">
                <div style="text-align: center; margin-bottom: 10px; color: #856404; font-weight: bold;">
                    ğŸ‘‘ í˜¸ìŠ¤íŠ¸ ì „ìš©
                </div>
                <button class="start-button" id="startRouletteButton" onclick="startRoulette()" disabled>
                    ğŸ° ë£°ë › ì‹œì‘ (ìµœì†Œ 2ëª… ì¤€ë¹„ í•„ìš”)
                </button>
            </div>

            <!-- ë£°ë › ì»¨í…Œì´ë„ˆ (í•­ìƒ í‘œì‹œ) -->
            <div class="roulette-container" id="rouletteContainer" style="display: flex;">
                <div class="roulette-wrapper">
                    <div class="roulette-pointer"></div>
                    <div class="roulette-wheel" id="rouletteWheel"></div>
                    <div class="roulette-center">ğŸ°</div>
                </div>
            </div>

            <!-- ê²Œì„ ì¢…ë£Œ ë²„íŠ¼ (í˜¸ìŠ¤íŠ¸ ì „ìš©, ê²°ê³¼ í›„ í‘œì‹œ) -->
            <div id="endGameSection" style="display: none; text-align: center; margin-top: 20px;">
                <button class="end-button" onclick="endRouletteGame()">ğŸ ê²Œì„ ì¢…ë£Œ</button>
            </div>

            <!-- ì±„íŒ… ì„¹ì…˜ -->
            <div class="chat-section">
                <div style="font-weight: bold; color: #7c4dff; margin-bottom: 10px;">ğŸ’¬ ì±„íŒ…</div>
                <div class="chat-messages" id="chatMessages"></div>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="chatInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." style="flex: 1; margin: 0;" onkeypress="handleChatKeypress(event)">
                    <button onclick="sendMessage()" style="width: auto; padding: 10px 20px;">ì „ì†¡</button>
                </div>
            </div>
        </section>
    </div>

    <!-- ê¸°ë¡ ì„¹ì…˜ -->
    <div class="history-section" id="historySection">
        <div class="history-title">ğŸ“œ ê²Œì„ ê¸°ë¡</div>
        <div id="historyList"></div>
    </div>

    <!-- ê²°ê³¼ ì˜¤ë²„ë ˆì´ -->
    <div class="result-overlay" id="resultOverlay">
        <div class="result-card">
            <div class="result-title">ğŸŠ ë‹¹ì²¨ì ë°œí‘œ ğŸŠ</div>
            <div class="result-winner" id="resultWinner"></div>
            <div class="result-message">ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‰</div>
            <button onclick="closeResultOverlay()" style="width: auto; padding: 12px 30px;">í™•ì¸</button>
        </div>
    </div>

    <!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ëª¨ë‹¬ -->
    <div id="passwordModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000;">
        <div style="background: white; padding: 30px; border-radius: 12px; max-width: 400px; width: 90%;">
            <h3 style="color: #7c4dff; margin-bottom: 15px;">ğŸ”’ ë¹„ê³µê°œ ë°©</h3>
            <p style="margin-bottom: 15px; color: #666;">ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
            <input type="password" id="roomPasswordInput" placeholder="ë¹„ë°€ë²ˆí˜¸" style="margin-bottom: 15px;">
            <div style="display: flex; gap: 10px;">
                <button onclick="closePasswordModal()" style="background: #6c757d; flex: 1;">ì·¨ì†Œ</button>
                <button onclick="submitPassword()" style="flex: 1;">ì…ì¥</button>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // ì†Œì¼“ ì—°ê²°
        const socket = io({
            reconnection: true,
            reconnectionAttempts: 10,
            reconnectionDelay: 1000
        });

        // ìƒíƒœ ë³€ìˆ˜
        let currentRoomId = null;
        let currentUser = '';
        let isHost = false;
        let isReady = false;
        let readyUsers = [];
        let roomsList = [];
        let selectedRoomId = null;
        let rouletteHistory = [];
        let isSpinning = false;
        let roomExpiryInterval = null;
        let pendingRoomId = null;
        
        // íŒŒìŠ¤í…”í†¤ ìƒ‰ìƒ ëª©ë¡
        const PASTEL_COLORS = [
            { index: 0, hex: '#FFB3BA', name: 'íŒŒìŠ¤í…” í•‘í¬' },
            { index: 1, hex: '#BAFFC9', name: 'íŒŒìŠ¤í…” ë¯¼íŠ¸' },
            { index: 2, hex: '#BAE1FF', name: 'íŒŒìŠ¤í…” ë¸”ë£¨' },
            { index: 3, hex: '#FFFFBA', name: 'íŒŒìŠ¤í…” ì˜ë¡œìš°' },
            { index: 4, hex: '#FFD9BA', name: 'íŒŒìŠ¤í…” í”¼ì¹˜' },
            { index: 5, hex: '#E2BAFF', name: 'íŒŒìŠ¤í…” ë¼ë²¤ë”' },
            { index: 6, hex: '#BAFFED', name: 'íŒŒìŠ¤í…” ì•„ì¿ ì•„' },
            { index: 7, hex: '#FFC9DE', name: 'íŒŒìŠ¤í…” ë¡œì¦ˆ' },
            { index: 8, hex: '#C9FFE5', name: 'íŒŒìŠ¤í…” ìŠ¤í”„ë§ê·¸ë¦°' },
            { index: 9, hex: '#D4BAFF', name: 'íŒŒìŠ¤í…” í¼í”Œ' },
            { index: 10, hex: '#FFEEBA', name: 'íŒŒìŠ¤í…” í¬ë¦¼' },
            { index: 11, hex: '#BAFFD4', name: 'íŒŒìŠ¤í…” ì‹œí¼' },
            { index: 12, hex: '#FFCCCC', name: 'íŒŒìŠ¤í…” ì½”ë„' },
            { index: 13, hex: '#CCE5FF', name: 'íŒŒìŠ¤í…” ìŠ¤ì¹´ì´' },
            { index: 14, hex: '#E5FFCC', name: 'íŒŒìŠ¤í…” ë¼ì„' },
            { index: 15, hex: '#FFCCE5', name: 'íŒŒìŠ¤í…” ì²´ë¦¬' }
        ];
        let pendingUserName = null;

        // ë””ë°”ì´ìŠ¤ ID ìƒì„±/ê°€ì ¸ì˜¤ê¸°
        function getDeviceId() {
            let deviceId = localStorage.getItem('rouletteDeviceId');
            if (!deviceId) {
                deviceId = 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('rouletteDeviceId', deviceId);
            }
            return deviceId;
        }

        // ë°© ìƒì„± ì„¹ì…˜ í‘œì‹œ
        function showCreateRoomSection() {
            const globalName = document.getElementById('globalUserNameInput').value.trim();
            
            document.getElementById('lobbySection').classList.remove('active');
            document.getElementById('createRoomSection').classList.add('active');
            
            // í˜¸ìŠ¤íŠ¸ ì´ë¦„ ìë™ ì„¤ì •
            const hostNameInput = document.getElementById('createRoomHostNameInput');
            if (globalName) {
                hostNameInput.value = globalName;
                document.getElementById('createRoomNameInput').value = globalName + 'ë‹˜ì˜ Roulette';
            }
        }

        // ë¡œë¹„ë¡œ ëŒì•„ê°€ê¸°
        function goBackToLobby() {
            document.getElementById('createRoomSection').classList.remove('active');
            document.getElementById('lobbySection').classList.add('active');
        }

        // ë°© ìƒì„±
        function finalizeRoomCreation() {
            const hostName = document.getElementById('createRoomHostNameInput').value.trim();
            const roomName = document.getElementById('createRoomNameInput').value.trim();
            const isPrivate = document.getElementById('createRoomPrivateCheckbox').checked;
            const password = document.getElementById('createRoomPasswordInput').value.trim();
            const expiryTimeRadio = document.querySelector('input[name="roomExpiryTime"]:checked');
            const expiryHours = expiryTimeRadio ? parseInt(expiryTimeRadio.value) : 3;

            if (!hostName) {
                alert('í˜¸ìŠ¤íŠ¸ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            if (!roomName) {
                alert('ë°© ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            if (isPrivate && (!password || password.length < 4)) {
                alert('ë¹„ê³µê°œ ë°©ì€ 4ì ì´ìƒì˜ ë¹„ë°€ë²ˆí˜¸ê°€ í•„ìš”í•©ë‹ˆë‹¤!');
                return;
            }

            // ì´ë¦„ ì €ì¥
            localStorage.setItem('rouletteUserName', hostName);

            socket.emit('createRoom', {
                userName: hostName,
                roomName: roomName,
                isPrivate: isPrivate,
                password: isPrivate ? password : '',
                gameType: 'roulette',
                expiryHours: expiryHours,
                blockIPPerUser: false,
                deviceId: getDeviceId()
            });
        }

        // ë°© ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        function refreshRooms() {
            socket.emit('getRooms');
        }

        // ë°© ëª©ë¡ ë Œë”ë§
        function renderRoomsList() {
            const roomsListEl = document.getElementById('roomsList');
            
            // ë£°ë › ë°©ë§Œ í•„í„°ë§
            const rouletteRooms = roomsList.filter(room => room.gameType === 'roulette');
            
            if (rouletteRooms.length === 0) {
                roomsListEl.innerHTML = '<div style="color: #999; text-align: center; padding: 20px;">ìƒì„±ëœ ë£°ë › ë°©ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            roomsListEl.innerHTML = '';

            rouletteRooms.forEach(room => {
                const roomItem = document.createElement('div');
                const isMyRoom = room.roomId === currentRoomId;
                let className = 'room-item';
                if (isMyRoom) className += ' my-room';
                else if (room.roomId === selectedRoomId) className += ' active';
                roomItem.className = className;

                let statusClass = 'waiting';
                let statusText = 'ëŒ€ê¸° ì¤‘';
                if (room.isGameActive) {
                    statusClass = 'playing';
                    statusText = 'ê²Œì„ ì§„í–‰ ì¤‘';
                }

                const roomNameHtml = isMyRoom 
                    ? `${room.roomName}<span class="my-room-badge">ì°¸ì—¬ ì¤‘</span>`
                    : room.roomName;

                const privateBadge = room.isPrivate 
                    ? '<span style="color: #ff6b6b; font-weight: bold; margin-left: 5px;">ğŸ”’</span>' 
                    : '';

                const buttonText = isMyRoom ? 'ì¬ì…ì¥' : 'ì…ì¥';

                roomItem.innerHTML = `
                    <div class="room-info">
                        <div class="room-name"><span class="game-type-icon">ğŸ°</span>${roomNameHtml}${privateBadge}</div>
                        <div class="room-details">í˜¸ìŠ¤íŠ¸: ${room.hostName} | ì¸ì›: ${room.playerCount}ëª…</div>
                        <span class="room-status ${statusClass}">${statusText}</span>
                    </div>
                    <div class="room-action">
                        <button onclick="joinRoomDirectly('${room.roomId}')">${buttonText}</button>
                    </div>
                `;

                roomsListEl.appendChild(roomItem);
            });
        }

        // ë°© ì…ì¥
        function joinRoomDirectly(roomId) {
            const userName = document.getElementById('globalUserNameInput').value.trim();
            
            if (!userName) {
                alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                document.getElementById('globalUserNameInput').focus();
                return;
            }

            const room = roomsList.find(r => r.roomId === roomId);
            if (room && room.isPrivate) {
                pendingRoomId = roomId;
                pendingUserName = userName;
                document.getElementById('passwordModal').style.display = 'flex';
                document.getElementById('roomPasswordInput').focus();
            } else {
                socket.emit('joinRoom', {
                    roomId: roomId,
                    userName: userName,
                    isHost: false,
                    password: '',
                    deviceId: getDeviceId()
                });
            }

            localStorage.setItem('rouletteUserName', userName);
        }

        // ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ ë‹«ê¸°
        function closePasswordModal() {
            document.getElementById('passwordModal').style.display = 'none';
            document.getElementById('roomPasswordInput').value = '';
            pendingRoomId = null;
            pendingUserName = null;
        }

        // ë¹„ë°€ë²ˆí˜¸ ì œì¶œ
        function submitPassword() {
            const password = document.getElementById('roomPasswordInput').value;
            
            if (pendingRoomId && pendingUserName) {
                socket.emit('joinRoom', {
                    roomId: pendingRoomId,
                    userName: pendingUserName,
                    isHost: false,
                    password: password,
                    deviceId: getDeviceId()
                });
            }
            
            closePasswordModal();
        }

        // ë°© ë‚˜ê°€ê¸°
        function leaveRoom() {
            if (confirm('ë°©ì„ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                socket.emit('leaveRoom');
            }
        }

        // ì¤€ë¹„ í† ê¸€
        function toggleReady() {
            socket.emit('toggleReady');
        }

        // ì¤€ë¹„ ë²„íŠ¼ ì—…ë°ì´íŠ¸
        function updateReadyButton() {
            const btn = document.getElementById('readyButton');
            if (isReady) {
                btn.textContent = 'ì¤€ë¹„ ì·¨ì†Œ';
                btn.style.background = 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)';
            } else {
                btn.textContent = 'ì¤€ë¹„';
                btn.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
            }
        }

        // ì¤€ë¹„ ëª©ë¡ ë Œë”ë§
        function renderReadyUsers() {
            const readyUsersList = document.getElementById('readyUsersList');
            const readyCount = document.getElementById('readyCount');
            
            if (!readyUsersList || !readyCount) return;
            
            readyCount.textContent = readyUsers.length;
            
            if (readyUsers.length === 0) {
                readyUsersList.innerHTML = '<div style="color: #999; text-align: center; padding: 10px; width: 100%;" data-empty-ready>ì•„ì§ ì¤€ë¹„í•œ ì‚¬ëŒì´ ì—†ìŠµë‹ˆë‹¤</div>';
            } else {
                readyUsersList.innerHTML = '';
                readyUsers.forEach(userName => {
                    const tag = document.createElement('span');
                    tag.className = 'user-tag';
                    tag.textContent = userName;
                    
                    // í˜¸ìŠ¤íŠ¸ì´ê³  ê²Œì„ ì§„í–‰ ì¤‘ì´ ì•„ë‹ ë•Œ ë“œë˜ê·¸ ê°€ëŠ¥ (ì¤€ë¹„ ì·¨ì†Œìš©)
                    if (isHost && !isSpinning) {
                        tag.draggable = true;
                        tag.style.cursor = 'grab';
                        tag.setAttribute('data-user-name', userName);
                        
                        tag.addEventListener('dragstart', (e) => {
                            e.dataTransfer.setData('text/plain', userName);
                            e.dataTransfer.setData('source', 'ready');
                            tag.style.opacity = '0.5';
                        });
                        
                        tag.addEventListener('dragend', (e) => {
                            tag.style.opacity = '1';
                            // ì¤€ë¹„ ì„¹ì…˜ ë°–ìœ¼ë¡œ ë“œë¡­í•˜ë©´ ì¤€ë¹„ ì·¨ì†Œ
                            const readySection = document.getElementById('readySection');
                            const rect = readySection.getBoundingClientRect();
                            if (e.clientX < rect.left || e.clientX > rect.right || 
                                e.clientY < rect.top || e.clientY > rect.bottom) {
                                socket.emit('setUserReady', {
                                    userName: userName,
                                    isReady: false
                                });
                            }
                        });
                    }
                    
                    readyUsersList.appendChild(tag);
                });
            }

            // ì‹œì‘ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateStartButton();
            
            // ì¤€ë¹„í•œ ì‚¬ëŒë“¤ë¡œ ëŒë¦¼íŒ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
            if (!isSpinning) {
                updateRoulettePreview();
            }
        }
        
        
        // ëŒë¦¼íŒ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        function updateRoulettePreview() {
            if (readyUsers.length >= 1) {
                createRouletteWheel(readyUsers);
            } else {
                // ì¤€ë¹„í•œ ì‚¬ëŒì´ ì—†ìœ¼ë©´ ë¹ˆ ìƒíƒœ í‘œì‹œ
                const wheel = document.getElementById('rouletteWheel');
                wheel.innerHTML = '<div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #999; font-size: 14px; text-align: center;">ì¤€ë¹„í•œ ì‚¬ëŒì´<br>ì—†ìŠµë‹ˆë‹¤</div>';
            }
        }

        // ì‹œì‘ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateStartButton() {
            const btn = document.getElementById('startRouletteButton');
            if (btn && isHost) {
                if (readyUsers.length >= 2 && !isSpinning) {
                    btn.disabled = false;
                    btn.textContent = 'ğŸ° ë£°ë › ì‹œì‘!';
                } else {
                    btn.disabled = true;
                    btn.textContent = `ğŸ° ë£°ë › ì‹œì‘ (${readyUsers.length}/2ëª… ì¤€ë¹„)`;
                }
            }
        }

        // ë£°ë › ì‹œì‘
        function startRoulette() {
            if (readyUsers.length < 2) {
                alert('ìµœì†Œ 2ëª…ì´ ì¤€ë¹„í•´ì•¼ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!');
                return;
            }
            socket.emit('startRoulette');
        }

        // ë£°ë › íœ  ìƒì„±
        function createRouletteWheel(participants) {
            const wheel = document.getElementById('rouletteWheel');
            wheel.innerHTML = '';
            
            // íœ  íšŒì „ ìƒíƒœ ì´ˆê¸°í™” (ì¤‘ìš”: ì´ì „ ê²Œì„ì˜ íšŒì „ì´ ë‚¨ì•„ìˆìœ¼ë©´ ì•ˆë¨)
            wheel.style.transition = 'none';
            wheel.style.transform = 'rotate(0deg)';
            
            // íŒŒìŠ¤í…”í†¤ ìƒ‰ìƒ ë°°ì—´ - ìˆœì„œëŒ€ë¡œ ìë™ ë°°ì •
            const colorHexList = PASTEL_COLORS.map(c => c.hex);
            const participantColors = participants.map((name, idx) => colorHexList[idx % 16]);
            
            // conic-gradientë¡œ íŒŒì´ ì°¨íŠ¸ ë°°ê²½ ìƒì„± (0ë„ = 12ì‹œ ë°©í–¥ì—ì„œ ì‹œì‘)
            const segmentAngle = 360 / participants.length;
            let gradientParts = [];
            participants.forEach((name, idx) => {
                const startAngle = idx * segmentAngle;
                const endAngle = (idx + 1) * segmentAngle;
                gradientParts.push(`${participantColors[idx]} ${startAngle}deg ${endAngle}deg`);
            });
            wheel.style.background = `conic-gradient(from 0deg, ${gradientParts.join(', ')})`;
            wheel.style.border = '4px solid #222';
            
            // êµ¬ë¶„ì„ ê³¼ ì´ë¦„ ì¶”ê°€
            participants.forEach((name, index) => {
                // ì¤‘ì•™ì—ì„œ ë°”ê¹¥ìœ¼ë¡œ ë‚˜ê°€ëŠ” êµ¬ë¶„ì„  (ê²€ì€ìƒ‰)
                const divider = document.createElement('div');
                divider.style.cssText = `
                    position: absolute;
                    left: 50%;
                    top: 50%;
                    width: 3px;
                    height: 50%;
                    background: #222;
                    transform-origin: 0 0;
                    transform: rotate(${index * segmentAngle}deg) translateY(-100%);
                    box-shadow: 0 0 3px rgba(0,0,0,0.5);
                    z-index: 5;
                `;
                wheel.appendChild(divider);
                
                // ì´ë¦„ í…ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ (íŒŒì´ ì¡°ê° ì •ì¤‘ì•™ì— ìœ„ì¹˜, í•­ìƒ ìˆ˜í‰ìœ¼ë¡œ í‘œì‹œ)
                const textOverlay = document.createElement('div');
                // íŒŒì´ ì¡°ê°ì˜ ì •ì¤‘ì•™ ê³„ì‚°
                const angleToCenter = index * segmentAngle + segmentAngle / 2;
                const angleRad = (angleToCenter - 90) * Math.PI / 180; // -90ë„ëŠ” 12ì‹œ ë°©í–¥ ê¸°ì¤€
                const textRadius = 95; // ì¤‘ì•™ì—ì„œ í…ìŠ¤íŠ¸ê¹Œì§€ì˜ ê±°ë¦¬
                const textX = Math.cos(angleRad) * textRadius;
                const textY = Math.sin(angleRad) * textRadius;
                textOverlay.style.cssText = `
                    position: absolute;
                    left: calc(50% + ${textX}px);
                    top: calc(50% + ${textY}px);
                    transform: translate(-50%, -50%);
                    font-size: 16px;
                    font-weight: 700;
                    color: #333;
                    text-shadow: 2px 2px 0 #fff, -2px -2px 0 #fff, 2px -2px 0 #fff, -2px 2px 0 #fff, 0 2px 0 #fff, 0 -2px 0 #fff, 2px 0 0 #fff, -2px 0 0 #fff;
                    white-space: nowrap;
                    text-align: center;
                    z-index: 6;
                    letter-spacing: 1px;
                `;
                textOverlay.textContent = name.length > 6 ? name.substring(0, 6) + '..' : name;
                wheel.appendChild(textOverlay);
            });
        }

        // ë£°ë › ì• ë‹ˆë©”ì´ì…˜
        function spinRoulette(finalAngle, duration, callback) {
            const wheel = document.getElementById('rouletteWheel');
            
            wheel.style.transition = `transform ${duration}ms cubic-bezier(0.17, 0.67, 0.12, 0.99)`;
            wheel.style.transform = `rotate(${finalAngle}deg)`;
            
            setTimeout(() => {
                if (callback) callback();
            }, duration);
        }

        // ì ‘ì†ì ëª©ë¡ ì—…ë°ì´íŠ¸
        // í˜„ì¬ ì ‘ì†ì ëª©ë¡ ì €ì¥
        let currentUsers = [];
        
        function updateUsers(users) {
            currentUsers = users;
            const usersList = document.getElementById('usersList');
            const usersCount = document.getElementById('usersCount');
            
            if (!usersList || !usersCount) return;
            
            usersCount.textContent = users.length;
            usersList.innerHTML = '';
            
            users.forEach(user => {
                const tag = document.createElement('span');
                tag.className = 'user-tag';
                tag.textContent = user.name + (user.isHost ? ' ğŸ‘‘' : '');
                if (user.name === currentUser) {
                    tag.style.background = 'linear-gradient(135deg, #ffc107 0%, #ff8c00 100%)';
                    tag.style.color = '#333';
                }
                
                // í˜¸ìŠ¤íŠ¸ì´ê³  ê²Œì„ ì§„í–‰ ì¤‘ì´ ì•„ë‹ ë•Œ ë“œë˜ê·¸ ê°€ëŠ¥
                if (isHost && !isSpinning) {
                    tag.draggable = true;
                    tag.style.cursor = 'grab';
                    tag.setAttribute('data-user-name', user.name);
                    
                    tag.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('text/plain', user.name);
                        e.dataTransfer.setData('source', 'users');
                        tag.style.opacity = '0.5';
                    });
                    
                    tag.addEventListener('dragend', (e) => {
                        tag.style.opacity = '1';
                    });
                }
                
                usersList.appendChild(tag);
            });
            
            // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì„¤ì •
            if (isHost && !isSpinning) {
                setupDragAndDrop();
            }
        }
        
        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì„¤ì •
        function setupDragAndDrop() {
            const readyUsersList = document.getElementById('readyUsersList');
            const readySection = document.getElementById('readySection');
            
            if (!readyUsersList || !readySection) return;
            
            // ë“œë¡­ ì˜ì—­ ì„¤ì • (ì¤€ë¹„ ëª©ë¡)
            readyUsersList.addEventListener('dragover', (e) => {
                e.preventDefault();
                readyUsersList.style.backgroundColor = 'rgba(124, 77, 255, 0.1)';
                readyUsersList.style.border = '2px dashed #7c4dff';
            });
            
            readyUsersList.addEventListener('dragleave', (e) => {
                readyUsersList.style.backgroundColor = '';
                readyUsersList.style.border = '';
            });
            
            readyUsersList.addEventListener('drop', (e) => {
                e.preventDefault();
                readyUsersList.style.backgroundColor = '';
                readyUsersList.style.border = '';
                
                if (!isHost || isSpinning) return;
                
                const userName = e.dataTransfer.getData('text/plain');
                const source = e.dataTransfer.getData('source');
                
                // ì ‘ì†ì ëª©ë¡ì—ì„œ ë“œë˜ê·¸í•œ ê²½ìš°ë§Œ ì²˜ë¦¬
                if (source === 'users' && userName) {
                    // ì´ë¯¸ ì¤€ë¹„ ìƒíƒœì¸ì§€ í™•ì¸
                    if (!readyUsers.includes(userName)) {
                        socket.emit('setUserReady', {
                            userName: userName,
                            isReady: true
                        });
                    }
                }
            });
        }

        // ì±„íŒ… ë©”ì‹œì§€ ì¶”ê°€
        // ë””ë°”ì´ìŠ¤ ì•„ì´ì½˜ ê°€ì ¸ì˜¤ê¸°
        function getDeviceIcon(deviceType) {
            if (!deviceType) return '';
            if (deviceType === 'iOS') return 'ğŸ';
            if (deviceType === 'Android') return 'ğŸ“±';
            if (deviceType === 'PC') return 'ğŸ’»';
            return '';
        }
        
        function addChatMessage(data) {
            const chatMessages = document.getElementById('chatMessages');
            if (!chatMessages) return;
            
            // ì²« ë©”ì‹œì§€ë©´ ë¹ˆ ìƒíƒœ ë©”ì‹œì§€ ì œê±°
            const emptyMsg = chatMessages.querySelector('[data-empty-message]');
            if (emptyMsg) {
                emptyMsg.remove();
            }
            
            // ìŠ¤í¬ë¡¤ì´ ë§¨ ì•„ë˜ì— ìˆëŠ”ì§€ í™•ì¸
            const isScrolledToBottom = chatMessages.scrollHeight - chatMessages.scrollTop - chatMessages.clientHeight < 10;
            
            const msgDiv = document.createElement('div');
            
            // ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì²˜ë¦¬
            if (data.isSystem || data.userName === 'ì‹œìŠ¤í…œ') {
                msgDiv.className = 'chat-message system';
                if (data.isRouletteWinner) {
                    msgDiv.classList.add('winner');
                }
                msgDiv.textContent = data.message;
                chatMessages.appendChild(msgDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                return;
            }
            
            // ì¼ë°˜ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼
            const isMe = data.userName === currentUser;
            msgDiv.style.cssText = `margin-bottom: 10px; padding: 10px; background: ${isMe ? '#e8f5e9' : 'white'}; border-radius: 8px; border-left: 3px solid ${isMe ? '#4caf50' : '#7c4dff'};`;
            
            // ì‚¬ìš©ì ì´ë¦„ (ë°©ì¥ ì™•ê´€ + ë””ë°”ì´ìŠ¤ ì•„ì´ì½˜ + ì´ë¦„ + (ë‚˜))
            const userNameSpan = document.createElement('span');
            userNameSpan.style.cssText = `font-weight: 600; color: ${isMe ? '#2e7d32' : '#7c4dff'}; margin-right: 8px;`;
            
            let userNameText = '';
            if (data.isHost) userNameText += 'ğŸ‘‘ ';
            if (data.deviceType) {
                userNameText += getDeviceIcon(data.deviceType) + ' ';
            }
            userNameText += data.userName;
            if (isMe) userNameText += ' (ë‚˜)';
            userNameSpan.textContent = userNameText;
            
            // ë©”ì‹œì§€ ë‚´ìš©
            const messageSpan = document.createElement('span');
            messageSpan.style.color = '#333';
            messageSpan.textContent = data.message;
            
            // ì‹œê°„
            const timeSpan = document.createElement('div');
            timeSpan.style.cssText = 'font-size: 11px; color: #999; margin-top: 4px;';
            timeSpan.textContent = data.time || new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            
            msgDiv.appendChild(userNameSpan);
            msgDiv.appendChild(messageSpan);
            msgDiv.appendChild(timeSpan);
            
            chatMessages.appendChild(msgDiv);
            
            // ìŠ¤í¬ë¡¤ì´ ë§¨ ì•„ë˜ì— ìˆì—ˆìœ¼ë©´ ìŠ¤í¬ë¡¤
            if (isScrolledToBottom) {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        // ë©”ì‹œì§€ ì „ì†¡
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message) {
                socket.emit('sendMessage', { message: message });
                input.value = '';
            }
        }

        // ì±„íŒ… ì—”í„°í‚¤ ì²˜ë¦¬
        function handleChatKeypress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // ê¸°ë¡ ë Œë”ë§
        function renderHistory() {
            const historyList = document.getElementById('historyList');
            if (!historyList) return;
            
            if (rouletteHistory.length === 0) {
                historyList.innerHTML = '<div style="color: #999; text-align: center;">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }
            
            historyList.innerHTML = '';
            
            rouletteHistory.slice().reverse().forEach(record => {
                const item = document.createElement('div');
                item.className = 'history-item';
                item.innerHTML = `
                    <div class="history-round">${record.round}ë¼ìš´ë“œ (${record.time})</div>
                    <div class="history-participants">ì°¸ê°€ì: ${record.participants.join(', ')}</div>
                    <div class="history-winner">ğŸŠ ë‹¹ì²¨: ${record.winner}</div>
                `;
                historyList.appendChild(item);
            });
        }

        // ê²Œì„ ì¢…ë£Œ
        function endRouletteGame() {
            socket.emit('endRoulette');
        }

        // ê²°ê³¼ ì˜¤ë²„ë ˆì´ ë‹«ê¸°
        function closeResultOverlay() {
            document.getElementById('resultOverlay').classList.remove('visible');
        }

        // ë°© í­íŒŒ ì¹´ìš´íŠ¸ë‹¤ìš´
        function startRoomExpiryCountdown(createdAt, expiryHours) {
            if (roomExpiryInterval) {
                clearInterval(roomExpiryInterval);
            }
            
            const expirySection = document.getElementById('roomExpirySection');
            const countdownElement = document.getElementById('roomExpiryCountdown');
            
            if (!expirySection || !countdownElement) return;
            
            expirySection.style.display = 'block';
            
            function updateCountdown() {
                const now = new Date();
                const createdAtDate = new Date(createdAt);
                const expiryTime = createdAtDate.getTime() + (expiryHours * 60 * 60 * 1000);
                const remaining = expiryTime - now.getTime();
                
                if (remaining <= 0) {
                    countdownElement.textContent = '00:00:00';
                    if (roomExpiryInterval) {
                        clearInterval(roomExpiryInterval);
                    }
                    return;
                }
                
                const hours = Math.floor(remaining / (1000 * 60 * 60));
                const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
                
                countdownElement.textContent = 
                    `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }
            
            updateCountdown();
            roomExpiryInterval = setInterval(updateCountdown, 1000);
        }

        // ê²Œì„ í™”ë©´ ì´ˆê¸°í™”
        function initializeGameScreen(data) {
            document.getElementById('roomTitle').textContent = data.roomName || 'ë£°ë › ë°©';
            
            if (data.createdAt && data.expiryHours) {
                startRoomExpiryCountdown(data.createdAt, data.expiryHours);
            }
            
            // í˜¸ìŠ¤íŠ¸ UI ì„¤ì •
            if (isHost) {
                document.getElementById('hostBadge').style.display = 'inline-block';
                document.getElementById('hostControls').style.display = 'block';
                const dragHint = document.getElementById('dragHint');
                if (dragHint) dragHint.style.display = 'inline';
            } else {
                document.getElementById('hostBadge').style.display = 'none';
                document.getElementById('hostControls').style.display = 'none';
                const dragHint = document.getElementById('dragHint');
                if (dragHint) dragHint.style.display = 'none';
            }
            
            // ê¸°ë¡ ì„¹ì…˜ í‘œì‹œ
            document.getElementById('historySection').classList.add('visible');
            
            // ì±„íŒ… ê¸°ë¡ ë¡œë“œ
            if (data.chatHistory) {
                document.getElementById('chatMessages').innerHTML = '';
                data.chatHistory.forEach(msg => addChatMessage(msg));
            }
            
            // ë£°ë › ê¸°ë¡ ë¡œë“œ
            if (data.gameState && data.gameState.rouletteHistory) {
                rouletteHistory = data.gameState.rouletteHistory;
                renderHistory();
            }
            
            // ì¤€ë¹„ ìƒíƒœ ë³µì›
            if (data.readyUsers) {
                readyUsers = data.readyUsers;
                isReady = readyUsers.includes(currentUser);
                renderReadyUsers();
                updateReadyButton();
            }
            
            // ëŒë¦¼íŒ ë¯¸ë¦¬ë³´ê¸° ì´ˆê¸°í™”
            updateRoulettePreview();
        }

        // === ì†Œì¼“ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ===
        
        socket.on('connect', () => {
            document.getElementById('connectionStatus').textContent = 'â— ì—°ê²°ë¨';
            document.getElementById('connectionStatus').className = 'connection-status connected';
            
            const createRoomStatus = document.getElementById('createRoomConnectionStatus');
            if (createRoomStatus) {
                createRoomStatus.textContent = 'â— ì—°ê²°ë¨';
                createRoomStatus.className = 'connection-status connected';
            }
            
            if (document.getElementById('lobbySection').classList.contains('active')) {
                refreshRooms();
            }
        });

        socket.on('disconnect', () => {
            document.getElementById('connectionStatus').textContent = 'â— ì—°ê²° ëŠê¹€';
            document.getElementById('connectionStatus').className = 'connection-status disconnected';
        });

        socket.on('roomsList', (rooms) => {
            roomsList = rooms;
            renderRoomsList();
        });

        socket.on('roomsListUpdated', (rooms) => {
            roomsList = rooms;
            renderRoomsList();
        });

        socket.on('roomCreated', (data) => {
            currentRoomId = data.roomId;
            currentUser = document.getElementById('createRoomHostNameInput').value.trim();
            isHost = true;
            isReady = data.isReady || false;
            readyUsers = data.readyUsers || [];

            document.getElementById('lobbySection').classList.remove('active');
            document.getElementById('createRoomSection').classList.remove('active');
            document.getElementById('gameSection').classList.add('active');
            
            document.body.classList.remove('lobby-active');
            document.body.classList.add('game-active');

            initializeGameScreen(data);
            renderReadyUsers();
            updateReadyButton();
        });

        socket.on('roomJoined', (data) => {
            // ì„±ê³µ ì‹œ ì—ëŸ¬ í”Œë˜ê·¸ ì œê±°
            sessionStorage.removeItem('rouletteFromDice');
            
            // ë¡œë”© í™”ë©´ ìˆ¨ê¸°ê¸°
            document.getElementById('loadingScreen').style.display = 'none';
            
            currentRoomId = data.roomId;
            currentUser = document.getElementById('globalUserNameInput').value.trim();
            isHost = data.isHost;
            isReady = data.isReady || false;
            readyUsers = data.readyUsers || [];

            document.getElementById('lobbySection').classList.remove('active');
            document.getElementById('gameSection').classList.add('active');
            
            document.body.classList.remove('lobby-active');
            document.body.classList.add('game-active');

            initializeGameScreen(data);
            renderReadyUsers();
            updateReadyButton();
        });

        socket.on('roomError', (message) => {
            // ë‹¤ë¥¸ í˜ì´ì§€ì—ì„œ ì˜¨ ê²½ìš° ì£¼ì‚¬ìœ„ ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°
            const fromDice = sessionStorage.getItem('rouletteFromDice');
            if (fromDice === 'true') {
                sessionStorage.removeItem('rouletteFromDice');
                alert(message);
                window.location.href = '/dice-game-multiplayer.html';
                return;
            }
            
            // ë¡œë”© í™”ë©´ ìˆ¨ê¸°ê³  ë¡œë¹„ ë³´ì—¬ì£¼ê¸°
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('lobbySection').style.display = 'block';
            alert(message);
        });

        socket.on('rouletteError', (message) => {
            alert(message);
        });

        socket.on('updateUsers', (users) => {
            updateUsers(users);
        });

        socket.on('readyStateChanged', (data) => {
            isReady = data.isReady;
            updateReadyButton();
        });

        socket.on('readyUsersUpdated', (users) => {
            readyUsers = users || [];
            renderReadyUsers();
            
            // ë³¸ì¸ì˜ ì¤€ë¹„ ìƒíƒœ í™•ì¸
            isReady = readyUsers.includes(currentUser);
            updateReadyButton();
        });

        socket.on('newMessage', (data) => {
            addChatMessage(data);
        });

        socket.on('rouletteStarted', (data) => {
            isSpinning = true;
            
            // UI ìƒíƒœ ë³€ê²½ (ëŒë¦¼íŒì€ ì´ë¯¸ ë³´ì´ëŠ” ìƒíƒœ)
            document.getElementById('readySection').style.display = 'none';
            document.getElementById('hostControls').style.display = 'none';
            
            // ë£°ë › íœ  ìƒì„±
            createRouletteWheel(data.participants);
            
            // í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì§ì ‘ ê°ë„ ê³„ì‚°
            // conic-gradient(from 0deg): index Nì€ N*segmentAngle ~ (N+1)*segmentAngle
            // index Nì˜ ì¤‘ì•™: (N + 0.5) * segmentAngle
            // 
            // rotate(X deg) í›„ í™”ì‚´í‘œê°€ ê°€ë¦¬í‚¤ëŠ” ìœ„ì¹˜ = (360 - X) mod 360
            // ë‹¹ì²¨ì ì¤‘ì•™ì´ í™”ì‚´í‘œì— ì˜¤ë ¤ë©´: X = 360 - winnerCenterAngle
            // totalRotationì€ 360ì˜ ë°°ìˆ˜ê°€ ì•„ë‹ˆë¯€ë¡œ, ì „ì²´ ë°”í€´ ìˆ˜ë§Œ ì‚¬ìš©
            const segmentAngle = 360 / data.participants.length;
            const winnerCenterAngle = (data.winnerIndex + 0.5) * segmentAngle;
            const neededRotation = 360 - winnerCenterAngle;
            const fullRotations = Math.floor(data.totalRotation / 360);
            const finalAngle = fullRotations * 360 + neededRotation;
            
            console.log('ë£°ë ›: participants=' + data.participants.length + ', winnerIndex=' + data.winnerIndex + ', winner=' + data.winner + ', neededRotation=' + neededRotation + ', finalAngle=' + finalAngle);
            
            // ê°•ì œ ë¦¬í”Œë¡œìš° í›„ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
            const wheel = document.getElementById('rouletteWheel');
            wheel.offsetHeight; // ê°•ì œ ë¦¬í”Œë¡œìš°
            
            setTimeout(() => {
                spinRoulette(finalAngle, data.spinDuration, () => {
                    isSpinning = false;
                    
                    // ========== ğŸ§ª CSS ì• ë‹ˆë©”ì´ì…˜ ê²€ì¦ ë¡œê·¸ ==========
                    const wheelAfter = document.getElementById('rouletteWheel');
                    const computedTransform = window.getComputedStyle(wheelAfter).transform;
                    
                    // matrixì—ì„œ ì‹¤ì œ ê°ë„ ì¶”ì¶œ
                    let actualAngle = null;
                    if (computedTransform && computedTransform !== 'none') {
                        const matrixMatch = computedTransform.match(/matrix\(([^)]+)\)/);
                        if (matrixMatch) {
                            const values = matrixMatch[1].split(',').map(v => parseFloat(v.trim()));
                            actualAngle = Math.atan2(values[1], values[0]) * (180 / Math.PI);
                            if (actualAngle < 0) actualAngle += 360;
                        }
                    }
                    
                    const expectedAngle = finalAngle % 360;
                    const diff = actualAngle !== null ? Math.abs(actualAngle - expectedAngle) : null;
                    const diffAdjusted = diff !== null ? Math.min(diff, 360 - diff) : null;
                    const isAccurate = diffAdjusted !== null && diffAdjusted <= 1;
                    
                    // í™”ì‚´í‘œê°€ ê°€ë¦¬í‚¤ëŠ” ì„¸ê·¸ë¨¼íŠ¸ ê²€ì¦
                    const arrowPointsTo = (360 - (finalAngle % 360) + 360) % 360;
                    const winnerStart = data.winnerIndex * segmentAngle;
                    const winnerEnd = (data.winnerIndex + 1) * segmentAngle;
                    const isInWinnerSegment = arrowPointsTo >= winnerStart && arrowPointsTo < winnerEnd;
                    
                    console.log('%c========== ğŸ° ë£°ë › CSS ê²€ì¦ ==========', 'font-size: 14px; font-weight: bold; color: #7c4dff;');
                    console.log('ì°¸ê°€ì:', data.participants);
                    console.log('ë‹¹ì²¨ì:', data.winner, '(index:', data.winnerIndex + ')');
                    console.log('ì„¸ê·¸ë¨¼íŠ¸ ê°ë„:', segmentAngle.toFixed(2) + 'Â°');
                    console.log('ë‹¹ì²¨ì ì„¸ê·¸ë¨¼íŠ¸ ë²”ìœ„:', winnerStart.toFixed(2) + 'Â° ~ ' + winnerEnd.toFixed(2) + 'Â°');
                    console.log('---');
                    console.log('ëª©í‘œ íšŒì „ (ì „ì²´):', finalAngle.toFixed(2) + 'Â°');
                    console.log('ëª©í‘œ íšŒì „ (mod 360):', expectedAngle.toFixed(2) + 'Â°');
                    console.log('ì‹¤ì œ CSS ê°ë„:', actualAngle !== null ? actualAngle.toFixed(2) + 'Â°' : 'N/A');
                    console.log('ì˜¤ì°¨:', diffAdjusted !== null ? diffAdjusted.toFixed(2) + 'Â°' : 'N/A');
                    console.log('---');
                    console.log('í™”ì‚´í‘œ ê°€ë¦¬í‚¤ëŠ” ìœ„ì¹˜:', arrowPointsTo.toFixed(2) + 'Â°');
                    console.log('ë‹¹ì²¨ì ì„¸ê·¸ë¨¼íŠ¸ ì•ˆì— ìˆìŒ?', isInWinnerSegment ? 'âœ… YES' : 'âŒ NO');
                    console.log('---');
                    console.log('style.transform:', wheelAfter.style.transform);
                    console.log('computed transform:', computedTransform);
                    
                    if (isAccurate && isInWinnerSegment) {
                        console.log('%câœ… í…ŒìŠ¤íŠ¸ í†µê³¼: CSS ì• ë‹ˆë©”ì´ì…˜ ì •í™•!', 'color: green; font-weight: bold; font-size: 16px;');
                    } else if (isInWinnerSegment) {
                        console.log('%câš ï¸ ë¶€ë¶„ í†µê³¼: ì„¸ê·¸ë¨¼íŠ¸ëŠ” ë§ì§€ë§Œ ê°ë„ ì˜¤ì°¨ ìˆìŒ', 'color: orange; font-weight: bold; font-size: 16px;');
                    } else {
                        console.log('%câŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: í™”ì‚´í‘œê°€ ë‹¤ë¥¸ ì„¸ê·¸ë¨¼íŠ¸ë¥¼ ê°€ë¦¬í‚´!', 'color: red; font-weight: bold; font-size: 16px;');
                    }
                    console.log('%c==========================================', 'font-size: 14px; font-weight: bold; color: #7c4dff;');
                    // ========== ê²€ì¦ ë¡œê·¸ ë ==========
                    
                    // í˜¸ìŠ¤íŠ¸ë§Œ ê²°ê³¼ ì´ë²¤íŠ¸ ì „ì†¡
                    if (isHost) {
                        socket.emit('rouletteResult', { winner: data.winner });
                    }
                    
                    // ê²°ê³¼ ì˜¤ë²„ë ˆì´ í‘œì‹œ
                    document.getElementById('resultWinner').textContent = data.winner;
                    document.getElementById('resultOverlay').classList.add('visible');
                    
                    // ê¸°ë¡ ì¶”ê°€
                    rouletteHistory.push(data.record);
                    renderHistory();
                    
                    // í˜¸ìŠ¤íŠ¸ì—ê²Œ ì¢…ë£Œ ë²„íŠ¼ í‘œì‹œ
                    if (isHost) {
                        document.getElementById('endGameSection').style.display = 'block';
                    }
                });
            }, 50); // 50ms ì§€ì—°ìœ¼ë¡œ ë¦¬í”Œë¡œìš° ë³´ì¥
        });

        socket.on('rouletteEnded', (data) => {
            // ê²°ê³¼ ì²˜ë¦¬ ì™„ë£Œ
        });

        socket.on('rouletteGameEnded', (data) => {
            isSpinning = false;
            
            // UI ì´ˆê¸°í™” (ëŒë¦¼íŒì€ ê³„ì† í‘œì‹œ)
            document.getElementById('rouletteContainer').style.display = 'flex';
            document.getElementById('readySection').style.display = 'block';
            document.getElementById('endGameSection').style.display = 'none';
            
            // ë£°ë › íœ  ì´ˆê¸°í™”
            const wheel = document.getElementById('rouletteWheel');
            wheel.style.transition = 'none';
            wheel.style.transform = 'rotate(0deg)';
            
            // í˜¸ìŠ¤íŠ¸ ì»¨íŠ¸ë¡¤ í‘œì‹œ
            if (isHost) {
                document.getElementById('hostControls').style.display = 'block';
            }
            
            // ì¤€ë¹„ ìƒíƒœ ì´ˆê¸°í™”
            readyUsers = [];
            isReady = false;
            renderReadyUsers();
            updateReadyButton();
            updateStartButton();
        });

        socket.on('roomDeleted', (data) => {
            alert(data.message || 'ë°©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            
            if (roomExpiryInterval) {
                clearInterval(roomExpiryInterval);
            }
            
            // ì£¼ì‚¬ìœ„ ë©”ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™
            window.location.href = '/dice-game-multiplayer.html';
        });

        // ë°© ë‚˜ê°€ê¸° ì™„ë£Œ (ì„œë²„ì—ì„œ roomLeft emit)
        socket.on('roomLeft', () => {
            if (roomExpiryInterval) {
                clearInterval(roomExpiryInterval);
            }
            
            // ì£¼ì‚¬ìœ„ ë©”ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™
            window.location.href = '/dice-game-multiplayer.html';
        });

        // ë ˆê±°ì‹œ ì´ë²¤íŠ¸ í˜¸í™˜ì„± ìœ ì§€
        socket.on('leftRoom', () => {
            if (roomExpiryInterval) {
                clearInterval(roomExpiryInterval);
            }
            
            // ì£¼ì‚¬ìœ„ ë©”ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™
            window.location.href = '/dice-game-multiplayer.html';
        });

        socket.on('hostChanged', (data) => {
            if (data.newHostId === socket.id) {
                isHost = true;
                document.getElementById('hostBadge').style.display = 'inline-block';
                document.getElementById('hostControls').style.display = 'block';
                updateStartButton();
                alert('ë‹¹ì‹ ì´ ìƒˆë¡œìš´ í˜¸ìŠ¤íŠ¸ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
        });
        
        // ë¹„ê³µê°œ ë°© ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
        document.addEventListener('DOMContentLoaded', () => {
            const privateCheckbox = document.getElementById('createRoomPrivateCheckbox');
            const passwordContainer = document.getElementById('createRoomPasswordContainer');
            
            if (privateCheckbox && passwordContainer) {
                privateCheckbox.addEventListener('change', function() {
                    passwordContainer.style.display = this.checked ? 'block' : 'none';
                    if (!this.checked) {
                        document.getElementById('createRoomPasswordInput').value = '';
                    }
                });
            }
            
            // ì €ì¥ëœ ì´ë¦„ ë¶ˆëŸ¬ì˜¤ê¸°
            const savedName = localStorage.getItem('rouletteUserName');
            if (savedName) {
                document.getElementById('globalUserNameInput').value = savedName;
            }
            
            // URL íŒŒë¼ë¯¸í„°ë¡œ ë°© ìƒì„±/ì…ì¥ ìš”ì²­ì´ ì™”ëŠ”ì§€ í™•ì¸
            const urlParams = new URLSearchParams(window.location.search);
            
            // ë°© ìƒì„± ìš”ì²­
            if (urlParams.get('createRoom') === 'true') {
                const pendingRoom = localStorage.getItem('pendingRouletteRoom');
                if (pendingRoom) {
                    const roomData = JSON.parse(pendingRoom);
                    localStorage.removeItem('pendingRouletteRoom');
                    
                    // ì†Œì¼“ ì—°ê²° í›„ ë°© ìƒì„±
                    socket.on('connect', function onConnect() {
                        socket.off('connect', onConnect); // í•œ ë²ˆë§Œ ì‹¤í–‰
                        
                        socket.emit('createRoom', {
                            userName: roomData.userName,
                            roomName: roomData.roomName,
                            isPrivate: roomData.isPrivate,
                            password: roomData.password,
                            gameType: 'roulette',
                            expiryHours: roomData.expiryHours,
                            blockIPPerUser: roomData.blockIPPerUser,
                            deviceId: getDeviceId()
                        });
                    });
                    
                    // URLì—ì„œ íŒŒë¼ë¯¸í„° ì œê±°
                    window.history.replaceState({}, document.title, window.location.pathname);
                }
            }
            
            // ë°© ì…ì¥ ìš”ì²­
            if (urlParams.get('joinRoom') === 'true') {
                const pendingJoin = localStorage.getItem('pendingRouletteJoin');
                if (pendingJoin) {
                    const joinData = JSON.parse(pendingJoin);
                    localStorage.removeItem('pendingRouletteJoin');
                    
                    // ì—ëŸ¬ ì‹œ ëŒì•„ê°ˆ í”Œë˜ê·¸ ì €ì¥
                    sessionStorage.setItem('rouletteFromDice', 'true');
                    
                    // ë¡œë”© í™”ë©´ í‘œì‹œ
                    document.getElementById('loadingScreen').style.display = 'flex';
                    document.getElementById('lobbySection').style.display = 'none';
                    
                    // ì´ë¦„ ì„¤ì •
                    document.getElementById('globalUserNameInput').value = joinData.userName;
                    
                    // ì†Œì¼“ ì—°ê²° í›„ ë°© ì…ì¥
                    socket.on('connect', function onJoinConnect() {
                        socket.off('connect', onJoinConnect); // í•œ ë²ˆë§Œ ì‹¤í–‰
                        
                        if (joinData.isPrivate) {
                            // ë¹„ê³µê°œ ë°©ì´ë©´ ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ í‘œì‹œ
                            pendingRoomId = joinData.roomId;
                            pendingUserName = joinData.userName;
                            document.getElementById('passwordModal').style.display = 'flex';
                            document.getElementById('roomPasswordInput').focus();
                        } else {
                            // ê³µê°œ ë°©ì´ë©´ ë°”ë¡œ ì…ì¥
                            socket.emit('joinRoom', {
                                roomId: joinData.roomId,
                                userName: joinData.userName,
                                isHost: false,
                                password: '',
                                deviceId: getDeviceId()
                            });
                        }
                    });
                    
                    // URLì—ì„œ íŒŒë¼ë¯¸í„° ì œê±°
                    window.history.replaceState({}, document.title, window.location.pathname);
                }
            }
        });
    </script>
</body>
</html>

