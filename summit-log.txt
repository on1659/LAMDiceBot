========================================
🔷 Summit Log - 2026-02-14 (horse-app P1~P3)
========================================

## 변경 파일
- horse-app/src/types/socket-events.ts: 소켓 payload 타입 정밀화
- horse-app/src/stores/gameStore.ts: 주문/채팅 상태 분리 및 액션 추가
- horse-app/src/hooks/useSocketEvents.ts: 이벤트 핸들러 정밀화 및 상태 동기화
- horse-app/src/components/ChatPanel.tsx: 시스템/AI 라벨, 리액션 UI, 이미지 메시지 표시
- horse-app/src/components/OrderPanel.tsx: 주문 목록/정렬/요약, 자주메뉴 연동
- horse-app/src/components/RoomHeader.tsx: 랭킹 fallback 안정화, 사운드 토글 개선
- horse-app/src/components/LobbyScreen.tsx: 브라우저 유틸 경유 접근으로 안정화
- horse-app/src/utils/externalModules.ts: 안전한 window 접근/네비게이션 유틸
- horse-app/src/utils/browser.ts: URLSearchParams/디바이스 유틸 신규
- docs/meeting/2026-02-14-horse-rebuild-p1-p3-log.md: 진행 로그 기록

## 핵심 변경
- P1: 공통 상태 접근 패턴 통일, 소켓 이벤트 타입을 명확화해 unknown 제거
- P2: 채팅 리액션/시스템 표기, 주문 목록·정렬·요약 및 자주메뉴 연동 추가
- P2: 랭킹 모듈 실패 시 /statistics fallback 및 serverId/userName 전달
- P3: 빌드/정적 검증 완료

## 검증
- horse-app: npm run build (PASS, Vite 경고: non-module shared scripts)
- node -c routes/api.js (PASS)
- node -c test-file-separation.js (PASS)

========================================
📋 Summit Log - 2026-02-14 (경마 React 리빌드 - horse-app)
========================================

## 변경 파일 (31개 신규 - horse-app/)

### 프로젝트 구조
- horse-app/package.json: React 19 + Vite 7 + Zustand 5 + Socket.IO + Tailwind CSS 4
- horse-app/vite.config.ts: base '/horse-app/', proxy → localhost:3000
- horse-app/tsconfig.json, tsconfig.app.json, tsconfig.node.json: TypeScript 설정
- horse-app/eslint.config.js: ESLint 설정
- horse-app/index.html: SPA 엔트리 포인트

### 컴포넌트 (12개)
- src/App.tsx: 메인 앱 (lobby↔game 페이즈 분기)
- src/main.tsx: React 엔트리
- src/components/GameLayout.tsx: 게임 페이즈별 레이아웃 라우팅
- src/components/LobbyScreen.tsx: 방 생성/참가
- src/components/RoomHeader.tsx: 방 헤더 (방명, 호스트 뱃지, 나가기)
- src/components/UsersList.tsx: 접속자 목록
- src/components/ReadySection.tsx: 준비 토글
- src/components/HostControls.tsx: 방장 컨트롤 (시작, 종료, 데이터삭제)
- src/components/GameStatus.tsx: 게임 상태 표시
- src/components/VehicleSelection.tsx: 탈것 선택 그리드 + 코스 길이 선택
- src/components/Countdown.tsx: 3-2-1-START 카운트다운 오버레이
- src/components/RaceTrack.tsx: 레이스 트랙 + 미니맵 (requestAnimationFrame 기반)
- src/components/RaceResult.tsx: 결과 화면 (순위, 승자, 다시보기, 기록)

### 훅/스토어
- src/hooks/useSocket.ts: Socket.IO 연결 관리
- src/hooks/useSocketEvents.ts: 서버→클라이언트 이벤트 핸들러 등록
- src/stores/gameStore.ts: Zustand 전역 상태 (게임 페이즈, 레이스 데이터, 유저 정보)

### 타입 정의
- src/types/game-state.ts: 트랙, 레이스, 기믹, 날씨, 슬로우모션 타입
- src/types/socket-events.ts: 서버↔클라이언트 소켓 이벤트 타입
- src/types/vehicle.ts: 탈것 ID, 이름 타입

### 유틸리티
- src/utils/raceSimulator.ts: 프레임 기반 레이스 시뮬레이션 엔진
- src/utils/vehicleEmoji.ts: 탈것 이모지/배경색 매핑

### 스타일
- src/index.css: Tailwind CSS 4 + CSS 변수 기반 다크 테마

## 상세 변경 내역

### 아키텍처
- 기존 바닐라 JS (horse-race-multiplayer.html + js/horse-race.js 6168줄) → React + TypeScript (21개 파일 2595줄)
- 컴포넌트 분리: 12개 역할별 컴포넌트
- Zustand 상태관리: 전역 변수 수십 개 → 단일 스토어
- TypeScript: 서버↔클라이언트 이벤트 타입 안전성

### 서버 코드 대조 검토 (3회차)
- Bug fix 1차 (5개): horseRaceEnded 페이로드 불일치, result 페이즈 전환 누락, 기믹 데이터 mutation, Math.random() 렌더링 깜빡임, 슬로우모션 미해제
- Bug fix 3차 (4개): horseRaceGameReset 페이로드 불일치 (서버는 horseRaceHistory만 전송), HorseSelectionReadyPayload optional 필드 처리, setRaceResult winners 미반영, horseSelectionReady fallback 처리

### 주의사항
- 기존 코드 (horse-race-multiplayer.html + js/horse-race.js + css/horse-race.css) 전혀 미수정
- 서버 코드 (socket/horse.js) 변경 없음
- horse-app/dist/ 빌드 결과물: 272KB JS + 25KB CSS
- 아직 서버 라우팅 연결 안 됨 (기존 HTML이 계속 서빙 중)

========================================
📋 Summit Log - 2026-02-12 (deviceId→tabId 재연결 판별 수정)
========================================

## 변경 파일 (4개)
- socket/rooms.js: deviceId 기반 → tabId(sessionStorage) 기반 재연결 판별로 변경
- dice-game-multiplayer.html: tabId 생성 + 모든 joinRoom/createRoom에 tabId 전송
- js/horse-race.js: tabId 생성 + 모든 joinRoom/createRoom에 tabId 전송
- roulette-game-multiplayer.html: tabId 생성 + 모든 joinRoom/createRoom에 tabId 전송

## 상세 변경 내역

### 문제
- deviceId는 localStorage → 같은 브라우저의 모든 탭이 동일 값 공유
- 중복접속(_1) 기능이 동작하지 않음 (같은 deviceId → 재연결로 처리 → 구 소켓 강제 종료)
- 다른 탭에서 접속하면 첫 번째 탭이 끊어지는 버그

### 해결: sessionStorage 기반 tabId
- sessionStorage는 탭별 격리 → 같은 탭 새로고침: 유지, 새 탭: 다른 값
- 같은 탭 새로고침 → 같은 tabId → 재연결 (구 소켓 disconnect + 기존 유저 정보 인계)
- 같은 브라우저 새 탭 → 다른 tabId → 중복접속 (_1 접미사)
- 다른 브라우저 → 다른 tabId → 중복접속 (_1 접미사)

### 서버 변경 (rooms.js)
- joinRoom: `isSameDevice` → `isSameTab` (data.tabId vs connectedUserWithSameName.tabId)
- createRoom/joinRoom/getCurrentRoom: socket.tabId = data.tabId 저장
- 재연결 경로에서도 socket.tabId 저장

### 클라이언트 변경 (3개 게임)
- 페이지 로드 시 sessionStorage에 tabId 없으면 랜덤 생성
- getTabId() 함수 추가
- 모든 joinRoom/createRoom emit에 tabId: getTabId() 추가

========================================

========================================
📋 Summit Log - 2026-02-12 (주사위 방 새로고침 재입장)
========================================

## 변경 파일 (1개)
- dice-game-multiplayer.html: 주사위 방 새로고침 시 자동 재입장 (diceActiveRoom 키)

## 상세 변경 내역

### 주사위 방 새로고침 재입장
- 기존: 주사위 방에서 새로고침하면 로비로 돌아감 (방에서 나가짐)
- 수정: sessionStorage('diceActiveRoom')에 방 정보 저장 → 새로고침 시 자동 joinRoom
- roomCreated/roomJoined: {roomId, userName, serverId, serverName} 저장
- roomLeft/roomDeleted/roomError/kicked: removeItem
- 서버 목록 버튼/PageHistoryManager.onServerSelect: removeItem
- roomError 시 로비 복원 처리 (재입장 실패 시 빈 화면 방지)

========================================

========================================
📋 Summit Log - 2026-02-12 (새로고침 재입장 중복 입장 버그 수정)
========================================

## 변경 파일 (1개)
- socket/rooms.js: joinRoom 중복 이름 체크에 deviceId 기반 재연결 판별 추가

## 상세 변경 내역

### 새로고침 시 무한 중복 입장 버그 수정
- 문제: 새로고침 시 구 소켓이 아직 connected 상태 → 서버가 "중복 이름"으로 판단
  → "이더" → "이더_1" → "이더_1_1"... 무한 반복
- 원인: joinRoom의 중복 이름 체크가 socket.connected만 확인
  → 새로고침 시 구 소켓 disconnect 처리보다 새 소켓 joinRoom이 먼저 처리됨
- 수정: 같은 deviceId면 구 소켓이 connected여도 재연결로 처리
  1. connectedUserWithSameName.deviceId === deviceId 체크 추가
  2. 같은 기기면 구 소켓 강제 disconnect(true) 후 재연결 경로로 분기
  3. 재연결 경로에서 socket.deviceId 설정 추가 (다음 새로고침 대비)

========================================

========================================
📋 Summit Log - 2026-02-12 (경마/룰렛 새로고침 재입장)
========================================

## 변경 파일 (2개)
- js/horse-race.js: 새로고침 시 sessionStorage 기반 자동 재입장 로직 추가
- roulette-game-multiplayer.html: 동일 패턴 적용 (rouletteActiveRoom 키)

## 상세 변경 내역

### 새로고침 재입장 (경마 + 룰렛)
- 문제: 경마/룰렛 진입 시 URL 파라미터(createRoom/joinRoom)가 replaceState로 제거됨
  → 새로고침하면 fromDice=false가 되어 /game으로 리다이렉트
- 해결: sessionStorage에 방 정보 저장 후 새로고침 시 자동 재입장

#### IIFE 흐름 변경
1. URL 파라미터 확인 (fromDice)
2. fromDice가 아니면 sessionStorage('horseRaceActiveRoom'/'rouletteActiveRoom') 확인
3. 방 정보가 있으면 serverId 설정 + socket.emit('joinRoom') 으로 재입장
4. 없으면 /game으로 리다이렉트

#### sessionStorage 저장/삭제 위치
- 저장: roomCreated, roomJoined 이벤트에서 {roomId, userName, serverId, serverName} 저장
- 삭제: roomLeft, leftRoom, roomDeleted, roomError 이벤트에서 removeItem
- 경마 키: 'horseRaceActiveRoom'
- 룰렛 키: 'rouletteActiveRoom'

#### 재입장 시 동작
- currentServerId/currentServerName 복원
- socket.emit('setServerId') 호출
- document.title 설정
- socket 연결 완료 후 joinRoom emit (isHost: false로 재입장)
- JSON 파싱 실패 시 sessionStorage 정리 후 /game 리다이렉트

========================================

========================================
📋 Summit Log - 2026-02-12 (경마/룰렛 로비 제거)
========================================

## 변경 파일 (4개)
- horse-race-multiplayer.html: lobbySection, createRoomSection HTML 제거, loadingScreen 기본 display:flex, body class="lobby-active" 제거, server-select-shared.js 참조 제거, globalUserNameInput을 hidden input으로 변경
- js/horse-race.js: showCreateRoomSection, goBackToLobby, finalizeRoomCreation, refreshRooms, renderRoomsList, joinRoomDirectly 함수 제거, ServerSelectModule.init else 블록 제거, roomsList/roomsListUpdated 소켓 이벤트 제거, socket.on('connect'/'disconnect') 핸들러 간소화, roomCreated/roomJoined에서 lobbySection 참조 제거, roomError에서 /game 리다이렉트로 통합, DOMContentLoaded auto-create/join에서 lobbySection.display 참조 제거, roomsList/selectedRoomId 전역 변수 제거
- css/horse-race.css: body.lobby-active, .lobby-section, .create-room-section, .rooms-list, .room-item 등 로비 관련 CSS 전체 제거
- roulette-game-multiplayer.html: 경마와 동일 패턴 적용 - lobbySection/createRoomSection HTML 제거, 로비 관련 CSS/JS 함수/소켓 이벤트 제거, ServerSelectModule 제거, loadingScreen 기본 표시

## 상세 변경 내역

### 경마/룰렛 로비 dead code 제거
- 경마/룰렛 페이지는 항상 주사위 로비에서 ?createRoom=true 또는 ?joinRoom=true로만 진입
- 직접 URL 접속 시 /game으로 리다이렉트되므로 자체 로비가 절대 표시되지 않음
- 방 나가기/삭제 시에도 /game으로 리다이렉트하므로 로비 불필요
- 로비 깜빡임 원인: 페이지 로드 시 lobby-active 클래스로 로비가 기본 표시 → 소켓 연결 후 방 생성까지 잠시 보임
- 해결: 로비 자체를 제거하고 loadingScreen을 기본 표시(display:flex)로 변경

### 제거된 코드량
- horse-race-multiplayer.html: lobbySection ~40줄, createRoomSection ~48줄 HTML 제거
- js/horse-race.js: ~200줄 로비 관련 함수/이벤트 제거
- css/horse-race.css: ~100줄 로비 관련 스타일 제거
- roulette-game-multiplayer.html: ~350줄 (HTML + 인라인 JS + CSS) 제거

========================================

========================================
📋 Summit Log - 2026-02-12 (서버 선택 페이지 분리 + 랭킹 고도화)
========================================

## 변경 파일 (16개)
- index.html: 서버 선택 전용 페이지 신규 생성 (header/footer + ServerSelectModule)
- routes/api.js: GET / → index.html, GET /game → dice-game-multiplayer.html 라우트 추가
- dice-game-multiplayer.html: ServerSelectModule.init 최소화(멤버모달용), server-select-active CSS 제거, 세션 복원 로직(diceSession/returnToLobby), 세션 없으면 / 리다이렉트, PageHistoryManager.onServerSelect → window.location.href='/', getCurrentPage에서 serverSelectOverlay 체크 제거
- js/horse-race.js: 복귀 URL /dice-game-multiplayer.html → /game (4곳)
- roulette-game-multiplayer.html: 복귀 URL /dice-game-multiplayer.html → /game (6곳)
- horse-race-multiplayer.html: 주사위 게임 링크 /dice-game-multiplayer.html → /game
- about-us.html, contact.html, dice-rules-guide.html, privacy-policy.html, probability-analysis.html, statistics.html, terms-of-service.html: 메인 돌아가기 링크 dice-game-multiplayer.html → /
- db/ranking.js: 랭킹 동점자 규칙(같은 점수=같은 등수) + 종합 탭 서브탭(순위/참여)
- ranking-shared.js: 동점자 등수 표시 UI + 종합 서브탭 UI + PC max-width 조정
- routes/server.js: 서버 관련 버그 수정

## 상세 변경 내역

### 페이지 분리 (핵심)
- 기존: / → dice-game-multiplayer.html (서버 선택 오버레이 + 로비 + 게임 모두 한 파일)
- 변경: / → index.html (서버 선택만), /game → dice-game-multiplayer.html (로비+게임)
- 서버 선택 완료 → sessionStorage에 diceSession 저장 → /game 이동
- /game 직접 접속(세션 없음) → / 리다이렉트
- 새로고침 → diceSession 존재하면 로비 유지
- "← 서버 목록" 버튼 → diceSession 삭제 후 / 이동

### 랭킹 고도화
- db/ranking.js: 동점자 같은 등수 처리 로직 추가
- ranking-shared.js: 종합 탭에 순위/참여 서브탭 UI

========================================

========================================
📋 Summit Log - 2026-02-12 (회원가입 개선 + 세션 복원 + UI 수정)
========================================

## 변경 파일 (4개)
- server-select-shared.js: 회원가입 암호코드 확인, _showConfirm 커스텀 모달, footer 링크, 통계 링크, pendingCount 빨간점
- dice-game-multiplayer.html: 세션 복원 시 오버레이 숨김, server-select-active CSS 수정, 방 제목에 서버이름 태그, 통계 링크 제거, 전체서버통합 라벨
- ranking-shared.js: PC max-width를 헤더/탭 제거하고 콘텐츠만 640px
- socket/server.js: serverJoined에 pendingCount 포함 (호스트용), server.js 오타 제거

## 상세 변경 내역

### 1. 회원가입 암호코드 확인
- server-select-shared.js: _authModal에 isRegister 파라미터 추가
- 회원가입 시 "암호코드 확인" 입력 필드 추가 (ss-pin-confirm)
- 두 값 불일치 시 "암호코드가 일치하지 않습니다" 에러
- Enter 키 흐름: 이름→암호코드→암호코드 확인→제출
- doSubmit → doApiCall 분리: 확인 모달 후 API 호출

### 2. 커스텀 확인 모달 (_showConfirm)
- 브라우저 confirm() 대신 커스텀 오버레이 모달
- "비밀번호 찾기 기능이 없습니다" 경고 + 취소/가입하기 버튼
- 배경 클릭으로 닫기 지원

### 3. 서버 선택 footer 링크
- 서버 선택 오버레이 하단에 Copyright + 개인정보/이용약관/문의하기/통계 링크
- 보라색 배경에 맞는 흰색 반투명 스타일
- 기존 footer에서 통계 링크 제거 (서버 선택에서만 접근)

### 4. 세션 복원 + 서버 선택 오버레이 처리
- diceSession 복원 시 document.body.classList.remove('server-select-active') 추가
- ServerSelectModule.hide() 호출로 오버레이 제거
- body.server-select-active CSS에서 header/footer 숨김 제거 (container만 숨김)

### 5. 방 제목에 서버 이름 태그
- joinRoom 콜백에서 [서버이름] + 방제목 형태로 표시
- roomNameUpdated 이벤트에서도 서버이름 태그 유지

### 6. 랭킹 PC 레이아웃 수정
- 헤더/탭의 max-width 제거 (전체 너비)
- 콘텐츠만 max-width: 640px로 중앙 정렬

### 7. 대기 멤버 빨간점 (serverJoined)
- socket/server.js: 호스트 입장 시 getMembers로 미승인 멤버 수 조회
- serverJoined 이벤트에 pendingCount 포함
- server-select-shared.js: pendingCount > 0이면 300ms 후 _showMembersDot() 호출

### 8. 전체 서버 통합 라벨
- 방문자/플레이 횟수 위에 "전체 서버 통합" 작은 회색 텍스트 추가

### 9. server.js 오타 수정
- line 36: 'ㅛ' 한글 오타 제거

========================================

========================================
📋 Summit Log - 2026-02-12 (서버 방 격리 + 랭킹/서버 버그 수정)
========================================

## 변경 파일 (20개)
- ranking-shared.js: 주문 탭 조건 수정, getGameTabKeys 동적 체크, PC max-width 520px
- db/ranking.js: isPrivate → serverId 기반 주문 데이터 포함 조건
- db/servers.js: is_member 쿼리에 host_name 포함
- server-select-shared.js: 기본 필터에 host_name 체크 추가
- dice-game-multiplayer.html: currentServerName 변수, 세션 복원 시 serverName/setServerId, pending 데이터에 serverName 추가(6곳), 방 목록 서버 태그, createRoom에 serverName
- js/horse-race.js: currentServerName 변수, pending 데이터에서 serverName 추출, setServerId emit, createRoom에 serverName(2곳)
- roulette-game-multiplayer.html: currentServerName 변수, pending 데이터에서 serverName 추출, setServerId emit, createRoom에 serverName(2곳)
- socket/rooms.js: 방 데이터에 serverName 추가, getRooms 서버ID 필터링, joinRoom 서버ID 체크, createRoom에서 socket.serverId 자동 설정
- socket/server.js: createServer 유효성 검사(이름 2~20자, 설명 100자, 참여코드 4~20자 영숫자), joinServer 승인제 분기(미승인→serverJoinRequested, 승인→serverJoined)
- admin.html: 체크박스 일괄 삭제 기능, FOUC 수정
- chat-shared.js: 사소한 수정
- db/stats.js: 사소한 수정
- horse-race-multiplayer.html: 사소한 수정
- routes/api.js: 사소한 수정
- routes/server.js: 서버 생성 유효성 추가
- socket/dice.js: 사소한 수정
- socket/horse.js: 사소한 수정
- statistics.html: 사소한 수정
- css/team-pastel.css: 삭제 (팀 게임 제거)
- team-game-multiplayer.html: 삭제 (팀 게임 제거)

## 상세 변경 내역

### 1. 서버 방 격리 (Server Room Isolation)
- socket/rooms.js: getRooms에서 userServerId와 room.serverId 비교, 불일치 시 필터링
- socket/rooms.js: joinRoom에서 serverId 불일치 시 '다른 서버의 방에는 입장할 수 없습니다' 에러
- socket/rooms.js: createRoom에서 room.serverName 저장, socket.serverId 자동 설정
- null === null 매칭으로 자유 플레이 사용자끼리만 방 공유

### 2. 서버 이름 방 목록 표시
- dice-game-multiplayer.html: 방 목록 렌더링에 [서버이름] 태그 추가 (보라색)

### 3. 서버 이름 새로고침 복원
- dice: sessionStorage의 diceSession에서 serverName 복원, currentServerName 변수
- horse/roulette: localStorage의 pending 데이터에서 serverName 복원
- 모든 pending 데이터(6곳)에 serverName 추가

### 4. setServerId 동기화
- dice: 세션 복원 시 socket.emit('setServerId') 호출
- horse/roulette: pending 데이터 파싱 후 socket.emit('setServerId') 호출
- 페이지 이동 시 새 소켓에 serverId가 설정되어 방 격리 정상 동작

### 5. 랭킹 수정
- ranking-shared.js line 505: data.serverType === 'private' → data.orders 존재 여부
- getGameTabKeys(): _cache.orders 존재 시에만 'orders' 탭 추가
- PC 레이아웃: @media (min-width: 768px) max-width: 520px, margin: auto

### 6. 서버 목록 호스트 표시 수정
- db/servers.js: is_member 쿼리에 s.host_name = $1 OR EXISTS(...) 추가
- server-select-shared.js: 기본 필터에 s.host_name === myName fallback

### 7. 서버 생성 유효성 검사 (서버 사이드)
- socket/server.js: 이름 2~20자 한글/영문/숫자/공백/-/_ 허용
- socket/server.js: 설명 0~100자
- socket/server.js: 참여코드 4~20자 영숫자만 (선택사항)

### 8. 참여신청 승인제
- socket/server.js: joinServer에서 신규→serverJoinRequested, 미승인 재접속→serverJoinRequested, 승인 멤버→serverJoined

### 9. 팀 게임 제거
- team-game-multiplayer.html: 전체 삭제 (1872줄)
- css/team-pastel.css: 전체 삭제 (419줄)

========================================

========================================
📋 Summit Log - 2026-02-11 (서버 선택 디자인 복원 + 기능 유지)
========================================

## 변경 파일
- server-select-shared.js: 디자인 이전 스타일로 복원 (118줄 추가, 197줄 삭제)

## 상세 변경 내역

### 디자인 복원 (사용자 피드백: "이전 UI가 더 이쁘다")
- 배경: #f8f9fb 소프트 화이트 → linear-gradient(#667eea, #764ba2) 보라 그라데이션 복원
- 컨테이너: 흰색 카드 + box-shadow: 0 20px 60px rgba(0,0,0,0.3) 복원
- 자유 플레이 버튼: 인디고 그라데이션 카드 → dashed border 버튼 복원
- 로그인 버튼: 인디고 solid → rgba(255,255,255,0.2) 반투명 복원
- 강조색: #4F46E5 → #667eea 복원
- 모달: backdrop-filter blur 제거 → rgba(0,0,0,0.5) 복원
- 서버 카드, 생성 버튼, 관리 버튼 등 모든 CSS 이전 스타일 복원

### 유지된 새 기능
- selectFree(): 이름만 있으면 바로 입장 (로그인 불필요)
- _showNameModal(): 이름 입력 간단 모달
- show()에서 _isLoggedIn() 체크하여 서버 목록 조건부 표시
- _serverSectionHTML() / _loginPromptHTML() / _updateServerSection()
- MAIN_CSS, MODAL_CSS 상수 분리 구조

========================================

========================================
📋 Summit Log - 2026-02-11 (랭킹 색상 변경 + 서버 선택 화면 리뉴얼)
========================================

## 변경 파일
- ranking-shared.js: 색상 팔레트 변경 (주황→블루/인디고), 14줄 변경
- server-select-shared.js: 전면 리라이트 (296줄 삭제, 456줄 추가)

## 상세 변경 내역

### 랭킹 색상 변경 (ranking-shared.js)
- 헤더 그라데이션: #FF6B6B→#FF8E53→#FFD93D → #667eea→#764ba2→#9B59B6 (코럴-오렌지 → 블루-퍼플)
- 탭 active: #FF6B6B→#FF8E53 → #667eea→#764ba2
- 탭 보더: rgba(255,107,107,...) → rgba(102,126,234,...)
- 섹션 제목: #FF8E53 → #8B9CF7
- 섹션 라인: rgba(255,142,83,0.3) → rgba(102,126,234,0.3)
- 이유: 사용자 피드백 "주황색 너무 별로다"

### 서버 선택 화면 전면 리뉴얼 (server-select-shared.js) — 이후 디자인 복원됨
- 모던/미니멀 디자인 적용 (이후 보라색 그라데이션으로 복원)
- 자유 플레이 로직 변경 (유지됨)
- 서버 목록 로그인 제한 (유지됨)

========================================

========================================
📋 Summit Log - 2026-02-11 (랭킹 UI 다크 게임 테마 리디자인)
========================================

## 변경 파일
- ranking-shared.js: 전면 리라이트 (184줄 삭제, 542줄 추가 = 742줄)

## 상세 변경 내역

### 디자인 시스템 전면 교체
- 배경: #f5f6fa (밝은 회색) → #1a1a2e (다크 네이비)
- 헤더: #667eea→#764ba2 보라 → #FF6B6B→#FF8E53→#FFD93D 코럴-오렌지-옐로우
- 카드: 흰색 배경 → 글래스모피즘 (rgba(255,255,255,0.06) + backdrop-filter blur)
- 값 텍스트: #667eea → #FFD700 (골드)
- 섹션 제목: #888 → #FF8E53 (오렌지) + 우측 그라데이션 라인
- 폰트: 헤더/탭/섹션에 'Jua' 웹폰트 적용

### 탭 구조 변경 (5탭 → 2탭 + 서브칩)
- 기존: [종합] [주사위] [경마] [룰렛] [주문*] (5개 플랫 탭)
- 변경: [🏆 종합] [🎮 게임별] 메인 2탭
- 게임별 선택 시 하단 서브 칩: [🎲 주사위] [🐎 경마] [🎰 룰렛] [🍜 주문*]
- 각 게임 칩에 고유 색상 (#667eea, #e67e22, #7c4dff, #e91e63)
- 상태 변수: _currentMainTab, _currentGameTab

### 메달 뱃지 (이모지 → CSS)
- 1등: .rk-gold - 금색 그라데이션 + 글로우 펄스 애니메이션 (rkPulseGold 2.5s)
- 2등: .rk-silver - 은색 그라데이션
- 3등: .rk-bronze - 동색 그라데이션
- 4등+: .rk-rank-num - 반투명 원형 숫자

### 스켈레톤 로딩
- 기존 스피너 → skeletonHTML() 함수: 카드 형태 플레이스홀더
- .rk-skeleton-circle + .rk-skeleton-bar + rkShimmer 애니메이션

### 콘텐츠 전환 애니메이션
- setContentWithTransition(): fadeOut(150ms) → innerHTML 교체 → fadeIn + translateY
- 섹션별 rkFadeInUp 애니메이션 (staggered: 0.05s 간격)

### 모바일 제스처
- setupGestures(): 좌우 스와이프로 탭 전환
  - 조건: 수평 > 60px && 수평 > 수직 * 1.5 (스크롤 충돌 방지)
  - 종합 ← → 게임별 메인탭 전환
  - 게임별 내 서브탭 간 이동
- setupPullToRefresh(): 당겨서 새로고침
  - 최상단에서 80px 이상 당기면 캐시 무효화 + 재로드
  - "↓ 당겨서 새로고침" / "↑ 놓으면 새로고침" 인디케이터

### 기존 인터페이스 유지
- RankingModule.init(serverId, userName) - 변경 없음
- RankingModule.show() - 변경 없음
- RankingModule.hide() - 변경 없음
- RankingModule.invalidateCache() - 변경 없음
- 백엔드(db/ranking.js) API 응답 형식 변경 없음

========================================

========================================
📋 Summit Log - 2026-02-11 (랭킹 고도화 + 서버 목록 자동갱신)
========================================

## 변경 파일
- db/init.js: server_game_records에 game_rank 컬럼 추가
- db/ranking.js: 종합 랭킹에 avgRank 추가, 경마 탈것 등수 분포 테이블 쿼리
- db/servers.js: recordServerGame()에 gameRank 파라미터 추가
- socket/dice.js: determineDiceWinner→determineDiceRanks 리팩토링 (등수 판별, 동점 처리)
- socket/horse.js: recordServerGame에 rank 전달
- socket/server.js: io.emit('serversList')→io.emit('serversUpdated') 변경
- server-select-shared.js: serversUpdated 이벤트 핸들러 추가, 새로고침 버튼 제거
- ranking-shared.js: UI 전면 개편 (인라인 스타일→CSS 클래스, 탭, 탈것 테이블, 페이드 애니메이션)
- 4개 게임 HTML: 랭킹 버튼 스타일 변경 (핑크 그라데이션→게임별 아웃라인)

## 상세 변경 내역

### DB 스키마 변경
- server_game_records에 game_rank INTEGER 컬럼 추가 (ALTER TABLE, duplicate_column 예외 처리)

### 주사위 등수 판별 시스템 (socket/dice.js)
- determineDiceWinner() 삭제 → determineDiceRanks() 신규
- 전체 참가자 등수를 판별 (단순 승자 1명 → 전체 순위)
- 동점자 동일 등수 처리 (i > 0 && sorted[i].result !== sorted[i-1].result → rank = i + 1)
- gameRules에서 낮/작/최소/로우/low → 오름차순, 그 외 → 내림차순
- 2곳(수동 endGame + 자동 endGame)에 동일 적용

### 종합 랭킹 평균 등수 추가 (db/ranking.js)
- getOverallRanking CTE에 AVG(game_rank) + COUNT(game_rank <= 3) 추가
- avgRank 배열: 평균 등수 오름차순 정렬, TOP3 횟수 포함
- fallback: avgRank: [] 추가

### 경마 탈것 등수 분포 (db/ranking.js)
- 기존: popularHorse/worstHorse (1등/6등 최다 탈것 1마리씩)
- 변경: vehicles 배열 (전체 탈것의 1~6등 분포 테이블)
- 쿼리: rank_1~rank_6 전부 SELECT, ORDER BY rank_1 DESC
- UI: ranking-shared.js에 rk-vehicle-table HTML 테이블 렌더링

### 서버 목록 자동 갱신 (socket/server.js + server-select-shared.js)
- socket/server.js: 서버 생성 시 io.emit('serversUpdated') (기존: io.emit('serversList', servers))
- 이유: 각 클라이언트가 자기 userName으로 재조회해야 is_member 정렬이 정확함
- server-select-shared.js: 'serversUpdated' 이벤트에서 _emitGetServers() 호출
- 새로고침 버튼 CSS(.ss-refresh-btn) + HTML 제거

### 랭킹 UI 개편 (ranking-shared.js)
- 인라인 스타일 → <style> 블록 + CSS 클래스 방식으로 전환
- 오버레이 페이드인 애니메이션 (opacity 0→1, .rk-visible)
- hide() 시 페이드아웃 + 200ms 후 DOM 제거
- 탭 바: .rk-tab 클래스, active 시 #667eea 배경 + 글로우 그림자
- 카드: .rk-card (border-radius: 14px, 미세 그림자)
- 행: .rk-row (호버 효과, 메달 이모지 1~3등)
- 경마: rk-vehicle-table (1등 금색/6등 빨간색 강조)
- 로딩: 스피너 애니메이션 (rk-spinner, rkSpin)

### 랭킹 버튼 디자인 통일 (4개 게임 HTML)
- 기존: background: linear-gradient(#f093fb, #f5576c), 🏆 아이콘
- 변경: background: white, border: 2px solid [게임색상], 아이콘 제거
- 주사위/팀: #667eea, 경마: #8b4513, 룰렛: #7c4dff

========================================

========================================
📋 Summit Log - 2026-02-11 (서버별 랭킹 시스템)
========================================

## 변경 파일
- db/init.js: order_stats 테이블 CREATE 추가
- db/ranking.js (신규): 랭킹 쿼리 함수 + 주문 기록 UPSERT
- ranking-shared.js (신규): 풀스크린 랭킹 UI 오버레이 모듈
- socket/rooms.js: room.isPrivateServer 캐시 설정
- socket/dice.js: 비공개서버 주사위 승자 판별 (determineDiceWinner)
- socket/horse.js: 비공개서버 경마 결과 DB 기록 (server_game_records + game_sessions)
- socket/shared.js: 비공개서버 주문 시 order_stats UPSERT
- routes/server.js: GET /api/ranking/:serverId, /api/ranking/free 엔드포인트
- dice-game-multiplayer.html: 랭킹 버튼 + script + RankingModule.init
- horse-race-multiplayer.html: 랭킹 버튼 + script
- js/horse-race.js: RankingModule.init 호출 추가
- roulette-game-multiplayer.html: 랭킹 버튼 + script + RankingModule.init
- team-game-multiplayer.html: 랭킹 버튼 + script + RankingModule.init

## 상세 변경 내역

### DB 스키마
- order_stats 테이블 신규 (server_id NOT NULL DEFAULT 0, UNIQUE(server_id, user_name, menu_text))
- server_id=0은 자유 플레이 (NULL-safe UPSERT 보장)

### 공개/비공개 서버 분기 저장
- room.isPrivateServer: 방 생성 시 1회 DB 조회 후 캐시 (getServerById → password_hash 확인)
- 공개서버: 기존 동작 그대로 유지 (주사위 is_winner=false, 경마 기록 없음)
- 비공개서버만 추가 기록:
  - 주사위: determineDiceWinner()로 승자 판별 → is_winner=true
  - 경마: recordServerGame() + recordGameSession() 호출 추가 (2곳: raceAnimationComplete, selectHorse)
  - 주문: order_stats UPSERT (recordOrder 함수)

### 주사위 승자 판별 로직
- gameRules에서 "낮/작/최소/로우/low" → lowest wins
- 그 외 → highest wins (기본)
- 동점 시 먼저 굴린 사람 우선 (배열 순서)

### 랭킹 쿼리 (db/ranking.js)
- getOverallRanking: CTE 기반 단일 쿼리 (games, wins, win_rate)
- getGameRanking: 게임타입별 승수/참여수
- getHorseRaceStats: vehicle_stats에서 인기말/꼴등말
- getOrderRanking: 최다 주문자, 인기 메뉴
- getMyTopOrders: 개인 TOP 3 메뉴
- getFullRanking: 전체 데이터 조합 (serverType 포함)

### 랭킹 API
- GET /api/ranking/free (자유 플레이, 먼저 등록)
- GET /api/ranking/:serverId(\\d+) (정규식으로 숫자만 매칭 → 충돌 방지)
- 응답에 serverType: "public"|"private" 포함
- 비공개서버만 orders 필드 포함 (공개서버는 null)

### 랭킹 UI (ranking-shared.js)
- RankingModule IIFE 패턴 (ServerSelectModule과 동일)
- 10초 TTL 인메모리 캐시 + invalidateCache()
- 풀스크린 오버레이 (fixed, inset:0, z-index:9999)
- serverType에 따라 탭 동적 구성 (공개: 4탭, 비공개: 5탭)
- 메달 이모지 (1등🥇, 2등🥈, 3등🥉)

### 로비 버튼
- 4개 게임 HTML에 "🏆 랭킹" 버튼 추가
- ranking-shared.js script 태그 추가
- ServerSelectModule.init 콜백에서 RankingModule.init 호출

========================================

========================================
📋 Summit Log - 2026-02-11 (서버 참여코드 도입)
========================================

## 변경 파일
- db/servers.js: joinServer() 로직 순서 변경 + 에러 메시지 변경
- server-select-shared.js: 멤버 판별 후 참여코드 모달 스킵 + UI 텍스트 변경

## 상세 변경 내역

### 서버 참여코드 (비밀번호 → 참여코드)
- 개념 변경: "비밀번호" → "참여코드" (처음 가입 시에만 필요)
- db/servers.js joinServer(): 멤버 체크를 비밀번호 체크보다 먼저 실행
  - 이미 멤버 → 코드 없이 바로 입장 (last_seen 업데이트만)
  - 새 가입 → 참여코드 확인 후 멤버 등록
- 에러 메시지: "비밀번호가 일치하지 않습니다" → "참여코드가 일치하지 않습니다"
- bcrypt 경고: "서버 비밀번호가 평문 저장" → "서버 참여코드가 평문 저장"

### 클라이언트 UI 변경 (server-select-shared.js)
- renderServerList(): onclick에 is_member 플래그 전달
- selectServer(): isPrivate && !isMember일 때만 참여코드 모달 표시
  - 멤버면 바로 _selectServer() 호출 (모달 스킵)
- 서버 생성 모달: "비밀번호 *" → "참여코드 *", placeholder "서버 비밀번호 (필수)" → "서버 참여코드 (필수)"
- 입장 모달: placeholder "비밀번호 입력" → "참여코드 입력"
- 에러 텍스트: "비밀번호를 입력하세요" → "참여코드를 입력하세요"
- 참여코드 input type: password → text (코드를 보이게)

========================================

========================================
📋 Summit Log - 2026-02-11 (이름 입력 숨기기 + 서버 목록 복귀 버튼)
========================================

## 변경 파일
- dice-game-multiplayer.html: 로비 이름 입력 숨김 + serverInfoBar에 서버 목록 복귀 버튼 추가
- horse-race-multiplayer.html: 로비/방 생성 이름 입력 숨김 + serverInfoBar에 서버 목록 복귀 버튼 추가
- roulette-game-multiplayer.html: 로비/방 생성 이름 입력 숨김 + serverInfoBar에 서버 목록 복귀 버튼 추가
- team-game-multiplayer.html: 닉네임 입력 숨김 + serverInfoBar에 서버 목록 복귀 버튼 추가
- js/horse-race.js: ServerSelectModule onSelect 콜백 수정 (infoBar 항상 표시)

## 상세 변경 내역

### 이름 입력 필드 숨기기
- 로그인 시 _saveName()이 이미 모든 입력 필드에 값을 설정하므로 사용자가 직접 입력할 필요 없음
- dice: globalUserNameInput의 input-group에 display:none 추가
- horse-race: globalUserNameInput 섹션 숨김 + createRoomHostNameInput 섹션 숨김
- roulette: globalUserNameInput 섹션 숨김 + createRoomHostNameInput 섹션 숨김
- team: nickname-input 섹션 숨김
- input 엘리먼트는 DOM에 유지 (기존 코드에서 읽기 때문)

### 서버 목록 복귀 버튼
- 4개 게임의 serverInfoBar에 "← 서버 목록" 버튼 추가 (ServerSelectModule.show() 호출)
- serverInfoBar를 항상 display:flex로 표시 (자유 플레이에서도 복귀 가능)
- 자유 플레이 모드: serverInfoName, serverMembersBtn 숨김 (서버 관련 UI 불필요)
- 서버 모드: serverInfoName, serverMembersBtn 표시
- 멤버 버튼에 id="serverMembersBtn" 추가하여 JS에서 제어 가능

========================================

========================================
📋 Summit Log - 2026-02-11 (서버 이름 중복체크 + 새로고침 버튼 + 멤버 모달 CSS 수정)
========================================

## 변경 파일
- db/servers.js: createServer에 서버 이름 중복 체크 추가
- server-select-shared.js: 새로고침 버튼 디자인 개선, 모달 CSS를 head로 분리

## 상세 변경 내역

### [서버 이름 중복 체크]
- createServer()에 SELECT 쿼리로 동일 이름 서버 존재 여부 확인
- 중복 시 '이미 같은 이름의 서버가 있습니다.' 에러 반환

### [새로고침 버튼 디자인 개선]
- 기존: 🔄 이모지 (font-size: 0.7em, 배경 없음)
- 변경: ↻ 새로고침 텍스트 버튼 (.ss-refresh-btn), 보라색 테마, hover/active 효과

### [모달 CSS head 분리]
- 문제: 모달 CSS가 오버레이 <style> 안에 있어서, 서버 입장 후 오버레이 remove() 시 CSS도 사라짐
- 로비에서 멤버보기 클릭 시 스타일 없이 하단에 텍스트로 표시되는 버그
- 해결: init()에서 <head>에 'ss-modal-styles' id로 CSS 한 번 주입
- 대상: ss-members-modal, ss-myserver-modal, ss-error-modal, ss-joining-overlay, ss-pw-modal 및 관련 하위 클래스
- 오버레이 <style>에서 중복 CSS 제거 (ssShake 포함)

========================================

========================================
📋 Summit Log - 2026-02-10 (관리자 로그인 개선)
========================================

## 변경 파일
- utils/auth.js: ADMIN_ID/ADMIN_PASSWORD fallback 기본값 제거 (환경변수 필수)
- routes/server.js: /auth/login에서 관리자 인증 우선 체크, adminToken 반환
- server-select-shared.js: 로그인 응답에 adminToken 있으면 /admin으로 리다이렉트

## 상세 변경 내역

### [관리자 인증 fallback 제거]
- `|| 'admin'`, `|| '0000'` 제거 → 환경변수 미설정 시 로그인 불가
- 실서버에서 기본값으로 인한 인증 실패 방지

### [일반 로그인에서 관리자 인증]
- POST /api/auth/login: DB 유저 체크 전에 generateAdminToken(name, pin) 먼저 시도
- 관리자 인증 성공 시 { user: { name, isAdmin: true }, adminToken } 반환
- 클라이언트: adminToken 존재 시 sessionStorage 저장 후 /admin으로 이동

========================================

========================================
📋 Summit Log - 2026-02-10 (관리자 페이지)
========================================

## 변경 파일
- utils/auth.js: ADMIN_ID 환경변수 추가, generateAdminToken(id, password) 시그니처 변경
- routes/server.js: /admin/verify에 id 파라미터 추가, GET /admin/users, DELETE /admin/users/:id 추가
- routes/api.js: GET /admin 라우트 추가
- admin.html: ID+PW 로그인으로 변경, 유저 관리 섹션 추가 (목록/삭제), 로그아웃, sessionStorage 토큰 유지

## 상세 변경 내역

### [관리자 인증 개선]
- ADMIN_ID 환경변수 추가 (기본값: 'admin')
- generateAdminToken(id, password): ID+PW 둘 다 검증
- /api/admin/verify: body에 { id, password } 전송

### [유저 관리 API]
- GET /api/admin/users: adminAuth 미들웨어, users 테이블 전체 목록
- DELETE /api/admin/users/:id: 유저 삭제 + server_members에서 해당 유저 멤버십 제거

### [관리자 페이지 UI]
- ID+PW 입력 → 로그인 → sessionStorage에 토큰 저장
- 대시보드: 서버 수, 활성 서버 수, 유저 수 통계
- 서버 관리: 테이블 (ID, 이름, 호스트, 멤버, 상태, 생성일, 멤버보기/삭제)
- 유저 관리: 테이블 (ID, 이름, 관리자, 가입일, 마지막 로그인, 삭제)
- 로그아웃 버튼

========================================

========================================
📋 Summit Log - 2026-02-10 (서버 참여 제한 + 내 서버 관리)
========================================

## 변경 파일
- db/servers.js: getMyServers(), getUserJoinedCount() 추가, joinServer 5개 제한
- routes/server.js: GET /api/my-servers, DELETE /api/my-servers/:id 추가
- server-select-shared.js: 내 서버 관리 모달 UI (목록/멤버관리/삭제)

## 상세 변경 내역

### [서버 참여 5개 제한]
- getUserJoinedCount(userName): approved 멤버 수 카운트
- joinServer(): 기존 멤버 재입장은 제한 없음, 신규 가입만 5개 체크
- 초과 시 에러: "서버는 최대 5개까지 참여할 수 있습니다."

### [내 서버 관리 API]
- GET /api/my-servers?userName= → host_name으로 필터링된 서버 목록
- DELETE /api/my-servers/:id → host_name 검증 후 삭제 + serverDeleted 소켓 이벤트

### [내 서버 관리 UI]
- showMyServersModal(): 로그인 필수, fetch로 내 서버 목록 로드
- 서버별: 멤버 수 표시, [멤버 관리] [서버 삭제] 버튼
- showServerMembersManage(): 기존 showMembersModal 재사용 (임시 _currentServer 설정)
- deleteMyServer(): confirm 확인 → DELETE API → 토스트 + 서버목록 갱신
- CSS: .ss-myserver-modal, .ss-myserver-box, .ss-manage-btn

========================================

========================================
📋 Summit Log - 2026-02-10 (서버 입장 UX 개선)
========================================

## 변경 파일
- server-select-shared.js: 서버 입장 로딩 오버레이 + 디바운스 + 타임아웃 + 에러 모달 + 성공 토스트

## 상세 변경 내역

### [서버 입장 UX 개선 - 3인 회의 결과 구현]
- _isJoining 디바운스 플래그 + _joiningTimeout 변수 추가
- _showJoiningOverlay(serverName): 전체화면 스피너 + "서버명 입장 중..." + 취소 버튼
- _clearJoining(): 플래그 초기화 + 타임아웃 클리어 + 오버레이 제거
- cancelJoining(): 외부 호출용 취소 함수 (export)
- _showErrorModal(msg): 중앙 에러 모달 (ssShake 애니메이션 재사용)
- _selectServer(): 디바운스 체크 + 오버레이 표시 + 10초 타임아웃
- showPasswordModal > confirmPw(): 동일 플로우 적용
- serverJoined 핸들러: _clearJoining() + 성공 토스트
- serverError 핸들러: _clearJoining() + 에러 모달 (기존 텍스트 에러 대체)
- CSS: .ss-joining-overlay, .ss-spinner(@keyframes ssSpin), .ss-error-modal, .ss-error-box

========================================

========================================
📋 Summit Log - 2026-02-10 (로그인 시스템 + 방 필터링 + 서버 정렬)
========================================

## 변경 파일
- db/auth.js: [신규] 유저 인증 함수 (register, login, bcrypt 해싱)
- db/init.js: users 테이블 추가 (name, pin_hash, is_admin)
- db/servers.js: host_code 제거, getServers에 userName 파라미터 추가 (is_member 정렬)
- routes/server.js: /api/auth/register, /api/auth/login 엔드포인트 추가
- server-select-shared.js: 로그인/회원가입 모달 분리, _authModal 공통화, 토스트 알림, 새로고침
- socket/index.js: 방 목록 필터링 (비공개방 서버멤버만, 공개방 10개 제한)
- socket/rooms.js: getRooms 이벤트에 동일 필터 적용
- socket/server.js: getServers에 userName 전달, hostCode 응답 제거

## 상세 변경 내역

### [유저 인증 시스템] (db/auth.js, db/init.js, routes/server.js)
- users 테이블: name(UNIQUE), pin_hash, is_admin, last_login_at
- register(): 이름 중복 체크 + PIN 4~6자리 검증 + bcrypt 해싱
- login(): 이름으로 조회 + PIN 비교 + last_login_at 업데이트
- POST /api/auth/register, POST /api/auth/login 엔드포인트

### [로그인/회원가입 UI 분리] (server-select-shared.js)
- _authModal(): 공통 모달 헬퍼 (title, confirmText, apiUrl, onSuccess)
- showLoginModal(): 로그인 전용 모달
- showRegisterModal(): 회원가입 전용 모달
- 상단바: 비로그인시 [로그인][회원가입], 로그인시 [👤이름][로그아웃]
- _updateLoginBtn(): 회원가입/로그아웃 버튼 동적 토글
- _isLoggedIn(): localStorage.userAuth 체크
- _showToast(): 성공 알림 팝업 (2초 자동 사라짐)
- 로그인/로그아웃/새로고침 시 getServers + getRooms 동시 갱신

### [방 목록 필터링] (socket/index.js, socket/rooms.js)
- filterRoomsForSocket(): 소켓별 필터링 함수
- 비공개방(isPrivate): socket.serverId === room.serverId인 경우만 표시
- 공개방: PUBLIC_ROOMS_LIMIT(10)개 제한
- broadcastFilteredRooms(): io.emit 대신 소켓별 개별 emit
- getRooms 이벤트에도 동일 필터 적용

### [서버 목록 정렬] (db/servers.js, socket/server.js)
- getServers({ userName }): userName이 있으면 is_member 여부 조회
- ORDER BY is_member DESC: 가입한 서버 상단 정렬
- getServers 소켓에서 socket.serverUserName 또는 data.userName 전달
- 클라이언트: _emitGetServers() 헬퍼로 userName 포함 emit

### [host_code 제거]
- db/servers.js: generateHostCode(), crypto import 제거
- createServer SQL에서 host_code 컬럼 제거
- socket/server.js: serverCreated 응답에서 hostCode 제거
- server-select-shared.js: 호스트코드 알림 팝업 제거

### [localStorage 키 동기화 수정]
- _saveName(): diceGameUserName, createRoomHostNameInput 추가
- logout(): diceGameUserName 제거 추가
- _getUserName(): diceGameUserName 폴백 체인 추가

========================================

========================================
📋 Summit Log - 2026-02-09 (로그인 UI 외부 배치 + 로그아웃)
========================================

## 변경 파일
- server-select-shared.js: 로그인/로그아웃 버튼 컨테이너 바깥 이동 + 로그아웃 기능 + UI 심플화

## 상세 변경 내역

### [로그인 UI 외부 배치] (server-select-shared.js)
- 로그인 버튼을 .ss-container(흰색 박스) 안에서 바깥(그라데이션 배경)으로 이동
- #serverSelectOverlay에 flex-direction: column + gap: 12px 추가
- .ss-top-bar 래퍼 추가: 로그인 버튼 + 로그아웃 버튼 그룹
- 버튼 스타일: border 제거, 반투명 배경(rgba 0.2), 작은 폰트/패딩으로 심플화
- 로그아웃 버튼: 배경 없음, 연한 흰색 텍스트만

### [로그아웃 기능] (server-select-shared.js)
- logout() 함수 추가: localStorage 5개 키 전부 삭제 + 페이지 내 input 초기화
- _updateLoginBtn()에 로그아웃 버튼 동적 토글 로직 추가
- exports에 logout 추가

========================================

========================================
📋 Summit Log - 2026-02-09 (서버 기능 전체 포팅 + 로그인 UI 개선)
========================================

## 변경 파일
- server-select-shared.js: 로그인 UI 모달 방식 전환 + 멤버 관리 모달 + 서버 검색 + fetch URL 버그 수정
- socket/server.js: getSocketIdByUser() 함수 추가
- socket/dice.js: 게임 종료 시 세션 기록 호출 (수동/자동 2곳)
- socket/roulette.js: 룰렛 결과 처리 시 세션 기록 호출
- routes/server.js: 승인/거절/강퇴 시 실시간 소켓 알림 emit
- server.js: app.set('io', io) 추가 (routes에서 io 접근용)
- db/init.js: game_sessions 테이블 + server_game_records ALTER TABLE
- db/servers.js: recordGameSession(), generateSessionId() 추가
- dice-game-multiplayer.html: 서버 정보 바 + 멤버 목록 버튼
- roulette-game-multiplayer.html: 서버 정보 바 + 멤버 목록 버튼
- horse-race-multiplayer.html: 서버 정보 바 + 멤버 목록 버튼
- js/horse-race.js: onSelect 콜백에 서버 정보 바 표시
- team-game-multiplayer.html: 서버 정보 바 + 멤버 목록 버튼
- docs/GameGuide/01-plan/features/pending/server-concept.plan.md: 구현 상태 전체 완료 업데이트
- update-log.txt: 업데이트 로그 추가
- summit-log.txt: 서밋 로그 추가

## 상세 변경 내역

### [로그인 UI 모달 방식 전환] (server-select-shared.js)
- 기존: 서버 선택 화면에 이름 입력란이 항상 노출 (ss-login-area)
- 변경: 헤더 아래 로그인 버튼만 표시 (이름 있으면 "👤 이름", 없으면 "🔑 로그인")
- showLoginModal(): 클릭 시 이름 입력 모달 표시
- _requireNameThen(callback): 이름 없으면 모달로 입력 받고 콜백 실행
- selectFree(), _selectServer(), showPasswordModal(), doCreate() 모두 _requireNameThen 패턴으로 변경
- _saveName(): localStorage 5개 키 동기화 + 페이지 내 input 반영 + 로그인 버튼 갱신
- showNamePrompt() 유틸 함수 제거 (_requireNameThen으로 대체)

### [멤버 관리 모달] (server-select-shared.js)
- showMembersModal(): 멤버 목록 모달 + 5초 자동 갱신
- _fetchMembers(): GET /api/server/:id/members 호출
- _renderMembers(): 온라인/오프라인 점 + HOST/대기중 뱃지 + 승인/거절/강퇴 버튼
- approveMember(), kickMember(): POST/DELETE API 호출

### [fetch URL 버그 수정] (server-select-shared.js)
- _fetchMembers, approveMember, kickMember 3곳 /server/ → /api/server/ 수정
- m.is_online → m.isOnline 프로퍼티명 수정 (API 응답 camelCase 매칭)

### [실시간 소켓 알림] (routes/server.js + socket/server.js)
- routes/server.js: approve 엔드포인트에서 req.app.get('io')로 io 접근
- serverApproved/serverRejected: 대상 유저 소켓에 직접 emit
- serverKicked: 강퇴 전 소켓ID 확보 → 삭제 후 emit
- memberUpdated: 서버 룸 전체에 브로드캐스트
- socket/server.js: getSocketIdByUser() export 추가

### [게임 세션 추적] (db/init.js + db/servers.js + socket/dice.js + socket/roulette.js)
- game_sessions 테이블: server_id, session_id, game_type, game_rules, winner, participant_count
- server_game_records: range_min, range_max, game_rules 컬럼 ALTER TABLE 추가
- generateSessionId(): ${gameType}_${serverId}_${Date.now()}
- recordGameSession(): game_sessions INSERT
- socket/dice.js: endGame + 자동종료 2곳에서 세션 + 개별 기록 저장
- socket/roulette.js: rouletteResult에서 세션 + 개별 기록 저장

### [게임 로비 서버 정보 바] (4개 게임 HTML + js/horse-race.js)
- 서버 입장 시 로비 상단에 서버명 + 멤버 목록 버튼 표시
- 게임별 테마 색상 적용 (#667eea/dice, #7c4dff/roulette, #8b4513/horse, #667eea/team)

========================================

========================================
📋 Summit Log - 2026-02-09 (카메라 시스템 정밀 개선)
========================================

## 변경 파일
- js/horse-race.js: 카메라 시스템 6건 개선 + 버그 수정 4건 + Dead Code 정리 4건
- docs/meeting/multi/2026-02-08-camera-precision.md: 3인 멀티에이전트 회의록 (신규)
- docs/GameGuide/01-plan/features/applied/mobile-race-viewport.plan.md: pending→applied 이동
- update-log.txt: 업데이트 로그 추가
- summit-log.txt: 서밋 로그 추가

## 상세 변경 내역

### [꼴등 카메라 타겟 버그 수정]
- 기존: 전체 6마리 중 꼴등을 추적 → 베팅 안 된 말도 추적
- 수정: bettedIndices 필터 적용, 베팅된 말 기준 꼴등 추적
- 영향: 패닝 타겟(line 2279), 꼴등 추적 모드(line 2349)

### [꼴등 슬로우모션 미발동 버그 수정]
- 원인: !slowMotionActive 가드가 리더 슬로우 중 꼴등 체크를 차단
- 수정1: 가드 제거 → 리더 슬로우 중에도 꼴등 슬로우 감지 가능
- 수정2: 꼴등 발동 시 slowMotionActive=false로 리더 슬로우 취소
- 수정3: 비네트 remove() → opacity:'0'으로 변경 (재사용 위해 DOM 유지)

### [사운드 충돌 버그 수정] (40건 검증에서 발견)
- 원인: 리더/꼴등 슬로우가 같은 프레임에 발동 시, 리더 fadeout interval이 꼴등 환호성까지 삭제
- 수정: leaderCheerFadeInterval 변수로 interval ID 보관
- 꼴등 발동 시 clearInterval + 볼륨 0.9 복원

### [비네트 색상 미갱신 버그 수정] (40건 검증에서 발견)
- 원인: remove()→opacity:'0' 변경으로, 리더 비네트(검정)가 DOM에 남아 꼴등(빨강) 미적용
- 수정: 꼴등 발동 시 vignette.style.boxShadow 강제 갱신 (빨간색)

### [적응형 Lerp Speed]
- 기존: 고정 lerpSpeed 0.08
- 변경: 거리 기반 4단계 (< 50px: 0.05, < 200px: 0.10, < 500px: 0.20, else: 0.35)
- 효과: 가까우면 부드럽게, 멀면 빠르게 추격

### [경기 상황 인식 컷어웨이]
- getCutawayDuration(): 접전(1.5초), 독주(4초), 기본(3초) 분기
- selectRandomCutawayTarget(): 순위별 가중치 선택 (2위 30%, 3위 25%...)
- 결승 50m 전: cutawayDisabled=true → 컷어웨이 완전 비활성화

### [결승선 도착 연출 강화]
- PAN_DELAY 500ms → 800ms 하드코딩 (여유로운 1등 포커스)
- 접전 중간점 추적: 꼴등 후보 2마리 gap < 80px → midPos 카메라

### [카메라 모드 전환 시각 피드백]
- showCameraModeOverlay(): 트랙 상단 중앙에 모드명 오버레이 (2초 후 fadeout)
- updateCameraBtnUI(): prevCameraMode 추적 → 변경 시 오버레이 트리거
- 버튼 바운스: scale(1.1) → 150ms → scale(1)

### [Dead Code 정리]
- updateTrackScroll() 함수 삭제 (미사용)
- [모바일디버그] console.log 삭제
- PAN_DELAY 상수 삭제 (800 하드코딩으로 대체)
- gapM 변수 삭제 (계산만 하고 미사용)

## 검증 내역
- 40건 코드 정밀 검증 수행 (20건 + 20건 추가)
- 버그 2건 발견 및 수정 (사운드 충돌, 비네트 색상)
- Dead Code 2건 발견 및 정리 (PAN_DELAY, gapM)

========================================
📋 Summit Log - 2026-02-08
========================================

## 변경 파일
- dice-game-multiplayer.html: 게임 타입 선택 시각적 강조 스타일 변경 (솔리드→틴트)
- team-game-multiplayer.html: 파스텔 UI 토글 + 탭 내비게이션 추가
- css/team-pastel.css: 팀 배정 파스텔 테마 CSS (신규)
- update-log.txt: 업데이트 로그 추가
- summit-log.txt: 서밋 로그 추가

## 상세 변경 내역

### [게임 타입 선택 스타일 개선] (dice-game-multiplayer.html:1429-1453)
- 기존: 선택된 게임 타입에 솔리드 컬러 배경 + 흰 글씨 → 눈이 아픔
- 변경: 연한 틴트 배경(${color}12) + 두꺼운 테두리(2.5px) + 은은한 그림자
- 미선택 항목: 회색 테두리(#e0e0e0, 1px)로 변경 (기존: 각 타입 색상 테두리)
- 텍스트 색상: 기존 색상 유지 (흰색으로 바뀌지 않음)

### [팀 배정 파스텔 UI] (team-game-multiplayer.html)
- 🎨 ON/OFF 토글 버튼 추가 (connection-sound-row)
- 호스트 컨트롤에 탭 내비게이션 추가 (플레이어/팀 구성/제약조건)
- 3개 패널에 id 부여 (panel-players, panel-teams, panel-restrictions)
- Pastel Forest UI 토글 JS: localStorage 저장, body.pastel-ui 클래스 토글
- 탭 클릭 시 해당 패널만 표시 (pastelOn일 때만)
- Jua + Gaegu 폰트 로드, /css/team-pastel.css 링크 추가

### [팀 파스텔 CSS] (css/team-pastel.css, 신규)
- body.pastel-ui 클래스 기반 파스텔 테마 스타일시트

========================================
📋 Summit Log - 2026-02-06 (2차)
========================================

## 변경 파일
- assets/sounds/sound-manager.js: playSound/playLoop 음소거 처리 변경
- dice-game-multiplayer.html: 볼륨 UI 체크박스 → 버튼+슬라이더
- roulette-game-multiplayer.html: 볼륨 UI 체크박스 → 버튼+슬라이더
- socket/horse.js: 중복 선택 검증 로직 제거, canSelectDuplicate=true
- socket/rooms.js: canSelectDuplicate=true (4곳)

## 상세 변경 내역

### [SoundManager 음소거 처리 개선]
- sound-manager.js:73-87 playSound(): enabled=false여도 볼륨 0으로 재생
- sound-manager.js:96-124 playLoop(): 동일하게 볼륨 0으로 재생
- 목적: 음소거 상태에서 BGM 시작 → 음소거 해제 시 즉시 들리도록

### [주사위 게임 볼륨 UI 변경]
- dice-game-multiplayer.html:1418-1424: 체크박스 → 버튼+슬라이더 HTML
- CSS: .volume-control, .volume-btn, .volume-slider 스타일 추가
- JS: diceMasterVolume, toggleDiceMute(), setDiceMasterVolume() 함수 추가
- SoundManager.setMasterVolumeGetter(getDiceMasterVolume) 등록

### [룰렛 게임 볼륨 UI 변경]
- roulette-game-multiplayer.html:927-933: 체크박스 → 버튼+슬라이더 HTML
- CSS: 볼륨 컨트롤 스타일 추가 (슬라이더 색상 #7c4dff)
- JS: rouletteMasterVolume, RouletteSound의 gain에 볼륨 곱셈 적용
- playTick(), playStopRumble(), playWinner()에 getRouletteMasterVolume() 반영

### [경마 중복 선택 항상 허용]
- socket/horse.js:526-537: 중복 선택 검증 if문 제거
- socket/horse.js:533,823: canSelectDuplicate = true
- socket/rooms.js:395,605,825,990: canSelectDuplicate = true (4곳)
- 효과: 말 수와 사람 수 상관없이 같은 말 여러 명 선택 가능

========================================

========================================
📋 Summit Log - 2026-02-06
========================================

## 변경 파일
- socket/horse.js: 준비 상태 체크, 선택 초기화 순서 수정, 비동기 이벤트 순서 버그 수정
- socket/shared.js: 준비 취소 시 말 선택 취소 로직 추가
- js/horse-race.js: 랜덤 선택 버튼, 점프 기능, 춤 애니메이션, 클라이언트 이벤트 핸들러
- css/horse-race.css: 점프/춤 애니메이션 keyframes 추가

## 상세 변경 내역

### [준비 상태 기반 선택 제어]
- socket/horse.js:479: selectHorse 핸들러에 readyUsers 체크 추가
  - 준비 안 된 유저가 말 선택 시 '먼저 준비를 해주세요!' 에러 반환
- socket/shared.js:266-274: toggleReady 핸들러에 말 선택 취소 로직 추가
  - 준비 취소 시 userHorseBets에서 해당 유저 삭제
  - 'horseSelectionCancelled' 이벤트 emit
- js/horse-race.js: horseSelectionCancelled 이벤트 핸들러 추가
  - selectedUsersFromServer, userHorseBets 동기화

### [랜덤 선택 버튼]
- js/horse-race.js:880-930: renderHorseSelection()에 랜덤 버튼 추가
  - 주사위 아이콘(🎲) + 흔들림 애니메이션
  - 6개 이상 탈것: 가로 직사각형, 그 외: 정사각형
  - 현재 선택한 말 제외하고 랜덤 선택 (취소 방지)
  - grid.insertBefore()로 맨 앞 배치

### [경주 중 점프 기능]
- js/horse-race.js:1319-1330: 탈것 생성 시 클릭 이벤트 추가
  - isRaceActive 체크, 내 탈것만 반응
  - 'jumping' 클래스 추가/제거 (0.4초 후)
- css/horse-race.css:1517-1526: vehicleJump keyframes
  - translateY(-25px) 점프 애니메이션

### [선택된 탈것 춤 애니메이션]
- js/horse-race.js:961-974: triggerRandomDance() 함수
  - setTimeout으로 1~2초 랜덤 간격
  - .vehicle-display에 'dancing' 클래스 토글
- css/horse-race.css:1535-1551: selectedDance keyframes
  - translateY + rotate + scale 조합
  - 0.6초 1회 애니메이션

### [비동기 이벤트 순서 버그 수정]
- 문제: 첫 선택 시 horseSelectionReady가 비동기로 전송되어
  horseSelectionUpdated보다 늦게 도착, selectedUsersFromServer 덮어쓰기
- 해결: socket/horse.js 구조 변경
  1. horseIndex 추출 먼저 실행
  2. needsInitialization 플래그로 초기화 여부 저장
  3. 선택 저장 후 horseSelectionUpdated 전송
  4. 그 후 horseSelectionReady 전송 (선택 포함)

========================================

========================================
📋 Summit Log - 2026-02-05 (3)
========================================

## 변경 파일
- horse-race-multiplayer.html: 7954줄 → 370줄 (CSS/JS 외부 분리)
- css/horse-race.css: 새로 생성 (1514줄, 스타일 추출)
- js/horse-race.js: 새로 생성 (6071줄, 로직 추출)
- test-file-separation.js: HTTP 기반 파일 분리 검증 테스트 (12개 테스트)
- test-browser.js: Puppeteer E2E 브라우저 테스트 (20개 테스트)
- test-ranking.js: 순위 계산 검증 테스트 (100회 시뮬레이션)

## 상세 변경 내역

### [파일 분리 리팩토링] (horse-race-multiplayer.html → css/ + js/)
- 목적: 411KB 단일 파일을 관리 가능한 모듈로 분리
- CSS 추출:
  - Lines 14-1526, 1540-1543 → css/horse-race.css
  - @keyframes 애니메이션 포함
- JS 추출:
  - Lines 1873-7920, 7936-7956 → js/horse-race.js
  - let/const → var 변환 (전역 변수 54개)
  - 8-space indentation 제거
- HTML 정리:
  - 인라인 <style>, <script> 제거
  - <link rel="stylesheet" href="/css/horse-race.css"> 추가
  - <script src="/js/horse-race.js"> 추가
  - 370줄로 축소

### [테스트 스크립트 추가]
- test-file-separation.js:
  - HTTP 요청으로 파일 로드 검증
  - 인라인 코드 없음 확인
  - 전역 변수 var 선언 확인
  - 파일 크기 범위 검증
- test-browser.js:
  - Puppeteer로 실제 브라우저 테스트
  - DOM 요소 존재 확인
  - 전역 함수 정의 확인
  - 콘솔/네트워크 에러 확인
  - 반응형 레이아웃 테스트
- test-ranking.js:
  - 서버 순위 시뮬레이션 100회 검증
  - finishJudgedTime 기반 순위 정확성 확인

### [Gap 분석 결과]
- 파일 분리: Match Rate 100%
- Deterministic-Race: Match Rate 85% (Date.now() → frameCount 미구현)

========================================

========================================
📋 Summit Log - 2026-02-05 (2)
========================================

## 변경 파일
- horse-race-multiplayer.html: 다시보기 카운트다운/트랙옵션 추가, 슬로우모션 해제 조건 수정
- socket/rooms.js: 트랙 프리셋 하드코딩 제거, config 파일에서 로드
- config/horse/race.json: short 트랙 500m → 100m 변경

## 상세 변경 내역

### [다시보기 기능 수정] (horse-race-multiplayer.html)
- 문제 1: 다시보기 시 3-2-1-START 카운트다운 없이 바로 출발
- 수정: setTimeout 딜레이 0ms → 4000ms 변경 (line 6602)
- 문제 2: 다시보기 시 trackDistanceMeters 미전달 → 500m 기본값 사용 → 속도 불일치
- 수정: startRaceAnimation에 trackOptions 파라미터 추가 (line 6599-6602)
  - trackDistanceMeters, weatherSchedule, weatherConfig 전달

### [슬로우모션 해제 조건 수정] (horse-race-multiplayer.html)
- 문제: 꼴등 슬로우모션이 결승선 닿아도 안 끝나는 경우 있음
- 기존: loserCameraTarget.finished (왼쪽 끝 통과 시)
- 수정: loserCameraTarget.finishJudged (오른쪽 끝 터치 시)

### [트랙 프리셋 하드코딩 제거] (socket/rooms.js)
- 문제: rooms.js가 `{ short: 500, medium: 700, long: 1000 }` 하드코딩
- config/horse/race.json은 short: 100m인데 클라이언트에 500m 전송됨
- 수정:
  - 파일 상단에 config 로드 추가
  - trackMetersFromConfig 전역 변수로 프리셋 저장
  - 3곳(line 396, 610, 829)에서 하드코딩 → trackMetersFromConfig 사용
  - horseSelectionReady 이벤트에 trackPresets 필드 추가

### [클라이언트 하드코딩 제거] (horse-race-multiplayer.html)
- line 7072: 하드코딩된 trackMeters → trackPresetsFromServer 사용

========================================

========================================
📋 Summit Log - 2026-02-05
========================================

## 변경 파일
- socket/horse.js: 루저 슬로우모션 로직 추가, 도착 판정 개선 (+163줄)
- horse-race-multiplayer.html: 클라이언트 동기화 개선 (+81줄)
- config/horse/race.json: 슬로우모션 설정 조정
- package.json: puppeteer 의존성 추가

## 상세 변경 내역

### [서버에 루저 슬로우모션 로직 추가] (socket/horse.js)
- 기존: 서버에는 leader 슬로우모션만 있고 loser 슬로우모션 없었음
- 문제: 클라이언트는 꼴등 슬로우모션 연출하는데 서버는 안함 → 순위 타이밍 불일치 가능
- 수정:
  - smConf에 loser 설정 추가: `{ triggerDistanceM: 10, factor: 0.4 }`
  - loserSlowMotionTriggered, loserSlowMotionActive, loserCameraTargetIndex 변수 추가
  - 꼴등 직전 말이 결승선 10m 이내일 때 발동
  - 카메라 타겟(꼴등 직전 말)이 완주하면 해제

### [도착 판정 2단계 시스템] (socket/horse.js)
- finishJudged: 말의 오른쪽 끝이 결승선 터치 → 순위 확정
- finished: 말의 왼쪽 끝이 결승선 통과 → 완전 정지
- visualWidth 함수 추가: 탈것별 시각적 너비 반영 (car:50, rocket:60 등)
- 순위는 finishJudgedTime 기준으로 정렬

### [슬로우모션 해제 조건 통일]
- 기존: leader가 currentPos >= finishLine일 때 해제
- 변경: 어떤 말이라도 finishJudged 되면 해제 (클라이언트와 동일)

### [200회 시뮬레이션 검증 완료]
- 서버-클라이언트 시뮬레이션 로직 추출하여 독립 비교 테스트
- 순위 일치율: 100%
- 리더 슬로우모션 타이밍 일치율: 100%
- 루저 슬로우모션 타이밍 일치율: 100% (서버 로직 추가 후)

========================================

========================================
📋 Summit Log - 2026-02-03 (7)
========================================

## 변경 파일
- horse-race-multiplayer.html: 4가지 버그 수정

## 상세 변경 내역

### 버그 1: 다시보기 규칙 완화 (라인 1748, 5984-6010, 6018-6030)
- 원인: 카운트다운 시점에 한 번만 체크하고 고정 → 잠깐 나갔다가 돌아와도 다시보기로 처리됨
- 수정: 카운트다운 중 visibilitychange + focus 리스너 등록
- countdownVisibilityHandler로 탭 복귀 시 missedAtCountdown = false 복구
- 조건 완화: `!missedAtCountdown || (isVisible && hasFocus)` (한번이라도 봤거나 출발 시점에 보면 OK)

### 버그 2: 트랙 변경 즉시 반영 (라인 2235-2252)
- 원인: 버튼 클릭 시 UI만 변경하고 currentTrackLength 변수 미갱신
- 수정: 클릭 시 즉시 currentTrackLength, currentTrackDistanceMeters 갱신 + renderTrackForSelection() 호출

### 버그 3: 꼴등 자동준비 미작동 (라인 6152-6157)
- 원인: horseRaceEnded에서 isReady = false 강제 초기화 → 서버의 readyStateChanged와 충돌
- 수정: isReady 직접 초기화 제거, mySelectedHorse만 초기화 → 서버 이벤트에 위임

### 버그 4: 경기결과 패널 오류 (라인 6128-6132)
- 원인: 클라이언트가 horseRaceHistory.push() + 서버가 horseRaceEnded로 덮어쓰기 → 호스트 중복, 라운드 번호 오류
- 수정: 클라이언트 직접 push 제거, 서버 데이터(horseRaceEnded)만 사용

========================================

========================================
📋 Summit Log - 2026-02-03 (6)
========================================

## 변경 파일
- config/horse/race.json: 기믹 category 필드 추가, 배율/지속시간 조정
- socket/horse.js: 같은 category 연속 방지 로직 추가

## 상세 변경 내역

### 기믹 category 분류 체계 도입
- 각 기믹에 `category` 필드 추가: boost, slow, stop, reverse 4종
- boost: sprint, item_boost, reverse_boost
- slow: slow, wobble
- stop: stop, obstacle, item_trap
- reverse: slip, reverse
- 향후 새 기믹 추가 시 category만 지정하면 연속 방지 자동 적용

### 같은 category 연속 방지 (socket/horse.js ~line 157-167)
- 기믹 생성 루프에서 직전 기믹의 category 추적
- 같은 category가 뽑히면 최대 3회 재뽑기
- boost→boost, stop→stop 등 극단적 연속 기믹 방지

### 배율/지속시간 밸런스 조정
- sprint: [1.3, 2.0] → [1.2, 1.5] (최대 가속 40% 감소)
- item_boost: [1.5, 2.0] → [1.3, 1.6] (최대 가속 25% 감소)
- reverse_boost: [2.0, 3.0] → [1.5, 2.0] (최대 가속 33% 감소)
- obstacle duration: [1000, 3000] → [500, 1500] (최대 정지 50% 감소)
- reverse duration: [2000, 3000] → [1000, 2000] (최대 후진 33% 감소)

========================================

========================================
📋 Summit Log - 2026-02-03 (5)
========================================

## 변경 파일
- horse-race-multiplayer.html: 상세 통계 표시 → 추천 뱃지로 변경

## 상세 변경 내역

### 말 선택 버튼 통계 표시 변경 (renderHorseSelection)
- 기존: 각 탈것 버튼에 "1등 X% | 꼴등 Y%" + "N회 등장" 또는 "기록 없음" 표시
- 변경: 1등 비율이 가장 낮은 탈것 1개에만 빨간색 "추천!" 뱃지 표시
- 목적: 승률 평준화 — 약한 탈것을 추천하여 유저 선택 유도
- 조건: appearance_count >= 5 이상인 탈것만 대상, 없으면 추천 없음
- forEach 루프 직전에 recommendedVehicleId 계산 로직 추가

========================================

========================================
📋 Summit Log - 2026-02-03 (4)
========================================

## 변경 파일
- horse-race-multiplayer.html: 미완주 말 순위 이중 카운팅 버그 수정

## 상세 변경 내역

### 비석 순위 이중 카운팅 수정 (line ~3555)
- 원인: 미완주 말 순위 계산 시 `actualFinishOrder.length + idx`에서 `.push()`로 length가 매 반복 증가하여 이중 카운팅
- 예: 6마리 중 4완주 2미완주 시 → 2번째 미완주가 "7등"으로 표시
- 수정: 루프 전 `baseFinishOrder = actualFinishOrder.length` 캐싱 후 `baseFinishOrder + idx` 사용

========================================

========================================
📋 Summit Log - 2026-02-03 (3)
========================================

## 변경 파일
- horse-race-multiplayer.html: 놓친 경주 다시보기 스포일러 방지, 트랙 길이 변경 즉시 반영

## 상세 변경 내역

### 놓친 경주 다시보기 결과 스포일러 방지
- 원인: 서버가 12초 타이머로 결과 채팅 메시지(isHorseRaceWinner)를 전송, 화면 안 봐도 도착
- 수정: pendingRaceResultMessages 큐 추가
- ChatModule.init에 messageFilter 옵션 추가: missedHorseRace && isHorseRaceWinner 메시지 보관
- replayMissedRace() onComplete에서 보관 메시지 표시
- horseSelectionReady에서 다시보기 안 하고 넘어간 경우 보관 메시지 즉시 표시

### 트랙 길이 변경 즉시 반영
- trackLengthChanged 이벤트에서 renderHorseSelection() 호출 추가
- 방장이 트랙 길이 바꾸면 비호스트 유저 UI 즉시 갱신

========================================

========================================
📋 Summit Log - 2026-02-03 (2)
========================================

## 변경 파일
- config/horse/race.json: 트랙 거리 300/500/700 → 500/700/1000 변경
- socket/horse.js: 기본 트랙 short→medium, trackPresets 정보를 클라이언트에 전송
- horse-race-multiplayer.html: 클라이언트-서버 속도 동기화 개선, 트랙 거리 UI 동적 생성

## 상세 변경 내역

### 트랙 거리 변경
- race.json: short 500m, medium 700m, long 1000m
- 서버/클라이언트 기본값 'short' → 'medium' (500m 기본)
- 클라이언트 하드코딩된 fallback 300 → 500으로 변경 (4곳)

### 트랙 거리 UI config 연동
- 서버가 TRACK_PRESETS의 meters 값을 horseSelectionReady, trackLengthChanged 이벤트에 포함
- 클라이언트 trackPresetsFromServer 변수로 수신, 버튼 텍스트 동적 생성
- config만 변경하면 클라이언트 코드 수정 없이 거리 반영

### 비호스트 트랙 거리 표시 개선
- 기존: 작은 회색 텍스트 "트랙: 500m"
- 변경: 배지 스타일 (🏁 + 파란색 강조 + 배경 그라데이션)

### 클라이언트-서버 속도 동기화 개선
- 미사용 pseudoRandom 코드 제거 (9301/49297 상수)
- state.simElapsed 추가: 서버와 동일한 16ms 고정 스텝으로 속도 변동 interval 계산
- lerp 보간 프레임 독립화: speedDiff * 0.05 → speedDiff * (1 - 0.95^(deltaTime/16))

========================================

========================================
📋 Summit Log - 2026-02-03
========================================

## 변경 파일
- db/init.js: vehicle_stats 테이블 CREATE TABLE 추가
- db/vehicle-stats.js (신규): 탈것 통계 CRUD 모듈 (DB + 파일 fallback)
- socket/horse.js: 경기 종료 시 통계 저장 호출, horseSelectionReady에 인기말 데이터 추가
- horse-race-multiplayer.html: popularVehicles 변수 추가, 말 선택 버튼에 "인기" 뱃지 표시
- config/horse/race.json: 기믹 설정 조정
- update-log.txt: 업데이트 내역 추가

## 상세 변경 내역

### [탈것 통계 DB 저장 시스템]
- vehicle_stats 테이블: server_id, vehicle_id, appearance_count, pick_count, rank_1~rank_6
- UPSERT 방식으로 경기마다 집계 누적
- PostgreSQL 사용 불가 시 config/vehicle-stats.json 파일 fallback
- db/menus.js의 DB+파일 병행 패턴 참고하여 동일 구조 적용

### [경기 종료 시 저장]
- socket/horse.js 2개 코드 경로에 recordVehicleRaceResult() 호출 추가
  - 메인 경주 경로 (타이머 기반 결과 처리)
  - 자동 준비 경주 경로 (allSelected 기반)
- rankings, selectedVehicleTypes, userHorseBets 데이터로 각 탈것의 등장/순위/선택 집계

### [인기말 표시]
- horseSelectionReady 이벤트 3곳에 popularVehicles 배열 추가 전송
- getPopularVehicles(): pick_rate(선택률) 상위 2개, 최소 등장 5회 이상 조건
- 클라이언트: 말 선택 버튼에 주황색 "인기" 뱃지 표시

### [BGM 변경]
- assets/sounds/horse-race/back_bgm.mp3 삭제
- assets/sounds/horse-race/bgm.mp3 변경

========================================

